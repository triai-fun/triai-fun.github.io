"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4521],{89522:function(e,o,n){n.d(o,{Z:function(){return u}});var t=n(12249),r=n(5853),a=n(68031),d=n(59201),i=n(8113),l=n(344),s=n(63671);class u extends s.bQ{async loginWallet(e){var o;let n=new d.M,t=new l.M2y(this.buildConfigure(n)),r=new a.zv(await t.loginByWallet({walletLoginRequestVO:{walletAddress:e.walletAddress,signature:e.signature,timestamp:e.timestamp.toString()}},{signal:null===(o=e.abortController)||void 0===o?void 0:o.signal}));return r.hasError()||n.afterHandler(r.response,{url:"/login",data:e}),r}async getUserInfo(e){var o;let n=new Headers;e.Authorization&&n.set("Authorization",e.Authorization),delete e.Authorization;let t=new l.M2y(this.buildConfigure());return new a.zv(await t.getUserInfo({signal:null===(o=e.abortController)||void 0===o?void 0:o.signal,headers:n}))}async uploadFile(e){var o;let n=new FormData;n.append("file",e.file);let t=new l.M2y(this.buildConfigure()),r=await t.upload({file:e.file},{signal:null===(o=e.abortController)||void 0===o?void 0:o.signal,body:n});return new a.zv(r)}async addNFTInfo(e){var o;e.Authorization,delete e.Authorization;let n=new l.lG6(this.buildConfigure());return new a.zv(await n.uploadHash({uploadHashRequestVO:e},{signal:null===(o=e.abortController)||void 0===o?void 0:o.signal}))}constructor(e=new d.Z){super(),(0,t._)(this,"httpRequest",void 0),this.httpRequest=e}}u=(0,r.gn)([i.ZP.Singleton,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof HttpRequest?Object:HttpRequest])],u)},14931:function(e,o,n){n.d(o,{Z:function(){return D}});var t=n(6178),r=n(72917),a=n(71549),d=n(21707),i=n(10433),l=n(95665),s=n(89769),u=n(81939),c=n(68651),v=n(2265),f=n(83123),w=n(43949),R=n(344),I=n(22928),m=n(68031),p=n(89522),g=n(20605),h=n(74439),y=n(64798),C=n.n(y);function D(e,o){let{t:n}=(0,w.$G)(["dao"]),y=(0,t.T)(),D=(0,t.C)(e=>e.global),Z=(0,t.C)(e=>e.dao),k=(0,t.C)(e=>e.user);(0,r.Z)(e);let T=new I.Z,A=new p.Z,[L,E]=v.useState(0),[S,N]=v.useState(!1);async function F(e){var o;if(!(e=null!=e?e:null===(o=Z.nodeListFilters.selectedDao)||void 0===o?void 0:o.address))throw Error("No dao address");let n=await T.getRankSimpleInfo(e);return y(l.Z.slice.actions.updateSimpleRankInfo({luckyUsers:n.luckyRecords.map(e=>e.userAddress),voteUsers:n.voteAddresses,prevVoteUsers:n.prevVoteAddresses,voteWithdrawed:n.voteWithdrawed,nodeUsers:n.nodeAddresses,prevNodeUsers:n.prevNodeAddresses,nodeWithdrawed:n.nodeWithdrawed})),n}function b(e,o){var n,t,r,a,d,i,l,s;let v=new c.Z(u.Z.wei2eth(null!==(t=null===(n=Z.daoCurrentRoundInfo)||void 0===n?void 0:n.pool.luckyPool)&&void 0!==t?t:0n));switch(null==(o=null!=o?o:Z.rankInfo.luckyUsers)||o.length,e){case 0:return new c.Z(0);case 1:return v.multipliedBy(null!==(a=null===(r=Z.daoContractInfo)||void 0===r?void 0:r.firstLuckyRewardRate)&&void 0!==a?a:.6);case 2:return v.multipliedBy(null!==(i=null===(d=Z.daoContractInfo)||void 0===d?void 0:d.secondLuckyRewardRate)&&void 0!==i?i:.3);default:return v.multipliedBy(null!==(s=null===(l=Z.daoContractInfo)||void 0===l?void 0:l.thirdLuckyRewardRate)&&void 0!==s?s:.1).div(31)}}function U(e,o){let n=new c.Z(u.Z.wei2eth(e));return e=>{var t,r,a,d,i,l;if(o[e-1])return new c.Z(0);switch(e){case 0:default:return new c.Z(0);case 1:return n.multipliedBy(null!==(r=null===(t=Z.daoContractInfo)||void 0===t?void 0:t.firstPlaceRewardRate)&&void 0!==r?r:.6);case 2:return n.multipliedBy(null!==(d=null===(a=Z.daoContractInfo)||void 0===a?void 0:a.secondPlaceRewardRate)&&void 0!==d?d:.3);case 3:return n.multipliedBy(null!==(l=null===(i=Z.daoContractInfo)||void 0===i?void 0:i.thirdPlaceRewardRate)&&void 0!==l?l:.1)}}}function P(){var e,o,n,t,r;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"currnet",d=null!==(t="currnet"===a?null===(e=Z.daoCurrentRoundInfo)||void 0===e?void 0:e.pool.voteRankPool:null===(o=Z.daoContractInfo)||void 0===o?void 0:o.top3VotedPoolPre)&&void 0!==t?t:0n;return new c.Z(d.toString()).multipliedBy(null!==(r=null===(n=Z.daoContractInfo)||void 0===n?void 0:n.voteRankRewardRate)&&void 0!==r?r:0)}function M(){var e,o,n,t,r;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"currnet",d=null!==(t="currnet"===a?null===(e=Z.daoCurrentRoundInfo)||void 0===e?void 0:e.pool.communityPool:null===(o=Z.daoContractInfo)||void 0===o?void 0:o.top3NodePoolPre)&&void 0!==t?t:0n;return new c.Z(d.toString()).multipliedBy(null!==(r=null===(n=Z.daoContractInfo)||void 0===n?void 0:n.communityRewardRate)&&void 0!==r?r:0)}function O(e,o){var n,t;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"currnet";e=null!=e?e:Z.rankInfo.prevVoteUsers,o=null!==(n=null!=o?o:Z.rankInfo.voteWithdrawed)&&void 0!==n?n:[];let a=P(r);return null!==(t=null==e?void 0:e.map((e,o)=>o+1).map((n,t)=>{let d=U(BigInt(a.toFixed(0)),"pre"===r?o:[])(n);return{rank:n,address:e[t],reward:d}}))&&void 0!==t?t:[]}function V(e,o){var n,t;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"currnet";e=null!=e?e:Z.rankInfo.prevNodeUsers,o=null!==(n=null!=o?o:Z.rankInfo.nodeWithdrawed)&&void 0!==n?n:[];let a=M(r);return null!==(t=null==e?void 0:e.map((e,o)=>o+1).map((n,t)=>{let d=U(BigInt(a.toFixed(0)),"pre"===r?o:[])(n);return{rank:n,address:e[t],reward:d}}))&&void 0!==t?t:[]}async function W(o,n){var t,r,i,l;if(!(n=null!==(i=null!=n?n:e)&&void 0!==i?i:null===(t=Z.nodeListFilters.selectedDao)||void 0===t?void 0:t.address))throw Error("No dao address");if(o=null!==(l=null!=o?o:null===(r=Z.rankInfo)||void 0===r?void 0:r.luckyUsers)&&void 0!==l?l:[],!Z.daoContractInfo)throw Error("No current round no");let s=Z.daoContractInfo.currentRoundNO,u=I.Z.buildGetUserRankDetailInfo(o,n,s),c=a.Q.getDefaultProvider(),v=new d.z(a.Q.getTargetNet().chainId,c),f=await v.all(u.calls);return I.Z.analyzeUserDetailInfo(f,u.singleUserCallCount,u.userAddresses)}function x(e,o){return e.map((e,n)=>{let t=n+1;return{rank:t,address:e.userAddress,votes:Number(u.Z.wei2eth(e.voteInfo.votedAmount)),beVotes:0,reward:o(t)}})}async function B(e){let o=Date.now();if((!(o-L<6e4)||!Z.rankInfo.luckyRank||!(Z.rankInfo.luckyRank.length>0))&&!S)try{var n,t,r,a,d;if(N(!0),!(e=null!=e?e:null===(n=Z.nodeListFilters.selectedDao)||void 0===n?void 0:n.address))throw Error("No dao address");if(!Z.daoContractInfo)throw Error("No dao contract info");if(!Z.daoCurrentRoundInfo)throw Error("No current round info");let i=Z.daoContractInfo.currentRoundNO,s=await F(e);D.token&&k.ethInfo.walletAddress&&z(s.nodeWithdrawed);let c=await T.getRankInfo({daoAddress:e,voteAddresses:s.voteAddresses,nodeAddresses:s.nodeAddresses,userAddress:k.ethInfo.walletAddress,currentRoundNO:i}),v=s.luckyRecords.map(e=>e.userAddress),f=s.luckyRecords.map((e,o)=>({rank:o+1,address:e.userAddress,votes:Number(e.votedAmount),beVotes:0,reward:b(o+1,v).toNumber()})),w=P(),R=(t=c.voteData,r=e=>U(BigInt(w.toFixed(0)),[])(e).toNumber(),x(t,r).map((e,o)=>{let n=Number(u.Z.wei2eth(t[o].promotionInfo.sonVotedAmountToday));return{...e,beVotes:n}})),I=M(),m=(a=c.nodeData,d=e=>U(BigInt(I.toFixed(0)),[])(e).toNumber(),x(a,d).map((e,o)=>{let n=Number(u.Z.wei2eth(a[o].promotionInfo.sonVotedAmountWeek));return{...e,beVotes:n}}));y(l.Z.slice.actions.updateDetailRankInfo({luckyRank:f,voteRank:R,nodeRank:m})),E(o)}catch(e){i.Z.E("useDAORankInfo::updateRankInfo error",e)}finally{N(!1)}}async function _(){y(l.Z.slice.actions.clearRankInfo()),y(l.Z.slice.actions.clearUserRankInfo())}async function z(e){var o,t,r,a,d,u;let c=null===(o=Z.nodeListFilters.selectedDao)||void 0===o?void 0:o.address,v=k.ethInfo.walletAddress;if(!c)throw Error(n("NoSelectedDao"));if(!v)throw Error(n("Can't found user address"));new I.Z;let w=new R.q$p(A.buildConfigure()),p=await w.getMyRank({daoAddress:c}),g=new m.zv(p);if(g.hasError()){let e=g.getError();(0,f.L6)(e.msg),i.Z.E(e)}let h=null!==(a=g.getData().daoMyRankList)&&void 0!==a?a:[],C=I.z.DAOUserRankInfoAdapter.getFactory(v),D=h.map(C).map(e=>e.toJSON());y(l.Z.slice.actions.updateUserRankInfo(D));let T=new Map(D.map(e=>[e.rewardType,e.rank]));y(l.Z.slice.actions.updateUserRankRewardInfo([[s.r.RankRewardType.LUCKY_REWARD,b(T.get(s.r.RankRewardType.LUCKY_REWARD)).toNumber()],[s.r.RankRewardType.VOTE_TOP_REWARD,U(null!==(d=null===(t=Z.daoContractInfo)||void 0===t?void 0:t.top3NodePoolPre)&&void 0!==d?d:0n,e)(T.get(s.r.RankRewardType.VOTE_TOP_REWARD)).toNumber()],[s.r.RankRewardType.NODE_TOP_REWARD,U(null!==(u=null===(r=Z.daoContractInfo)||void 0===r?void 0:r.top3NodePoolPre)&&void 0!==u?u:0n,e)(T.get(s.r.RankRewardType.NODE_TOP_REWARD)).toNumber()]]))}return v.useEffect(()=>{var e;if(!(null==o?void 0:o.autoTrigger))return;if(!(null===(e=Z.nodeListFilters.selectedDao)||void 0===e?void 0:e.address)||!Z.daoCurrentRoundInfo){_();return}let t=C()(()=>{B().catch(e=>{(0,f.L6)(new f.HU(e,n("GetRankDataFailed")).asToastMessage()),i.Z.E("updateRankInfo",e)})},1e3),r=h.Z.sleepForAnimationFrame(200);r.wait(()=>t());let a=setInterval(()=>{"visible"===document.visibilityState&&t()},6e4);return()=>{r.cancel(g.Z.ReactError.useEffectDestroy()),clearInterval(a),t.cancel(),_()}},[Z.daoCurrentRoundInfo,D.token,k.ethInfo.walletAddress]),{updateRankSimpleInfo:F,updateUserRankInfo:z,calcLuckyRewardInLocal:b,getLuckyRewardInLocal:function(e){var o;return null!==(o=null==(e=null!=e?e:Z.rankInfo.luckyUsers)?void 0:e.map((e,o)=>o+1).map((o,n)=>({rank:o,address:e[n],reward:b(o,e)})))&&void 0!==o?o:[]},getUserLuckyRewardInLocal:function(e,o){var n,t;e=null!=e?e:k.ethInfo.walletAddress;let r=null!==(t=(o=null!==(n=null!=o?o:Z.rankInfo.luckyUsers)&&void 0!==n?n:[]).indexOf(e))&&void 0!==t?t:-1;return b(-1===r?4:r+1,o)},calcTop3RewardInLocal:U,getVoteTop3Rawards:O,getUserVoteTopReward:function(e,o){var n,t;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"currnet";return e=null!=e?e:k.ethInfo.walletAddress,(null!==(t=O(void 0,o=null!==(n=null!=o?o:Z.rankInfo.voteWithdrawed)&&void 0!==n?n:[],r).find(o=>o.address===e))&&void 0!==t?t:{reward:new c.Z(0)}).reward},getNodeTop3Rawards:V,getUserNodeTopReward:function(e,o){var n,t;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"currnet";return e=null!=e?e:k.ethInfo.walletAddress,(null!==(t=V(void 0,o=null!==(n=null!=o?o:Z.rankInfo.nodeWithdrawed)&&void 0!==n?n:[],r).find(o=>o.address===e))&&void 0!==t?t:{reward:new c.Z(0)}).reward},getLastInvestorsDetailInfo:W,updateRankInfo:B,clearRankInfo:_}}},94521:function(e,o,n){n.d(o,{Z:function(){return Z}});var t=n(2265),r=n(72917),a=n(68651),d=n(43009),i=n(6178),l=n(74439),s=n(43949),u=n(81939),c=n(83123),v=n(13965),f=n(20151),w=n(10433),R=n(14931),I=n(20605),m=n(22928),p=n(95665),g=n(344),h=n(68031),y=n(64798),C=n.n(y),D=n(35178);function Z(){var e,o,n,y,Z,k,T,A,L,E,S,N,F,b,U,P,M,O,V,W,x,B,_,z,H,q,G,$,J,Q,K,Y,j,X,ee,eo,en,et,er,ea,ed,ei,el,es,eu,ec,ev,ef,ew,eR,eI,em,ep,eg,eh,ey;let eC=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},eD=(0,i.T)(),{t:eZ}=(0,s.$G)(["dao"]),ek=(0,i.C)(e=>e.global),eT=(0,i.C)(e=>e.dao),eA=(0,i.C)(e=>e.user),eL=(0,r.Z)(),eE=null!==(Y=null==eC?void 0:eC.autoTrigger)&&void 0!==Y&&Y,eS=(0,R.Z)(void 0,{autoTrigger:eE}),[eN,eF]=t.useState(0),[eb,eU]=t.useState(0),[eP,eM]=t.useState(!1),[eO,eV]=t.useState(!1),[eW,ex]=t.useState(!1),eB=null!==(j=null===(e=eT.daoContractInfo)||void 0===e?void 0:e.voteRankClaimDurationAdd)&&void 0!==j?j:0,e_=null!==(X=null===(o=eT.daoContractInfo)||void 0===o?void 0:o.createTime)&&void 0!==X?X:0,ez=null!==(ee=null===(n=eT.daoContractInfo)||void 0===n?void 0:n.rewardRoundPass)&&void 0!==ee?ee:0,eH=null!==(eo=null===(y=eT.daoContractInfo)||void 0===y?void 0:y.airdropDurationGetLimit)&&void 0!==eo?eo:0;m.Z.getCurrentRewardRoundTimestamp(e_,eB,ez);let eq=null!==(en=null===(Z=eT.daoCurrentRoundInfo)||void 0===Z?void 0:Z.roundExpire)&&void 0!==en?en:0,eG=null!==(et=null===(k=eT.userInfo)||void 0===k?void 0:k.voteAndAirDropReward.clairReward)&&void 0!==et?et:0n,e$=eN||(null!==(er=null===(T=eT.userInfo)||void 0===T?void 0:T.voteInfo.roundFirstVotedDate)&&void 0!==er?er:0),eJ=eq>0?l.Z.convertTimeDifference(new Date(e$+eH-ek.currentTime),{includeDays:!1}):0,eQ=eG>0n,eK=Math.floor(ek.currentTime/eB)*eB+eB,eY=eT.userRewardInfo.voteTopReward.gt(0)?l.Z.convertTimeDifference(new Date(eK-ek.currentTime),{includeDays:!1}):0,ej=eT.userRewardInfo.voteTopReward.gt(0),eX=null!==(ea=null===(A=eT.daoContractInfo)||void 0===A?void 0:A.communityDuration)&&void 0!==ea?ea:0,e0=Math.floor((null!==(ed=null===(L=eT.daoContractInfo)||void 0===L?void 0:L.top3NodeDate)&&void 0!==ed?ed:0)/eX)*eX+(null!==(ei=null===(E=eT.daoContractInfo)||void 0===E?void 0:E.communityDuration)&&void 0!==ei?ei:0);null===(S=eT.daoContractInfo)||void 0===S||S.communityRewardDuration;let e1=eT.userRewardInfo.nodeTopReward.gt(0)?l.Z.convertTimeDifference(new Date(e0-ek.currentTime),{includeDays:!1}):0,e2=eT.userRewardInfo.nodeTopReward.gt(0),e6=l.Z.convertTimeDifference(new Date((null!==(el=null===(N=eT.daoCurrentRoundInfo)||void 0===N?void 0:N.roundExpire)&&void 0!==el?el:0)-ek.currentTime),{includeDays:!1}),e3=l.Z.convertTimeDifference(new Date((null!==(es=null===(F=eT.daoCurrentRoundInfo)||void 0===F?void 0:F.roundExpire)&&void 0!==es?es:0)+(null!==(eu=null===(b=eT.daoContractInfo)||void 0===b?void 0:b.loserPoolRewardTimeLimit)&&void 0!==eu?eu:0)-ek.currentTime),{includeDays:!1}),e4=0===e6&&0!==e3&&eT.userRewardInfo.luckyReward.gt(0)&&(null===(U=eT.userInfo)||void 0===U?void 0:U.voteInfo.isLuckyRewardClaimed)===!1,e9=(null!==(ec=null===(P=eT.daoCurrentRoundInfo)||void 0===P?void 0:P.totalVoteAmount)&&void 0!==ec?ec:0n)-(null!==(ev=null===(M=eT.daoCurrentRoundInfo)||void 0===M?void 0:M.totalEthDone)&&void 0!==ev?ev:0n),e8=(null===(O=eT.userInfo)||void 0===O?void 0:O.voteInfo.isLoserRewardClaimed)?new a.Z(0):new a.Z((null!==(ef=null===(V=eT.userInfo)||void 0===V?void 0:V.voteInfo.votedAmount)&&void 0!==ef?ef:0n).toString()).minus((null!==(ew=null===(W=eT.userInfo)||void 0===W?void 0:W.voteInfo.ethDone)&&void 0!==ew?ew:0n).toString()).div((0n===e9?1n:e9).toString()).multipliedBy((null!==(eR=null===(x=eT.daoCurrentRoundInfo)||void 0===x?void 0:x.pool.loserPool)&&void 0!==eR?eR:0n).toString()),e5=(null===(B=eT.userInfo)||void 0===B?void 0:B.voteInfo.isLoserRewardClaimed)?new a.Z(0):new a.Z((null!==(eI=null===(_=eT.userInfo)||void 0===_?void 0:_.voteInfo.votedAmount)&&void 0!==eI?eI:0n).toString()).minus((null!==(em=null===(z=eT.userInfo)||void 0===z?void 0:z.voteInfo.ethDone)&&void 0!==em?em:0n).toString()).div((0n===e9?1n:e9).toString()).multipliedBy((null!==(ep=null===(H=eT.daoCurrentRoundInfo)||void 0===H?void 0:H.pool.loserPoolETH)&&void 0!==ep?ep:0n).toString()),e7=l.Z.convertTimeDifference(new Date((null!==(eg=null===(q=eT.daoCurrentRoundInfo)||void 0===q?void 0:q.roundExpire)&&void 0!==eg?eg:0)-ek.currentTime),{includeDays:!1}),oe=l.Z.convertTimeDifference(new Date((null!==(eh=null===(G=eT.daoCurrentRoundInfo)||void 0===G?void 0:G.roundExpire)&&void 0!==eh?eh:0)+(null!==(ey=null===($=eT.daoContractInfo)||void 0===$?void 0:$.loserPoolRewardTimeLimit)&&void 0!==ey?ey:0)-ek.currentTime),{includeDays:!1}),oo=0===e7&&0!==oe&&(e8.gt(0)||e5.gt(0)),on=[{title:eZ("DAOReward"),reward:u.Z.wei2eth(eG),hasDetails:!0,countdown:0===eJ?"":eJ.toFormated(),claimable:eQ,handleClaim:ot},{title:eZ("VoteTopReward"),reward:eT.userRewardInfo.voteTopReward.toString(),hasDetails:!1,countdown:0===eY?"":eY.toFormated(),claimable:ej,handleClaim:or},{title:eZ("NodeTopReward"),reward:eT.userRewardInfo.nodeTopReward.toString(),hasDetails:!1,countdown:0===e1?"":e1.toFormated(),claimable:e2,handleClaim:oa},{title:eZ("LuckyReward"),reward:eT.userRewardInfo.luckyReward.toString(),hasDetails:!1,countdown:(null===(J=eT.userInfo)||void 0===J?void 0:J.voteInfo.isLuckyRewardClaimed)?"":0!==e6?e6.toFormated():0!==e3?e3.toFormated():"",claimable:e4,handleClaim:od},{title:eZ("OtherReward"),tokenReward:e8.gt(0)?u.Z.wei2eth(e8.toFixed(0,a.Z.ROUND_DOWN)):"0",hasDetails:!1,countdown:(null===(Q=eT.userInfo)||void 0===Q?void 0:Q.voteInfo.isLoserRewardClaimed)?"":0!==e7?e7.toFormated():0!==oe?oe.toFormated():"",claimable:oo,handleClaim:oi}];async function ot(){var e;let o=null===(e=eT.nodeListFilters.selectedDao)||void 0===e?void 0:e.address;if(!o){(0,c.L6)(eZ("NoSelectedDao"));return}if(!eQ)return;let n=v.r.getInstance(),t=u.Z.getInstance(n.getProvider()),r=f.bR.connect(o,await t.getSigner());try{let e=await r.claimVoteAndAirDropReward();await e.wait(),(0,c.x9)(eZ("ClaimVoteAndAirDropRewardSuccess"));let o=Date.now();eF(o),eV(!0),eT.userInfo&&eD(p.Z.slice.actions.updateUserInfo({...eT.userInfo,voteAndAirDropReward:{...eT.userInfo.voteAndAirDropReward,clairReward:0n}})),await ol(),setTimeout(()=>{eV(!1)},5e3)}catch(e){(0,c.L6)(new c.HU(e,eZ("ClaimVoteAndAirDropRewardFailed")).asToastMessage()),w.Z.E(e)}}async function or(){var e,o;if(!(null===(e=eT.nodeListFilters.selectedDao)||void 0===e?void 0:e.address)){(0,c.L6)(eZ("NoSelectedDao"));return}eD(p.Z.slice.actions.updateUserRewardInfo({...eT.userRewardInfo,voteTopReward:new a.Z(0)}));let n=v.r.getInstance(),t=u.Z.getInstance(n.getProvider()),r=f.bR.connect(null===(o=eT.nodeListFilters.selectedDao)||void 0===o?void 0:o.address,await t.getSigner());try{let e=await r.claimTop3VotedReward();await e.wait(),(0,c.x9)(eZ("ClaimNodeTopRewardSuccess")),await ol()}catch(e){eD(p.Z.slice.actions.updateUserRewardInfo({...eT.userRewardInfo,voteTopReward:eT.userRewardInfo.voteTopReward})),(0,c.L6)(new c.HU(e,eZ("ClaimNodeTopRewardFailed")).asToastMessage()),w.Z.E(e)}}async function oa(){var e,o;if(!(null===(e=eT.nodeListFilters.selectedDao)||void 0===e?void 0:e.address))return(0,c.L6)(eZ("NoSelectedDao"));eD(p.Z.slice.actions.updateUserRewardInfo({...eT.userRewardInfo,nodeTopReward:new a.Z(0)}));let n=v.r.getInstance(),t=u.Z.getInstance(n.getProvider()),r=f.bR.connect(null===(o=eT.nodeListFilters.selectedDao)||void 0===o?void 0:o.address,await t.getSigner());try{let e=await r.claimTop3NodeReward();await e.wait(),(0,c.x9)(eZ("ClaimNodeTopRewardSuccess")),await ol()}catch(e){eD(p.Z.slice.actions.updateUserRewardInfo({...eT.userRewardInfo,nodeTopReward:eT.userRewardInfo.nodeTopReward})),(0,c.L6)(new c.HU(e,eZ("ClaimNodeTopRewardFailed")).asToastMessage()),w.Z.E(e)}}async function od(){var e,o;if(!(null===(e=eT.nodeListFilters.selectedDao)||void 0===e?void 0:e.address))return(0,c.L6)(eZ("NoSelectedDao"));eT.userInfo&&eD(p.Z.slice.actions.updateUserInfo({...eT.userInfo,voteInfo:{...eT.userInfo.voteInfo,isLuckyRewardClaimed:!0}}));let n=v.r.getInstance(),t=u.Z.getInstance(n.getProvider()),r=f.bR.connect(null===(o=eT.nodeListFilters.selectedDao)||void 0===o?void 0:o.address,await t.getSigner());try{let e=await r.claimLuckyReward();await e.wait(),(0,c.x9)(eZ("ClaimLuckyRewardSuccess")),await ol()}catch(e){eT.userInfo&&eD(p.Z.slice.actions.updateUserInfo({...eT.userInfo,voteInfo:{...eT.userInfo.voteInfo,isLuckyRewardClaimed:!1}})),(0,c.L6)(new c.HU(e,eZ("ClaimLuckyRewardFailed")).asToastMessage()),w.Z.E(e)}}async function oi(){var e,o;if(!(null===(e=eT.nodeListFilters.selectedDao)||void 0===e?void 0:e.address))return(0,c.L6)(eZ("NoSelectedDao"));eT.userInfo&&eD(p.Z.slice.actions.updateUserInfo({...eT.userInfo,voteInfo:{...eT.userInfo.voteInfo,isLoserRewardClaimed:!0}}));let n=v.r.getInstance(),t=u.Z.getInstance(n.getProvider()),r=f.bR.connect(null===(o=eT.nodeListFilters.selectedDao)||void 0===o?void 0:o.address,await t.getSigner());try{let e=await r.claimLoserReward();await e.wait(),(0,c.x9)(eZ("ClaimOtherRewardSuccess")),await ol()}catch(e){eT.userInfo&&eD(p.Z.slice.actions.updateUserInfo({...eT.userInfo,voteInfo:{...eT.userInfo.voteInfo,isLoserRewardClaimed:!1}})),(0,c.L6)(new c.HU(e,eZ("ClaimOtherRewardFailed")).asToastMessage()),w.Z.E(e)}}async function ol(){var e;let o=null===(e=eT.nodeListFilters.selectedDao)||void 0===e?void 0:e.address;if(o)try{eM(!0),ex(!0),eD(D.Z.slice.actions.updateTime(Date.now())),await new Promise(e=>setTimeout(e,2e3)),await Promise.all([eL.updateInfo(),eS.updateRankSimpleInfo(o),os(o),oc(o)]),await oR(o),eC.handleAfterClaim&&await eC.handleAfterClaim()}catch(e){w.Z.E("Error in handleAfterClaim:",e)}finally{eM(!1),ex(!1)}}async function os(e){var o;let n=Date.now();if(!eW&&n-eb<6e4||eP)return;let t=new m.Z;if(!(e=null!=e?e:null===(o=eT.nodeListFilters.selectedDao)||void 0===o?void 0:o.address)){(0,c.L6)(eZ("NoSelectedDao"));return}try{eM(!0);let o=await t.getUserVoteNodeRankReward({userAddress:eA.ethInfo.walletAddress,daoAddress:e});eD(p.Z.slice.actions.updateUserRewardInfo({luckyReward:new a.Z(u.Z.wei2eth(o.luckyReward.reward)),voteTopReward:new a.Z(u.Z.wei2eth(o.voteTopReward.reward)),nodeTopReward:new a.Z(u.Z.wei2eth(o.nodeTopReward.reward))})),eU(n)}catch(e){(0,c.L6)(new c.HU(e,eZ("GetUserVoteNodeRankRewardFailed")).asToastMessage()),w.Z.E(e)}finally{eM(!1)}}let ou=t.useCallback(C()(e=>{var o;if(null===(o=eT.daoContractInfo)||void 0===o?void 0:o.daoAddress)return os(eT.daoContractInfo.daoAddress)},800),[eT.daoContractInfo,eA.ethInfo.walletAddress]);async function oc(e){if(eO)return;let o=new m.Z,n=new g.q$p(o.buildConfigure()),t=await n.getLastClaimTime({daoAddress:e}),r=new h.zv(t);if(r.hasError()){let e=r.getError();(0,c.L6)(new c.HU(e,eZ("GetLastClaimTimeFailed")).asToastMessage()),w.Z.E(e);return}let a=d.Z.Time.fromTimestamp(r.getData());eO||a.toJSTime()===eN||eF(a.toJSTime())}function ov(e,o){let n=Number("120");return new a.Z(u.Z.wei2eth(e)).multipliedBy(n).div(100).minus(u.Z.wei2eth(o))}t.useEffect(()=>{if(!eE||!eT.daoContractInfo||!eA.ethInfo.walletAddress)return;let e=l.Z.sleepForAnimationFrame(300);e.wait(()=>{ou()});let o=setInterval(()=>{"visible"===document.visibilityState&&ou()},6e4);return()=>{e.cancel(I.Z.ReactError.useEffectDestroy()),clearInterval(o)}},[eT.daoContractInfo,eA.ethInfo.walletAddress,eE,ou]);let of=t.useCallback(C()(e=>{oc(e)},500),[]);async function ow(){var e;let o=null===(e=eT.nodeListFilters.selectedDao)||void 0===e?void 0:e.address;if(o&&eA.ethInfo.walletAddress)try{eM(!0),ex(!0),await Promise.all([eL.updateInfo(),eS.updateRankSimpleInfo(o),os(o),oc(o)]),await oR(o),eU(Date.now()),ex(!1)}catch(e){w.Z.E("Error in refreshAllData:",e)}finally{eM(!1)}}async function oR(e){try{let o=v.r.getInstance(),n=u.Z.getInstance(o.getProvider()),t=f.bR.connect(e,await n.getSigner()),r=eA.ethInfo.walletAddress;if(!r)return;let a=await t.getVoteAndAirDropReward(r);if(eT.userInfo){let e={...eT.userInfo,voteAndAirDropReward:{...eT.userInfo.voteAndAirDropReward,clairReward:a.clairReward,airdropReward:a.airdropReward,nodeReward:a.nodeReward,airdropLinkReward:a.airdropLinkReward,reinvestReward:a.reinvestReward}};eD(p.Z.slice.actions.updateUserInfo(e))}}catch(e){w.Z.E("Error checking reward claim status:",e)}}return t.useEffect(()=>{var e;if((null===(e=eT.nodeListFilters.selectedDao)||void 0===e?void 0:e.address)&&ek.token)return of(eT.nodeListFilters.selectedDao.address),()=>{of.cancel()}},[null===(K=eT.nodeListFilters.selectedDao)||void 0===K?void 0:K.address,ek.token,of]),t.useEffect(()=>{eW&&eE&&ow()},[eW,eE]),{rewardItems:on,handleVoteAirdropClaim:ot,handleVoteRankClaim:or,handleNodeRankClaim:oa,handleLuckyClaim:od,handleOtherClaim:oi,estimatePendingReward:ov,estimateUserPendingReward:function(){var e,o,n,t;return ov(null!==(n=null===(e=eT.userInfo)||void 0===e?void 0:e.voteInfo.votedAmount)&&void 0!==n?n:0n,null!==(t=null===(o=eT.userInfo)||void 0===o?void 0:o.voteInfo.ethDone)&&void 0!==t?t:0n)},getClaimNodeRewardCountdown:function(){if(!eT.daoContractInfo)return"";let e=Math.floor(ek.currentTime/1e3),o=86400*Math.floor(Math.floor(e_/1e3)/86400),n=o+604800*Math.floor((e-o)/604800)+604800-e;if(n<=0)return"00:00:00";let t=Math.floor(n/3600).toString().padStart(2,"0"),r=Math.floor(n%3600/60).toString().padStart(2,"0"),a=Math.floor(n%60).toString().padStart(2,"0");return"".concat(t,":").concat(r,":").concat(a)},refreshAllData:ow,isUpdating:eP}}}}]);