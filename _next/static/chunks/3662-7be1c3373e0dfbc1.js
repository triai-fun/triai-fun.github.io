"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3662],{89522:function(e,o,t){t.d(o,{Z:function(){return u}});var n=t(63995),r=t(5853),a=t(68031),d=t(59201),i=t(8113),l=t(344),s=t(63671);class u extends s.bQ{async loginWallet(e){var o;let t=new d.M,n=new l.M2y(this.buildConfigure(t)),r=new a.zv(await n.loginByWallet({walletLoginRequestVO:{walletAddress:e.walletAddress,signature:e.signature,timestamp:e.timestamp.toString()}},{signal:null===(o=e.abortController)||void 0===o?void 0:o.signal}));return r.hasError()||t.afterHandler(r.response,{url:"/login",data:e}),r}async getUserInfo(e){var o;let t=new Headers;e.Authorization&&t.set("Authorization",e.Authorization),delete e.Authorization;let n=new l.M2y(this.buildConfigure());return new a.zv(await n.getUserInfo({signal:null===(o=e.abortController)||void 0===o?void 0:o.signal,headers:t}))}async uploadFile(e){var o;let t=new FormData;t.append("file",e.file);let n=new l.M2y(this.buildConfigure()),r=await n.upload({file:e.file},{signal:null===(o=e.abortController)||void 0===o?void 0:o.signal,body:t});return new a.zv(r)}async addNFTInfo(e){var o;e.Authorization,delete e.Authorization;let t=new l.lG6(this.buildConfigure());return new a.zv(await t.uploadHash({uploadHashRequestVO:e},{signal:null===(o=e.abortController)||void 0===o?void 0:o.signal}))}constructor(e=new d.Z){super(),(0,n._)(this,"httpRequest",void 0),this.httpRequest=e}}u=(0,r.gn)([i.ZP.Singleton,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof HttpRequest?Object:HttpRequest])],u)},12628:function(e,o,t){t.d(o,{Z:function(){return u}});var n=t(57437),r=t(32223),a=t(43949),d=t(89769),i=t(99376),l=t(53335),s=t(95665);function u(e){let o=(0,i.useRouter)(),{t}=(0,a.$G)(["dao"]),u=[{title:t("TabVote"),url:"/dao/node",target:d.r.VotingTabEnum.VOTE},{title:t("TabEWV"),url:"/dao/ewv",target:d.r.VotingTabEnum.EWV},{title:t("TabNode"),url:"/dao/user",target:d.r.VotingTabEnum.NODE}];return(0,n.jsx)("div",{className:"flex flex-col items-stretch md:items-center",children:(0,n.jsx)(r.Z,{className:(0,l.m6)("mb-10",e.className),tabItemClassName:()=>"w-[33%] md:w-[180px]",tabItemTitleClassName:()=>"w-full",displayType:r.L.BgGradient,activeIndex:u.findIndex(o=>o.target===e.activeTarget),tabList:u,onClick:e=>{let t=new URLSearchParams(location.search);if(!t.has(s.Z.Params.DAO_ADDRESS))return o.push(e);let n=new URL(e,location.origin),r=new URLSearchParams(n.search);r.set(s.Z.Params.DAO_ADDRESS,t.get(s.Z.Params.DAO_ADDRESS)),n.search=r.toString(),o.push("".concat(n.origin).concat(n.pathname,"?").concat(r.toString()))}})})}},14931:function(e,o,t){t.d(o,{Z:function(){return D}});var n=t(6178),r=t(72917),a=t(3682),d=t(21707),i=t(10433),l=t(95665),s=t(89769),u=t(81939),c=t(68651),v=t(2265),f=t(83123),w=t(43949),I=t(344),p=t(22928),R=t(68031),m=t(89522),g=t(20605),h=t(74439),C=t(64798),y=t.n(C);function D(e,o){let{t}=(0,w.$G)(["dao"]),C=(0,n.T)(),D=(0,n.C)(e=>e.global),T=(0,n.C)(e=>e.dao),A=(0,n.C)(e=>e.user);(0,r.Z)(e);let Z=new p.Z,N=new m.Z,[k,E]=v.useState(0),[L,S]=v.useState(!1);async function b(e){var o;if(!(e=null!=e?e:null===(o=T.nodeListFilters.selectedDao)||void 0===o?void 0:o.address))throw Error("No dao address");let t=await Z.getRankSimpleInfo(e);return C(l.Z.slice.actions.updateSimpleRankInfo({luckyUsers:t.luckyRecords.map(e=>e.userAddress),voteUsers:t.voteAddresses,prevVoteUsers:t.prevVoteAddresses,voteWithdrawed:t.voteWithdrawed,nodeUsers:t.nodeAddresses,prevNodeUsers:t.prevNodeAddresses,nodeWithdrawed:t.nodeWithdrawed})),t}function F(e,o){var t,n,r,a,d,i,l,s;let v=new c.Z(u.Z.wei2eth(null!==(n=null===(t=T.daoCurrentRoundInfo)||void 0===t?void 0:t.pool.luckyPool)&&void 0!==n?n:0n));switch(null==(o=null!=o?o:T.rankInfo.luckyUsers)||o.length,e){case 0:return new c.Z(0);case 1:return v.multipliedBy(null!==(a=null===(r=T.daoContractInfo)||void 0===r?void 0:r.firstLuckyRewardRate)&&void 0!==a?a:.6);case 2:return v.multipliedBy(null!==(i=null===(d=T.daoContractInfo)||void 0===d?void 0:d.secondLuckyRewardRate)&&void 0!==i?i:.3);default:return v.multipliedBy(null!==(s=null===(l=T.daoContractInfo)||void 0===l?void 0:l.thirdLuckyRewardRate)&&void 0!==s?s:.1).div(31)}}function U(e,o){let t=new c.Z(u.Z.wei2eth(e));return e=>{var n,r,a,d,i,l;if(o[e-1])return new c.Z(0);switch(e){case 0:default:return new c.Z(0);case 1:return t.multipliedBy(null!==(r=null===(n=T.daoContractInfo)||void 0===n?void 0:n.firstPlaceRewardRate)&&void 0!==r?r:.6);case 2:return t.multipliedBy(null!==(d=null===(a=T.daoContractInfo)||void 0===a?void 0:a.secondPlaceRewardRate)&&void 0!==d?d:.3);case 3:return t.multipliedBy(null!==(l=null===(i=T.daoContractInfo)||void 0===i?void 0:i.thirdPlaceRewardRate)&&void 0!==l?l:.1)}}}function P(){var e,o,t,n,r;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"currnet",d=null!==(n="currnet"===a?null===(e=T.daoCurrentRoundInfo)||void 0===e?void 0:e.pool.voteRankPool:null===(o=T.daoContractInfo)||void 0===o?void 0:o.top3VotedPoolPre)&&void 0!==n?n:0n;return new c.Z(d.toString()).multipliedBy(null!==(r=null===(t=T.daoContractInfo)||void 0===t?void 0:t.voteRankRewardRate)&&void 0!==r?r:0)}function M(){var e,o,t,n,r;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"currnet",d=null!==(n="currnet"===a?null===(e=T.daoCurrentRoundInfo)||void 0===e?void 0:e.pool.communityPool:null===(o=T.daoContractInfo)||void 0===o?void 0:o.top3NodePoolPre)&&void 0!==n?n:0n;return new c.Z(d.toString()).multipliedBy(null!==(r=null===(t=T.daoContractInfo)||void 0===t?void 0:t.communityRewardRate)&&void 0!==r?r:0)}function O(e,o){var t,n;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"currnet";e=null!=e?e:T.rankInfo.prevVoteUsers,o=null!==(t=null!=o?o:T.rankInfo.voteWithdrawed)&&void 0!==t?t:[];let a=P(r);return null!==(n=null==e?void 0:e.map((e,o)=>o+1).map((t,n)=>{let d=U(BigInt(a.toFixed(0)),"pre"===r?o:[])(t);return{rank:t,address:e[n],reward:d}}))&&void 0!==n?n:[]}function V(e,o){var t,n;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"currnet";e=null!=e?e:T.rankInfo.prevNodeUsers,o=null!==(t=null!=o?o:T.rankInfo.nodeWithdrawed)&&void 0!==t?t:[];let a=M(r);return null!==(n=null==e?void 0:e.map((e,o)=>o+1).map((t,n)=>{let d=U(BigInt(a.toFixed(0)),"pre"===r?o:[])(t);return{rank:t,address:e[n],reward:d}}))&&void 0!==n?n:[]}async function x(o,t){var n,r,i,l;if(!(t=null!==(i=null!=t?t:e)&&void 0!==i?i:null===(n=T.nodeListFilters.selectedDao)||void 0===n?void 0:n.address))throw Error("No dao address");if(o=null!==(l=null!=o?o:null===(r=T.rankInfo)||void 0===r?void 0:r.luckyUsers)&&void 0!==l?l:[],!T.daoContractInfo)throw Error("No current round no");let s=T.daoContractInfo.currentRoundNO,u=p.Z.buildGetUserRankDetailInfo(o,t,s),c=a.Q.getDefaultProvider(),v=new d.z(a.Q.getTargetNet().chainId,c),f=await v.all(u.calls);return p.Z.analyzeUserDetailInfo(f,u.singleUserCallCount,u.userAddresses)}function B(e,o){return e.map((e,t)=>{let n=t+1;return{rank:n,address:e.userAddress,votes:Number(u.Z.wei2eth(e.voteInfo.votedAmount)),beVotes:0,reward:o(n)}})}async function W(e){let o=Date.now();if((!(o-k<6e4)||!T.rankInfo.luckyRank||!(T.rankInfo.luckyRank.length>0))&&!L)try{var t,n,r,a,d;if(S(!0),!(e=null!=e?e:null===(t=T.nodeListFilters.selectedDao)||void 0===t?void 0:t.address))throw Error("No dao address");if(!T.daoContractInfo)throw Error("No dao contract info");if(!T.daoCurrentRoundInfo)throw Error("No current round info");let i=T.daoContractInfo.currentRoundNO,s=await b(e);D.token&&A.ethInfo.walletAddress&&z(s.nodeWithdrawed);let c=await Z.getRankInfo({daoAddress:e,voteAddresses:s.voteAddresses,nodeAddresses:s.nodeAddresses,userAddress:A.ethInfo.walletAddress,currentRoundNO:i}),v=s.luckyRecords.map(e=>e.userAddress),f=s.luckyRecords.map((e,o)=>({rank:o+1,address:e.userAddress,votes:Number(e.votedAmount),beVotes:0,reward:F(o+1,v).toNumber()})),w=P(),I=(n=c.voteData,r=e=>U(BigInt(w.toFixed(0)),[])(e).toNumber(),B(n,r).map((e,o)=>{let t=Number(u.Z.wei2eth(n[o].promotionInfo.sonVotedAmountToday));return{...e,beVotes:t}})),p=M(),R=(a=c.nodeData,d=e=>U(BigInt(p.toFixed(0)),[])(e).toNumber(),B(a,d).map((e,o)=>{let t=Number(u.Z.wei2eth(a[o].promotionInfo.sonVotedAmountWeek));return{...e,beVotes:t}}));C(l.Z.slice.actions.updateDetailRankInfo({luckyRank:f,voteRank:I,nodeRank:R})),E(o)}catch(e){i.Z.E("useDAORankInfo::updateRankInfo error",e)}finally{S(!1)}}async function _(){C(l.Z.slice.actions.clearRankInfo()),C(l.Z.slice.actions.clearUserRankInfo())}async function z(e){var o,n,r,a,d,u;let c=null===(o=T.nodeListFilters.selectedDao)||void 0===o?void 0:o.address,v=A.ethInfo.walletAddress;if(!c)throw Error(t("NoSelectedDao"));if(!v)throw Error(t("Can't found user address"));new p.Z;let w=new I.q$p(N.buildConfigure()),m=await w.getMyRank({daoAddress:c}),g=new R.zv(m);if(g.hasError()){let e=g.getError();(0,f.L6)(e.msg),i.Z.E(e)}let h=null!==(a=g.getData().daoMyRankList)&&void 0!==a?a:[],y=p.z.DAOUserRankInfoAdapter.getFactory(v),D=h.map(y).map(e=>e.toJSON());C(l.Z.slice.actions.updateUserRankInfo(D));let Z=new Map(D.map(e=>[e.rewardType,e.rank]));C(l.Z.slice.actions.updateUserRankRewardInfo([[s.r.RankRewardType.LUCKY_REWARD,F(Z.get(s.r.RankRewardType.LUCKY_REWARD)).toNumber()],[s.r.RankRewardType.VOTE_TOP_REWARD,U(null!==(d=null===(n=T.daoContractInfo)||void 0===n?void 0:n.top3NodePoolPre)&&void 0!==d?d:0n,e)(Z.get(s.r.RankRewardType.VOTE_TOP_REWARD)).toNumber()],[s.r.RankRewardType.NODE_TOP_REWARD,U(null!==(u=null===(r=T.daoContractInfo)||void 0===r?void 0:r.top3NodePoolPre)&&void 0!==u?u:0n,e)(Z.get(s.r.RankRewardType.NODE_TOP_REWARD)).toNumber()]]))}return v.useEffect(()=>{var e;if(!(null==o?void 0:o.autoTrigger))return;if(!(null===(e=T.nodeListFilters.selectedDao)||void 0===e?void 0:e.address)||!T.daoCurrentRoundInfo){_();return}let n=y()(()=>{W().catch(e=>{(0,f.L6)(new f.HU(e,t("GetRankDataFailed")).asToastMessage()),i.Z.E("updateRankInfo",e)})},1e3),r=h.Z.sleepForAnimationFrame(200);r.wait(()=>n());let a=setInterval(()=>{"visible"===document.visibilityState&&n()},6e4);return()=>{r.cancel(g.Z.ReactError.useEffectDestroy()),clearInterval(a),n.cancel(),_()}},[T.daoCurrentRoundInfo,D.token,A.ethInfo.walletAddress]),{updateRankSimpleInfo:b,updateUserRankInfo:z,calcLuckyRewardInLocal:F,getLuckyRewardInLocal:function(e){var o;return null!==(o=null==(e=null!=e?e:T.rankInfo.luckyUsers)?void 0:e.map((e,o)=>o+1).map((o,t)=>({rank:o,address:e[t],reward:F(o,e)})))&&void 0!==o?o:[]},getUserLuckyRewardInLocal:function(e,o){var t,n;e=null!=e?e:A.ethInfo.walletAddress;let r=null!==(n=(o=null!==(t=null!=o?o:T.rankInfo.luckyUsers)&&void 0!==t?t:[]).indexOf(e))&&void 0!==n?n:-1;return F(-1===r?4:r+1,o)},calcTop3RewardInLocal:U,getVoteTop3Rawards:O,getUserVoteTopReward:function(e,o){var t,n;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"currnet";return e=null!=e?e:A.ethInfo.walletAddress,(null!==(n=O(void 0,o=null!==(t=null!=o?o:T.rankInfo.voteWithdrawed)&&void 0!==t?t:[],r).find(o=>o.address===e))&&void 0!==n?n:{reward:new c.Z(0)}).reward},getNodeTop3Rawards:V,getUserNodeTopReward:function(e,o){var t,n;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"currnet";return e=null!=e?e:A.ethInfo.walletAddress,(null!==(n=V(void 0,o=null!==(t=null!=o?o:T.rankInfo.nodeWithdrawed)&&void 0!==t?t:[],r).find(o=>o.address===e))&&void 0!==n?n:{reward:new c.Z(0)}).reward},getLastInvestorsDetailInfo:x,updateRankInfo:W,clearRankInfo:_}}},50544:function(e,o,t){t.d(o,{Z:function(){return f}});var n=t(2265),r=t(89769),a=t(43949),d=t(6178),i=t(21707),l=t(40366),s=t(3682),u=t(10433),c=t(95665),v=t(81939);function f(){var e,o,t,f,w,I,p,R,m,g,h,C,y,D,T,A,Z,N,k,E;let L=(0,d.T)(),{t:S,i18n:b}=(0,a.$G)(["dao"]),F=(0,d.C)(e=>e.dao),U="/images/dao/",P=new Map([[r.r.NodeType.NONE,{color1:"#000",color2:"#fff",title:S("notNode.title"),description:S("notNode.description"),image:"".concat(U,"not-node.png"),upgradeInfo:{userNodeCount:0n,requiredNodeCount:0n,ethPrice:0n}}],[r.r.NodeType.CANDIDATE,{color1:"#E700E6",color2:"#4B4BDF",title:S("candidateNode.title"),description:S("candidateNode.description",{title:S("candidateNode.title").toLocaleLowerCase(),token:F.tokenInfo.symbol,value:v.Z.wei2eth(null!==(h=null===(e=F.daoContractInfo)||void 0===e?void 0:e.applyCandidateEthAmount)&&void 0!==h?h:0n)}),image:"".concat(U,"candidate-node.png"),upgradeInfo:{userNodeCount:0n,requiredNodeCount:0n,ethPrice:null!==(C=null===(o=F.daoContractInfo)||void 0===o?void 0:o.applyCandidateEthAmount)&&void 0!==C?C:0n}}],[r.r.NodeType.MASTER,{color1:"#EA7D01",color2:"#B06D00",title:S("mainNode.title"),description:S("mainNode.description",{prevTitle:S("candidateNode.title").toLocaleLowerCase(),title:S("mainNode.title").toLocaleLowerCase(),nodeCount:String(null!==(y=null===(t=F.daoContractInfo)||void 0===t?void 0:t.votesForMaster)&&void 0!==y?y:0n)}),image:"".concat(U,"main-node.png"),upgradeInfo:{userNodeCount:null!==(D=null===(f=F.userInfo)||void 0===f?void 0:f.userInfo.sonCount)&&void 0!==D?D:0n,requiredNodeCount:null!==(T=null===(w=F.daoContractInfo)||void 0===w?void 0:w.votesForMaster)&&void 0!==T?T:0n,ethPrice:0n}}],[r.r.NodeType.SUPER,{color1:"#00E7D4",color2:"#4B4BDF",title:S("superNode.title"),description:S("superNode.description",{prevTitle:S("mainNode.title").toLocaleLowerCase(),title:S("superNode.title").toLocaleLowerCase(),token:F.tokenInfo.symbol,value:v.Z.wei2eth(null!==(A=null===(I=F.daoContractInfo)||void 0===I?void 0:I.applySuperEthAmount)&&void 0!==A?A:0n),nodeCount:String(null!==(Z=null===(p=F.daoContractInfo)||void 0===p?void 0:p.masterForSuper)&&void 0!==Z?Z:0n)}),image:"".concat(U,"super-node.png"),upgradeInfo:{userNodeCount:null!==(N=null===(R=F.userInfo)||void 0===R?void 0:R.userInfo.sonMasterNodeCount)&&void 0!==N?N:0n,requiredNodeCount:null!==(k=null===(m=F.daoContractInfo)||void 0===m?void 0:m.masterForSuper)&&void 0!==k?k:0n,ethPrice:null!==(E=null===(g=F.daoContractInfo)||void 0===g?void 0:g.applySuperEthAmount)&&void 0!==E?E:0n}}]]),M=Array.from(P.entries()),O=new Map;M.forEach((e,o)=>{let t=e[0],n=M[o+1];O.set(t,{nextKey:n?Number(n[0]):void 0,nextValue:n?n[1]:void 0})});let V=new Map(F.nodesCurrentRoundInfo.map(e=>["".concat(e.daoAddress,",").concat(e.nodeAddress),e]));async function x(e,o){if(0===e.length)return[];let t=new i.C(o.daoAddress,l.K),n=e.map(e=>t.promotions(o.currentRoundNO,e)),r=s.Q.getDefaultProvider(),a=new i.z(s.Q.getTargetNet().chainId,r),d=await a.all(n),c=e.map((e,t)=>({nodeAddress:e,daoAddress:o.daoAddress,promotionInfo:d[t]}));return u.Z.I("getNodeCurrentRoundSimpleInfo",c),c}async function B(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],o=arguments.length>1?arguments[1]:void 0;if(!(o=null!=o?o:F.daoContractInfo))throw Error("daoAddress and currentRoundNO can't be empty");let t=await x([e,F.nodes.data.map(e=>e.walletAddress)].flat(),o);L(c.Z.slice.actions.updateNodesCurrentRoundInfo(t))}async function W(e,o){var t;let n=null!=o?o:null===(t=F.daoContractInfo)||void 0===t?void 0:t.daoAddress;if(!n)throw Error("daoAddress can't be empty");try{let o=new i.C(n,l.K),t=s.Q.getDefaultProvider(),r=new i.z(s.Q.getTargetNet().chainId,t),a=o.users(e),d=await r.all([a]),c=Number(d[0].nodeType);return u.Z.I("getNodeTypeByAddress",{nodeAddress:e,nodeType:c}),c}catch(e){return u.Z.E("getNodeTypeByAddress error",e),r.r.NodeType.NONE}}return n.useEffect(()=>{P.set(r.r.NodeType.MASTER,{...P.get(r.r.NodeType.MASTER),title:S("mainNode.title")}),P.set(r.r.NodeType.SUPER,{...P.get(r.r.NodeType.SUPER),title:S("superNode.title")})},[b.language]),{nodeMap:P,nodeToNextMap:O,getNodeCurrentRoundSimpleInfo:x,updateNodeCurrentRoundInfoSimpleInfo:B,nodeCurrentRoundSimpleInfoMap:V,getNodeTypeByAddress:W}}},94521:function(e,o,t){t.d(o,{Z:function(){return T}});var n=t(2265),r=t(72917),a=t(68651),d=t(43009),i=t(6178),l=t(74439),s=t(43949),u=t(81939),c=t(83123),v=t(13965),f=t(20151),w=t(10433),I=t(14931),p=t(20605),R=t(22928),m=t(95665),g=t(344),h=t(68031),C=t(64798),y=t.n(C),D=t(35178);function T(){var e,o,t,C,T,A,Z,N,k,E,L,S,b,F,U,P,M,O,V,x,B,W,_,z,H,q,G,Q,$,K,j,J,Y,X,ee,eo,et,en,er,ea,ed,ei,el,es,eu,ec,ev,ef,ew,eI,ep,eR,em,eg,eh,eC;let ey=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},eD=(0,i.T)(),{t:eT}=(0,s.$G)(["dao"]),eA=(0,i.C)(e=>e.global),eZ=(0,i.C)(e=>e.dao),eN=(0,i.C)(e=>e.user),ek=(0,r.Z)(),eE=null!==(J=null==ey?void 0:ey.autoTrigger)&&void 0!==J&&J,eL=(0,I.Z)(void 0,{autoTrigger:eE}),[eS,eb]=n.useState(0),[eF,eU]=n.useState(0),[eP,eM]=n.useState(!1),[eO,eV]=n.useState(!1),[ex,eB]=n.useState(!1),eW=null!==(Y=null===(e=eZ.daoContractInfo)||void 0===e?void 0:e.voteRankClaimDurationAdd)&&void 0!==Y?Y:0,e_=null!==(X=null===(o=eZ.daoContractInfo)||void 0===o?void 0:o.createTime)&&void 0!==X?X:0,ez=null!==(ee=null===(t=eZ.daoContractInfo)||void 0===t?void 0:t.rewardRoundPass)&&void 0!==ee?ee:0,eH=null!==(eo=null===(C=eZ.daoContractInfo)||void 0===C?void 0:C.airdropDurationGetLimit)&&void 0!==eo?eo:0;R.Z.getCurrentRewardRoundTimestamp(e_,eW,ez);let eq=null!==(et=null===(T=eZ.daoCurrentRoundInfo)||void 0===T?void 0:T.roundExpire)&&void 0!==et?et:0,eG=null!==(en=null===(A=eZ.userInfo)||void 0===A?void 0:A.voteAndAirDropReward.clairReward)&&void 0!==en?en:0n,eQ=eS||(null!==(er=null===(Z=eZ.userInfo)||void 0===Z?void 0:Z.voteInfo.roundFirstVotedDate)&&void 0!==er?er:0),e$=eq>0?l.Z.convertTimeDifference(new Date(eQ+eH-eA.currentTime),{includeDays:!1}):0,eK=eG>0n,ej=Math.floor(eA.currentTime/eW)*eW+eW,eJ=eZ.userRewardInfo.voteTopReward.gt(0)?l.Z.convertTimeDifference(new Date(ej-eA.currentTime),{includeDays:!1}):0,eY=eZ.userRewardInfo.voteTopReward.gt(0),eX=null!==(ea=null===(N=eZ.daoContractInfo)||void 0===N?void 0:N.communityDuration)&&void 0!==ea?ea:0,e0=Math.floor((null!==(ed=null===(k=eZ.daoContractInfo)||void 0===k?void 0:k.top3NodeDate)&&void 0!==ed?ed:0)/eX)*eX+(null!==(ei=null===(E=eZ.daoContractInfo)||void 0===E?void 0:E.communityDuration)&&void 0!==ei?ei:0);null===(L=eZ.daoContractInfo)||void 0===L||L.communityRewardDuration;let e1=eZ.userRewardInfo.nodeTopReward.gt(0)?l.Z.convertTimeDifference(new Date(e0-eA.currentTime),{includeDays:!1}):0,e2=eZ.userRewardInfo.nodeTopReward.gt(0),e6=l.Z.convertTimeDifference(new Date((null!==(el=null===(S=eZ.daoCurrentRoundInfo)||void 0===S?void 0:S.roundExpire)&&void 0!==el?el:0)-eA.currentTime),{includeDays:!1}),e3=l.Z.convertTimeDifference(new Date((null!==(es=null===(b=eZ.daoCurrentRoundInfo)||void 0===b?void 0:b.roundExpire)&&void 0!==es?es:0)+(null!==(eu=null===(F=eZ.daoContractInfo)||void 0===F?void 0:F.loserPoolRewardTimeLimit)&&void 0!==eu?eu:0)-eA.currentTime),{includeDays:!1}),e9=0===e6&&0!==e3&&eZ.userRewardInfo.luckyReward.gt(0)&&(null===(U=eZ.userInfo)||void 0===U?void 0:U.voteInfo.isLuckyRewardClaimed)===!1,e4=(null!==(ec=null===(P=eZ.daoCurrentRoundInfo)||void 0===P?void 0:P.totalVoteAmount)&&void 0!==ec?ec:0n)-(null!==(ev=null===(M=eZ.daoCurrentRoundInfo)||void 0===M?void 0:M.totalEthDone)&&void 0!==ev?ev:0n),e8=(null===(O=eZ.userInfo)||void 0===O?void 0:O.voteInfo.isLoserRewardClaimed)?new a.Z(0):new a.Z((null!==(ef=null===(V=eZ.userInfo)||void 0===V?void 0:V.voteInfo.votedAmount)&&void 0!==ef?ef:0n).toString()).minus((null!==(ew=null===(x=eZ.userInfo)||void 0===x?void 0:x.voteInfo.ethDone)&&void 0!==ew?ew:0n).toString()).div((0n===e4?1n:e4).toString()).multipliedBy((null!==(eI=null===(B=eZ.daoCurrentRoundInfo)||void 0===B?void 0:B.pool.loserPool)&&void 0!==eI?eI:0n).toString()),e5=(null===(W=eZ.userInfo)||void 0===W?void 0:W.voteInfo.isLoserRewardClaimed)?new a.Z(0):new a.Z((null!==(ep=null===(_=eZ.userInfo)||void 0===_?void 0:_.voteInfo.votedAmount)&&void 0!==ep?ep:0n).toString()).minus((null!==(eR=null===(z=eZ.userInfo)||void 0===z?void 0:z.voteInfo.ethDone)&&void 0!==eR?eR:0n).toString()).div((0n===e4?1n:e4).toString()).multipliedBy((null!==(em=null===(H=eZ.daoCurrentRoundInfo)||void 0===H?void 0:H.pool.loserPoolETH)&&void 0!==em?em:0n).toString()),e7=l.Z.convertTimeDifference(new Date((null!==(eg=null===(q=eZ.daoCurrentRoundInfo)||void 0===q?void 0:q.roundExpire)&&void 0!==eg?eg:0)-eA.currentTime),{includeDays:!1}),oe=l.Z.convertTimeDifference(new Date((null!==(eh=null===(G=eZ.daoCurrentRoundInfo)||void 0===G?void 0:G.roundExpire)&&void 0!==eh?eh:0)+(null!==(eC=null===(Q=eZ.daoContractInfo)||void 0===Q?void 0:Q.loserPoolRewardTimeLimit)&&void 0!==eC?eC:0)-eA.currentTime),{includeDays:!1}),oo=0===e7&&0!==oe&&(e8.gt(0)||e5.gt(0)),ot=[{title:eT("DAOReward"),reward:u.Z.wei2eth(eG),hasDetails:!0,countdown:0===e$?"":e$.toFormated(),claimable:eK,handleClaim:on},{title:eT("VoteTopReward"),reward:eZ.userRewardInfo.voteTopReward.toString(),hasDetails:!1,countdown:0===eJ?"":eJ.toFormated(),claimable:eY,handleClaim:or},{title:eT("NodeTopReward"),reward:eZ.userRewardInfo.nodeTopReward.toString(),hasDetails:!1,countdown:0===e1?"":e1.toFormated(),claimable:e2,handleClaim:oa},{title:eT("LuckyReward"),reward:eZ.userRewardInfo.luckyReward.toString(),hasDetails:!1,countdown:(null===($=eZ.userInfo)||void 0===$?void 0:$.voteInfo.isLuckyRewardClaimed)?"":0!==e6?e6.toFormated():0!==e3?e3.toFormated():"",claimable:e9,handleClaim:od},{title:eT("OtherReward"),tokenReward:e8.gt(0)?u.Z.wei2eth(e8.toFixed(0,a.Z.ROUND_DOWN)):"0",hasDetails:!1,countdown:(null===(K=eZ.userInfo)||void 0===K?void 0:K.voteInfo.isLoserRewardClaimed)?"":0!==e7?e7.toFormated():0!==oe?oe.toFormated():"",claimable:oo,handleClaim:oi}];async function on(){var e;let o=null===(e=eZ.nodeListFilters.selectedDao)||void 0===e?void 0:e.address;if(!o){(0,c.L6)(eT("NoSelectedDao"));return}if(!eK)return;let t=v.r.getInstance(),n=u.Z.getInstance(t.getProvider()),r=f.bR.connect(o,await n.getSigner());try{let e=await r.claimVoteAndAirDropReward();await e.wait(),(0,c.x9)(eT("ClaimVoteAndAirDropRewardSuccess"));let o=Date.now();eb(o),eV(!0),eZ.userInfo&&eD(m.Z.slice.actions.updateUserInfo({...eZ.userInfo,voteAndAirDropReward:{...eZ.userInfo.voteAndAirDropReward,clairReward:0n}})),await ol(),setTimeout(()=>{eV(!1)},5e3)}catch(e){(0,c.L6)(new c.HU(e,eT("ClaimVoteAndAirDropRewardFailed")).asToastMessage()),w.Z.E(e)}}async function or(){var e,o;if(!(null===(e=eZ.nodeListFilters.selectedDao)||void 0===e?void 0:e.address)){(0,c.L6)(eT("NoSelectedDao"));return}eD(m.Z.slice.actions.updateUserRewardInfo({...eZ.userRewardInfo,voteTopReward:new a.Z(0)}));let t=v.r.getInstance(),n=u.Z.getInstance(t.getProvider()),r=f.bR.connect(null===(o=eZ.nodeListFilters.selectedDao)||void 0===o?void 0:o.address,await n.getSigner());try{let e=await r.claimTop3VotedReward();await e.wait(),(0,c.x9)(eT("ClaimNodeTopRewardSuccess")),await ol()}catch(e){eD(m.Z.slice.actions.updateUserRewardInfo({...eZ.userRewardInfo,voteTopReward:eZ.userRewardInfo.voteTopReward})),(0,c.L6)(new c.HU(e,eT("ClaimNodeTopRewardFailed")).asToastMessage()),w.Z.E(e)}}async function oa(){var e,o;if(!(null===(e=eZ.nodeListFilters.selectedDao)||void 0===e?void 0:e.address))return(0,c.L6)(eT("NoSelectedDao"));eD(m.Z.slice.actions.updateUserRewardInfo({...eZ.userRewardInfo,nodeTopReward:new a.Z(0)}));let t=v.r.getInstance(),n=u.Z.getInstance(t.getProvider()),r=f.bR.connect(null===(o=eZ.nodeListFilters.selectedDao)||void 0===o?void 0:o.address,await n.getSigner());try{let e=await r.claimTop3NodeReward();await e.wait(),(0,c.x9)(eT("ClaimNodeTopRewardSuccess")),await ol()}catch(e){eD(m.Z.slice.actions.updateUserRewardInfo({...eZ.userRewardInfo,nodeTopReward:eZ.userRewardInfo.nodeTopReward})),(0,c.L6)(new c.HU(e,eT("ClaimNodeTopRewardFailed")).asToastMessage()),w.Z.E(e)}}async function od(){var e,o;if(!(null===(e=eZ.nodeListFilters.selectedDao)||void 0===e?void 0:e.address))return(0,c.L6)(eT("NoSelectedDao"));eZ.userInfo&&eD(m.Z.slice.actions.updateUserInfo({...eZ.userInfo,voteInfo:{...eZ.userInfo.voteInfo,isLuckyRewardClaimed:!0}}));let t=v.r.getInstance(),n=u.Z.getInstance(t.getProvider()),r=f.bR.connect(null===(o=eZ.nodeListFilters.selectedDao)||void 0===o?void 0:o.address,await n.getSigner());try{let e=await r.claimLuckyReward();await e.wait(),(0,c.x9)(eT("ClaimLuckyRewardSuccess")),await ol()}catch(e){eZ.userInfo&&eD(m.Z.slice.actions.updateUserInfo({...eZ.userInfo,voteInfo:{...eZ.userInfo.voteInfo,isLuckyRewardClaimed:!1}})),(0,c.L6)(new c.HU(e,eT("ClaimLuckyRewardFailed")).asToastMessage()),w.Z.E(e)}}async function oi(){var e,o;if(!(null===(e=eZ.nodeListFilters.selectedDao)||void 0===e?void 0:e.address))return(0,c.L6)(eT("NoSelectedDao"));eZ.userInfo&&eD(m.Z.slice.actions.updateUserInfo({...eZ.userInfo,voteInfo:{...eZ.userInfo.voteInfo,isLoserRewardClaimed:!0}}));let t=v.r.getInstance(),n=u.Z.getInstance(t.getProvider()),r=f.bR.connect(null===(o=eZ.nodeListFilters.selectedDao)||void 0===o?void 0:o.address,await n.getSigner());try{let e=await r.claimLoserReward();await e.wait(),(0,c.x9)(eT("ClaimOtherRewardSuccess")),await ol()}catch(e){eZ.userInfo&&eD(m.Z.slice.actions.updateUserInfo({...eZ.userInfo,voteInfo:{...eZ.userInfo.voteInfo,isLoserRewardClaimed:!1}})),(0,c.L6)(new c.HU(e,eT("ClaimOtherRewardFailed")).asToastMessage()),w.Z.E(e)}}async function ol(){var e;let o=null===(e=eZ.nodeListFilters.selectedDao)||void 0===e?void 0:e.address;if(o)try{eM(!0),eB(!0),eD(D.Z.slice.actions.updateTime(Date.now())),await new Promise(e=>setTimeout(e,2e3)),await Promise.all([ek.updateInfo(),eL.updateRankSimpleInfo(o),os(o),oc(o)]),await oI(o),ey.handleAfterClaim&&await ey.handleAfterClaim()}catch(e){w.Z.E("Error in handleAfterClaim:",e)}finally{eM(!1),eB(!1)}}async function os(e){var o;let t=Date.now();if(!ex&&t-eF<6e4||eP)return;let n=new R.Z;if(!(e=null!=e?e:null===(o=eZ.nodeListFilters.selectedDao)||void 0===o?void 0:o.address)){(0,c.L6)(eT("NoSelectedDao"));return}try{eM(!0);let o=await n.getUserVoteNodeRankReward({userAddress:eN.ethInfo.walletAddress,daoAddress:e});eD(m.Z.slice.actions.updateUserRewardInfo({luckyReward:new a.Z(u.Z.wei2eth(o.luckyReward.reward)),voteTopReward:new a.Z(u.Z.wei2eth(o.voteTopReward.reward)),nodeTopReward:new a.Z(u.Z.wei2eth(o.nodeTopReward.reward))})),eU(t)}catch(e){(0,c.L6)(new c.HU(e,eT("GetUserVoteNodeRankRewardFailed")).asToastMessage()),w.Z.E(e)}finally{eM(!1)}}let ou=n.useCallback(y()(e=>{var o;if(null===(o=eZ.daoContractInfo)||void 0===o?void 0:o.daoAddress)return os(eZ.daoContractInfo.daoAddress)},800),[eZ.daoContractInfo,eN.ethInfo.walletAddress]);async function oc(e){if(eO)return;let o=new R.Z,t=new g.q$p(o.buildConfigure()),n=await t.getLastClaimTime({daoAddress:e}),r=new h.zv(n);if(r.hasError()){let e=r.getError();(0,c.L6)(new c.HU(e,eT("GetLastClaimTimeFailed")).asToastMessage()),w.Z.E(e);return}let a=d.Z.Time.fromTimestamp(r.getData());eO||a.toJSTime()===eS||eb(a.toJSTime())}function ov(e,o){let t=Number("120");return new a.Z(u.Z.wei2eth(e)).multipliedBy(t).div(100).minus(u.Z.wei2eth(o))}n.useEffect(()=>{if(!eE||!eZ.daoContractInfo||!eN.ethInfo.walletAddress)return;let e=l.Z.sleepForAnimationFrame(300);e.wait(()=>{ou()});let o=setInterval(()=>{"visible"===document.visibilityState&&ou()},6e4);return()=>{e.cancel(p.Z.ReactError.useEffectDestroy()),clearInterval(o)}},[eZ.daoContractInfo,eN.ethInfo.walletAddress,eE,ou]);let of=n.useCallback(y()(e=>{oc(e)},500),[]);async function ow(){var e;let o=null===(e=eZ.nodeListFilters.selectedDao)||void 0===e?void 0:e.address;if(o&&eN.ethInfo.walletAddress)try{eM(!0),eB(!0),await Promise.all([ek.updateInfo(),eL.updateRankSimpleInfo(o),os(o),oc(o)]),await oI(o),eU(Date.now()),eB(!1)}catch(e){w.Z.E("Error in refreshAllData:",e)}finally{eM(!1)}}async function oI(e){try{let o=v.r.getInstance(),t=u.Z.getInstance(o.getProvider()),n=f.bR.connect(e,await t.getSigner()),r=eN.ethInfo.walletAddress;if(!r)return;let a=await n.getVoteAndAirDropReward(r);if(eZ.userInfo){let e={...eZ.userInfo,voteAndAirDropReward:{...eZ.userInfo.voteAndAirDropReward,clairReward:a.clairReward,airdropReward:a.airdropReward,nodeReward:a.nodeReward,airdropLinkReward:a.airdropLinkReward,reinvestReward:a.reinvestReward}};eD(m.Z.slice.actions.updateUserInfo(e))}}catch(e){w.Z.E("Error checking reward claim status:",e)}}return n.useEffect(()=>{var e;if((null===(e=eZ.nodeListFilters.selectedDao)||void 0===e?void 0:e.address)&&eA.token)return of(eZ.nodeListFilters.selectedDao.address),()=>{of.cancel()}},[null===(j=eZ.nodeListFilters.selectedDao)||void 0===j?void 0:j.address,eA.token,of]),n.useEffect(()=>{ex&&eE&&ow()},[ex,eE]),{rewardItems:ot,handleVoteAirdropClaim:on,handleVoteRankClaim:or,handleNodeRankClaim:oa,handleLuckyClaim:od,handleOtherClaim:oi,estimatePendingReward:ov,estimateUserPendingReward:function(){var e,o,t,n;return ov(null!==(t=null===(e=eZ.userInfo)||void 0===e?void 0:e.voteInfo.votedAmount)&&void 0!==t?t:0n,null!==(n=null===(o=eZ.userInfo)||void 0===o?void 0:o.voteInfo.ethDone)&&void 0!==n?n:0n)},getClaimNodeRewardCountdown:function(){if(!eZ.daoContractInfo)return"";let e=Math.floor(eA.currentTime/1e3),o=86400*Math.floor(Math.floor(e_/1e3)/86400),t=o+604800*Math.floor((e-o)/604800)+604800-e;if(t<=0)return"00:00:00";let n=Math.floor(t/3600).toString().padStart(2,"0"),r=Math.floor(t%3600/60).toString().padStart(2,"0"),a=Math.floor(t%60).toString().padStart(2,"0");return"".concat(n,":").concat(r,":").concat(a)},refreshAllData:ow,isUpdating:eP}}}}]);