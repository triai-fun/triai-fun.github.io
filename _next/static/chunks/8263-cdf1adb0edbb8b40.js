"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8263],{89522:function(e,o,t){t.d(o,{Z:function(){return u}});var n=t(12249),r=t(5853),a=t(68031),d=t(59201),i=t(8113),l=t(344),s=t(63671);class u extends s.bQ{async loginWallet(e){var o;let t=new d.M,n=new l.M2y(this.buildConfigure(t)),r=new a.zv(await n.loginByWallet({walletLoginRequestVO:{walletAddress:e.walletAddress,signature:e.signature,timestamp:e.timestamp.toString()}},{signal:null===(o=e.abortController)||void 0===o?void 0:o.signal}));return r.hasError()||t.afterHandler(r.response,{url:"/login",data:e}),r}async getUserInfo(e){var o;let t=new Headers;e.Authorization&&t.set("Authorization",e.Authorization),delete e.Authorization;let n=new l.M2y(this.buildConfigure());return new a.zv(await n.getUserInfo({signal:null===(o=e.abortController)||void 0===o?void 0:o.signal,headers:t}))}async uploadFile(e){var o;let t=new FormData;t.append("file",e.file);let n=new l.M2y(this.buildConfigure()),r=await n.upload({file:e.file},{signal:null===(o=e.abortController)||void 0===o?void 0:o.signal,body:t});return new a.zv(r)}async addNFTInfo(e){var o;e.Authorization,delete e.Authorization;let t=new l.lG6(this.buildConfigure());return new a.zv(await t.uploadHash({uploadHashRequestVO:e},{signal:null===(o=e.abortController)||void 0===o?void 0:o.signal}))}constructor(e=new d.Z){super(),(0,n._)(this,"httpRequest",void 0),this.httpRequest=e}}u=(0,r.gn)([i.ZP.Singleton,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof HttpRequest?Object:HttpRequest])],u)},88263:function(e,o,t){t.d(o,{Z:function(){return A}});var n=t(2265),r=t(72917),a=t(68651),d=t(43009),i=t(6178),l=t(74439),s=t(43949),u=t(81939),c=t(83123),v=t(13965),f=t(20151),w=t(10433),R=t(3682),I=t(21707),m=t(95665),p=t(89769),g=t(344),h=t(22928),y=t(68031),C=t(89522),D=t(20605),Z=t(7310),k=t.n(Z),T=t(35178);function A(){var e,o,t,Z,A,L,E,S,N,F,b,U,P,M,O,V,W,x,B,_,z,H,q,G,$,J,Q,K,Y,j,X,ee,eo,et,en,er,ea,ed,ei,el,es,eu,ec,ev,ef,ew,eR,eI,em,ep,eg,eh,ey,eC,eD,eZ;let ek=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},eT=(0,i.T)(),{t:eA}=(0,s.$G)(["dao"]),eL=(0,i.C)(e=>e.global),eE=(0,i.C)(e=>e.dao),eS=(0,i.C)(e=>e.user),eN=(0,r.Z)(),eF=null!==(ee=null==ek?void 0:ek.autoTrigger)&&void 0!==ee&&ee,eb=function(e,o){let{t}=(0,s.$G)(["dao"]),d=(0,i.T)(),v=(0,i.C)(e=>e.global),f=(0,i.C)(e=>e.dao),Z=(0,i.C)(e=>e.user);(0,r.Z)(e);let T=new h.Z,A=new C.Z,[L,E]=n.useState(0),[S,N]=n.useState(!1);async function F(e){var o;if(!(e=null!=e?e:null===(o=f.nodeListFilters.selectedDao)||void 0===o?void 0:o.address))throw Error("No dao address");let t=await T.getRankSimpleInfo(e);return d(m.Z.slice.actions.updateSimpleRankInfo({luckyUsers:t.luckyRecords.map(e=>e.userAddress),voteUsers:t.voteAddresses,prevVoteUsers:t.prevVoteAddresses,voteWithdrawed:t.voteWithdrawed,nodeUsers:t.nodeAddresses,prevNodeUsers:t.prevNodeAddresses,nodeWithdrawed:t.nodeWithdrawed})),t}function b(e,o){var t,n,r,d,i,l,s,c;let v=new a.Z(u.Z.wei2eth(null!==(n=null===(t=f.daoCurrentRoundInfo)||void 0===t?void 0:t.pool.luckyPool)&&void 0!==n?n:0n));switch(null==(o=null!=o?o:f.rankInfo.luckyUsers)||o.length,e){case 0:return new a.Z(0);case 1:return v.multipliedBy(null!==(d=null===(r=f.daoContractInfo)||void 0===r?void 0:r.firstLuckyRewardRate)&&void 0!==d?d:.6);case 2:return v.multipliedBy(null!==(l=null===(i=f.daoContractInfo)||void 0===i?void 0:i.secondLuckyRewardRate)&&void 0!==l?l:.3);default:return v.multipliedBy(null!==(c=null===(s=f.daoContractInfo)||void 0===s?void 0:s.thirdLuckyRewardRate)&&void 0!==c?c:.1).div(31)}}function U(e,o){let t=new a.Z(u.Z.wei2eth(e));return e=>{var n,r,d,i,l,s;if(o[e-1])return new a.Z(0);switch(e){case 0:default:return new a.Z(0);case 1:return t.multipliedBy(null!==(r=null===(n=f.daoContractInfo)||void 0===n?void 0:n.firstPlaceRewardRate)&&void 0!==r?r:.6);case 2:return t.multipliedBy(null!==(i=null===(d=f.daoContractInfo)||void 0===d?void 0:d.secondPlaceRewardRate)&&void 0!==i?i:.3);case 3:return t.multipliedBy(null!==(s=null===(l=f.daoContractInfo)||void 0===l?void 0:l.thirdPlaceRewardRate)&&void 0!==s?s:.1)}}}function P(){var e,o,t,n,r;let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"currnet",i=null!==(n="currnet"===d?null===(e=f.daoCurrentRoundInfo)||void 0===e?void 0:e.pool.voteRankPool:null===(o=f.daoContractInfo)||void 0===o?void 0:o.top3VotedPoolPre)&&void 0!==n?n:0n;return new a.Z(i.toString()).multipliedBy(null!==(r=null===(t=f.daoContractInfo)||void 0===t?void 0:t.voteRankRewardRate)&&void 0!==r?r:0)}function M(){var e,o,t,n,r;let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"currnet",i=null!==(n="currnet"===d?null===(e=f.daoCurrentRoundInfo)||void 0===e?void 0:e.pool.communityPool:null===(o=f.daoContractInfo)||void 0===o?void 0:o.top3NodePoolPre)&&void 0!==n?n:0n;return new a.Z(i.toString()).multipliedBy(null!==(r=null===(t=f.daoContractInfo)||void 0===t?void 0:t.communityRewardRate)&&void 0!==r?r:0)}function O(e,o){var t,n;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"currnet";e=null!=e?e:f.rankInfo.prevVoteUsers,o=null!==(t=null!=o?o:f.rankInfo.voteWithdrawed)&&void 0!==t?t:[];let a=P(r);return null!==(n=null==e?void 0:e.map((e,o)=>o+1).map((t,n)=>{let d=U(BigInt(a.toFixed(0)),"pre"===r?o:[])(t);return{rank:t,address:e[n],reward:d}}))&&void 0!==n?n:[]}function V(e,o){var t,n;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"currnet";e=null!=e?e:f.rankInfo.prevNodeUsers,o=null!==(t=null!=o?o:f.rankInfo.nodeWithdrawed)&&void 0!==t?t:[];let a=M(r);return null!==(n=null==e?void 0:e.map((e,o)=>o+1).map((t,n)=>{let d=U(BigInt(a.toFixed(0)),"pre"===r?o:[])(t);return{rank:t,address:e[n],reward:d}}))&&void 0!==n?n:[]}async function W(o,t){var n,r,a,d;if(!(t=null!==(a=null!=t?t:e)&&void 0!==a?a:null===(n=f.nodeListFilters.selectedDao)||void 0===n?void 0:n.address))throw Error("No dao address");if(o=null!==(d=null!=o?o:null===(r=f.rankInfo)||void 0===r?void 0:r.luckyUsers)&&void 0!==d?d:[],!f.daoContractInfo)throw Error("No current round no");let i=f.daoContractInfo.currentRoundNO,l=h.Z.buildGetUserRankDetailInfo(o,t,i),s=R.Q.getDefaultProvider(),u=new I.z(R.Q.getTargetNet().chainId,s),c=await u.all(l.calls);return h.Z.analyzeUserDetailInfo(c,l.singleUserCallCount,l.userAddresses)}function x(e,o){return e.map((e,t)=>{let n=t+1;return{rank:n,address:e.userAddress,votes:Number(u.Z.wei2eth(e.voteInfo.votedAmount)),beVotes:0,reward:o(n)}})}async function B(e){let o=Date.now();if((!(o-L<6e4)||!f.rankInfo.luckyRank||!(f.rankInfo.luckyRank.length>0))&&!S)try{var t,n,r,a,i;if(N(!0),!(e=null!=e?e:null===(t=f.nodeListFilters.selectedDao)||void 0===t?void 0:t.address))throw Error("No dao address");if(!f.daoContractInfo)throw Error("No dao contract info");if(!f.daoCurrentRoundInfo)throw Error("No current round info");let l=f.daoContractInfo.currentRoundNO,s=await F(e);v.token&&Z.ethInfo.walletAddress&&z(s.nodeWithdrawed);let c=await T.getRankInfo({daoAddress:e,voteAddresses:s.voteAddresses,nodeAddresses:s.nodeAddresses,userAddress:Z.ethInfo.walletAddress,currentRoundNO:l}),w=s.luckyRecords.map(e=>e.userAddress),R=s.luckyRecords.map((e,o)=>({rank:o+1,address:e.userAddress,votes:Number(e.votedAmount),beVotes:0,reward:b(o+1,w).toNumber()})),I=P(),p=(n=c.voteData,r=e=>U(BigInt(I.toFixed(0)),[])(e).toNumber(),x(n,r).map((e,o)=>{let t=Number(u.Z.wei2eth(n[o].promotionInfo.sonVotedAmountToday));return{...e,beVotes:t}})),g=M(),h=(a=c.nodeData,i=e=>U(BigInt(g.toFixed(0)),[])(e).toNumber(),x(a,i).map((e,o)=>{let t=Number(u.Z.wei2eth(a[o].promotionInfo.sonVotedAmountWeek));return{...e,beVotes:t}}));d(m.Z.slice.actions.updateDetailRankInfo({luckyRank:R,voteRank:p,nodeRank:h})),E(o)}catch(e){w.Z.E("useDAORankInfo::updateRankInfo error",e)}finally{N(!1)}}async function _(){d(m.Z.slice.actions.clearRankInfo()),d(m.Z.slice.actions.clearUserRankInfo())}async function z(e){var o,n,r,a,i,l;let s=null===(o=f.nodeListFilters.selectedDao)||void 0===o?void 0:o.address,u=Z.ethInfo.walletAddress;if(!s)throw Error(t("NoSelectedDao"));if(!u)throw Error(t("Can't found user address"));new h.Z;let v=new g.q$p(A.buildConfigure()),R=await v.getMyRank({daoAddress:s}),I=new y.zv(R);if(I.hasError()){let e=I.getError();(0,c.L6)(e.msg),w.Z.E(e)}let C=null!==(a=I.getData().daoMyRankList)&&void 0!==a?a:[],D=h.z.DAOUserRankInfoAdapter.getFactory(u),k=C.map(D).map(e=>e.toJSON());d(m.Z.slice.actions.updateUserRankInfo(k));let T=new Map(k.map(e=>[e.rewardType,e.rank]));d(m.Z.slice.actions.updateUserRankRewardInfo([[p.r.RankRewardType.LUCKY_REWARD,b(T.get(p.r.RankRewardType.LUCKY_REWARD)).toNumber()],[p.r.RankRewardType.VOTE_TOP_REWARD,U(null!==(i=null===(n=f.daoContractInfo)||void 0===n?void 0:n.top3NodePoolPre)&&void 0!==i?i:0n,e)(T.get(p.r.RankRewardType.VOTE_TOP_REWARD)).toNumber()],[p.r.RankRewardType.NODE_TOP_REWARD,U(null!==(l=null===(r=f.daoContractInfo)||void 0===r?void 0:r.top3NodePoolPre)&&void 0!==l?l:0n,e)(T.get(p.r.RankRewardType.NODE_TOP_REWARD)).toNumber()]]))}return n.useEffect(()=>{var e;if(!(null==o?void 0:o.autoTrigger))return;if(!(null===(e=f.nodeListFilters.selectedDao)||void 0===e?void 0:e.address)||!f.daoCurrentRoundInfo){_();return}let n=k()(()=>{B().catch(e=>{(0,c.L6)(new c.HU(e,t("GetRankDataFailed")).asToastMessage()),w.Z.E("updateRankInfo",e)})},1e3),r=l.Z.sleepForAnimationFrame(200);r.wait(()=>n());let a=setInterval(()=>{"visible"===document.visibilityState&&n()},6e4);return()=>{r.cancel(D.Z.ReactError.useEffectDestroy()),clearInterval(a),n.cancel(),_()}},[f.daoCurrentRoundInfo,v.token,Z.ethInfo.walletAddress]),{updateRankSimpleInfo:F,updateUserRankInfo:z,calcLuckyRewardInLocal:b,getLuckyRewardInLocal:function(e){var o;return null!==(o=null==(e=null!=e?e:f.rankInfo.luckyUsers)?void 0:e.map((e,o)=>o+1).map((o,t)=>({rank:o,address:e[t],reward:b(o,e)})))&&void 0!==o?o:[]},getUserLuckyRewardInLocal:function(e,o){var t,n;e=null!=e?e:Z.ethInfo.walletAddress;let r=null!==(n=(o=null!==(t=null!=o?o:f.rankInfo.luckyUsers)&&void 0!==t?t:[]).indexOf(e))&&void 0!==n?n:-1;return b(-1===r?4:r+1,o)},calcTop3RewardInLocal:U,getVoteTop3Rawards:O,getUserVoteTopReward:function(e,o){var t,n;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"currnet";return e=null!=e?e:Z.ethInfo.walletAddress,(null!==(n=O(void 0,o=null!==(t=null!=o?o:f.rankInfo.voteWithdrawed)&&void 0!==t?t:[],r).find(o=>o.address===e))&&void 0!==n?n:{reward:new a.Z(0)}).reward},getNodeTop3Rawards:V,getUserNodeTopReward:function(e,o){var t,n;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"currnet";return e=null!=e?e:Z.ethInfo.walletAddress,(null!==(n=V(void 0,o=null!==(t=null!=o?o:f.rankInfo.nodeWithdrawed)&&void 0!==t?t:[],r).find(o=>o.address===e))&&void 0!==n?n:{reward:new a.Z(0)}).reward},getLastInvestorsDetailInfo:W,updateRankInfo:B,clearRankInfo:_}}(void 0,{autoTrigger:eF}),[eU,eP]=n.useState(0),[eM,eO]=n.useState(0),[eV,eW]=n.useState(!1),[ex,eB]=n.useState(!1),[e_,ez]=n.useState(!1),eH=null!==(eo=null===(e=eE.daoContractInfo)||void 0===e?void 0:e.voteRankClaimDurationAdd)&&void 0!==eo?eo:0,eq=null!==(et=null===(o=eE.daoContractInfo)||void 0===o?void 0:o.createTime)&&void 0!==et?et:0,eG=null!==(en=null===(t=eE.daoContractInfo)||void 0===t?void 0:t.rewardRoundPass)&&void 0!==en?en:0,e$=null!==(er=null===(Z=eE.daoContractInfo)||void 0===Z?void 0:Z.airdropDurationGetLimit)&&void 0!==er?er:0;h.Z.getCurrentRewardRoundTimestamp(eq,eH,eG);let eJ=null!==(ea=null===(A=eE.daoCurrentRoundInfo)||void 0===A?void 0:A.roundExpire)&&void 0!==ea?ea:0,eQ=null!==(ed=null===(L=eE.userInfo)||void 0===L?void 0:L.voteAndAirDropReward.clairReward)&&void 0!==ed?ed:0n,eK=eU||(null!==(ei=null===(E=eE.userInfo)||void 0===E?void 0:E.voteInfo.roundFirstVotedDate)&&void 0!==ei?ei:0),eY=eJ>0?l.Z.convertTimeDifference(new Date(eK+e$-eL.currentTime),{includeDays:!1}):0,ej=eQ>0n,eX=Math.floor(eL.currentTime/eH)*eH+eH,e0=eE.userRewardInfo.voteTopReward.gt(0)?l.Z.convertTimeDifference(new Date(eX-eL.currentTime),{includeDays:!1}):0,e1=eE.userRewardInfo.voteTopReward.gt(0),e2=null!==(el=null===(S=eE.daoContractInfo)||void 0===S?void 0:S.communityDuration)&&void 0!==el?el:0,e6=Math.floor((null!==(es=null===(N=eE.daoContractInfo)||void 0===N?void 0:N.top3NodeDate)&&void 0!==es?es:0)/e2)*e2+(null!==(eu=null===(F=eE.daoContractInfo)||void 0===F?void 0:F.communityDuration)&&void 0!==eu?eu:0);null===(b=eE.daoContractInfo)||void 0===b||b.communityRewardDuration;let e3=eE.userRewardInfo.nodeTopReward.gt(0)?l.Z.convertTimeDifference(new Date(e6-eL.currentTime),{includeDays:!1}):0,e8=eE.userRewardInfo.nodeTopReward.gt(0),e4=l.Z.convertTimeDifference(new Date((null!==(ec=null===(U=eE.daoCurrentRoundInfo)||void 0===U?void 0:U.roundExpire)&&void 0!==ec?ec:0)-eL.currentTime),{includeDays:!1}),e9=l.Z.convertTimeDifference(new Date((null!==(ev=null===(P=eE.daoCurrentRoundInfo)||void 0===P?void 0:P.roundExpire)&&void 0!==ev?ev:0)+(null!==(ef=null===(M=eE.daoContractInfo)||void 0===M?void 0:M.loserPoolRewardTimeLimit)&&void 0!==ef?ef:0)-eL.currentTime),{includeDays:!1}),e5=0===e4&&0!==e9&&eE.userRewardInfo.luckyReward.gt(0)&&(null===(O=eE.userInfo)||void 0===O?void 0:O.voteInfo.isLuckyRewardClaimed)===!1,e7=(null!==(ew=null===(V=eE.daoCurrentRoundInfo)||void 0===V?void 0:V.totalVoteAmount)&&void 0!==ew?ew:0n)-(null!==(eR=null===(W=eE.daoCurrentRoundInfo)||void 0===W?void 0:W.totalEthDone)&&void 0!==eR?eR:0n),oe=(null===(x=eE.userInfo)||void 0===x?void 0:x.voteInfo.isLoserRewardClaimed)?new a.Z(0):new a.Z((null!==(eI=null===(B=eE.userInfo)||void 0===B?void 0:B.voteInfo.votedAmount)&&void 0!==eI?eI:0n).toString()).minus((null!==(em=null===(_=eE.userInfo)||void 0===_?void 0:_.voteInfo.ethDone)&&void 0!==em?em:0n).toString()).div((0n===e7?1n:e7).toString()).multipliedBy((null!==(ep=null===(z=eE.daoCurrentRoundInfo)||void 0===z?void 0:z.pool.loserPool)&&void 0!==ep?ep:0n).toString()),oo=(null===(H=eE.userInfo)||void 0===H?void 0:H.voteInfo.isLoserRewardClaimed)?new a.Z(0):new a.Z((null!==(eg=null===(q=eE.userInfo)||void 0===q?void 0:q.voteInfo.votedAmount)&&void 0!==eg?eg:0n).toString()).minus((null!==(eh=null===(G=eE.userInfo)||void 0===G?void 0:G.voteInfo.ethDone)&&void 0!==eh?eh:0n).toString()).div((0n===e7?1n:e7).toString()).multipliedBy((null!==(ey=null===($=eE.daoCurrentRoundInfo)||void 0===$?void 0:$.pool.loserPoolETH)&&void 0!==ey?ey:0n).toString()),ot=l.Z.convertTimeDifference(new Date((null!==(eC=null===(J=eE.daoCurrentRoundInfo)||void 0===J?void 0:J.roundExpire)&&void 0!==eC?eC:0)-eL.currentTime),{includeDays:!1}),on=l.Z.convertTimeDifference(new Date((null!==(eD=null===(Q=eE.daoCurrentRoundInfo)||void 0===Q?void 0:Q.roundExpire)&&void 0!==eD?eD:0)+(null!==(eZ=null===(K=eE.daoContractInfo)||void 0===K?void 0:K.loserPoolRewardTimeLimit)&&void 0!==eZ?eZ:0)-eL.currentTime),{includeDays:!1}),or=0===ot&&0!==on&&(oe.gt(0)||oo.gt(0)),oa=[{title:eA("DAOReward"),reward:u.Z.wei2eth(eQ),hasDetails:!0,countdown:0===eY?"":eY.toFormated(),claimable:ej,handleClaim:od},{title:eA("VoteTopReward"),reward:eE.userRewardInfo.voteTopReward.toString(),hasDetails:!1,countdown:0===e0?"":e0.toFormated(),claimable:e1,handleClaim:oi},{title:eA("NodeTopReward"),reward:eE.userRewardInfo.nodeTopReward.toString(),hasDetails:!1,countdown:0===e3?"":e3.toFormated(),claimable:e8,handleClaim:ol},{title:eA("LuckyReward"),reward:eE.userRewardInfo.luckyReward.toString(),hasDetails:!1,countdown:(null===(Y=eE.userInfo)||void 0===Y?void 0:Y.voteInfo.isLuckyRewardClaimed)?"":0!==e4?e4.toFormated():0!==e9?e9.toFormated():"",claimable:e5,handleClaim:os},{title:eA("OtherReward"),tokenReward:oe.gt(0)?u.Z.wei2eth(oe.toFixed(0,a.Z.ROUND_DOWN)):"0",hasDetails:!1,countdown:(null===(j=eE.userInfo)||void 0===j?void 0:j.voteInfo.isLoserRewardClaimed)?"":0!==ot?ot.toFormated():0!==on?on.toFormated():"",claimable:or,handleClaim:ou}];async function od(){var e;let o=null===(e=eE.nodeListFilters.selectedDao)||void 0===e?void 0:e.address;if(!o){(0,c.L6)(eA("NoSelectedDao"));return}if(!ej)return;let t=v.r.getInstance(),n=u.Z.getInstance(t.getProvider()),r=f.bR.connect(o,await n.getSigner());try{let e=await r.claimVoteAndAirDropReward();await e.wait(),(0,c.x9)(eA("ClaimVoteAndAirDropRewardSuccess"));let o=Date.now();eP(o),eB(!0),eE.userInfo&&eT(m.Z.slice.actions.updateUserInfo({...eE.userInfo,voteAndAirDropReward:{...eE.userInfo.voteAndAirDropReward,clairReward:0n}})),await oc(),setTimeout(()=>{eB(!1)},5e3)}catch(e){(0,c.L6)(new c.HU(e,eA("ClaimVoteAndAirDropRewardFailed")).asToastMessage()),w.Z.E(e)}}async function oi(){var e,o;if(!(null===(e=eE.nodeListFilters.selectedDao)||void 0===e?void 0:e.address)){(0,c.L6)(eA("NoSelectedDao"));return}eT(m.Z.slice.actions.updateUserRewardInfo({...eE.userRewardInfo,voteTopReward:new a.Z(0)}));let t=v.r.getInstance(),n=u.Z.getInstance(t.getProvider()),r=f.bR.connect(null===(o=eE.nodeListFilters.selectedDao)||void 0===o?void 0:o.address,await n.getSigner());try{let e=await r.claimTop3VotedReward();await e.wait(),(0,c.x9)(eA("ClaimNodeTopRewardSuccess")),await oc()}catch(e){eT(m.Z.slice.actions.updateUserRewardInfo({...eE.userRewardInfo,voteTopReward:eE.userRewardInfo.voteTopReward})),(0,c.L6)(new c.HU(e,eA("ClaimNodeTopRewardFailed")).asToastMessage()),w.Z.E(e)}}async function ol(){var e,o;if(!(null===(e=eE.nodeListFilters.selectedDao)||void 0===e?void 0:e.address))return(0,c.L6)(eA("NoSelectedDao"));eT(m.Z.slice.actions.updateUserRewardInfo({...eE.userRewardInfo,nodeTopReward:new a.Z(0)}));let t=v.r.getInstance(),n=u.Z.getInstance(t.getProvider()),r=f.bR.connect(null===(o=eE.nodeListFilters.selectedDao)||void 0===o?void 0:o.address,await n.getSigner());try{let e=await r.claimTop3NodeReward();await e.wait(),(0,c.x9)(eA("ClaimNodeTopRewardSuccess")),await oc()}catch(e){eT(m.Z.slice.actions.updateUserRewardInfo({...eE.userRewardInfo,nodeTopReward:eE.userRewardInfo.nodeTopReward})),(0,c.L6)(new c.HU(e,eA("ClaimNodeTopRewardFailed")).asToastMessage()),w.Z.E(e)}}async function os(){var e,o;if(!(null===(e=eE.nodeListFilters.selectedDao)||void 0===e?void 0:e.address))return(0,c.L6)(eA("NoSelectedDao"));eE.userInfo&&eT(m.Z.slice.actions.updateUserInfo({...eE.userInfo,voteInfo:{...eE.userInfo.voteInfo,isLuckyRewardClaimed:!0}}));let t=v.r.getInstance(),n=u.Z.getInstance(t.getProvider()),r=f.bR.connect(null===(o=eE.nodeListFilters.selectedDao)||void 0===o?void 0:o.address,await n.getSigner());try{let e=await r.claimLuckyReward();await e.wait(),(0,c.x9)(eA("ClaimLuckyRewardSuccess")),await oc()}catch(e){eE.userInfo&&eT(m.Z.slice.actions.updateUserInfo({...eE.userInfo,voteInfo:{...eE.userInfo.voteInfo,isLuckyRewardClaimed:!1}})),(0,c.L6)(new c.HU(e,eA("ClaimLuckyRewardFailed")).asToastMessage()),w.Z.E(e)}}async function ou(){var e,o;if(!(null===(e=eE.nodeListFilters.selectedDao)||void 0===e?void 0:e.address))return(0,c.L6)(eA("NoSelectedDao"));eE.userInfo&&eT(m.Z.slice.actions.updateUserInfo({...eE.userInfo,voteInfo:{...eE.userInfo.voteInfo,isLoserRewardClaimed:!0}}));let t=v.r.getInstance(),n=u.Z.getInstance(t.getProvider()),r=f.bR.connect(null===(o=eE.nodeListFilters.selectedDao)||void 0===o?void 0:o.address,await n.getSigner());try{let e=await r.claimLoserReward();await e.wait(),(0,c.x9)(eA("ClaimOtherRewardSuccess")),await oc()}catch(e){eE.userInfo&&eT(m.Z.slice.actions.updateUserInfo({...eE.userInfo,voteInfo:{...eE.userInfo.voteInfo,isLoserRewardClaimed:!1}})),(0,c.L6)(new c.HU(e,eA("ClaimOtherRewardFailed")).asToastMessage()),w.Z.E(e)}}async function oc(){var e;let o=null===(e=eE.nodeListFilters.selectedDao)||void 0===e?void 0:e.address;if(o)try{eW(!0),ez(!0),eT(T.Z.slice.actions.updateTime(Date.now())),await new Promise(e=>setTimeout(e,2e3)),await Promise.all([eN.updateInfo(),eb.updateRankSimpleInfo(o),ov(o),ow(o)]),await op(o),ek.handleAfterClaim&&await ek.handleAfterClaim()}catch(e){w.Z.E("Error in handleAfterClaim:",e)}finally{eW(!1),ez(!1)}}async function ov(e){var o;let t=Date.now();if(!e_&&t-eM<6e4||eV)return;let n=new h.Z;if(!(e=null!=e?e:null===(o=eE.nodeListFilters.selectedDao)||void 0===o?void 0:o.address)){(0,c.L6)(eA("NoSelectedDao"));return}try{eW(!0);let o=await n.getUserVoteNodeRankReward({userAddress:eS.ethInfo.walletAddress,daoAddress:e});eT(m.Z.slice.actions.updateUserRewardInfo({luckyReward:new a.Z(u.Z.wei2eth(o.luckyReward.reward)),voteTopReward:new a.Z(u.Z.wei2eth(o.voteTopReward.reward)),nodeTopReward:new a.Z(u.Z.wei2eth(o.nodeTopReward.reward))})),eO(t)}catch(e){(0,c.L6)(new c.HU(e,eA("GetUserVoteNodeRankRewardFailed")).asToastMessage()),w.Z.E(e)}finally{eW(!1)}}let of=n.useCallback(k()(e=>{var o;if(null===(o=eE.daoContractInfo)||void 0===o?void 0:o.daoAddress)return ov(eE.daoContractInfo.daoAddress)},800),[eE.daoContractInfo,eS.ethInfo.walletAddress]);async function ow(e){if(ex)return;let o=new h.Z,t=new g.q$p(o.buildConfigure()),n=await t.getLastClaimTime({daoAddress:e}),r=new y.zv(n);if(r.hasError()){let e=r.getError();(0,c.L6)(new c.HU(e,eA("GetLastClaimTimeFailed")).asToastMessage()),w.Z.E(e);return}let a=d.Z.Time.fromTimestamp(r.getData());ex||a.toJSTime()===eU||eP(a.toJSTime())}function oR(e,o){let t=Number("120");return new a.Z(u.Z.wei2eth(e)).multipliedBy(t).div(100).minus(u.Z.wei2eth(o))}n.useEffect(()=>{if(!eF||!eE.daoContractInfo||!eS.ethInfo.walletAddress)return;let e=l.Z.sleepForAnimationFrame(300);e.wait(()=>{of()});let o=setInterval(()=>{"visible"===document.visibilityState&&of()},6e4);return()=>{e.cancel(D.Z.ReactError.useEffectDestroy()),clearInterval(o)}},[eE.daoContractInfo,eS.ethInfo.walletAddress,eF,of]);let oI=n.useCallback(k()(e=>{ow(e)},500),[]);async function om(){var e;let o=null===(e=eE.nodeListFilters.selectedDao)||void 0===e?void 0:e.address;if(o&&eS.ethInfo.walletAddress)try{eW(!0),ez(!0),await Promise.all([eN.updateInfo(),eb.updateRankSimpleInfo(o),ov(o),ow(o)]),await op(o),eO(Date.now()),ez(!1)}catch(e){w.Z.E("Error in refreshAllData:",e)}finally{eW(!1)}}async function op(e){try{let o=v.r.getInstance(),t=u.Z.getInstance(o.getProvider()),n=f.bR.connect(e,await t.getSigner()),r=eS.ethInfo.walletAddress;if(!r)return;let a=await n.getVoteAndAirDropReward(r);if(eE.userInfo){let e={...eE.userInfo,voteAndAirDropReward:{...eE.userInfo.voteAndAirDropReward,clairReward:a.clairReward,airdropReward:a.airdropReward,nodeReward:a.nodeReward,airdropLinkReward:a.airdropLinkReward,reinvestReward:a.reinvestReward}};eT(m.Z.slice.actions.updateUserInfo(e))}}catch(e){w.Z.E("Error checking reward claim status:",e)}}return n.useEffect(()=>{var e;if((null===(e=eE.nodeListFilters.selectedDao)||void 0===e?void 0:e.address)&&eL.token)return oI(eE.nodeListFilters.selectedDao.address),()=>{oI.cancel()}},[null===(X=eE.nodeListFilters.selectedDao)||void 0===X?void 0:X.address,eL.token,oI]),n.useEffect(()=>{e_&&eF&&om()},[e_,eF]),{rewardItems:oa,handleVoteAirdropClaim:od,handleVoteRankClaim:oi,handleNodeRankClaim:ol,handleLuckyClaim:os,handleOtherClaim:ou,estimatePendingReward:oR,estimateUserPendingReward:function(){var e,o,t,n;return oR(null!==(t=null===(e=eE.userInfo)||void 0===e?void 0:e.voteInfo.votedAmount)&&void 0!==t?t:0n,null!==(n=null===(o=eE.userInfo)||void 0===o?void 0:o.voteInfo.ethDone)&&void 0!==n?n:0n)},getClaimNodeRewardCountdown:function(){if(!eE.daoContractInfo)return"";let e=Math.floor(eL.currentTime/1e3),o=86400*Math.floor(Math.floor(eq/1e3)/86400),t=o+604800*Math.floor((e-o)/604800)+604800-e;if(t<=0)return"00:00:00";let n=Math.floor(t/3600).toString().padStart(2,"0"),r=Math.floor(t%3600/60).toString().padStart(2,"0"),a=Math.floor(t%60).toString().padStart(2,"0");return"".concat(n,":").concat(r,":").concat(a)},refreshAllData:om,isUpdating:eV}}}}]);