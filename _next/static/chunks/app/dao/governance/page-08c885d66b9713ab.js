(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9086],{23560:function(e,t,n){Promise.resolve().then(n.bind(n,62097))},62097:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return C}});var a=n(57437),s=n(97235),o=n(68071),i=n(27635),r=n(38435),l=n(10990),d=n(89769),u=n(2265),c=n(43949),p=n(83123),m=n(79787),y=n(74439),h=n(6178),x=n(37455),g=n(64943),v=n(22928),f=n(10433),w=n(69356),b=n(50544),N=n(53335),j=n(41525),V=n(3682);function T(){let{t:e}=(0,c.$G)(["common","dao"]);return(0,a.jsxs)("div",{className:"py-8 space-y-6",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h1",{className:"text-2xl md:text-4xl font-bold text-white",children:e("GovernanceProposalSystemTitle",{ns:"dao"})}),(0,a.jsx)("p",{className:"text-base md:text-lg text-tip",children:e("GovernanceProposalSystemSubtitle",{ns:"dao"})})]}),(0,a.jsxs)("div",{className:"flex flex-col lg:flex-row gap-6 lg:gap-8",children:[(0,a.jsx)("div",{className:"flex-1 lg:max-w-[891px]",children:(0,a.jsx)(D,{})}),(0,a.jsx)("div",{className:"w-full lg:w-[420px] lg:flex-shrink-0",children:(0,a.jsx)(A,{})})]})]})}function D(){let{t:e}=(0,c.$G)(["common","dao"]),{governanceStore:t,castVote:n,loadRestartVotes:s,stopDao:o,restartDao:i}=function(e){var t,n,a,s,o,i,r,l,d,c,p,m;let y=(0,h.T)(),w=(0,h.C)(e=>e.governance),b=(0,h.C)(e=>e.user),N=(0,h.C)(e=>e.dao),j=u.useMemo(()=>new g.Z,[]),V=u.useMemo(()=>new v.Z,[]),T=function(){let[e,t]=u.useState({});return u.useEffect(()=>{let e=()=>{let e=new URLSearchParams(location.search),n={get:function(e){return this[e]}};for(let[t,a]of e.entries())n[t]=a;t(n)};return e(),window.addEventListener("popstate",e),()=>{window.removeEventListener("popstate",e)}},[]),e}(),D=(null==T?void 0:null===(t=T.get)||void 0===t?void 0:t.call(T,"daoAddress"))||(null==T?void 0:T.daoAddress),A=u.useCallback(async function(){var e,t,n,a;try{y(x.Z.slice.actions.setLoading(!0));let a=(null===(t=N.nodeListFilters)||void 0===t?void 0:null===(e=t.selectedDao)||void 0===e?void 0:e.address)||(null==D?void 0:D.trim())||(null===(n=w.overview)||void 0===n?void 0:n.daoAddress);if(!a)return null;let s=await j.getOverview(a);return y(x.Z.slice.actions.updateOverview(s)),y(x.Z.slice.actions.setError(null)),s}catch(e){throw f.Z.E("useRestartVote.updateOverview",e),y(x.Z.slice.actions.setError(null!==(a=null==e?void 0:e.message)&&void 0!==a?a:"Unknown error")),e}finally{y(x.Z.slice.actions.setLoading(!1))}},[y,j,null===(a=N.nodeListFilters)||void 0===a?void 0:null===(n=a.selectedDao)||void 0===n?void 0:n.address,D,null===(s=w.overview)||void 0===s?void 0:s.daoAddress]),S=u.useCallback(async function(e){let t=null!=e?e:b.ethInfo.walletAddress;if(!t)return y(x.Z.slice.actions.updateMyInfo(null)),null;try{var n,a,s;let e=(null===(a=N.nodeListFilters)||void 0===a?void 0:null===(n=a.selectedDao)||void 0===n?void 0:n.address)||(null==D?void 0:D.trim())||(null===(s=w.overview)||void 0===s?void 0:s.daoAddress);if(!e)return null;let o=await j.getMyInfo(t,e);return y(x.Z.slice.actions.updateMyInfo(o)),o}catch(e){throw f.Z.E("useRestartVote.updateMyInfo",e),e}},[y,j,b.ethInfo.walletAddress,null===(i=N.nodeListFilters)||void 0===i?void 0:null===(o=i.selectedDao)||void 0===o?void 0:o.address,D,null===(r=w.overview)||void 0===r?void 0:r.daoAddress]),R=u.useCallback(async function(e){var t,n,a,s,o,i,r,l;let d=w.overview;if(!d){f.Z.L("loadRestartVotes.skip",{reason:"no-overview"});return}let u=null!==(t=null==e?void 0:e.page)&&void 0!==t?t:1,c=null!==(n=null==e?void 0:e.pageSize)&&void 0!==n?n:5;try{y(x.Z.slice.actions.setRestartVotesLoading(!0)),f.Z.L("loadRestartVotes.begin",{daoAddress:d.daoAddress,round:d.currentVotingRound,page:u,pageSize:c});let e=await V.getRestartVotes({daoAddress:d.daoAddress,round:d.currentVotingRound,page:u,pageSize:c});if(null==e?void 0:null===(a=e.hasError)||void 0===a?void 0:a.call(e)){let t=null===(o=e.getError)||void 0===o?void 0:o.call(e);throw f.Z.L("loadRestartVotes.error",t),t}let t=null!==(i=null===(s=e.getData)||void 0===s?void 0:s.call(e))&&void 0!==i?i:[];f.Z.L("loadRestartVotes.raw",{length:null!==(r=null==t?void 0:t.length)&&void 0!==r?r:0,sample:null==t?void 0:t[0]});let n=t.map(e=>({userAddress:e.userAddress,txHash:e.txHash,voteTime:e.voteTime,voteNumber:e.voteNumber,voteAmount:e.voteAmount,choice:e.choice}));f.Z.L("loadRestartVotes.mapped",{length:n.length,first:n[0]});let p="function"==typeof e.getTotalPage&&null!==(l=e.getTotalPage())&&void 0!==l?l:null;if("number"==typeof p&&p>0){let e=p*c;y(x.Z.slice.actions.setRestartVotes({data:n,page:u,total:e})),f.Z.L("loadRestartVotes.dispatched",{page:u,total:e})}else y(x.Z.slice.actions.setRestartVotes({data:n,page:u})),f.Z.L("loadRestartVotes.dispatched(no-total)",{page:u})}catch(e){f.Z.L("useRestartVote.loadRestartVotes",e)}finally{y(x.Z.slice.actions.setRestartVotesLoading(!1)),f.Z.L("loadRestartVotes.end")}},[V,y,w.overview]);u.useEffect(()=>{(null==e?void 0:e.auto)&&A()},[null==e?void 0:e.auto,A]),u.useEffect(()=>{(null==e?void 0:e.auto)&&S()},[null==e?void 0:e.auto,b.ethInfo.walletAddress,S]),u.useEffect(()=>{(null==e?void 0:e.auto)&&w.overview&&R({page:1})},[null==e?void 0:e.auto,null===(l=w.overview)||void 0===l?void 0:l.daoAddress,null===(d=w.overview)||void 0===d?void 0:d.currentVotingRound]);let E=u.useCallback(async e=>{var t;let n=null===(t=w.overview)||void 0===t?void 0:t.daoAddress;if(!n)throw Error("Missing DAO address");let a=await j.castVote(n,e);return await Promise.all([A(),S(),R({page:1})]),a},[null===(c=w.overview)||void 0===c?void 0:c.daoAddress,j,A,S,R]),C=u.useCallback(async()=>{var e,t,n,a,s,o,i,r,l;let d=null===(e=w.overview)||void 0===e?void 0:e.restartVotecontractAddress;if(!d)throw Error("Missing RestartVote contract address");f.Z.L("stopDao.begin",{restartVoteAddress:d,overview:w.overview,currentStatus:null===(t=w.overview)||void 0===t?void 0:t.currentStatus,continueVotes:null===(a=w.overview)||void 0===a?void 0:null===(n=a.continueVotes)||void 0===n?void 0:n.toString(),restartVotes:null===(o=w.overview)||void 0===o?void 0:null===(s=o.restartVotes)||void 0===s?void 0:s.toString(),totalVoters:null===(r=w.overview)||void 0===r?void 0:null===(i=r.totalVoters)||void 0===i?void 0:i.toString(),isVotingActive:null===(l=w.overview)||void 0===l?void 0:l.isVotingActive});let u=await j.stopDaoByAddress(d);return f.Z.L("stopDao.success",{txHash:u}),await A(),u},[null===(p=w.overview)||void 0===p?void 0:p.restartVotecontractAddress,w.overview,j,A]),M=u.useCallback(async()=>{var e;let t=null===(e=w.overview)||void 0===e?void 0:e.restartVotecontractAddress;if(!t)throw Error("Missing RestartVote contract address");let n=await j.restartDaoByAddress(t);return await A(),n},[null===(m=w.overview)||void 0===m?void 0:m.restartVotecontractAddress,j,A]);return{governanceStore:w,updateOverview:A,updateMyInfo:S,loadRestartVotes:R,castVote:E,stopDao:C,restartDao:M}}({auto:!0});return(0,a.jsx)("div",{className:"space-y-6",children:(0,a.jsx)(S,{governanceStore:t,castVote:n,loadRestartVotes:s,stopDao:o,restartDao:i})})}function A(){var e,t;let{t:n}=(0,c.$G)(["common","dao"]);(0,h.T)();let s=(0,h.C)(e=>e.user.ethInfo.isConnected),o=(0,h.C)(e=>e.governance.myInfo),i=(0,h.C)(e=>e.user.ethInfo.walletAddress),{getNodeTypeByAddress:r}=(0,b.Z)(),[l,m]=u.useState(null);u.useEffect(()=>{if(!s||!i){m(null);return}let e=!0;return r(i).then(t=>{e&&m(t)}).catch(()=>{e&&m(d.r.NodeType.NONE)}),()=>{e=!1}},[s,i,r]);let y=u.useMemo(()=>{if(!s)return null;if(o&&!o.isEligibleToVote)return n("NoPermission",{ns:"dao"});switch(l){case d.r.NodeType.SUPER:return n("superNode.title",{ns:"dao"});case d.r.NodeType.MASTER:return n("mainNode.title",{ns:"dao"});case d.r.NodeType.CANDIDATE:return n("candidateNode.title",{ns:"dao"});case d.r.NodeType.NONE:default:return n("NormalAddress",{ns:"dao"})}},[s,o,l,n]),x=(0,b.Z)(),g=!!(s&&o&&!o.isEligibleToVote),v=x.nodeMap.get(null!=l?l:d.r.NodeType.NONE),f=(null!=l?l:d.r.NodeType.NONE)===d.r.NodeType.NONE,w=g?"#797575":f?"#E700E6":null!==(e=null==v?void 0:v.color1)&&void 0!==e?e:"#E700E6",j=g?"#797575":f?"#4B4BDF":null!==(t=null==v?void 0:v.color2)&&void 0!==t?t:"#4B4BDF",V=()=>{(0,p.x9)(n("ComingSoon",{ns:"common"}))};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-[#050505] border border-[#666666] rounded-lg p-6 relative",children:[y&&(0,a.jsx)("div",{className:"absolute top-4 right-4",children:(0,a.jsx)("div",{className:(0,N.m6)("p-[1px] rounded","bg-gradient-to-r from-[".concat(w,"] to-[").concat(j,"]")),style:{backgroundImage:"linear-gradient(to right, ".concat(w,", ").concat(j,")")},children:(0,a.jsx)("div",{className:"bg-black w-[100px] h-[22px] flex items-center justify-center leading-none rounded",children:(0,a.jsx)("span",{className:(0,N.m6)("text-[10px] leading-none font-medium bg-gradient-to-r bg-clip-text text-transparent","from-[".concat(w,"] to-[").concat(j,"]")),style:{backgroundImage:"linear-gradient(to right, ".concat(w,", ").concat(j,")")},children:y})})})}),(0,a.jsx)("h3",{className:"text-lg font-medium text-white mb-4",children:n("CurrentStatus",{ns:"dao"})}),!s&&(0,a.jsx)("div",{className:"space-y-3",children:(0,a.jsx)("p",{className:"text-sm text-tip",children:n("NoConnectWalletTip",{ns:"common"})})}),s&&(0,a.jsxs)("div",{className:"space-y-2",children:[!o&&(0,a.jsx)("p",{className:"text-sm text-tip",children:n("Loading",{ns:"dao"})}),o&&o.hasVoted&&(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("p",{className:"text-sm text-green-400 font-medium",children:n("AlreadyVoted",{ns:"dao"})}),(0,a.jsx)("p",{className:"text-xs text-tip",children:new Date(o.timestamp).toLocaleString()}),(0,a.jsx)("p",{className:"text-sm font-medium",children:1===o.choice?(0,a.jsx)("span",{className:"text-green-400",children:n("Support",{ns:"dao"})}):(0,a.jsx)("span",{className:"text-red-400",children:n("Oppose",{ns:"dao"})})})]}),o&&!o.hasVoted&&!o.isEligibleToVote&&(0,a.jsx)("p",{className:"text-sm text-tip",children:n("NoVotingEligibility",{ns:"dao"})}),o&&!o.hasVoted&&o.isEligibleToVote&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("span",{className:"text-sm text-tip",children:[n("votesTitle",{ns:"dao"}),":"]}),(0,a.jsx)("span",{className:"text-white text-sm font-medium",children:Number(o.votingWeight).toLocaleString()})]}),(0,a.jsxs)("div",{className:"space-y-3 mt-4",children:[(0,a.jsx)("button",{onClick:V,className:"w-full py-3 px-4 bg-gradient-to-r from-primary to-highlight text-white font-medium rounded-lg hover:opacity-90 transition-opacity",children:n("CreateNewProposal",{ns:"dao"})}),(0,a.jsx)("button",{onClick:V,className:"w-full py-3 px-4 border border-[#666666] text-white font-medium rounded-lg hover:bg-[#1a1a1a] transition-colors",children:n("ViewMyProposals",{ns:"dao"})})]})]})]}),(0,a.jsxs)("div",{className:"bg-[#050505] border border-[#666666] rounded-lg p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-white mb-4",children:n("GovernanceRules",{ns:"dao"})}),(0,a.jsxs)("div",{className:"space-y-3 text-sm text-tip",children:[(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[(0,a.jsx)("span",{className:"text-primary",children:"•"}),(0,a.jsx)("span",{children:n("RuleOnlyDAOAddresses",{ns:"dao"})})]}),(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[(0,a.jsx)("span",{className:"text-primary",children:"•"}),(0,a.jsx)("span",{children:n("RuleVoteWeights",{ns:"dao"})})]}),(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[(0,a.jsx)("span",{className:"text-primary",children:"•"}),(0,a.jsx)("span",{children:n("RuleOneVotePerProposal",{ns:"dao"})})]}),(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[(0,a.jsx)("span",{className:"text-primary",children:"•"}),(0,a.jsx)("span",{children:n("SupportRatePass",{ns:"dao",rate:60})})]}),(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[(0,a.jsx)("span",{className:"text-primary",children:"•"}),(0,a.jsx)("span",{children:n("VotingPeriodHours",{ns:"dao",hours:48})})]})]})]})]})}function S(e){var t,n;let{governanceStore:s,castVote:o,loadRestartVotes:i,stopDao:r,restartDao:l}=e,{t:d}=(0,c.$G)(["dao"]),u=s.overview,p=s.isLoading,m=!!(null==u?void 0:u.restartVotecontractAddress);if(p&&!u)return(0,a.jsx)("div",{className:"bg-[#050505] border border-[#666666] rounded-lg p-6 hover:border-[#888888] transition-colors",children:(0,a.jsx)("div",{className:"flex flex-col gap-2",children:(0,a.jsx)("h3",{className:"text-lg font-medium text-white",children:d("Loading",{ns:"dao"})})})});if(!m)return(0,a.jsx)("div",{className:"bg-[#050505] border border-[#666666] rounded-lg p-6 hover:border-[#888888] transition-colors",children:(0,a.jsx)("div",{className:"flex flex-col gap-2",children:(0,a.jsx)("h3",{className:"text-lg font-medium text-white",children:d("NoProposal",{ns:"dao"})})})});let y=Date.now(),h=(null==u?void 0:u.currentStatus)||1,x=Number((null!==(t=null==u?void 0:u.continueVotes)&&void 0!==t?t:0n)+(null!==(n=null==u?void 0:u.restartVotes)&&void 0!==n?n:0n)),g=(()=>{var e,t,n;let a=(null!==(e=null==u?void 0:u.continueVotes)&&void 0!==e?e:0n)+(null!==(t=null==u?void 0:u.restartVotes)&&void 0!==t?t:0n);return 0n===a?0:Math.round(Number((null!==(n=null==u?void 0:u.restartVotes)&&void 0!==n?n:0n)*10000n/a)/100)})(),v=1===h?null==u?void 0:u.votingStartTime:2===h?null==u?void 0:u.votingEndTime:5===h?null==u?void 0:u.stopResumeTime:void 0,f=v?(()=>{let e=Math.max(0,v-y),t=String(Math.floor(e/36e5)).padStart(2,"0"),n=String(Math.floor(e%36e5/6e4)).padStart(2,"0"),a=String(Math.floor(e%6e4/1e3)).padStart(2,"0");return"".concat(t,":").concat(n,":").concat(a)})():"--:--:--";return(0,a.jsx)(R,{title:d("RestartDAOProposalTitle"),description:d("RestartDAOProposalDescription"),statusCode:h,countdownText:f,voteCount:x,supportRate:g,castVote:o,loadRestartVotes:i,stopDao:r,restartDao:l})}function R(e){var t,n,s;let{title:o,description:i,statusCode:r,countdownText:l,voteCount:d,supportRate:x,castVote:g,loadRestartVotes:v,stopDao:b,restartDao:N}=e,{t:T}=(0,c.$G)(["common","dao"]),D=(0,h.T)(),[A,S]=u.useState(!0),[R,E]=u.useState(1),[C,M]=u.useState(!1),[I,Z]=u.useState(null),[L,P]=u.useState(null),[k,O]=u.useState(!1),B=e=>{switch(e){case 2:case 3:return"text-green-400";case 1:case 5:return"text-yellow-400";case 4:return"text-red-400";case 6:return"text-blue-400";default:return"text-gray-400"}},F=(0,h.C)(e=>e.governance.restartVotes),U=(0,h.C)(e=>e.governance.myInfo),H=(0,h.C)(e=>e.user.ethInfo.isConnected),_=Math.max(1,Math.ceil(((null!==(s=null!==(n=F.total)&&void 0!==n?n:null===(t=F.data)||void 0===t?void 0:t.length)&&void 0!==s?s:0)||5*R)/5)),W=F.data||[],Q=u.useMemo(()=>{if(_<=3)return Array.from({length:_},(e,t)=>t+1);let e=Math.floor(1.5),t=R-e,n=R+e;return t<1&&(t=1,n=3),n>_&&(n=_,t=_-3+1),Array.from({length:n-t+1},(e,n)=>t+n)},[R,_,3]),G=_>3&&Q[0]>2,z=_>3&&Q[Q.length-1]<_-1;u.useEffect(()=>{v({page:R})},[R]);let $=2===r,Y=V.Q.getTargetNet(),J={justNow:T("JustNow",{ns:"common"}),minutesAgo:T("MinutesAgo",{ns:"common",minutes:"{0}"}),hoursAgo:T("HoursAgo",{ns:"common",hours:"{0}"}),daysAgo:T("DaysAgo",{ns:"common",days:"{0}"}),monthsAgo:T("MonthsAgo",{ns:"common",months:"{0}"}),yearsAgo:T("YearsAgo",{ns:"common",years:"{0}"}),yesterday:T("Yesterday",{ns:"common"}),today:T("Today",{ns:"common"})},K=async e=>{if(!$){(0,p.L6)(T("VotingNotStarted",{ns:"dao"}));return}if(!H){D(w.Z.slice.actions.updateNeedBinding(!0)),(0,p.L6)(T("NoConnectWalletTip",{ns:"common"}));return}if(!(null==U?void 0:U.isEligibleToVote)){(0,p.L6)(T("NoVotingEligibility",{ns:"dao"}));return}if(null==U?void 0:U.hasVoted){(0,p.L6)(T("AlreadyVoted",{ns:"dao"}));return}try{M(!0),Z(e),await g(e),(0,p.x9)(T("VoteSuccess",{ns:"dao"}))}catch(t){let e=(null==t?void 0:t.shortMessage)||(null==t?void 0:t.message)||T("VoteFailed",{ns:"dao"});(0,p.L6)(e)}finally{M(!1),Z(null)}},X=async()=>{try{f.Z.L("\uD83C\uDFAF [handleStopDao] 用户点击停止DAO按钮",{statusCode:r,timestamp:new Date().toISOString()}),P("stop"),f.Z.L("\uD83C\uDFAF [handleStopDao] 开始调用stopDao函数");let e=await b();f.Z.L("\uD83C\uDFAF [handleStopDao] stopDao调用成功",{txHash:e}),(0,p.x9)(T("OperationSuccess",{ns:"common"}))}catch(t){f.Z.E("❌ [handleStopDao] 停止DAO操作失败",{error:null==t?void 0:t.message,shortMessage:null==t?void 0:t.shortMessage,code:null==t?void 0:t.code,data:null==t?void 0:t.data,reason:null==t?void 0:t.reason,stack:null==t?void 0:t.stack,fullError:t});let e=(null==t?void 0:t.shortMessage)||(null==t?void 0:t.message)||T("OperationFailed",{ns:"common"});(0,p.L6)("停止DAO失败: ".concat(e))}finally{P(null)}},q=async()=>{try{P("restart"),await N(),(0,p.x9)(T("OperationSuccess",{ns:"common"}))}catch(t){let e=(null==t?void 0:t.shortMessage)||(null==t?void 0:t.message)||T("OperationFailed",{ns:"common"});(0,p.L6)(e)}finally{P(null)}};return(0,a.jsxs)("div",{className:"bg-[#050505] border border-[#666666] rounded-lg p-6 hover:border-[#888888] transition-colors relative",children:[(0,a.jsxs)("div",{className:"cursor-pointer",onClick:()=>S(!A),children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-2 sm:gap-4 mb-2",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-white flex items-center gap-2",children:o}),(0,a.jsxs)("div",{className:"flex flex-row items-center justify-start sm:justify-end gap-1 whitespace-nowrap leading-tight",children:[(0,a.jsx)("span",{className:"text-sm font-medium ".concat(B(r)),children:(e=>{switch(e){case 1:return T("VotingNotStarted",{ns:"dao"});case 2:return T("VotingInProgress",{ns:"dao"});case 3:return T("Passed",{ns:"dao"});case 4:return T("NotPassed",{ns:"dao"});case 5:return T("DAOStopping",{ns:"dao"});case 6:return T("DAORestarting",{ns:"dao"});default:return T("Unknown",{ns:"common"})}})(r)}),[1,2,5].includes(r)&&(0,a.jsxs)("span",{className:"text-sm font-medium ".concat(B(r)," font-mono tabular-nums ml-1"),children:["(",l,")"]})]})]}),(0,a.jsx)("p",{className:"text-tip text-sm leading-relaxed whitespace-pre-line w-full mb-4",children:i.replaceAll("\\n","\n")}),(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("span",{className:"text-sm text-tip",children:[T("TotalVotes",{ns:"dao"}),": ",(0,a.jsx)("span",{className:"text-white",children:d.toLocaleString()})]}),(0,a.jsxs)("span",{className:"text-sm text-tip",children:[T("SupportRate",{ns:"dao"}),": ",(0,a.jsxs)("span",{className:"text-white",children:[x,"%"]})]}),(0,a.jsx)("button",{className:"ml-2 text-tip hover:text-white focus:outline-none",onClick:e=>{e.stopPropagation(),O(e=>!e)},"aria-label":T("Help",{ns:"common"}),title:T("Help",{ns:"common"}),children:(0,a.jsxs)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,a.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,a.jsx)("path",{d:"M9.5 9a2.5 2.5 0 1 1 4 2c-.9.6-1.5 1-1.5 2v1"}),(0,a.jsx)("circle",{cx:"12",cy:"17",r:"1"})]})})]}),k&&(0,a.jsx)("div",{className:"bg-[#0a0a0a] border border-[#666666] rounded-lg p-3 text-sm text-tip",onClick:e=>e.stopPropagation(),children:(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[(0,a.jsx)("span",{className:"text-primary",children:"•"}),(0,a.jsx)("span",{children:T("GovernanceHelpTip1",{ns:"dao"})})]}),(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[(0,a.jsx)("span",{className:"text-primary",children:"•"}),(0,a.jsx)("span",{children:T("GovernanceHelpTip2",{ns:"dao"})})]}),(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[(0,a.jsx)("span",{className:"text-primary",children:"•"}),(0,a.jsx)("span",{children:T("GovernanceHelpTip3",{ns:"dao"})})]})]})}),r>=1&&(0,a.jsxs)("div",{className:"flex flex-wrap gap-2 w-full",children:[(0,a.jsx)("button",{className:"flex-none basis-1/2 sm:flex-1 sm:basis-auto min-w-0 px-4 py-2 border border-[#666666] text-white text-sm rounded hover:bg-[#1a1a1a] transition-colors disabled:opacity-60 disabled:cursor-not-allowed text-center",disabled:3!==r||null!==L,onClick:e=>{e.stopPropagation(),3===r&&X()},children:T("StopDAO",{ns:"dao"})}),(0,a.jsx)("button",{className:"flex-none basis-1/2 sm:flex-1 sm:basis-auto min-w-0 px-4 py-2 border border-[#666666] text-white text-sm rounded hover:bg-[#1a1a1a] transition-colors disabled:opacity-60 disabled:cursor-not-allowed text-center",disabled:6!==r||null!==L,onClick:e=>{e.stopPropagation(),6===r&&q()},children:T("RestartDAO",{ns:"dao"})}),(0,a.jsxs)("button",{className:"flex-none basis-1/2 sm:flex-1 sm:basis-auto min-w-0 px-4 py-2 border border-[#666666] text-white text-sm rounded hover:bg-[#1a1a1a] transition-colors disabled:opacity-60 disabled:cursor-not-allowed text-center flex items-center justify-center gap-1",disabled:C||!$,onClick:e=>{e.stopPropagation(),K(1)},children:[(0,a.jsx)("span",{"aria-hidden":!0,children:"\uD83D\uDC4D"}),(0,a.jsx)("span",{children:C&&0===I?T("Submitting",{ns:"common"}):T("Support",{ns:"dao"})})]}),(0,a.jsxs)("button",{className:"flex-none basis-1/2 sm:flex-1 sm:basis-auto min-w-0 px-4 py-2 border border-[#666666] text-white text-sm rounded hover:bg-[#1a1a1a] transition-colors disabled:opacity-60 disabled:cursor-not-allowed text-center flex items-center justify-center gap-1",disabled:C||!$,onClick:e=>{e.stopPropagation(),K(0)},children:[(0,a.jsx)("span",{"aria-hidden":!0,children:"\uD83D\uDC4E"}),(0,a.jsx)("span",{children:C&&1===I?T("Submitting",{ns:"common"}):T("Oppose",{ns:"dao"})})]})]}),[3,4].includes(r)&&(0,a.jsx)("div",{className:"flex justify-end sm:justify-start",children:(0,a.jsx)("span",{className:"text-sm text-tip",children:x>=60?"✅ ".concat(T("Passed",{ns:"dao"})):"❌ ".concat(T("NotPassed",{ns:"dao"}))})})]}),(0,a.jsx)("div",{className:"flex justify-center mt-4",children:(0,a.jsxs)("div",{className:"flex items-center gap-2 text-tip text-xs",children:[(0,a.jsx)("span",{children:A?T("ClickToCollapseVotingRecords",{ns:"dao"}):T("ClickToExpandVotingRecords",{ns:"dao"})}),(0,a.jsxs)("div",{className:"flex gap-1",children:[(0,a.jsx)("div",{className:"w-1 h-1 bg-tip rounded-full opacity-60"}),(0,a.jsx)("div",{className:"w-1 h-1 bg-tip rounded-full opacity-40"}),(0,a.jsx)("div",{className:"w-1 h-1 bg-tip rounded-full opacity-20"})]})]})})]}),A&&(0,a.jsxs)("div",{className:"mt-6 pt-6 border-t border-[#666666]",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h4",{className:"text-white font-medium",children:T("VotingRecords",{ns:"dao"})}),(0,a.jsx)("span",{className:"text-tip text-sm",children:T("TotalRecords",{ns:"dao",count:F.total||W.length})})]}),(0,a.jsx)("div",{className:"space-y-3",children:W.map((e,t)=>{let n=m.Z.toShort(e.userAddress,6,4),s=m.Z.toShort(e.userAddress,4,2),o=y.Z.latestDate(new Date(e.voteTime),J),i=1===e.choice;return(0,a.jsxs)("div",{className:"grid grid-cols-[auto_1fr_100px] items-center gap-2 p-3 bg-[#0a0a0a] rounded-lg",children:[(0,a.jsx)("div",{className:"flex items-center gap-3 min-w-0",children:e.txHash?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"sm:hidden",children:(0,a.jsx)(j.Z,{chainId:Y.chainId,hash:e.txHash,text:s,className:"text-white font-mono text-sm whitespace-nowrap truncate max-w-full"})}),(0,a.jsx)("span",{className:"hidden sm:inline",children:(0,a.jsx)(j.Z,{chainId:Y.chainId,hash:e.txHash,text:n,className:"text-white font-mono text-sm whitespace-nowrap truncate max-w-full"})})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"text-white font-mono text-sm whitespace-nowrap truncate max-w-full sm:hidden",children:s}),(0,a.jsx)("span",{className:"text-white font-mono text-sm whitespace-nowrap truncate max-w-full hidden sm:inline",children:n})]})}),(0,a.jsx)("div",{className:"flex items-center justify-center",children:(0,a.jsxs)("span",{className:"text-sm font-medium whitespace-nowrap text-center ".concat(i?"text-green-400":"text-red-400"),children:[i?T("Support",{ns:"dao"}):T("Oppose",{ns:"dao"}),"(",e.voteNumber,")"]})}),(0,a.jsx)("span",{className:"text-tip text-xs text-right whitespace-nowrap justify-self-end",children:o})]},t)})}),_>1&&(0,a.jsxs)("div",{className:"flex justify-center items-center gap-2 sm:gap-4 mt-6",children:[(0,a.jsxs)("button",{onClick:()=>E(e=>Math.max(e-1,1)),disabled:1===R,className:"px-0 sm:px-3 py-0 sm:py-1 w-8 h-8 sm:w-auto sm:h-auto text-sm border border-[#666666] text-white rounded hover:bg-[#1a1a1a] transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:[(0,a.jsx)("span",{className:"sm:hidden","aria-hidden":!0,children:"‹"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:T("PreviousPage",{ns:"common"})})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[_>3&&G&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>E(1),className:"w-8 h-8 text-sm rounded transition-colors ".concat(1===R?"bg-gradient-to-r from-primary to-highlight text-white":"border border-[#666666] text-white hover:bg-[#1a1a1a]"),children:1}),(0,a.jsx)("span",{className:"text-tip",children:"..."})]}),Q.map(e=>(0,a.jsx)("button",{onClick:()=>E(e),className:"w-8 h-8 text-sm rounded transition-colors ".concat(R===e?"bg-gradient-to-r from-primary to-highlight text-white":"border border-[#666666] text-white hover:bg-[#1a1a1a]"),children:e},e)),_>3&&z&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"text-tip",children:"..."}),(0,a.jsx)("button",{onClick:()=>E(_),className:"w-8 h-8 text-sm rounded transition-colors ".concat(R===_?"bg-gradient-to-r from-primary to-highlight text-white":"border border-[#666666] text-white hover:bg-[#1a1a1a]"),children:_})]})]}),(0,a.jsxs)("button",{onClick:()=>E(e=>Math.min(e+1,_)),disabled:R===_,className:"px-0 sm:px-3 py-0 sm:py-1 w-8 h-8 sm:w-auto sm:h-auto text-sm border border-[#666666] text-white rounded hover:bg-[#1a1a1a] transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:[(0,a.jsx)("span",{className:"sm:hidden","aria-hidden":!0,children:"›"}),(0,a.jsx)("span",{className:"hidden sm:inline",children:T("NextPage",{ns:"common"})})]})]})]})]})}var E=n(72917);function C(){var e,t;let n=(0,h.C)(e=>e.dao);return(0,E.Z)(void 0,{autoTrigger:!0,autoUpdateTokenInfo:!0}),(0,a.jsx)("div",{className:"relative overflow-x-hidden text-secondary bg-[#000000]",children:(0,a.jsxs)("div",{className:"w-full",children:[(0,a.jsx)(r.Z,{}),(0,a.jsx)(s.Z,{}),(0,a.jsxs)(o.ZP,{width:o.W7.ContentV2,background:o.nV.None,className:"mx-[20px] 2xl:mx-auto",children:[(0,a.jsx)(l.Z,{activeTarget:d.r.VotingTabEnum.GOVERNANCE}),(0,a.jsx)("div",{className:"mt-[20px]",children:(0,a.jsx)(T,{})},null!==(t=null===(e=n.nodeListFilters.selectedDao)||void 0===e?void 0:e.address)&&void 0!==t?t:"_"),(0,a.jsx)(i.Z,{})]})]})})}},41525:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});var a=n(57437);n(2265),n(34159);var s=n(22448),o=n(10867),i=n(3682);function r(e){let{chainId:t,hash:n,text:r,children:l,className:d,...u}=e,c=(0,a.jsx)(s.Z,{children:n}),p=new i.Q(t).getTXUrl(n);return(0,a.jsx)(o.Z,{placement:"top",speaker:c,trigger:"hover",children:(0,a.jsx)("a",{className:"component-chain-hash-link pointer hover underline ".concat(null!=d?d:""),href:p,target:"_blank",...u,children:null!=r?r:n})})}},425:function(e,t,n){"use strict";n.d(t,{x:function(){return a}});let a=[{inputs:[],stateMutability:"nonpayable",type:"constructor"},{inputs:[{internalType:"address",name:"target",type:"address"}],name:"AddressEmptyCode",type:"error"},{inputs:[{internalType:"address",name:"implementation",type:"address"}],name:"ERC1967InvalidImplementation",type:"error"},{inputs:[],name:"ERC1967NonPayable",type:"error"},{inputs:[],name:"FailedCall",type:"error"},{inputs:[],name:"InvalidInitialization",type:"error"},{inputs:[],name:"NotInitializing",type:"error"},{inputs:[],name:"UUPSUnauthorizedCallContext",type:"error"},{inputs:[{internalType:"bytes32",name:"slot",type:"bytes32"}],name:"UUPSUnsupportedProxiableUUID",type:"error"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint8",name:"target",type:"uint8"},{indexed:!1,internalType:"bytes",name:"key",type:"bytes"},{indexed:!1,internalType:"bytes",name:"value",type:"bytes"},{indexed:!0,internalType:"address",name:"caller",type:"address"},{indexed:!1,internalType:"uint256",name:"timestamp",type:"uint256"}],name:"DebugValueSet",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint64",name:"version",type:"uint64"}],name:"Initialized",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"implementation",type:"address"}],name:"Upgraded",type:"event"},{inputs:[],name:"UPGRADE_INTERFACE_VERSION",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"VOTING_DURATION",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"continueVotes",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"currentVotingRound",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"dao",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint8",name:"target",type:"uint8"},{internalType:"bytes",name:"key",type:"bytes"},{internalType:"bytes",name:"value",type:"bytes"}],name:"debugSet",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"factory",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"getCurrentStatus",outputs:[{internalType:"uint8",name:"",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"user",type:"address"}],name:"getVotingWeight",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint8",name:"nodeType",type:"uint8"}],name:"getWeightByNodeType",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"address",name:"_dao",type:"address"}],name:"initialize",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"user",type:"address"}],name:"isEligibleToVote",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"isVotingActive",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"isVotingFinished",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"isVotingPassed",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"proxiableUUID",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"restartDao",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"restartVotes",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"roundRestart",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"roundStop",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"startTime",type:"uint256"}],name:"startVoting",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"stopDao",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"totalVoters",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"newImplementation",type:"address"}],name:"upgradeTo",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"newImplementation",type:"address"},{internalType:"bytes",name:"data",type:"bytes"}],name:"upgradeToAndCall",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"enum RestartVote.VoteOption",name:"choice",type:"uint8"}],name:"vote",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"},{internalType:"address",name:"",type:"address"}],name:"votes",outputs:[{internalType:"bool",name:"hasVoted",type:"bool"},{internalType:"enum RestartVote.VoteOption",name:"choice",type:"uint8"},{internalType:"uint256",name:"weight",type:"uint256"},{internalType:"uint256",name:"timestamp",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"votingStartTime",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"}]},64943:function(e,t,n){"use strict";n.d(t,{Z:function(){return h}});var a=n(5853),s=n(8113),o=n(63671),i=n(3682),r=n(21707),l=n(425),d=n(81939),u=n(13965),c=n(10433),p=n(59868);let m=[{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"dao",type:"address"},{indexed:!0,internalType:"address",name:"creator",type:"address"},{indexed:!1,internalType:"uint256",name:"timestamp",type:"uint256"}],name:"RestartVoteCreated",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"dao",type:"address"},{indexed:!0,internalType:"address",name:"voter",type:"address"},{indexed:!1,internalType:"uint256",name:"weight",type:"uint256"},{indexed:!1,internalType:"uint8",name:"choice",type:"uint8"},{indexed:!1,internalType:"uint256",name:"currentRoundNO",type:"uint256"},{indexed:!1,internalType:"uint256",name:"timestamp",type:"uint256"}],name:"VoteCast",type:"event"},{inputs:[{internalType:"address",name:"_dao",type:"address"}],name:"createRestartVote",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_dao",type:"address"}],name:"daoAddresses",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_dao",type:"address"},{internalType:"uint256",name:"startTime",type:"uint256"}],name:"startVoting",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_newImplementation",type:"address"}],name:"updateDaoImplementation",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"daoProxy",type:"address"}],name:"upgradeRestartVote",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address[]",name:"restartVotes",type:"address[]"}],name:"upgradeRestartVoteBatch",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"dao",type:"address"},{internalType:"address",name:"voter",type:"address"},{internalType:"uint256",name:"weight",type:"uint256"},{internalType:"uint8",name:"voteOption",type:"uint8"},{internalType:"uint256",name:"currentRoundNO",type:"uint256"}],name:"voteEvent",outputs:[],stateMutability:"nonpayable",type:"function"}];var y=n(40366);class h extends o.bQ{async getRestartVoteAddress(e){let t="0xAafb6689aED0e6D16d6Ee9af84a1f3044a5B79E6";if(!t)return null;let n=i.Q.getDefaultProvider(),a=i.Q.getTargetNet().chainId,s=new r.z(a,n),o=new r.C(t,m);try{let t=await s.all([o.daoAddresses(e)]).then(e=>{let[t]=e;return t});if(!t||"0x0000000000000000000000000000000000000000"===t)return null;return t}catch(e){return null}}async getOverview(e){let t="0xAafb6689aED0e6D16d6Ee9af84a1f3044a5B79E6",n=await this.getRestartVoteAddress(e);if(!n)return{restartVotecontractAddress:"",restartVoteFactoryContractAddress:t,daoAddress:e,isVotingActive:!1,votingStartTime:0,votingEndTime:0,votingDurationSeconds:0,currentVotingRound:0,continueVotes:0n,restartVotes:0n,totalVoters:0n,currentStatus:1,roundExpire:0,stopResumeTime:0};let a=i.Q.getDefaultProvider(),s=i.Q.getTargetNet().chainId,o=new r.z(s,a),d=new r.C(n,l.x),[u,c,p,m,h,x]=await o.all([d.currentVotingRound(),d.isVotingActive(),d.votingStartTime(),d.VOTING_DURATION(),d.dao(),d.getCurrentStatus()]),g=Number(u),[v,f,w]=await o.all([d.continueVotes(u),d.restartVotes(u),d.totalVoters(u)]),b=1e3*Number(p),N=1e3*Number(m),j=0,V=0;try{if(5===Number(x)||6===Number(x)){let e=new r.C(h,y.K),t=await o.all([e.roundExpire(u)]).then(e=>{let[t]=e;return t});V=(j=1e3*Number(t))+1728e5}}catch(e){}return{restartVotecontractAddress:n,restartVoteFactoryContractAddress:t,daoAddress:h,isVotingActive:c,votingStartTime:b,votingEndTime:b+N,votingDurationSeconds:Number(m),currentVotingRound:g,continueVotes:v,restartVotes:f,totalVoters:w,currentStatus:Number(x),roundExpire:j,stopResumeTime:V}}async getMyInfo(e,t){let n=await this.getRestartVoteAddress(t);if(!n)return{restartVotecontractAddress:"",currentVotingRound:0,isEligibleToVote:!1,votingWeight:0n,hasVoted:!1,choice:0,weight:0n,timestamp:0};let a=i.Q.getDefaultProvider(),s=i.Q.getTargetNet().chainId,o=new r.z(s,a),d=new r.C(n,l.x),[u,c,p]=await o.all([d.currentVotingRound(),d.isEligibleToVote(e),d.getVotingWeight(e)]),m=Number(u),[y,h,x,g]=await o.all([d.votes(u,e)]).then(e=>{let[t]=e;return t});return{restartVotecontractAddress:n,currentVotingRound:m,isEligibleToVote:c,votingWeight:p,hasVoted:y,choice:Number(h),weight:x,timestamp:1e3*Number(g)}}async castVote(e,t){let n=await this.getRestartVoteAddress(e);if(!n)throw Error("RestartVote contract address not found");let a=i.Q.getTargetNet(),s=u.r.getInstance().getProvider();if(!s)throw Error("Wallet not connected");let o=d.Z.getInstance(s,a.chainId),r=await o.getSigner(),c=new p.CH(n,l.x,r),m=await c.vote(t);return await m.wait(),m.hash}async getCurrentStatus(e){let t=await this.getRestartVoteAddress(e);if(!t)return 1;let n=i.Q.getDefaultProvider(),a=i.Q.getTargetNet().chainId,s=new r.z(a,n),o=new r.C(t,l.x);return Number(await s.all([o.getCurrentStatus()]).then(e=>{let[t]=e;return t}))}async stopDao(e){let t=await this.getRestartVoteAddress(e);if(!t)throw Error("RestartVote contract address not found");let n=i.Q.getTargetNet(),a=u.r.getInstance().getProvider();if(!a)throw Error("Wallet not connected");let s=d.Z.getInstance(a,n.chainId),o=await s.getSigner(),r=new p.CH(t,l.x,o),c=await r.stopDao();return await c.wait(),c.hash}async restartDao(e){let t=await this.getRestartVoteAddress(e);if(!t)throw Error("RestartVote contract address not found");let n=i.Q.getTargetNet(),a=u.r.getInstance().getProvider();if(!a)throw Error("Wallet not connected");let s=d.Z.getInstance(a,n.chainId),o=await s.getSigner(),r=new p.CH(t,l.x,o),c=await r.restartDao();return await c.wait(),c.hash}async stopDaoByAddress(e){if(!e)throw Error("Missing RestartVote contract address");c.Z.L("\uD83D\uDD0D [stopDaoByAddress] 开始执行停止DAO操作",{restartVoteContractAddress:e,timestamp:new Date().toISOString()});let t=i.Q.getTargetNet(),n=u.r.getInstance().getProvider();if(!n)throw Error("Wallet not connected");c.Z.L("\uD83D\uDD0D [stopDaoByAddress] 钱包连接状态检查通过",{chainId:t.chainId,providerExists:!!n});let a=d.Z.getInstance(n,t.chainId),s=await a.getSigner(),o=await s.getAddress();c.Z.L("\uD83D\uDD0D [stopDaoByAddress] 获取签名者信息",{signerAddress:o,chainId:t.chainId});let r=new p.CH(e,l.x,s);try{let e=await r.currentVotingRound(),[t,n,a,s,o]=await Promise.all([r.isVotingActive(),r.continueVotes(e),r.restartVotes(e),r.roundStop(e),r.isVotingPassed()]);if(c.Z.L("\uD83D\uDD0D [stopDaoByAddress] 合约状态检查",{currentVotingRound:e.toString(),isVotingActive:t,continueVotes:n.toString(),restartVotes:a.toString(),roundStop:s,isVotingPassed:o,isRestartWinning:a>n}),s)throw c.Z.E("❌ [stopDaoByAddress] 当前轮次已经停止",{currentVotingRound:e.toString()}),Error("Current round already stopped");if(!o)throw c.Z.E("❌ [stopDaoByAddress] 投票未通过",{isVotingPassed:o,restartVotes:a.toString(),continueVotes:n.toString(),isRestartWinning:a>n}),Error("Voting not passed. Cannot stop DAO")}catch(e){throw c.Z.E("❌ [stopDaoByAddress] 预检查失败",{error:e.message,stack:e.stack}),e}c.Z.L("\uD83D\uDE80 [stopDaoByAddress] 开始发送交易");try{var m,y,h;let e=await r.stopDao();c.Z.L("✅ [stopDaoByAddress] 交易已发送",{txHash:e.hash,nonce:e.nonce,gasLimit:null===(m=e.gasLimit)||void 0===m?void 0:m.toString(),gasPrice:null===(y=e.gasPrice)||void 0===y?void 0:y.toString()}),c.Z.L("⏳ [stopDaoByAddress] 等待交易确认...");let t=await e.wait();return c.Z.L("✅ [stopDaoByAddress] 交易已确认",{txHash:e.hash,blockNumber:t.blockNumber,gasUsed:null===(h=t.gasUsed)||void 0===h?void 0:h.toString(),status:t.status}),e.hash}catch(e){throw c.Z.E("❌ [stopDaoByAddress] 交易执行失败",{error:e.message,code:e.code,data:e.data,reason:e.reason,stack:e.stack}),e}}async restartDaoByAddress(e){if(!e)throw Error("Missing RestartVote contract address");let t=i.Q.getTargetNet(),n=u.r.getInstance().getProvider();if(!n)throw Error("Wallet not connected");let a=d.Z.getInstance(n,t.chainId),s=await a.getSigner(),o=new p.CH(e,l.x,s),r=await o.restartDao();return await r.wait(),r.hash}}h=(0,a.gn)([s.ZP.Singleton],h)},37455:function(e,t,n){"use strict";var a,s=n(1455);!function(e){let t={overview:null,myInfo:null,isLoading:!1,error:null,lastUpdated:null,restartVotes:{page:1,pageSize:5,total:0,isLoading:!1,data:[]}};e.slice=(0,s.oM)({name:"governance",initialState:t,reducers:{setLoading(e,t){e.isLoading=t.payload},setError(e,t){e.error=t.payload},updateOverview(e,t){e.overview=t.payload,e.lastUpdated=Date.now()},clearOverview(e){e.overview=null},updateMyInfo(e,t){e.myInfo=t.payload},clearMyInfo(e){e.myInfo=null},setRestartVotesLoading(e,t){e.restartVotes.isLoading=t.payload},setRestartVotesPage(e,t){e.restartVotes.page=t.payload},setRestartVotes(e,t){e.restartVotes.data=t.payload.data,"number"==typeof t.payload.total&&(e.restartVotes.total=t.payload.total),"number"==typeof t.payload.page&&(e.restartVotes.page=t.payload.page)},clearRestartVotes(e){e.restartVotes={...t.restartVotes}}}})}(a||(a={})),t.Z=a},34159:function(){}},function(e){e.O(0,[1283,5073,2506,9409,927,9481,2784,6870,977,7181,6764,8575,7920,3448,1707,9738,1811,7072,923,344,6011,9302,2580,1240,6755,2971,2117,1744],function(){return e(e.s=23560)}),_N_E=e.O()}]);