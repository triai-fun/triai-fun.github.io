"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8263],{30681:function(e,t,o){o.d(t,{Cv:function(){return i},OM:function(){return d},yO:function(){return l}});var r=o(40257);let n=(e,t)=>{var o;return null!==(o=r.env[e])&&void 0!==o?o:t},a={baseSepolia:{aiDaoAddress:n("NEXT_PUBLIC_AIDAO_BASE_SEPOLIA_ADDRESS","0"),targetDaoAddress:n("NEXT_PUBLIC_AIDAO_BASE_SEPOLIA_TARGET_DAO","0"),rewardTokenAddress:n("NEXT_PUBLIC_AIDAO_BASE_SEPOLIA_REWARD_TOKEN","0")},baseMainnet:{aiDaoAddress:n("NEXT_PUBLIC_AIDAO_BASE_MAINNET_ADDRESS","0x79Baf19C82C88C63b4b827Ba5d37F9d0A05e65D5"),targetDaoAddress:n("NEXT_PUBLIC_AIDAO_BASE_MAINNET_TARGET_DAO","0x1A714D76F14B9e7C894B5580cE92316021863341"),rewardTokenAddress:n("NEXT_PUBLIC_AIDAO_BASE_MAINNET_REWARD_TOKEN","0xbff9E7a186ACF2C3f939a9C3Bcf5a38d86E7dbdF")}};function d(e){switch(e){case 84532:return a.baseSepolia;case 8453:return a.baseMainnet;default:return}}function i(e,t){if(!e)return!1;let o=d(t);return!!o&&o.targetDaoAddress.toLowerCase()===e.toLowerCase()}function l(e){let t=d(e);return null==t?void 0:t.aiDaoAddress}},89522:function(e,t,o){o.d(t,{Z:function(){return u}});var r=o(12249),n=o(5853),a=o(68031),d=o(59201),i=o(8113),l=o(344),s=o(63671);class u extends s.bQ{async loginWallet(e){var t;let o=new d.M,r=new l.M2y(this.buildConfigure(o)),n=new a.zv(await r.loginByWallet({walletLoginRequestVO:{walletAddress:e.walletAddress,signature:e.signature,timestamp:e.timestamp.toString()}},{signal:null===(t=e.abortController)||void 0===t?void 0:t.signal}));return n.hasError()||o.afterHandler(n.response,{url:"/login",data:e}),n}async getUserInfo(e){var t;let o=new Headers;e.Authorization&&o.set("Authorization",e.Authorization),delete e.Authorization;let r=new l.M2y(this.buildConfigure());return new a.zv(await r.getUserInfo({signal:null===(t=e.abortController)||void 0===t?void 0:t.signal,headers:o}))}async uploadFile(e){var t;let o=new FormData;o.append("file",e.file);let r=new l.M2y(this.buildConfigure()),n=await r.upload({file:e.file},{signal:null===(t=e.abortController)||void 0===t?void 0:t.signal,body:o});return new a.zv(n)}async addNFTInfo(e){var t;e.Authorization,delete e.Authorization;let o=new l.lG6(this.buildConfigure());return new a.zv(await o.uploadHash({uploadHashRequestVO:e},{signal:null===(t=e.abortController)||void 0===t?void 0:t.signal}))}constructor(e=new d.Z){super(),(0,r._)(this,"httpRequest",void 0),this.httpRequest=e}}u=(0,n.gn)([i.ZP.Singleton,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof HttpRequest?Object:HttpRequest])],u)},88263:function(e,t,o){o.d(t,{Z:function(){return N}});var r=o(2265),n=o(72917),a=o(68651),d=o(43009),i=o(6178),l=o(74439),s=o(43949),u=o(81939),c=o(83123),v=o(13965),f=o(70042),w=o(10433),I=o(3682),R=o(21707),m=o(95665),p=o(89769),h=o(344),g=o(22928),A=o(68031),C=o(89522),y=o(20605),D=o(64798),Z=o.n(D),T=o(35178),k=o(30681),E=o(88952),L=o(59868);function N(){var e,t,D,N,S,b,F,P,U,_,O,B,x,M,V,H,W,z,K,G,q,Q,X,$,j,J,Y,ee,et,eo,er,en,ea,ed,ei,el,es,eu,ec,ev,ef,ew,eI,eR,em,ep,eh,eg,eA,eC,ey,eD,eZ,eT,ek,eE,eL,eN;let eS=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},eb=(0,i.T)(),{t:eF}=(0,s.$G)(["dao"]),eP=(0,i.C)(e=>e.global),eU=(0,i.C)(e=>e.dao),e_=(0,i.C)(e=>e.user),eO=(0,n.Z)(),eB=null!==(ed=null==eS?void 0:eS.autoTrigger)&&void 0!==ed&&ed,ex=function(e,t){let{t:o}=(0,s.$G)(["dao"]),d=(0,i.T)(),v=(0,i.C)(e=>e.global),f=(0,i.C)(e=>e.dao),D=(0,i.C)(e=>e.user);(0,n.Z)(e);let T=new g.Z,k=new C.Z,[E,L]=r.useState(0),[N,S]=r.useState(!1);async function b(e){var t;if(!(e=null!=e?e:null===(t=f.nodeListFilters.selectedDao)||void 0===t?void 0:t.address))throw Error("No dao address");let o=await T.getRankSimpleInfo(e);return d(m.Z.slice.actions.updateSimpleRankInfo({luckyUsers:o.luckyRecords.map(e=>e.userAddress),voteUsers:o.voteAddresses,prevVoteUsers:o.prevVoteAddresses,voteWithdrawed:o.voteWithdrawed,nodeUsers:o.nodeAddresses,prevNodeUsers:o.prevNodeAddresses,nodeWithdrawed:o.nodeWithdrawed})),o}function F(e,t){var o,r,n,d,i,l,s,c;let v=new a.Z(u.Z.wei2eth(null!==(r=null===(o=f.daoCurrentRoundInfo)||void 0===o?void 0:o.pool.luckyPool)&&void 0!==r?r:0n));switch(null==(t=null!=t?t:f.rankInfo.luckyUsers)||t.length,e){case 0:return new a.Z(0);case 1:return v.multipliedBy(null!==(d=null===(n=f.daoContractInfo)||void 0===n?void 0:n.firstLuckyRewardRate)&&void 0!==d?d:.6);case 2:return v.multipliedBy(null!==(l=null===(i=f.daoContractInfo)||void 0===i?void 0:i.secondLuckyRewardRate)&&void 0!==l?l:.3);default:return v.multipliedBy(null!==(c=null===(s=f.daoContractInfo)||void 0===s?void 0:s.thirdLuckyRewardRate)&&void 0!==c?c:.1).div(31)}}function P(e,t){let o=new a.Z(u.Z.wei2eth(e));return e=>{var r,n,d,i,l,s;if(t[e-1])return new a.Z(0);switch(e){case 0:default:return new a.Z(0);case 1:return o.multipliedBy(null!==(n=null===(r=f.daoContractInfo)||void 0===r?void 0:r.firstPlaceRewardRate)&&void 0!==n?n:.6);case 2:return o.multipliedBy(null!==(i=null===(d=f.daoContractInfo)||void 0===d?void 0:d.secondPlaceRewardRate)&&void 0!==i?i:.3);case 3:return o.multipliedBy(null!==(s=null===(l=f.daoContractInfo)||void 0===l?void 0:l.thirdPlaceRewardRate)&&void 0!==s?s:.1)}}}function U(){var e,t,o,r,n;let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"currnet",i=null!==(r="currnet"===d?null===(e=f.daoCurrentRoundInfo)||void 0===e?void 0:e.pool.voteRankPool:null===(t=f.daoContractInfo)||void 0===t?void 0:t.top3VotedPoolPre)&&void 0!==r?r:0n;return new a.Z(i.toString()).multipliedBy(null!==(n=null===(o=f.daoContractInfo)||void 0===o?void 0:o.voteRankRewardRate)&&void 0!==n?n:0)}function _(){var e,t,o,r,n;let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"currnet",i=null!==(r="currnet"===d?null===(e=f.daoCurrentRoundInfo)||void 0===e?void 0:e.pool.communityPool:null===(t=f.daoContractInfo)||void 0===t?void 0:t.top3NodePoolPre)&&void 0!==r?r:0n;return new a.Z(i.toString()).multipliedBy(null!==(n=null===(o=f.daoContractInfo)||void 0===o?void 0:o.communityRewardRate)&&void 0!==n?n:0)}function O(e,t){var o,r;let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"currnet";e=null!=e?e:f.rankInfo.prevVoteUsers,t=null!==(o=null!=t?t:f.rankInfo.voteWithdrawed)&&void 0!==o?o:[];let a=U(n);return null!==(r=null==e?void 0:e.map((e,t)=>t+1).map((o,r)=>{let d=P(BigInt(a.toFixed(0)),"pre"===n?t:[])(o);return{rank:o,address:e[r],reward:d}}))&&void 0!==r?r:[]}function B(e,t){var o,r;let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"currnet";e=null!=e?e:f.rankInfo.prevNodeUsers,t=null!==(o=null!=t?t:f.rankInfo.nodeWithdrawed)&&void 0!==o?o:[];let a=_(n);return null!==(r=null==e?void 0:e.map((e,t)=>t+1).map((o,r)=>{let d=P(BigInt(a.toFixed(0)),"pre"===n?t:[])(o);return{rank:o,address:e[r],reward:d}}))&&void 0!==r?r:[]}async function x(t,o){var r,n,a,d;if(!(o=null!==(a=null!=o?o:e)&&void 0!==a?a:null===(r=f.nodeListFilters.selectedDao)||void 0===r?void 0:r.address))throw Error("No dao address");if(t=null!==(d=null!=t?t:null===(n=f.rankInfo)||void 0===n?void 0:n.luckyUsers)&&void 0!==d?d:[],!f.daoContractInfo)throw Error("No current round no");let i=f.daoContractInfo.currentRoundNO,l=g.Z.buildGetUserRankDetailInfo(t,o,i),s=I.Q.getDefaultProvider(),u=new R.z(I.Q.getTargetNet().chainId,s),c=await u.all(l.calls);return g.Z.analyzeUserDetailInfo(c,l.singleUserCallCount,l.userAddresses)}function M(e,t){return e.map((e,o)=>{let r=o+1;return{rank:r,address:e.userAddress,votes:Number(u.Z.wei2eth(e.voteInfo.votedAmount)),beVotes:0,reward:t(r)}})}async function V(e){let t=Date.now();if((!(t-E<6e4)||!f.rankInfo.luckyRank||!(f.rankInfo.luckyRank.length>0))&&!N)try{var o,r,n,a,i;if(S(!0),!(e=null!=e?e:null===(o=f.nodeListFilters.selectedDao)||void 0===o?void 0:o.address))throw Error("No dao address");if(!f.daoContractInfo)throw Error("No dao contract info");if(!f.daoCurrentRoundInfo)throw Error("No current round info");let l=f.daoContractInfo.currentRoundNO,s=await b(e);v.token&&D.ethInfo.walletAddress&&W(s.nodeWithdrawed);let c=await T.getRankInfo({daoAddress:e,voteAddresses:s.voteAddresses,nodeAddresses:s.nodeAddresses,userAddress:D.ethInfo.walletAddress,currentRoundNO:l}),w=s.luckyRecords.map(e=>e.userAddress),I=s.luckyRecords.map((e,t)=>({rank:t+1,address:e.userAddress,votes:Number(e.votedAmount),beVotes:0,reward:F(t+1,w).toNumber()})),R=U(),p=(r=c.voteData,n=e=>P(BigInt(R.toFixed(0)),[])(e).toNumber(),M(r,n).map((e,t)=>{let o=Number(u.Z.wei2eth(r[t].promotionInfo.sonVotedAmountToday));return{...e,beVotes:o}})),h=_(),g=(a=c.nodeData,i=e=>P(BigInt(h.toFixed(0)),[])(e).toNumber(),M(a,i).map((e,t)=>{let o=Number(u.Z.wei2eth(a[t].promotionInfo.sonVotedAmountWeek));return{...e,beVotes:o}}));d(m.Z.slice.actions.updateDetailRankInfo({luckyRank:I,voteRank:p,nodeRank:g})),L(t)}catch(e){w.Z.E("useDAORankInfo::updateRankInfo error",e)}finally{S(!1)}}async function H(){d(m.Z.slice.actions.clearRankInfo()),d(m.Z.slice.actions.clearUserRankInfo())}async function W(e){var t,r,n,a,i,l;let s=null===(t=f.nodeListFilters.selectedDao)||void 0===t?void 0:t.address,u=D.ethInfo.walletAddress;if(!s)throw Error(o("NoSelectedDao"));if(!u)throw Error(o("Can't found user address"));new g.Z;let v=new h.q$p(k.buildConfigure()),I=await v.getMyRank({daoAddress:s}),R=new A.zv(I);if(R.hasError()){let e=R.getError();(0,c.L6)(e.msg),w.Z.E(e)}let C=null!==(a=R.getData().daoMyRankList)&&void 0!==a?a:[],y=g.z.DAOUserRankInfoAdapter.getFactory(u),Z=C.map(y).map(e=>e.toJSON());d(m.Z.slice.actions.updateUserRankInfo(Z));let T=new Map(Z.map(e=>[e.rewardType,e.rank]));d(m.Z.slice.actions.updateUserRankRewardInfo([[p.r.RankRewardType.LUCKY_REWARD,F(T.get(p.r.RankRewardType.LUCKY_REWARD)).toNumber()],[p.r.RankRewardType.VOTE_TOP_REWARD,P(null!==(i=null===(r=f.daoContractInfo)||void 0===r?void 0:r.top3NodePoolPre)&&void 0!==i?i:0n,e)(T.get(p.r.RankRewardType.VOTE_TOP_REWARD)).toNumber()],[p.r.RankRewardType.NODE_TOP_REWARD,P(null!==(l=null===(n=f.daoContractInfo)||void 0===n?void 0:n.top3NodePoolPre)&&void 0!==l?l:0n,e)(T.get(p.r.RankRewardType.NODE_TOP_REWARD)).toNumber()]]))}return r.useEffect(()=>{var e;if(!(null==t?void 0:t.autoTrigger))return;if(!(null===(e=f.nodeListFilters.selectedDao)||void 0===e?void 0:e.address)||!f.daoCurrentRoundInfo){H();return}let r=Z()(()=>{V().catch(e=>{(0,c.L6)(new c.HU(e,o("GetRankDataFailed")).asToastMessage()),w.Z.E("updateRankInfo",e)})},1e3),n=l.Z.sleepForAnimationFrame(200);n.wait(()=>r());let a=setInterval(()=>{"visible"===document.visibilityState&&r()},6e4);return()=>{n.cancel(y.Z.ReactError.useEffectDestroy()),clearInterval(a),r.cancel(),H()}},[f.daoCurrentRoundInfo,v.token,D.ethInfo.walletAddress]),{updateRankSimpleInfo:b,updateUserRankInfo:W,calcLuckyRewardInLocal:F,getLuckyRewardInLocal:function(e){var t;return null!==(t=null==(e=null!=e?e:f.rankInfo.luckyUsers)?void 0:e.map((e,t)=>t+1).map((t,o)=>({rank:t,address:e[o],reward:F(t,e)})))&&void 0!==t?t:[]},getUserLuckyRewardInLocal:function(e,t){var o,r;e=null!=e?e:D.ethInfo.walletAddress;let n=null!==(r=(t=null!==(o=null!=t?t:f.rankInfo.luckyUsers)&&void 0!==o?o:[]).indexOf(e))&&void 0!==r?r:-1;return F(-1===n?4:n+1,t)},calcTop3RewardInLocal:P,getVoteTop3Rawards:O,getUserVoteTopReward:function(e,t){var o,r;let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"currnet";return e=null!=e?e:D.ethInfo.walletAddress,(null!==(r=O(void 0,t=null!==(o=null!=t?t:f.rankInfo.voteWithdrawed)&&void 0!==o?o:[],n).find(t=>t.address===e))&&void 0!==r?r:{reward:new a.Z(0)}).reward},getNodeTop3Rawards:B,getUserNodeTopReward:function(e,t){var o,r;let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"currnet";return e=null!=e?e:D.ethInfo.walletAddress,(null!==(r=B(void 0,t=null!==(o=null!=t?t:f.rankInfo.nodeWithdrawed)&&void 0!==o?o:[],n).find(t=>t.address===e))&&void 0!==r?r:{reward:new a.Z(0)}).reward},getLastInvestorsDetailInfo:x,updateRankInfo:V,clearRankInfo:H}}(void 0,{autoTrigger:eB}),[eM,eV]=r.useState(0),[eH,eW]=r.useState(0),[ez,eK]=r.useState(!1),[eG,eq]=r.useState(!1),[eQ,eX]=r.useState(!1),[e$,ej]=r.useState("0"),[eJ,eY]=r.useState("TOKEN"),[e0,e1]=r.useState("0"),[e6,e2]=r.useState(!1),[e3,e8]=r.useState("0"),e4=null!==(ei=null===(e=eU.daoContractInfo)||void 0===e?void 0:e.voteRankClaimDurationAdd)&&void 0!==ei?ei:0,e9=null!==(el=null===(t=eU.daoContractInfo)||void 0===t?void 0:t.createTime)&&void 0!==el?el:0,e7=null!==(es=null===(D=eU.daoContractInfo)||void 0===D?void 0:D.rewardRoundPass)&&void 0!==es?es:0,e5=null!==(eu=null===(N=eU.daoContractInfo)||void 0===N?void 0:N.airdropDurationGetLimit)&&void 0!==eu?eu:0;g.Z.getCurrentRewardRoundTimestamp(e9,e4,e7);let te=null!==(ec=null===(S=eU.daoCurrentRoundInfo)||void 0===S?void 0:S.roundExpire)&&void 0!==ec?ec:0,tt=null!==(ev=null===(b=eU.userInfo)||void 0===b?void 0:b.voteAndAirDropReward.clairReward)&&void 0!==ev?ev:0n,to=eM||(null!==(ef=null===(F=eU.userInfo)||void 0===F?void 0:F.voteInfo.roundFirstVotedDate)&&void 0!==ef?ef:0),tr=te>0?l.Z.convertTimeDifference(new Date(to+e5-eP.currentTime),{includeDays:!1}):0,tn=tt>0n,ta=Math.floor(eP.currentTime/e4)*e4+e4,td=eU.userRewardInfo.voteTopReward.gt(0)?l.Z.convertTimeDifference(new Date(ta-eP.currentTime),{includeDays:!1}):0,ti=eU.userRewardInfo.voteTopReward.gt(0),tl=null!==(ew=null===(P=eU.daoContractInfo)||void 0===P?void 0:P.communityDuration)&&void 0!==ew?ew:0,ts=Math.floor((null!==(eI=null===(U=eU.daoContractInfo)||void 0===U?void 0:U.top3NodeDate)&&void 0!==eI?eI:0)/tl)*tl+(null!==(eR=null===(_=eU.daoContractInfo)||void 0===_?void 0:_.communityDuration)&&void 0!==eR?eR:0);null===(O=eU.daoContractInfo)||void 0===O||O.communityRewardDuration;let tu=eU.userRewardInfo.nodeTopReward.gt(0)?l.Z.convertTimeDifference(new Date(ts-eP.currentTime),{includeDays:!1}):0,tc=eU.userRewardInfo.nodeTopReward.gt(0),tv=l.Z.convertTimeDifference(new Date((null!==(em=null===(B=eU.daoCurrentRoundInfo)||void 0===B?void 0:B.roundExpire)&&void 0!==em?em:0)-eP.currentTime),{includeDays:!1}),tf=l.Z.convertTimeDifference(new Date((null!==(ep=null===(x=eU.daoCurrentRoundInfo)||void 0===x?void 0:x.roundExpire)&&void 0!==ep?ep:0)+(null!==(eh=null===(M=eU.daoContractInfo)||void 0===M?void 0:M.loserPoolRewardTimeLimit)&&void 0!==eh?eh:0)-eP.currentTime),{includeDays:!1}),tw=0===tv&&0!==tf&&eU.userRewardInfo.luckyReward.gt(0)&&(null===(V=eU.userInfo)||void 0===V?void 0:V.voteInfo.isLuckyRewardClaimed)===!1,tI=new a.Z((null!==(eg=null===(H=eU.daoCurrentRoundInfo)||void 0===H?void 0:H.totalVoteAmount)&&void 0!==eg?eg:0n).toString()).minus((null!==(eA=null===(W=eU.daoCurrentRoundInfo)||void 0===W?void 0:W.totalEthDone)&&void 0!==eA?eA:0n).toString()),tR=(null===(z=eU.userInfo)||void 0===z?void 0:z.voteInfo.isLoserRewardClaimed)?new a.Z(0):new a.Z((null!==(eC=null===(K=eU.userInfo)||void 0===K?void 0:K.voteInfo.votedAmount)&&void 0!==eC?eC:0n).toString()).minus((null!==(ey=null===(G=eU.userInfo)||void 0===G?void 0:G.voteInfo.ethDone)&&void 0!==ey?ey:0n).toString()).div(tI.isZero()?"1":tI.toFixed(0)).multipliedBy((null!==(eD=null===(q=eU.daoCurrentRoundInfo)||void 0===q?void 0:q.pool.loserPool)&&void 0!==eD?eD:0n).toString()),tm=(null===(Q=eU.userInfo)||void 0===Q?void 0:Q.voteInfo.isLoserRewardClaimed)?new a.Z(0):new a.Z((null!==(eZ=null===(X=eU.userInfo)||void 0===X?void 0:X.voteInfo.votedAmount)&&void 0!==eZ?eZ:0n).toString()).minus((null!==(eT=null===($=eU.userInfo)||void 0===$?void 0:$.voteInfo.ethDone)&&void 0!==eT?eT:0n).toString()).div(tI.isZero()?"1":tI.toFixed(0)).multipliedBy((null!==(ek=null===(j=eU.daoCurrentRoundInfo)||void 0===j?void 0:j.pool.loserPoolETH)&&void 0!==ek?ek:0n).toString()),tp=l.Z.convertTimeDifference(new Date((null!==(eE=null===(J=eU.daoCurrentRoundInfo)||void 0===J?void 0:J.roundExpire)&&void 0!==eE?eE:0)-eP.currentTime),{includeDays:!1}),th=l.Z.convertTimeDifference(new Date((null!==(eL=null===(Y=eU.daoCurrentRoundInfo)||void 0===Y?void 0:Y.roundExpire)&&void 0!==eL?eL:0)+(null!==(eN=null===(ee=eU.daoContractInfo)||void 0===ee?void 0:ee.loserPoolRewardTimeLimit)&&void 0!==eN?eN:0)-eP.currentTime),{includeDays:!1}),tg=0===tp&&0!==th&&(tR.gt(0)||tm.gt(0)),tA=I.Q.getTargetNet().chainId,tC=(0,k.Cv)(null===(et=eU.nodeListFilters.selectedDao)||void 0===et?void 0:et.address,tA),ty=[{title:eF("DAOReward"),reward:u.Z.wei2eth(tt),hasDetails:!0,countdown:0===tr?"":tr.toFormated(),claimable:tn,handleClaim:tZ},{title:eF("VoteTopReward"),reward:eU.userRewardInfo.voteTopReward.toString(),hasDetails:!1,countdown:0===td?"":td.toFormated(),claimable:ti,handleClaim:tT},{title:eF("NodeTopReward"),reward:eU.userRewardInfo.nodeTopReward.toString(),hasDetails:!1,countdown:0===tu?"":tu.toFormated(),claimable:tc,handleClaim:tk},{title:eF("LuckyReward"),reward:eU.userRewardInfo.luckyReward.toString(),hasDetails:!1,countdown:(null===(eo=eU.userInfo)||void 0===eo?void 0:eo.voteInfo.isLuckyRewardClaimed)?"":0!==tv?tv.toFormated():0!==tf?tf.toFormated():"",claimable:tw,handleClaim:tE},{title:eF("OtherReward"),tokenReward:tR.gt(0)?u.Z.wei2eth(tR.toFixed(0,a.Z.ROUND_DOWN)):"0",hasDetails:!1,countdown:(null===(er=eU.userInfo)||void 0===er?void 0:er.voteInfo.isLoserRewardClaimed)?"":0!==tp?tp.toFormated():0!==th?th.toFormated():"",claimable:tg,handleClaim:tL}],tD=tC?[...ty,{title:eF("AIReward"),tokenReward:"".concat(e$," ").concat(eJ," (≈").concat(d.Z.toFixed(Number(e0),4)," ETH)"),hasDetails:!1,countdown:(null===(en=eU.userInfo)||void 0===en?void 0:en.voteInfo.isLoserRewardClaimed)?"":0!==tp?tp.toFormated():0!==th?th.toFormated():"",claimable:new a.Z(e$).gt(0)&&0===tp&&0!==th,handleClaim:tN}]:ty;async function tZ(){var e,t,o,r,n,d,i,l,s,I;let R=null===(e=eU.nodeListFilters.selectedDao)||void 0===e?void 0:e.address;if(!R){(0,c.L6)(eF("NoSelectedDao"));return}if(!tn)return;let p=v.r.getInstance(),h=u.Z.getInstance(p.getProvider()),g=f.bR.connect(R,await h.getSigner());try{let e=null===(t=eU.daoContractInfo)||void 0===t?void 0:t.currentRoundNO;if(!e){let t=await g.currentRoundNO();e=Number(t)}let n=await g.pools(e),d=n.airdropPool;if(tt>d){try{let e=null!==(r=null===(o=eU.daoContractInfo)||void 0===o?void 0:o.firstLuckyRewardRate)&&void 0!==r?r:0,t=new a.Z(u.Z.wei2eth(n.luckyPoolBalance)).multipliedBy(e).toFixed(1);e8(t)}catch(e){e8("0")}e2(!0);return}}catch(e){try{let e=null!==(d=null===(n=eU.daoCurrentRoundInfo)||void 0===n?void 0:n.pool.airdropPool)&&void 0!==d?d:0n;if(tt>e){try{let e=null!==(s=null===(i=eU.daoContractInfo)||void 0===i?void 0:i.firstLuckyRewardRate)&&void 0!==s?s:0,t=new a.Z(u.Z.wei2eth(null!==(I=null===(l=eU.daoCurrentRoundInfo)||void 0===l?void 0:l.pool.luckyPool)&&void 0!==I?I:0n)).multipliedBy(e).toFixed(1);e8(t)}catch(e){e8("0")}e2(!0);return}}catch(e){}}try{let e=await g.claimVoteAndAirDropReward();await e.wait(),(0,c.x9)(eF("ClaimVoteAndAirDropRewardSuccess"));let t=Date.now();eV(t),eq(!0),eU.userInfo&&eb(m.Z.slice.actions.updateUserInfo({...eU.userInfo,voteAndAirDropReward:{...eU.userInfo.voteAndAirDropReward,clairReward:0n}})),await tS(),setTimeout(()=>{eq(!1)},5e3)}catch(e){(0,c.L6)(new c.HU(e,eF("ClaimVoteAndAirDropRewardFailed")).asToastMessage()),w.Z.E(e)}}async function tT(){var e,t;if(!(null===(e=eU.nodeListFilters.selectedDao)||void 0===e?void 0:e.address)){(0,c.L6)(eF("NoSelectedDao"));return}eb(m.Z.slice.actions.updateUserRewardInfo({...eU.userRewardInfo,voteTopReward:new a.Z(0)}));let o=v.r.getInstance(),r=u.Z.getInstance(o.getProvider()),n=f.bR.connect(null===(t=eU.nodeListFilters.selectedDao)||void 0===t?void 0:t.address,await r.getSigner());try{let e=await n.claimTop3VotedReward();await e.wait(),(0,c.x9)(eF("ClaimNodeTopRewardSuccess")),await tS()}catch(e){eb(m.Z.slice.actions.updateUserRewardInfo({...eU.userRewardInfo,voteTopReward:eU.userRewardInfo.voteTopReward})),(0,c.L6)(new c.HU(e,eF("ClaimNodeTopRewardFailed")).asToastMessage()),w.Z.E(e)}}async function tk(){var e,t;if(!(null===(e=eU.nodeListFilters.selectedDao)||void 0===e?void 0:e.address))return(0,c.L6)(eF("NoSelectedDao"));eb(m.Z.slice.actions.updateUserRewardInfo({...eU.userRewardInfo,nodeTopReward:new a.Z(0)}));let o=v.r.getInstance(),r=u.Z.getInstance(o.getProvider()),n=f.bR.connect(null===(t=eU.nodeListFilters.selectedDao)||void 0===t?void 0:t.address,await r.getSigner());try{let e=await n.claimTop3NodeReward();await e.wait(),(0,c.x9)(eF("ClaimNodeTopRewardSuccess")),await tS()}catch(e){eb(m.Z.slice.actions.updateUserRewardInfo({...eU.userRewardInfo,nodeTopReward:eU.userRewardInfo.nodeTopReward})),(0,c.L6)(new c.HU(e,eF("ClaimNodeTopRewardFailed")).asToastMessage()),w.Z.E(e)}}async function tE(){var e,t;if(!(null===(e=eU.nodeListFilters.selectedDao)||void 0===e?void 0:e.address))return(0,c.L6)(eF("NoSelectedDao"));eU.userInfo&&eb(m.Z.slice.actions.updateUserInfo({...eU.userInfo,voteInfo:{...eU.userInfo.voteInfo,isLuckyRewardClaimed:!0}}));let o=v.r.getInstance(),r=u.Z.getInstance(o.getProvider()),n=f.bR.connect(null===(t=eU.nodeListFilters.selectedDao)||void 0===t?void 0:t.address,await r.getSigner());try{let e=await n.claimLuckyReward();await e.wait(),(0,c.x9)(eF("ClaimLuckyRewardSuccess")),await tS()}catch(e){eU.userInfo&&eb(m.Z.slice.actions.updateUserInfo({...eU.userInfo,voteInfo:{...eU.userInfo.voteInfo,isLuckyRewardClaimed:!1}})),(0,c.L6)(new c.HU(e,eF("ClaimLuckyRewardFailed")).asToastMessage()),w.Z.E(e)}}async function tL(){var e,t;if(!(null===(e=eU.nodeListFilters.selectedDao)||void 0===e?void 0:e.address))return(0,c.L6)(eF("NoSelectedDao"));eU.userInfo&&eb(m.Z.slice.actions.updateUserInfo({...eU.userInfo,voteInfo:{...eU.userInfo.voteInfo,isLoserRewardClaimed:!0}}));let o=v.r.getInstance(),r=u.Z.getInstance(o.getProvider()),n=f.bR.connect(null===(t=eU.nodeListFilters.selectedDao)||void 0===t?void 0:t.address,await r.getSigner());try{let e=await n.claimLoserReward();await e.wait(),(0,c.x9)(eF("ClaimOtherRewardSuccess")),await tS()}catch(e){eU.userInfo&&eb(m.Z.slice.actions.updateUserInfo({...eU.userInfo,voteInfo:{...eU.userInfo.voteInfo,isLoserRewardClaimed:!1}})),(0,c.L6)(new c.HU(e,eF("ClaimOtherRewardFailed")).asToastMessage()),w.Z.E(e)}}async function tN(){let e=I.Q.getTargetNet().chainId,t=(0,k.yO)(e);if(!t){(0,c.L6)(eF("NoAiDaoAddress"));return}let o=v.r.getInstance(),r=u.Z.getInstance(o.getProvider()),n=f.fj.connect(t,await r.getSigner());try{let e=await n.claimLoserReward();await e.wait(),(0,c.x9)(eF("ClaimAIRewardSuccess")),ej("0"),eY("TOKEN"),e1("0"),await tS()}catch(e){(0,c.L6)(new c.HU(e,eF("ClaimAIRewardFailed")).asToastMessage()),w.Z.E(e)}}async function tS(){var e;let t=null===(e=eU.nodeListFilters.selectedDao)||void 0===e?void 0:e.address;if(t)try{eK(!0),eX(!0),eb(T.Z.slice.actions.updateTime(Date.now())),await new Promise(e=>setTimeout(e,2e3)),await Promise.all([eO.updateInfo(),ex.updateRankSimpleInfo(t),tb(t),tP(t)]),await tx(t),eS.handleAfterClaim&&await eS.handleAfterClaim()}catch(e){w.Z.E("Error in handleAfterClaim:",e)}finally{eK(!1),eX(!1)}}async function tb(e){var t;let o=Date.now();if(!eQ&&o-eH<6e4||ez)return;let r=new g.Z;if(!(e=null!=e?e:null===(t=eU.nodeListFilters.selectedDao)||void 0===t?void 0:t.address)){(0,c.L6)(eF("NoSelectedDao"));return}try{eK(!0);let t=await r.getUserVoteNodeRankReward({userAddress:e_.ethInfo.walletAddress,daoAddress:e});eb(m.Z.slice.actions.updateUserRewardInfo({luckyReward:new a.Z(u.Z.wei2eth(t.luckyReward.reward)),voteTopReward:new a.Z(u.Z.wei2eth(t.voteTopReward.reward)),nodeTopReward:new a.Z(u.Z.wei2eth(t.nodeTopReward.reward))})),eW(o)}catch(e){(0,c.L6)(new c.HU(e,eF("GetUserVoteNodeRankRewardFailed")).asToastMessage()),w.Z.E(e)}finally{eK(!1)}}let tF=r.useCallback(Z()(e=>{var t;if(null===(t=eU.daoContractInfo)||void 0===t?void 0:t.daoAddress)return tb(eU.daoContractInfo.daoAddress)},800),[eU.daoContractInfo,e_.ethInfo.walletAddress]);async function tP(e){if(eG)return;let t=new g.Z,o=new h.q$p(t.buildConfigure()),r=await o.getLastClaimTime({daoAddress:e}),n=new A.zv(r);if(n.hasError()){let e=n.getError();(0,c.L6)(new c.HU(e,eF("GetLastClaimTimeFailed")).asToastMessage()),w.Z.E(e);return}let a=d.Z.Time.fromTimestamp(n.getData());eG||a.toJSTime()===eM||eV(a.toJSTime())}function tU(e,t){let o=Number("120");return new a.Z(u.Z.wei2eth(e)).multipliedBy(o).div(100).minus(u.Z.wei2eth(t))}r.useEffect(()=>{if(!eB||!eU.daoContractInfo||!e_.ethInfo.walletAddress)return;let e=l.Z.sleepForAnimationFrame(300);e.wait(()=>{var e;tF(),(null===(e=eU.nodeListFilters.selectedDao)||void 0===e?void 0:e.address)&&tB(eU.nodeListFilters.selectedDao.address)});let t=setInterval(()=>{"visible"===document.visibilityState&&tF()},6e4);return()=>{e.cancel(y.Z.ReactError.useEffectDestroy()),clearInterval(t)}},[eU.daoContractInfo,e_.ethInfo.walletAddress,eB,tF]);let t_=r.useCallback(Z()(e=>{tP(e)},500),[]);async function tO(){var e;let t=null===(e=eU.nodeListFilters.selectedDao)||void 0===e?void 0:e.address;if(t&&e_.ethInfo.walletAddress)try{eK(!0),eX(!0),await Promise.all([eO.updateInfo(),ex.updateRankSimpleInfo(t),tb(t),tP(t),tB(t)]),await tx(t),eW(Date.now()),eX(!1)}catch(e){w.Z.E("Error in refreshAllData:",e)}finally{eK(!1)}}async function tB(e){try{let t=I.Q.getTargetNet().chainId;if(!(0,k.Cv)(e,t)){ej("0"),eY("TOKEN"),e1("0");return}let r=(0,k.OM)(t),n=(0,k.yO)(t);if(!n||!r){ej("0"),eY("TOKEN"),e1("0");return}let d=v.r.getInstance(),i=u.Z.getInstance(d.getProvider()),l=e_.ethInfo.walletAddress;if(!l)return;let s=f.fj.connect(n,await i.getSigner()),c=await s.getLoserReward(l),R=u.Z.wei2eth(c);ej(R);let m=r.rewardTokenAddress;if(w.Z.L("rewardTokenAddress",m),m&&"0"!==m&&Number(R)>0){w.Z.L("rewardTokenAddress",2);try{w.Z.L("rewardTokenAddress",3);let e=await (0,E.co)(m);w.Z.L("priceInfo",e);let{TrinityTokenAbi:t}=await Promise.resolve().then(o.bind(o,13167)),r=new L.CH(m,t,await i.getSigner()),n=await r.symbol(),d=new a.Z(R).multipliedBy(e.sellPriceETH).toString();eY(n),e1(d)}catch(e){w.Z.L("rewardTokenAddress",4),w.Z.E("Error fetching AI reward token price:",e),eY("TOKEN"),e1("0")}}else eY("TOKEN"),e1("0")}catch(e){ej("0"),eY("TOKEN"),e1("0"),w.Z.E("Error fetching AI reward:",e)}}async function tx(e){try{let t=v.r.getInstance(),o=u.Z.getInstance(t.getProvider()),r=f.bR.connect(e,await o.getSigner()),n=e_.ethInfo.walletAddress;if(!n)return;let a=await r.getVoteAndAirDropReward(n);if(eU.userInfo){let e={...eU.userInfo,voteAndAirDropReward:{...eU.userInfo.voteAndAirDropReward,clairReward:a.clairReward,airdropReward:a.airdropReward,nodeReward:a.nodeReward,airdropLinkReward:a.airdropLinkReward,reinvestReward:a.reinvestReward}};eb(m.Z.slice.actions.updateUserInfo(e))}}catch(e){w.Z.E("Error checking reward claim status:",e)}}return r.useEffect(()=>{var e;if((null===(e=eU.nodeListFilters.selectedDao)||void 0===e?void 0:e.address)&&eP.token)return t_(eU.nodeListFilters.selectedDao.address),()=>{t_.cancel()}},[null===(ea=eU.nodeListFilters.selectedDao)||void 0===ea?void 0:ea.address,eP.token,t_]),r.useEffect(()=>{eQ&&eB&&tO()},[eQ,eB]),{rewardItems:tD,handleVoteAirdropClaim:tZ,handleVoteRankClaim:tT,handleNodeRankClaim:tk,handleLuckyClaim:tE,handleOtherClaim:tL,handleAiRewardClaim:tN,estimatePendingReward:tU,estimateUserPendingReward:function(){try{var e,t,o,r;let n=tU(null!==(o=null===(e=eU.userInfo)||void 0===e?void 0:e.voteInfo.votedAmount)&&void 0!==o?o:0n,null!==(r=null===(t=eU.userInfo)||void 0===t?void 0:t.voteInfo.ethDone)&&void 0!==r?r:0n);if(!n||n.isNaN())return new a.Z(0);return n}catch(e){return w.Z.W("Error calculating pending reward:",e),new a.Z(0)}},getClaimNodeRewardCountdown:function(){if(!eU.daoContractInfo)return"";let e=Math.floor(eP.currentTime/1e3),t=86400*Math.floor(Math.floor(e9/1e3)/86400),o=t+604800*Math.floor((e-t)/604800)+604800-e;if(o<=0)return"00:00:00";let r=Math.floor(o/3600).toString().padStart(2,"0"),n=Math.floor(o%3600/60).toString().padStart(2,"0"),a=Math.floor(o%60).toString().padStart(2,"0");return"".concat(r,":").concat(n,":").concat(a)},refreshAllData:tO,isUpdating:ez,ui:{airdropInsufficientOpen:e6,setAirdropInsufficientOpen:e2,airdropFirstPrizeAmount:e3}}}},88952:function(e,t,o){o.d(t,{co:function(){return R}});var r=o(12249),n=o(3682),a=o(94552),d=o(59868),i=o(41662),l=o(90135),s=o(90005),u=o(96727),c=o(45532),v=o(45556),f=o(10433);class w{async getPairReserves(e){let t,o;let r=await this.getPairAddress(e);if(r===a.N)throw Error("Pair does not exist");let n=new d.CH(r,c._,this.provider);try{let e=await this.provider.getCode(r);if("0x"===e)throw Error("Pair contract does not exist: ".concat(r));let a=await Promise.all([n.token0(),n.token1(),n.getReserves()]);t=a[0],a[1],o=a[2]}catch(e){throw f.Z.E("❌ 获取交易对储备失败:",e),e}let[i,l]=o,s=t.toLowerCase()===this.wethAddress.toLowerCase();return{ethReserve:s?i:l,tokenReserve:s?l:i,pairAddress:r}}async getPairAddress(e){let t=new d.CH(this.tokenSwapAddress,v.R,this.provider);try{let o=await this.provider.getCode(this.tokenSwapAddress);if("0x"===o)return f.Z.E("❌ TokenSwap合约不存在: ".concat(this.tokenSwapAddress)),a.N;let r=await t.trinityswapV2Factory(),n=await this.provider.getCode(r);if("0x"===n)return f.Z.E("❌ Factory合约不存在: ".concat(r)),a.N;try{let t=new d.CH(r,["function getPair(address tokenA, address tokenB) external view returns (address pair)"],this.provider),o=await t.getPair(e,this.wethAddress);if(o!==a.N){let e=await this.provider.getCode(o);if("0x"!==e)return o}}catch(e){}return await this.computePairAddress(r,e,this.wethAddress)}catch(e){return f.Z.E("❌ 获取交易对地址失败:",e),a.N}}async getRealtimePrice(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"1";try{let{ethReserve:o,tokenReserve:r}=await this.getPairReserves(e),n=i.fi(t),a=this.getAmountOut(n,o,r,997n),d=Number(i.dF(a)),l=i.fi("1"),s=this.getAmountOut(l,r,o,997n),u=Number(i.dF(s)),c=Number(o)/Number(r)*1e18,v=Number(i.dF(BigInt(Math.floor(c))));return{buyPriceETH:d,sellPriceETH:u,midPriceETH:v,slippage:v>0?Math.abs(1/d-u)/v*100:0}}catch(e){throw f.Z.E("❌ 计算价格时发生错误:",e),e}}getAmountOut(e,t,o){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:997n;if(0n===e||0n===t||0n===o)return 0n;let n=e*r;return n*o/(1000n*t+n)}async computePairAddress(e,t,o){let[r,n]=t.toLowerCase()<o.toLowerCase()?[t,o]:[o,t],a=l.w(s.VT(["address","address"],[r,n]));for(let t of["0x96e8ac4277198ff8b6f785478aa9a39f403cb768dd02cbee326c3e7da348845f","0xd0d4c4cd0848c93cb4fd1f498d7013ee6bfb25783ea21593d5834f5d250ece66","0x00fb7f630766e6a796048ea87d01acd3068e8ff67d078148a3fa3f4a84f69bd5","0xe18a34eb0e04b04f7a0ac29a6e80748dca96319b42c54d679cb821dca90c6303"]){let o=u.h(e,a,t),r=await this.provider.getCode(o);if("0x"!==r&&r.length>2)return o}return u.h(e,a,"0x96e8ac4277198ff8b6f785478aa9a39f403cb768dd02cbee326c3e7da348845f")}constructor(){if((0,r._)(this,"provider",void 0),(0,r._)(this,"wethAddress",void 0),(0,r._)(this,"tokenSwapAddress",void 0),this.provider=n.Q.getDefaultProvider(),this.wethAddress="0x4200000000000000000000000000000000000006",this.tokenSwapAddress="0x4Cd906AEF43aB89BB5714391B024b3C49bC76617",!this.wethAddress||!this.tokenSwapAddress)throw Error("Missing required environment variables")}}let I=new w;async function R(e){return I.getRealtimePrice(e)}}}]);