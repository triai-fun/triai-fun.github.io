"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8263],{89522:function(e,o,t){t.d(o,{Z:function(){return u}});var n=t(12249),r=t(5853),a=t(68031),d=t(59201),i=t(8113),l=t(344),s=t(63671);class u extends s.bQ{async loginWallet(e){var o;let t=new d.M,n=new l.M2y(this.buildConfigure(t)),r=new a.zv(await n.loginByWallet({walletLoginRequestVO:{walletAddress:e.walletAddress,signature:e.signature,timestamp:e.timestamp.toString()}},{signal:null===(o=e.abortController)||void 0===o?void 0:o.signal}));return r.hasError()||t.afterHandler(r.response,{url:"/login",data:e}),r}async getUserInfo(e){var o;let t=new Headers;e.Authorization&&t.set("Authorization",e.Authorization),delete e.Authorization;let n=new l.M2y(this.buildConfigure());return new a.zv(await n.getUserInfo({signal:null===(o=e.abortController)||void 0===o?void 0:o.signal,headers:t}))}async uploadFile(e){var o;let t=new FormData;t.append("file",e.file);let n=new l.M2y(this.buildConfigure()),r=await n.upload({file:e.file},{signal:null===(o=e.abortController)||void 0===o?void 0:o.signal,body:t});return new a.zv(r)}async addNFTInfo(e){var o;e.Authorization,delete e.Authorization;let t=new l.lG6(this.buildConfigure());return new a.zv(await t.uploadHash({uploadHashRequestVO:e},{signal:null===(o=e.abortController)||void 0===o?void 0:o.signal}))}constructor(e=new d.Z){super(),(0,n._)(this,"httpRequest",void 0),this.httpRequest=e}}u=(0,r.gn)([i.ZP.Singleton,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof HttpRequest?Object:HttpRequest])],u)},88263:function(e,o,t){t.d(o,{Z:function(){return A}});var n=t(2265),r=t(72917),a=t(68651),d=t(43009),i=t(6178),l=t(74439),s=t(43949),u=t(81939),c=t(83123),v=t(13965),f=t(70042),w=t(10433),R=t(3682),I=t(21707),m=t(95665),p=t(89769),g=t(344),h=t(22928),y=t(68031),C=t(89522),D=t(20605),Z=t(64798),k=t.n(Z),T=t(35178);function A(){var e,o,t,Z,A,L,E,N,S,F,b,U,P,O,M,V,x,W,B,_,z,H,q,G,Q,$,J,K,Y,j,X,ee,eo,et,en,er,ea,ed,ei,el,es,eu,ec,ev,ef,ew,eR,eI,em,ep;let eg=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},eh=(0,i.T)(),{t:ey}=(0,s.$G)(["dao"]),eC=(0,i.C)(e=>e.global),eD=(0,i.C)(e=>e.dao),eZ=(0,i.C)(e=>e.user),ek=(0,r.Z)(),eT=null!==(Y=null==eg?void 0:eg.autoTrigger)&&void 0!==Y&&Y,eA=function(e,o){let{t}=(0,s.$G)(["dao"]),d=(0,i.T)(),v=(0,i.C)(e=>e.global),f=(0,i.C)(e=>e.dao),Z=(0,i.C)(e=>e.user);(0,r.Z)(e);let T=new h.Z,A=new C.Z,[L,E]=n.useState(0),[N,S]=n.useState(!1);async function F(e){var o;if(!(e=null!=e?e:null===(o=f.nodeListFilters.selectedDao)||void 0===o?void 0:o.address))throw Error("No dao address");let t=await T.getRankSimpleInfo(e);return d(m.Z.slice.actions.updateSimpleRankInfo({luckyUsers:t.luckyRecords.map(e=>e.userAddress),voteUsers:t.voteAddresses,prevVoteUsers:t.prevVoteAddresses,voteWithdrawed:t.voteWithdrawed,nodeUsers:t.nodeAddresses,prevNodeUsers:t.prevNodeAddresses,nodeWithdrawed:t.nodeWithdrawed})),t}function b(e,o){var t,n,r,d,i,l,s,c;let v=new a.Z(u.Z.wei2eth(null!==(n=null===(t=f.daoCurrentRoundInfo)||void 0===t?void 0:t.pool.luckyPool)&&void 0!==n?n:0n));switch(null==(o=null!=o?o:f.rankInfo.luckyUsers)||o.length,e){case 0:return new a.Z(0);case 1:return v.multipliedBy(null!==(d=null===(r=f.daoContractInfo)||void 0===r?void 0:r.firstLuckyRewardRate)&&void 0!==d?d:.6);case 2:return v.multipliedBy(null!==(l=null===(i=f.daoContractInfo)||void 0===i?void 0:i.secondLuckyRewardRate)&&void 0!==l?l:.3);default:return v.multipliedBy(null!==(c=null===(s=f.daoContractInfo)||void 0===s?void 0:s.thirdLuckyRewardRate)&&void 0!==c?c:.1).div(31)}}function U(e,o){let t=new a.Z(u.Z.wei2eth(e));return e=>{var n,r,d,i,l,s;if(o[e-1])return new a.Z(0);switch(e){case 0:default:return new a.Z(0);case 1:return t.multipliedBy(null!==(r=null===(n=f.daoContractInfo)||void 0===n?void 0:n.firstPlaceRewardRate)&&void 0!==r?r:.6);case 2:return t.multipliedBy(null!==(i=null===(d=f.daoContractInfo)||void 0===d?void 0:d.secondPlaceRewardRate)&&void 0!==i?i:.3);case 3:return t.multipliedBy(null!==(s=null===(l=f.daoContractInfo)||void 0===l?void 0:l.thirdPlaceRewardRate)&&void 0!==s?s:.1)}}}function P(){var e,o,t,n,r;let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"currnet",i=null!==(n="currnet"===d?null===(e=f.daoCurrentRoundInfo)||void 0===e?void 0:e.pool.voteRankPool:null===(o=f.daoContractInfo)||void 0===o?void 0:o.top3VotedPoolPre)&&void 0!==n?n:0n;return new a.Z(i.toString()).multipliedBy(null!==(r=null===(t=f.daoContractInfo)||void 0===t?void 0:t.voteRankRewardRate)&&void 0!==r?r:0)}function O(){var e,o,t,n,r;let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"currnet",i=null!==(n="currnet"===d?null===(e=f.daoCurrentRoundInfo)||void 0===e?void 0:e.pool.communityPool:null===(o=f.daoContractInfo)||void 0===o?void 0:o.top3NodePoolPre)&&void 0!==n?n:0n;return new a.Z(i.toString()).multipliedBy(null!==(r=null===(t=f.daoContractInfo)||void 0===t?void 0:t.communityRewardRate)&&void 0!==r?r:0)}function M(e,o){var t,n;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"currnet";e=null!=e?e:f.rankInfo.prevVoteUsers,o=null!==(t=null!=o?o:f.rankInfo.voteWithdrawed)&&void 0!==t?t:[];let a=P(r);return null!==(n=null==e?void 0:e.map((e,o)=>o+1).map((t,n)=>{let d=U(BigInt(a.toFixed(0)),"pre"===r?o:[])(t);return{rank:t,address:e[n],reward:d}}))&&void 0!==n?n:[]}function V(e,o){var t,n;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"currnet";e=null!=e?e:f.rankInfo.prevNodeUsers,o=null!==(t=null!=o?o:f.rankInfo.nodeWithdrawed)&&void 0!==t?t:[];let a=O(r);return null!==(n=null==e?void 0:e.map((e,o)=>o+1).map((t,n)=>{let d=U(BigInt(a.toFixed(0)),"pre"===r?o:[])(t);return{rank:t,address:e[n],reward:d}}))&&void 0!==n?n:[]}async function x(o,t){var n,r,a,d;if(!(t=null!==(a=null!=t?t:e)&&void 0!==a?a:null===(n=f.nodeListFilters.selectedDao)||void 0===n?void 0:n.address))throw Error("No dao address");if(o=null!==(d=null!=o?o:null===(r=f.rankInfo)||void 0===r?void 0:r.luckyUsers)&&void 0!==d?d:[],!f.daoContractInfo)throw Error("No current round no");let i=f.daoContractInfo.currentRoundNO,l=h.Z.buildGetUserRankDetailInfo(o,t,i),s=R.Q.getDefaultProvider(),u=new I.z(R.Q.getTargetNet().chainId,s),c=await u.all(l.calls);return h.Z.analyzeUserDetailInfo(c,l.singleUserCallCount,l.userAddresses)}function W(e,o){return e.map((e,t)=>{let n=t+1;return{rank:n,address:e.userAddress,votes:Number(u.Z.wei2eth(e.voteInfo.votedAmount)),beVotes:0,reward:o(n)}})}async function B(e){let o=Date.now();if((!(o-L<6e4)||!f.rankInfo.luckyRank||!(f.rankInfo.luckyRank.length>0))&&!N)try{var t,n,r,a,i;if(S(!0),!(e=null!=e?e:null===(t=f.nodeListFilters.selectedDao)||void 0===t?void 0:t.address))throw Error("No dao address");if(!f.daoContractInfo)throw Error("No dao contract info");if(!f.daoCurrentRoundInfo)throw Error("No current round info");let l=f.daoContractInfo.currentRoundNO,s=await F(e);v.token&&Z.ethInfo.walletAddress&&z(s.nodeWithdrawed);let c=await T.getRankInfo({daoAddress:e,voteAddresses:s.voteAddresses,nodeAddresses:s.nodeAddresses,userAddress:Z.ethInfo.walletAddress,currentRoundNO:l}),w=s.luckyRecords.map(e=>e.userAddress),R=s.luckyRecords.map((e,o)=>({rank:o+1,address:e.userAddress,votes:Number(e.votedAmount),beVotes:0,reward:b(o+1,w).toNumber()})),I=P(),p=(n=c.voteData,r=e=>U(BigInt(I.toFixed(0)),[])(e).toNumber(),W(n,r).map((e,o)=>{let t=Number(u.Z.wei2eth(n[o].promotionInfo.sonVotedAmountToday));return{...e,beVotes:t}})),g=O(),h=(a=c.nodeData,i=e=>U(BigInt(g.toFixed(0)),[])(e).toNumber(),W(a,i).map((e,o)=>{let t=Number(u.Z.wei2eth(a[o].promotionInfo.sonVotedAmountWeek));return{...e,beVotes:t}}));d(m.Z.slice.actions.updateDetailRankInfo({luckyRank:R,voteRank:p,nodeRank:h})),E(o)}catch(e){w.Z.E("useDAORankInfo::updateRankInfo error",e)}finally{S(!1)}}async function _(){d(m.Z.slice.actions.clearRankInfo()),d(m.Z.slice.actions.clearUserRankInfo())}async function z(e){var o,n,r,a,i,l;let s=null===(o=f.nodeListFilters.selectedDao)||void 0===o?void 0:o.address,u=Z.ethInfo.walletAddress;if(!s)throw Error(t("NoSelectedDao"));if(!u)throw Error(t("Can't found user address"));new h.Z;let v=new g.q$p(A.buildConfigure()),R=await v.getMyRank({daoAddress:s}),I=new y.zv(R);if(I.hasError()){let e=I.getError();(0,c.L6)(e.msg),w.Z.E(e)}let C=null!==(a=I.getData().daoMyRankList)&&void 0!==a?a:[],D=h.z.DAOUserRankInfoAdapter.getFactory(u),k=C.map(D).map(e=>e.toJSON());d(m.Z.slice.actions.updateUserRankInfo(k));let T=new Map(k.map(e=>[e.rewardType,e.rank]));d(m.Z.slice.actions.updateUserRankRewardInfo([[p.r.RankRewardType.LUCKY_REWARD,b(T.get(p.r.RankRewardType.LUCKY_REWARD)).toNumber()],[p.r.RankRewardType.VOTE_TOP_REWARD,U(null!==(i=null===(n=f.daoContractInfo)||void 0===n?void 0:n.top3NodePoolPre)&&void 0!==i?i:0n,e)(T.get(p.r.RankRewardType.VOTE_TOP_REWARD)).toNumber()],[p.r.RankRewardType.NODE_TOP_REWARD,U(null!==(l=null===(r=f.daoContractInfo)||void 0===r?void 0:r.top3NodePoolPre)&&void 0!==l?l:0n,e)(T.get(p.r.RankRewardType.NODE_TOP_REWARD)).toNumber()]]))}return n.useEffect(()=>{var e;if(!(null==o?void 0:o.autoTrigger))return;if(!(null===(e=f.nodeListFilters.selectedDao)||void 0===e?void 0:e.address)||!f.daoCurrentRoundInfo){_();return}let n=k()(()=>{B().catch(e=>{(0,c.L6)(new c.HU(e,t("GetRankDataFailed")).asToastMessage()),w.Z.E("updateRankInfo",e)})},1e3),r=l.Z.sleepForAnimationFrame(200);r.wait(()=>n());let a=setInterval(()=>{"visible"===document.visibilityState&&n()},6e4);return()=>{r.cancel(D.Z.ReactError.useEffectDestroy()),clearInterval(a),n.cancel(),_()}},[f.daoCurrentRoundInfo,v.token,Z.ethInfo.walletAddress]),{updateRankSimpleInfo:F,updateUserRankInfo:z,calcLuckyRewardInLocal:b,getLuckyRewardInLocal:function(e){var o;return null!==(o=null==(e=null!=e?e:f.rankInfo.luckyUsers)?void 0:e.map((e,o)=>o+1).map((o,t)=>({rank:o,address:e[t],reward:b(o,e)})))&&void 0!==o?o:[]},getUserLuckyRewardInLocal:function(e,o){var t,n;e=null!=e?e:Z.ethInfo.walletAddress;let r=null!==(n=(o=null!==(t=null!=o?o:f.rankInfo.luckyUsers)&&void 0!==t?t:[]).indexOf(e))&&void 0!==n?n:-1;return b(-1===r?4:r+1,o)},calcTop3RewardInLocal:U,getVoteTop3Rawards:M,getUserVoteTopReward:function(e,o){var t,n;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"currnet";return e=null!=e?e:Z.ethInfo.walletAddress,(null!==(n=M(void 0,o=null!==(t=null!=o?o:f.rankInfo.voteWithdrawed)&&void 0!==t?t:[],r).find(o=>o.address===e))&&void 0!==n?n:{reward:new a.Z(0)}).reward},getNodeTop3Rawards:V,getUserNodeTopReward:function(e,o){var t,n;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"currnet";return e=null!=e?e:Z.ethInfo.walletAddress,(null!==(n=V(void 0,o=null!==(t=null!=o?o:f.rankInfo.nodeWithdrawed)&&void 0!==t?t:[],r).find(o=>o.address===e))&&void 0!==n?n:{reward:new a.Z(0)}).reward},getLastInvestorsDetailInfo:x,updateRankInfo:B,clearRankInfo:_}}(void 0,{autoTrigger:eT}),[eL,eE]=n.useState(0),[eN,eS]=n.useState(0),[eF,eb]=n.useState(!1),[eU,eP]=n.useState(!1),[eO,eM]=n.useState(!1),[eV,ex]=n.useState(0n),[eW,eB]=n.useState(!1),[e_,ez]=n.useState("0"),eH=null!==(j=null===(e=eD.daoContractInfo)||void 0===e?void 0:e.voteRankClaimDurationAdd)&&void 0!==j?j:0,eq=null!==(X=null===(o=eD.daoContractInfo)||void 0===o?void 0:o.createTime)&&void 0!==X?X:0,eG=null!==(ee=null===(t=eD.daoContractInfo)||void 0===t?void 0:t.rewardRoundPass)&&void 0!==ee?ee:0,eQ=null!==(eo=null===(Z=eD.daoContractInfo)||void 0===Z?void 0:Z.airdropDurationGetLimit)&&void 0!==eo?eo:0;h.Z.getCurrentRewardRoundTimestamp(eq,eH,eG);let e$=null!==(et=null===(A=eD.daoCurrentRoundInfo)||void 0===A?void 0:A.roundExpire)&&void 0!==et?et:0,eJ=null!==(en=null===(L=eD.userInfo)||void 0===L?void 0:L.voteAndAirDropReward.clairReward)&&void 0!==en?en:0n,eK=eL||(null!==(er=null===(E=eD.userInfo)||void 0===E?void 0:E.voteInfo.roundFirstVotedDate)&&void 0!==er?er:0),eY=e$>0?l.Z.convertTimeDifference(new Date(eK+eQ-eC.currentTime),{includeDays:!1}):0,ej=eJ>0n,eX=Math.floor(eC.currentTime/eH)*eH+eH,e0=eD.userRewardInfo.voteTopReward.gt(0)?l.Z.convertTimeDifference(new Date(eX-eC.currentTime),{includeDays:!1}):0,e1=eD.userRewardInfo.voteTopReward.gt(0),e2=null!==(ea=null===(N=eD.daoContractInfo)||void 0===N?void 0:N.communityDuration)&&void 0!==ea?ea:0,e6=Math.floor((null!==(ed=null===(S=eD.daoContractInfo)||void 0===S?void 0:S.top3NodeDate)&&void 0!==ed?ed:0)/e2)*e2+(null!==(ei=null===(F=eD.daoContractInfo)||void 0===F?void 0:F.communityDuration)&&void 0!==ei?ei:0);null===(b=eD.daoContractInfo)||void 0===b||b.communityRewardDuration;let e3=eD.userRewardInfo.nodeTopReward.gt(0)?l.Z.convertTimeDifference(new Date(e6-eC.currentTime),{includeDays:!1}):0,e8=eD.userRewardInfo.nodeTopReward.gt(0),e4=l.Z.convertTimeDifference(new Date((null!==(el=null===(U=eD.daoCurrentRoundInfo)||void 0===U?void 0:U.roundExpire)&&void 0!==el?el:0)-eC.currentTime),{includeDays:!1}),e9=l.Z.convertTimeDifference(new Date((null!==(es=null===(P=eD.daoCurrentRoundInfo)||void 0===P?void 0:P.roundExpire)&&void 0!==es?es:0)+(null!==(eu=null===(O=eD.daoContractInfo)||void 0===O?void 0:O.loserPoolRewardTimeLimit)&&void 0!==eu?eu:0)-eC.currentTime),{includeDays:!1}),e5=0===e4&&0!==e9&&eD.userRewardInfo.luckyReward.gt(0)&&(null===(M=eD.userInfo)||void 0===M?void 0:M.voteInfo.isLuckyRewardClaimed)===!1,e7=new a.Z((null!==(ec=null===(V=eD.daoCurrentRoundInfo)||void 0===V?void 0:V.totalVoteAmount)&&void 0!==ec?ec:0n).toString()).minus((null!==(ev=null===(x=eD.daoCurrentRoundInfo)||void 0===x?void 0:x.totalEthDone)&&void 0!==ev?ev:0n).toString()),oe=new a.Z((null===(W=eD.userInfo)||void 0===W?void 0:W.voteInfo.isLoserRewardClaimed)?0:eV.toString()),oo=(null===(B=eD.userInfo)||void 0===B?void 0:B.voteInfo.isLoserRewardClaimed)?new a.Z(0):new a.Z((null!==(ef=null===(_=eD.userInfo)||void 0===_?void 0:_.voteInfo.votedAmount)&&void 0!==ef?ef:0n).toString()).minus((null!==(ew=null===(z=eD.userInfo)||void 0===z?void 0:z.voteInfo.ethDone)&&void 0!==ew?ew:0n).toString()).div(e7.isZero()?"1":e7.toFixed(0)).multipliedBy((null!==(eR=null===(H=eD.daoCurrentRoundInfo)||void 0===H?void 0:H.pool.loserPoolETH)&&void 0!==eR?eR:0n).toString()),ot=l.Z.convertTimeDifference(new Date((null!==(eI=null===(q=eD.daoCurrentRoundInfo)||void 0===q?void 0:q.roundExpire)&&void 0!==eI?eI:0)-eC.currentTime),{includeDays:!1}),on=l.Z.convertTimeDifference(new Date((null!==(em=null===(G=eD.daoCurrentRoundInfo)||void 0===G?void 0:G.roundExpire)&&void 0!==em?em:0)+(null!==(ep=null===(Q=eD.daoContractInfo)||void 0===Q?void 0:Q.loserPoolRewardTimeLimit)&&void 0!==ep?ep:0)-eC.currentTime),{includeDays:!1}),or=0===ot&&0!==on&&(oe.gt(0)||oo.gt(0)),oa=[{title:ey("DAOReward"),reward:u.Z.wei2eth(eJ),hasDetails:!0,countdown:0===eY?"":eY.toFormated(),claimable:ej,handleClaim:oi},{title:ey("VoteTopReward"),reward:eD.userRewardInfo.voteTopReward.toString(),hasDetails:!1,countdown:0===e0?"":e0.toFormated(),claimable:e1,handleClaim:ol},{title:ey("NodeTopReward"),reward:eD.userRewardInfo.nodeTopReward.toString(),hasDetails:!1,countdown:0===e3?"":e3.toFormated(),claimable:e8,handleClaim:os},{title:ey("LuckyReward"),reward:eD.userRewardInfo.luckyReward.toString(),hasDetails:!1,countdown:(null===($=eD.userInfo)||void 0===$?void 0:$.voteInfo.isLuckyRewardClaimed)?"":0!==e4?e4.toFormated():0!==e9?e9.toFormated():"",claimable:e5,handleClaim:ou},{title:ey("OtherReward"),tokenReward:oe.gt(0)?u.Z.wei2eth(oe.toFixed(0,a.Z.ROUND_DOWN)):"0",hasDetails:!1,countdown:(null===(J=eD.userInfo)||void 0===J?void 0:J.voteInfo.isLoserRewardClaimed)?"":0!==ot?ot.toFormated():0!==on?on.toFormated():"",claimable:or,handleClaim:oc}];async function od(e){try{let o=eZ.ethInfo.walletAddress;if(!o)return;let t=R.Q.getDefaultProvider(),n=f.bR.connect(e,t),r=await n.getLoserRewardTokenValue(o);ex(r)}catch(e){ex(0n),w.Z.E("Error fetching loser token reward:",e)}}async function oi(){var e,o,t,n,r,d,i,l,s,R;let I=null===(e=eD.nodeListFilters.selectedDao)||void 0===e?void 0:e.address;if(!I){(0,c.L6)(ey("NoSelectedDao"));return}if(!ej)return;let p=v.r.getInstance(),g=u.Z.getInstance(p.getProvider()),h=f.bR.connect(I,await g.getSigner());try{let e=null===(o=eD.daoContractInfo)||void 0===o?void 0:o.currentRoundNO;if(!e){let o=await h.currentRoundNO();e=Number(o)}let r=await h.pools(e),d=r.airdropPool;if(eJ>d){try{let e=null!==(n=null===(t=eD.daoContractInfo)||void 0===t?void 0:t.firstLuckyRewardRate)&&void 0!==n?n:0,o=new a.Z(u.Z.wei2eth(r.luckyPoolBalance)).multipliedBy(e).toFixed(1);ez(o)}catch(e){ez("0")}eB(!0);return}}catch(e){try{let e=null!==(d=null===(r=eD.daoCurrentRoundInfo)||void 0===r?void 0:r.pool.airdropPool)&&void 0!==d?d:0n;if(eJ>e){try{let e=null!==(s=null===(i=eD.daoContractInfo)||void 0===i?void 0:i.firstLuckyRewardRate)&&void 0!==s?s:0,o=new a.Z(u.Z.wei2eth(null!==(R=null===(l=eD.daoCurrentRoundInfo)||void 0===l?void 0:l.pool.luckyPool)&&void 0!==R?R:0n)).multipliedBy(e).toFixed(1);ez(o)}catch(e){ez("0")}eB(!0);return}}catch(e){}}try{let e=await h.claimVoteAndAirDropReward();await e.wait(),(0,c.x9)(ey("ClaimVoteAndAirDropRewardSuccess"));let o=Date.now();eE(o),eP(!0),eD.userInfo&&eh(m.Z.slice.actions.updateUserInfo({...eD.userInfo,voteAndAirDropReward:{...eD.userInfo.voteAndAirDropReward,clairReward:0n}})),await ov(),setTimeout(()=>{eP(!1)},5e3)}catch(e){(0,c.L6)(new c.HU(e,ey("ClaimVoteAndAirDropRewardFailed")).asToastMessage()),w.Z.E(e)}}async function ol(){var e,o;if(!(null===(e=eD.nodeListFilters.selectedDao)||void 0===e?void 0:e.address)){(0,c.L6)(ey("NoSelectedDao"));return}eh(m.Z.slice.actions.updateUserRewardInfo({...eD.userRewardInfo,voteTopReward:new a.Z(0)}));let t=v.r.getInstance(),n=u.Z.getInstance(t.getProvider()),r=f.bR.connect(null===(o=eD.nodeListFilters.selectedDao)||void 0===o?void 0:o.address,await n.getSigner());try{let e=await r.claimTop3VotedReward();await e.wait(),(0,c.x9)(ey("ClaimNodeTopRewardSuccess")),await ov()}catch(e){eh(m.Z.slice.actions.updateUserRewardInfo({...eD.userRewardInfo,voteTopReward:eD.userRewardInfo.voteTopReward})),(0,c.L6)(new c.HU(e,ey("ClaimNodeTopRewardFailed")).asToastMessage()),w.Z.E(e)}}async function os(){var e,o;if(!(null===(e=eD.nodeListFilters.selectedDao)||void 0===e?void 0:e.address))return(0,c.L6)(ey("NoSelectedDao"));eh(m.Z.slice.actions.updateUserRewardInfo({...eD.userRewardInfo,nodeTopReward:new a.Z(0)}));let t=v.r.getInstance(),n=u.Z.getInstance(t.getProvider()),r=f.bR.connect(null===(o=eD.nodeListFilters.selectedDao)||void 0===o?void 0:o.address,await n.getSigner());try{let e=await r.claimTop3NodeReward();await e.wait(),(0,c.x9)(ey("ClaimNodeTopRewardSuccess")),await ov()}catch(e){eh(m.Z.slice.actions.updateUserRewardInfo({...eD.userRewardInfo,nodeTopReward:eD.userRewardInfo.nodeTopReward})),(0,c.L6)(new c.HU(e,ey("ClaimNodeTopRewardFailed")).asToastMessage()),w.Z.E(e)}}async function ou(){var e,o;if(!(null===(e=eD.nodeListFilters.selectedDao)||void 0===e?void 0:e.address))return(0,c.L6)(ey("NoSelectedDao"));eD.userInfo&&eh(m.Z.slice.actions.updateUserInfo({...eD.userInfo,voteInfo:{...eD.userInfo.voteInfo,isLuckyRewardClaimed:!0}}));let t=v.r.getInstance(),n=u.Z.getInstance(t.getProvider()),r=f.bR.connect(null===(o=eD.nodeListFilters.selectedDao)||void 0===o?void 0:o.address,await n.getSigner());try{let e=await r.claimLuckyReward();await e.wait(),(0,c.x9)(ey("ClaimLuckyRewardSuccess")),await ov()}catch(e){eD.userInfo&&eh(m.Z.slice.actions.updateUserInfo({...eD.userInfo,voteInfo:{...eD.userInfo.voteInfo,isLuckyRewardClaimed:!1}})),(0,c.L6)(new c.HU(e,ey("ClaimLuckyRewardFailed")).asToastMessage()),w.Z.E(e)}}async function oc(){var e,o;if(!(null===(e=eD.nodeListFilters.selectedDao)||void 0===e?void 0:e.address))return(0,c.L6)(ey("NoSelectedDao"));eD.userInfo&&eh(m.Z.slice.actions.updateUserInfo({...eD.userInfo,voteInfo:{...eD.userInfo.voteInfo,isLoserRewardClaimed:!0}}));let t=v.r.getInstance(),n=u.Z.getInstance(t.getProvider()),r=f.bR.connect(null===(o=eD.nodeListFilters.selectedDao)||void 0===o?void 0:o.address,await n.getSigner());try{let e=await r.claimLoserReward();await e.wait(),(0,c.x9)(ey("ClaimOtherRewardSuccess")),await ov()}catch(e){eD.userInfo&&eh(m.Z.slice.actions.updateUserInfo({...eD.userInfo,voteInfo:{...eD.userInfo.voteInfo,isLoserRewardClaimed:!1}})),(0,c.L6)(new c.HU(e,ey("ClaimOtherRewardFailed")).asToastMessage()),w.Z.E(e)}}async function ov(){var e;let o=null===(e=eD.nodeListFilters.selectedDao)||void 0===e?void 0:e.address;if(o)try{eb(!0),eM(!0),eh(T.Z.slice.actions.updateTime(Date.now())),await new Promise(e=>setTimeout(e,2e3)),await Promise.all([ek.updateInfo(),eA.updateRankSimpleInfo(o),of(o),oR(o)]),await og(o),eg.handleAfterClaim&&await eg.handleAfterClaim()}catch(e){w.Z.E("Error in handleAfterClaim:",e)}finally{eb(!1),eM(!1)}}async function of(e){var o;let t=Date.now();if(!eO&&t-eN<6e4||eF)return;let n=new h.Z;if(!(e=null!=e?e:null===(o=eD.nodeListFilters.selectedDao)||void 0===o?void 0:o.address)){(0,c.L6)(ey("NoSelectedDao"));return}try{eb(!0);let o=await n.getUserVoteNodeRankReward({userAddress:eZ.ethInfo.walletAddress,daoAddress:e});eh(m.Z.slice.actions.updateUserRewardInfo({luckyReward:new a.Z(u.Z.wei2eth(o.luckyReward.reward)),voteTopReward:new a.Z(u.Z.wei2eth(o.voteTopReward.reward)),nodeTopReward:new a.Z(u.Z.wei2eth(o.nodeTopReward.reward))})),eS(t)}catch(e){(0,c.L6)(new c.HU(e,ey("GetUserVoteNodeRankRewardFailed")).asToastMessage()),w.Z.E(e)}finally{eb(!1)}}let ow=n.useCallback(k()(e=>{var o;if(null===(o=eD.daoContractInfo)||void 0===o?void 0:o.daoAddress)return of(eD.daoContractInfo.daoAddress)},800),[eD.daoContractInfo,eZ.ethInfo.walletAddress]);async function oR(e){if(eU)return;let o=new h.Z,t=new g.q$p(o.buildConfigure()),n=await t.getLastClaimTime({daoAddress:e}),r=new y.zv(n);if(r.hasError()){let e=r.getError();(0,c.L6)(new c.HU(e,ey("GetLastClaimTimeFailed")).asToastMessage()),w.Z.E(e);return}let a=d.Z.Time.fromTimestamp(r.getData());eU||a.toJSTime()===eL||eE(a.toJSTime())}function oI(e,o){let t=Number("120");return new a.Z(u.Z.wei2eth(e)).multipliedBy(t).div(100).minus(u.Z.wei2eth(o))}n.useEffect(()=>{if(!eT||!eD.daoContractInfo||!eZ.ethInfo.walletAddress)return;let e=l.Z.sleepForAnimationFrame(300);e.wait(()=>{var e;ow(),(null===(e=eD.nodeListFilters.selectedDao)||void 0===e?void 0:e.address)&&od(eD.nodeListFilters.selectedDao.address)});let o=setInterval(()=>{"visible"===document.visibilityState&&ow()},6e4);return()=>{e.cancel(D.Z.ReactError.useEffectDestroy()),clearInterval(o)}},[eD.daoContractInfo,eZ.ethInfo.walletAddress,eT,ow]);let om=n.useCallback(k()(e=>{oR(e)},500),[]);async function op(){var e;let o=null===(e=eD.nodeListFilters.selectedDao)||void 0===e?void 0:e.address;if(o&&eZ.ethInfo.walletAddress)try{eb(!0),eM(!0),await Promise.all([ek.updateInfo(),eA.updateRankSimpleInfo(o),of(o),oR(o),od(o)]),await og(o),eS(Date.now()),eM(!1)}catch(e){w.Z.E("Error in refreshAllData:",e)}finally{eb(!1)}}async function og(e){try{let o=v.r.getInstance(),t=u.Z.getInstance(o.getProvider()),n=f.bR.connect(e,await t.getSigner()),r=eZ.ethInfo.walletAddress;if(!r)return;let a=await n.getVoteAndAirDropReward(r);if(eD.userInfo){let e={...eD.userInfo,voteAndAirDropReward:{...eD.userInfo.voteAndAirDropReward,clairReward:a.clairReward,airdropReward:a.airdropReward,nodeReward:a.nodeReward,airdropLinkReward:a.airdropLinkReward,reinvestReward:a.reinvestReward}};eh(m.Z.slice.actions.updateUserInfo(e))}}catch(e){w.Z.E("Error checking reward claim status:",e)}}return n.useEffect(()=>{var e;if((null===(e=eD.nodeListFilters.selectedDao)||void 0===e?void 0:e.address)&&eC.token)return om(eD.nodeListFilters.selectedDao.address),()=>{om.cancel()}},[null===(K=eD.nodeListFilters.selectedDao)||void 0===K?void 0:K.address,eC.token,om]),n.useEffect(()=>{eO&&eT&&op()},[eO,eT]),{rewardItems:oa,handleVoteAirdropClaim:oi,handleVoteRankClaim:ol,handleNodeRankClaim:os,handleLuckyClaim:ou,handleOtherClaim:oc,estimatePendingReward:oI,estimateUserPendingReward:function(){try{var e,o,t,n;let r=oI(null!==(t=null===(e=eD.userInfo)||void 0===e?void 0:e.voteInfo.votedAmount)&&void 0!==t?t:0n,null!==(n=null===(o=eD.userInfo)||void 0===o?void 0:o.voteInfo.ethDone)&&void 0!==n?n:0n);if(!r||r.isNaN())return new a.Z(0);return r}catch(e){return w.Z.W("Error calculating pending reward:",e),new a.Z(0)}},getClaimNodeRewardCountdown:function(){if(!eD.daoContractInfo)return"";let e=Math.floor(eC.currentTime/1e3),o=86400*Math.floor(Math.floor(eq/1e3)/86400),t=o+604800*Math.floor((e-o)/604800)+604800-e;if(t<=0)return"00:00:00";let n=Math.floor(t/3600).toString().padStart(2,"0"),r=Math.floor(t%3600/60).toString().padStart(2,"0"),a=Math.floor(t%60).toString().padStart(2,"0");return"".concat(n,":").concat(r,":").concat(a)},refreshAllData:op,isUpdating:eF,ui:{airdropInsufficientOpen:eW,setAirdropInsufficientOpen:eB,airdropFirstPrizeAmount:e_}}}}}]);