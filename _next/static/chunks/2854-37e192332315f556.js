"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2854],{89522:function(e,o,t){t.d(o,{Z:function(){return u}});var n=t(12249),r=t(5853),a=t(68031),d=t(59201),i=t(8113),l=t(344),s=t(63671);class u extends s.bQ{async loginWallet(e){var o;let t=new d.M,n=new l.M2y(this.buildConfigure(t)),r=new a.zv(await n.loginByWallet({walletLoginRequestVO:{walletAddress:e.walletAddress,signature:e.signature,timestamp:e.timestamp.toString()}},{signal:null===(o=e.abortController)||void 0===o?void 0:o.signal}));return r.hasError()||t.afterHandler(r.response,{url:"/login",data:e}),r}async getUserInfo(e){var o;let t=new Headers;e.Authorization&&t.set("Authorization",e.Authorization),delete e.Authorization;let n=new l.M2y(this.buildConfigure());return new a.zv(await n.getUserInfo({signal:null===(o=e.abortController)||void 0===o?void 0:o.signal,headers:t}))}async uploadFile(e){var o;let t=new FormData;t.append("file",e.file);let n=new l.M2y(this.buildConfigure()),r=await n.upload({file:e.file},{signal:null===(o=e.abortController)||void 0===o?void 0:o.signal,body:t});return new a.zv(r)}async addNFTInfo(e){var o;e.Authorization,delete e.Authorization;let t=new l.lG6(this.buildConfigure());return new a.zv(await t.uploadHash({uploadHashRequestVO:e},{signal:null===(o=e.abortController)||void 0===o?void 0:o.signal}))}constructor(e=new d.Z){super(),(0,n._)(this,"httpRequest",void 0),this.httpRequest=e}}u=(0,r.gn)([i.ZP.Singleton,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof HttpRequest?Object:HttpRequest])],u)},12628:function(e,o,t){t.d(o,{Z:function(){return u}});var n=t(57437),r=t(32223),a=t(43949),d=t(89769),i=t(99376),l=t(53335),s=t(95665);function u(e){let o=(0,i.useRouter)(),{t}=(0,a.$G)(["dao"]),u=[{title:t("TabVote"),url:"/dao/node",target:d.r.VotingTabEnum.VOTE},{title:t("TabEWV"),url:"/dao/ewv",target:d.r.VotingTabEnum.EWV},{title:t("TabNode"),url:"/dao/user",target:d.r.VotingTabEnum.NODE}];return(0,n.jsx)("div",{className:"flex flex-col items-stretch md:items-center",children:(0,n.jsx)(r.Z,{className:(0,l.m6)("mb-10",e.className),tabItemClassName:()=>"w-[33%] md:w-[180px]",tabItemTitleClassName:()=>"w-full",displayType:r.L.BgGradient,activeIndex:u.findIndex(o=>o.target===e.activeTarget),tabList:u,onClick:e=>{let t=new URLSearchParams(location.search);if(!t.has(s.Z.Params.DAO_ADDRESS))return o.push(e);let n=new URL(e,location.origin),r=new URLSearchParams(n.search);r.set(s.Z.Params.DAO_ADDRESS,t.get(s.Z.Params.DAO_ADDRESS)),n.search=r.toString(),o.push("".concat(n.origin).concat(n.pathname,"?").concat(r.toString()))}})})}},14931:function(e,o,t){t.d(o,{Z:function(){return C}});var n=t(6178),r=t(72917),a=t(71549),d=t(21707),i=t(10433),l=t(95665),s=t(89769),u=t(81939),c=t(68651),v=t(2265),f=t(83123),w=t(43949),R=t(344),I=t(22928),m=t(68031),p=t(89522),g=t(20605),h=t(74439),D=t(64798),y=t.n(D);function C(e,o){let{t}=(0,w.$G)(["dao"]),D=(0,n.T)(),C=(0,n.C)(e=>e.global),Z=(0,n.C)(e=>e.dao),T=(0,n.C)(e=>e.user);(0,r.Z)(e);let k=new I.Z,A=new p.Z,[L,E]=v.useState(0),[S,N]=v.useState(!1);async function b(e){var o;if(!(e=null!=e?e:null===(o=Z.nodeListFilters.selectedDao)||void 0===o?void 0:o.address))throw Error("No dao address");let t=await k.getRankSimpleInfo(e);return D(l.Z.slice.actions.updateSimpleRankInfo({luckyUsers:t.luckyRecords.map(e=>e.userAddress),voteUsers:t.voteAddresses,prevVoteUsers:t.prevVoteAddresses,voteWithdrawed:t.voteWithdrawed,nodeUsers:t.nodeAddresses,prevNodeUsers:t.prevNodeAddresses,nodeWithdrawed:t.nodeWithdrawed})),t}function U(e,o){var t,n,r,a,d,i,l,s;let v=new c.Z(u.Z.wei2eth(null!==(n=null===(t=Z.daoCurrentRoundInfo)||void 0===t?void 0:t.pool.luckyPool)&&void 0!==n?n:0n));switch(null==(o=null!=o?o:Z.rankInfo.luckyUsers)||o.length,e){case 0:return new c.Z(0);case 1:return v.multipliedBy(null!==(a=null===(r=Z.daoContractInfo)||void 0===r?void 0:r.firstLuckyRewardRate)&&void 0!==a?a:.6);case 2:return v.multipliedBy(null!==(i=null===(d=Z.daoContractInfo)||void 0===d?void 0:d.secondLuckyRewardRate)&&void 0!==i?i:.3);default:return v.multipliedBy(null!==(s=null===(l=Z.daoContractInfo)||void 0===l?void 0:l.thirdLuckyRewardRate)&&void 0!==s?s:.1).div(31)}}function F(e,o){let t=new c.Z(u.Z.wei2eth(e));return e=>{var n,r,a,d,i,l;if(o[e-1])return new c.Z(0);switch(e){case 0:default:return new c.Z(0);case 1:return t.multipliedBy(null!==(r=null===(n=Z.daoContractInfo)||void 0===n?void 0:n.firstPlaceRewardRate)&&void 0!==r?r:.6);case 2:return t.multipliedBy(null!==(d=null===(a=Z.daoContractInfo)||void 0===a?void 0:a.secondPlaceRewardRate)&&void 0!==d?d:.3);case 3:return t.multipliedBy(null!==(l=null===(i=Z.daoContractInfo)||void 0===i?void 0:i.thirdPlaceRewardRate)&&void 0!==l?l:.1)}}}function P(){var e,o,t,n,r;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"currnet",d=null!==(n="currnet"===a?null===(e=Z.daoCurrentRoundInfo)||void 0===e?void 0:e.pool.voteRankPool:null===(o=Z.daoContractInfo)||void 0===o?void 0:o.top3VotedPoolPre)&&void 0!==n?n:0n;return new c.Z(d.toString()).multipliedBy(null!==(r=null===(t=Z.daoContractInfo)||void 0===t?void 0:t.voteRankRewardRate)&&void 0!==r?r:0)}function V(){var e,o,t,n,r;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"currnet",d=null!==(n="currnet"===a?null===(e=Z.daoCurrentRoundInfo)||void 0===e?void 0:e.pool.communityPool:null===(o=Z.daoContractInfo)||void 0===o?void 0:o.top3NodePoolPre)&&void 0!==n?n:0n;return new c.Z(d.toString()).multipliedBy(null!==(r=null===(t=Z.daoContractInfo)||void 0===t?void 0:t.communityRewardRate)&&void 0!==r?r:0)}function O(e,o){var t,n;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"currnet";e=null!=e?e:Z.rankInfo.prevVoteUsers,o=null!==(t=null!=o?o:Z.rankInfo.voteWithdrawed)&&void 0!==t?t:[];let a=P(r);return null!==(n=null==e?void 0:e.map((e,o)=>o+1).map((t,n)=>{let d=F(BigInt(a.toFixed(0)),"pre"===r?o:[])(t);return{rank:t,address:e[n],reward:d}}))&&void 0!==n?n:[]}function x(e,o){var t,n;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"currnet";e=null!=e?e:Z.rankInfo.prevNodeUsers,o=null!==(t=null!=o?o:Z.rankInfo.nodeWithdrawed)&&void 0!==t?t:[];let a=V(r);return null!==(n=null==e?void 0:e.map((e,o)=>o+1).map((t,n)=>{let d=F(BigInt(a.toFixed(0)),"pre"===r?o:[])(t);return{rank:t,address:e[n],reward:d}}))&&void 0!==n?n:[]}async function M(o,t){var n,r,i,l;if(!(t=null!==(i=null!=t?t:e)&&void 0!==i?i:null===(n=Z.nodeListFilters.selectedDao)||void 0===n?void 0:n.address))throw Error("No dao address");if(o=null!==(l=null!=o?o:null===(r=Z.rankInfo)||void 0===r?void 0:r.luckyUsers)&&void 0!==l?l:[],!Z.daoContractInfo)throw Error("No current round no");let s=Z.daoContractInfo.currentRoundNO,u=I.Z.buildGetUserRankDetailInfo(o,t,s),c=a.Q.getDefaultProvider(),v=new d.z(a.Q.getTargetNet().chainId,c),f=await v.all(u.calls);return I.Z.analyzeUserDetailInfo(f,u.singleUserCallCount,u.userAddresses)}function W(e,o){return e.map((e,t)=>{let n=t+1;return{rank:n,address:e.userAddress,votes:Number(u.Z.wei2eth(e.voteInfo.votedAmount)),beVotes:0,reward:o(n)}})}async function _(e){let o=Date.now();if((!(o-L<6e4)||!Z.rankInfo.luckyRank||!(Z.rankInfo.luckyRank.length>0))&&!S)try{var t,n,r,a,d;if(N(!0),!(e=null!=e?e:null===(t=Z.nodeListFilters.selectedDao)||void 0===t?void 0:t.address))throw Error("No dao address");if(!Z.daoContractInfo)throw Error("No dao contract info");if(!Z.daoCurrentRoundInfo)throw Error("No current round info");let i=Z.daoContractInfo.currentRoundNO,s=await b(e);C.token&&T.ethInfo.walletAddress&&z(s.nodeWithdrawed);let c=await k.getRankInfo({daoAddress:e,voteAddresses:s.voteAddresses,nodeAddresses:s.nodeAddresses,userAddress:T.ethInfo.walletAddress,currentRoundNO:i}),v=s.luckyRecords.map(e=>e.userAddress),f=s.luckyRecords.map((e,o)=>({rank:o+1,address:e.userAddress,votes:Number(e.votedAmount),beVotes:0,reward:U(o+1,v).toNumber()})),w=P(),R=(n=c.voteData,r=e=>F(BigInt(w.toFixed(0)),[])(e).toNumber(),W(n,r).map((e,o)=>{let t=Number(u.Z.wei2eth(n[o].promotionInfo.sonVotedAmountToday));return{...e,beVotes:t}})),I=V(),m=(a=c.nodeData,d=e=>F(BigInt(I.toFixed(0)),[])(e).toNumber(),W(a,d).map((e,o)=>{let t=Number(u.Z.wei2eth(a[o].promotionInfo.sonVotedAmountWeek));return{...e,beVotes:t}}));D(l.Z.slice.actions.updateDetailRankInfo({luckyRank:f,voteRank:R,nodeRank:m})),E(o)}catch(e){i.Z.E("useDAORankInfo::updateRankInfo error",e)}finally{N(!1)}}async function B(){D(l.Z.slice.actions.clearRankInfo()),D(l.Z.slice.actions.clearUserRankInfo())}async function z(e){var o,n,r,a,d,u;let c=null===(o=Z.nodeListFilters.selectedDao)||void 0===o?void 0:o.address,v=T.ethInfo.walletAddress;if(!c)throw Error(t("NoSelectedDao"));if(!v)throw Error(t("Can't found user address"));new I.Z;let w=new R.q$p(A.buildConfigure()),p=await w.getMyRank({daoAddress:c}),g=new m.zv(p);if(g.hasError()){let e=g.getError();(0,f.L6)(e.msg),i.Z.E(e)}let h=null!==(a=g.getData().daoMyRankList)&&void 0!==a?a:[],y=I.z.DAOUserRankInfoAdapter.getFactory(v),C=h.map(y).map(e=>e.toJSON());D(l.Z.slice.actions.updateUserRankInfo(C));let k=new Map(C.map(e=>[e.rewardType,e.rank]));D(l.Z.slice.actions.updateUserRankRewardInfo([[s.r.RankRewardType.LUCKY_REWARD,U(k.get(s.r.RankRewardType.LUCKY_REWARD)).toNumber()],[s.r.RankRewardType.VOTE_TOP_REWARD,F(null!==(d=null===(n=Z.daoContractInfo)||void 0===n?void 0:n.top3NodePoolPre)&&void 0!==d?d:0n,e)(k.get(s.r.RankRewardType.VOTE_TOP_REWARD)).toNumber()],[s.r.RankRewardType.NODE_TOP_REWARD,F(null!==(u=null===(r=Z.daoContractInfo)||void 0===r?void 0:r.top3NodePoolPre)&&void 0!==u?u:0n,e)(k.get(s.r.RankRewardType.NODE_TOP_REWARD)).toNumber()]]))}return v.useEffect(()=>{var e;if(!(null==o?void 0:o.autoTrigger))return;if(!(null===(e=Z.nodeListFilters.selectedDao)||void 0===e?void 0:e.address)||!Z.daoCurrentRoundInfo){B();return}let n=y()(()=>{_().catch(e=>{(0,f.L6)(new f.HU(e,t("GetRankDataFailed")).asToastMessage()),i.Z.E("updateRankInfo",e)})},1e3),r=h.Z.sleepForAnimationFrame(200);r.wait(()=>n());let a=setInterval(()=>{"visible"===document.visibilityState&&n()},6e4);return()=>{r.cancel(g.Z.ReactError.useEffectDestroy()),clearInterval(a),n.cancel(),B()}},[Z.daoCurrentRoundInfo,C.token,T.ethInfo.walletAddress]),{updateRankSimpleInfo:b,updateUserRankInfo:z,calcLuckyRewardInLocal:U,getLuckyRewardInLocal:function(e){var o;return null!==(o=null==(e=null!=e?e:Z.rankInfo.luckyUsers)?void 0:e.map((e,o)=>o+1).map((o,t)=>({rank:o,address:e[t],reward:U(o,e)})))&&void 0!==o?o:[]},getUserLuckyRewardInLocal:function(e,o){var t,n;e=null!=e?e:T.ethInfo.walletAddress;let r=null!==(n=(o=null!==(t=null!=o?o:Z.rankInfo.luckyUsers)&&void 0!==t?t:[]).indexOf(e))&&void 0!==n?n:-1;return U(-1===r?4:r+1,o)},calcTop3RewardInLocal:F,getVoteTop3Rawards:O,getUserVoteTopReward:function(e,o){var t,n;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"currnet";return e=null!=e?e:T.ethInfo.walletAddress,(null!==(n=O(void 0,o=null!==(t=null!=o?o:Z.rankInfo.voteWithdrawed)&&void 0!==t?t:[],r).find(o=>o.address===e))&&void 0!==n?n:{reward:new c.Z(0)}).reward},getNodeTop3Rawards:x,getUserNodeTopReward:function(e,o){var t,n;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"currnet";return e=null!=e?e:T.ethInfo.walletAddress,(null!==(n=x(void 0,o=null!==(t=null!=o?o:Z.rankInfo.nodeWithdrawed)&&void 0!==t?t:[],r).find(o=>o.address===e))&&void 0!==n?n:{reward:new c.Z(0)}).reward},getLastInvestorsDetailInfo:M,updateRankInfo:_,clearRankInfo:B}}},94521:function(e,o,t){t.d(o,{Z:function(){return Z}});var n=t(2265),r=t(72917),a=t(68651),d=t(43009),i=t(6178),l=t(74439),s=t(43949),u=t(81939),c=t(83123),v=t(13965),f=t(20151),w=t(10433),R=t(14931),I=t(20605),m=t(22928),p=t(95665),g=t(344),h=t(68031),D=t(64798),y=t.n(D),C=t(35178);function Z(){var e,o,t,D,Z,T,k,A,L,E,S,N,b,U,F,P,V,O,x,M,W,_,B,z,H,G,q,$,j,J,Q,K,Y,X,ee,eo,et,en,er,ea,ed,ei,el,es,eu,ec,ev,ef,ew,eR,eI,em,ep,eg,eh,eD;let ey=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},eC=(0,i.T)(),{t:eZ}=(0,s.$G)(["dao"]),eT=(0,i.C)(e=>e.global),ek=(0,i.C)(e=>e.dao),eA=(0,i.C)(e=>e.user),eL=(0,r.Z)(),eE=null!==(K=null==ey?void 0:ey.autoTrigger)&&void 0!==K&&K,eS=(0,R.Z)(void 0,{autoTrigger:eE}),[eN,eb]=n.useState(0),[eU,eF]=n.useState(0),[eP,eV]=n.useState(!1),[eO,ex]=n.useState(!1),[eM,eW]=n.useState(!1),e_=null!==(Y=null===(e=ek.daoContractInfo)||void 0===e?void 0:e.voteRankClaimDurationAdd)&&void 0!==Y?Y:0,eB=null!==(X=null===(o=ek.daoContractInfo)||void 0===o?void 0:o.createTime)&&void 0!==X?X:0,ez=null!==(ee=null===(t=ek.daoContractInfo)||void 0===t?void 0:t.rewardRoundPass)&&void 0!==ee?ee:0,eH=null!==(eo=null===(D=ek.daoContractInfo)||void 0===D?void 0:D.airdropDurationGetLimit)&&void 0!==eo?eo:0;m.Z.getCurrentRewardRoundTimestamp(eB,e_,ez);let eG=null!==(et=null===(Z=ek.daoCurrentRoundInfo)||void 0===Z?void 0:Z.roundExpire)&&void 0!==et?et:0,eq=null!==(en=null===(T=ek.userInfo)||void 0===T?void 0:T.voteAndAirDropReward.clairReward)&&void 0!==en?en:0n,e$=eN||(null!==(er=null===(k=ek.userInfo)||void 0===k?void 0:k.voteInfo.roundFirstVotedDate)&&void 0!==er?er:0),ej=eG>0?l.Z.convertTimeDifference(new Date(e$+eH-eT.currentTime),{includeDays:!1}):0,eJ=eq>0n,eQ=Math.floor(eT.currentTime/e_)*e_+e_,eK=ek.userRewardInfo.voteTopReward.gt(0)?l.Z.convertTimeDifference(new Date(eQ-eT.currentTime),{includeDays:!1}):0,eY=ek.userRewardInfo.voteTopReward.gt(0),eX=null!==(ea=null===(A=ek.daoContractInfo)||void 0===A?void 0:A.communityDuration)&&void 0!==ea?ea:0,e0=Math.floor((null!==(ed=null===(L=ek.daoContractInfo)||void 0===L?void 0:L.top3NodeDate)&&void 0!==ed?ed:0)/eX)*eX+(null!==(ei=null===(E=ek.daoContractInfo)||void 0===E?void 0:E.communityDuration)&&void 0!==ei?ei:0);null===(S=ek.daoContractInfo)||void 0===S||S.communityRewardDuration;let e1=ek.userRewardInfo.nodeTopReward.gt(0)?l.Z.convertTimeDifference(new Date(e0-eT.currentTime),{includeDays:!1}):0,e2=ek.userRewardInfo.nodeTopReward.gt(0),e6=l.Z.convertTimeDifference(new Date((null!==(el=null===(N=ek.daoCurrentRoundInfo)||void 0===N?void 0:N.roundExpire)&&void 0!==el?el:0)-eT.currentTime),{includeDays:!1}),e3=l.Z.convertTimeDifference(new Date((null!==(es=null===(b=ek.daoCurrentRoundInfo)||void 0===b?void 0:b.roundExpire)&&void 0!==es?es:0)+(null!==(eu=null===(U=ek.daoContractInfo)||void 0===U?void 0:U.loserPoolRewardTimeLimit)&&void 0!==eu?eu:0)-eT.currentTime),{includeDays:!1}),e9=0===e6&&0!==e3&&ek.userRewardInfo.luckyReward.gt(0)&&(null===(F=ek.userInfo)||void 0===F?void 0:F.voteInfo.isLuckyRewardClaimed)===!1,e4=(null!==(ec=null===(P=ek.daoCurrentRoundInfo)||void 0===P?void 0:P.totalVoteAmount)&&void 0!==ec?ec:0n)-(null!==(ev=null===(V=ek.daoCurrentRoundInfo)||void 0===V?void 0:V.totalEthDone)&&void 0!==ev?ev:0n),e8=(null===(O=ek.userInfo)||void 0===O?void 0:O.voteInfo.isLoserRewardClaimed)?new a.Z(0):new a.Z((null!==(ef=null===(x=ek.userInfo)||void 0===x?void 0:x.voteInfo.votedAmount)&&void 0!==ef?ef:0n).toString()).minus((null!==(ew=null===(M=ek.userInfo)||void 0===M?void 0:M.voteInfo.ethDone)&&void 0!==ew?ew:0n).toString()).div((0n===e4?1n:e4).toString()).multipliedBy((null!==(eR=null===(W=ek.daoCurrentRoundInfo)||void 0===W?void 0:W.pool.loserPool)&&void 0!==eR?eR:0n).toString()),e5=(null===(_=ek.userInfo)||void 0===_?void 0:_.voteInfo.isLoserRewardClaimed)?new a.Z(0):new a.Z((null!==(eI=null===(B=ek.userInfo)||void 0===B?void 0:B.voteInfo.votedAmount)&&void 0!==eI?eI:0n).toString()).minus((null!==(em=null===(z=ek.userInfo)||void 0===z?void 0:z.voteInfo.ethDone)&&void 0!==em?em:0n).toString()).div((0n===e4?1n:e4).toString()).multipliedBy((null!==(ep=null===(H=ek.daoCurrentRoundInfo)||void 0===H?void 0:H.pool.loserPoolETH)&&void 0!==ep?ep:0n).toString()),e7=l.Z.convertTimeDifference(new Date((null!==(eg=null===(G=ek.daoCurrentRoundInfo)||void 0===G?void 0:G.roundExpire)&&void 0!==eg?eg:0)-eT.currentTime),{includeDays:!1}),oe=l.Z.convertTimeDifference(new Date((null!==(eh=null===(q=ek.daoCurrentRoundInfo)||void 0===q?void 0:q.roundExpire)&&void 0!==eh?eh:0)+(null!==(eD=null===($=ek.daoContractInfo)||void 0===$?void 0:$.loserPoolRewardTimeLimit)&&void 0!==eD?eD:0)-eT.currentTime),{includeDays:!1}),oo=0===e7&&0!==oe&&(e8.gt(0)||e5.gt(0)),ot=[{title:eZ("DAOReward"),reward:u.Z.wei2eth(eq),hasDetails:!0,countdown:0===ej?"":ej.toFormated(),claimable:eJ,handleClaim:on},{title:eZ("VoteTopReward"),reward:ek.userRewardInfo.voteTopReward.toString(),hasDetails:!1,countdown:0===eK?"":eK.toFormated(),claimable:eY,handleClaim:or},{title:eZ("NodeTopReward"),reward:ek.userRewardInfo.nodeTopReward.toString(),hasDetails:!1,countdown:0===e1?"":e1.toFormated(),claimable:e2,handleClaim:oa},{title:eZ("LuckyReward"),reward:ek.userRewardInfo.luckyReward.toString(),hasDetails:!1,countdown:(null===(j=ek.userInfo)||void 0===j?void 0:j.voteInfo.isLuckyRewardClaimed)?"":0!==e6?e6.toFormated():0!==e3?e3.toFormated():"",claimable:e9,handleClaim:od},{title:eZ("OtherReward"),tokenReward:e8.gt(0)?u.Z.wei2eth(e8.toFixed(0,a.Z.ROUND_DOWN)):"0",hasDetails:!1,countdown:(null===(J=ek.userInfo)||void 0===J?void 0:J.voteInfo.isLoserRewardClaimed)?"":0!==e7?e7.toFormated():0!==oe?oe.toFormated():"",claimable:oo,handleClaim:oi}];async function on(){var e;let o=null===(e=ek.nodeListFilters.selectedDao)||void 0===e?void 0:e.address;if(!o){(0,c.L6)(eZ("NoSelectedDao"));return}if(!eJ)return;let t=v.r.getInstance(),n=u.Z.getInstance(t.getProvider()),r=f.bR.connect(o,await n.getSigner());try{let e=await r.claimVoteAndAirDropReward();await e.wait(),(0,c.x9)(eZ("ClaimVoteAndAirDropRewardSuccess"));let o=Date.now();eb(o),ex(!0),ek.userInfo&&eC(p.Z.slice.actions.updateUserInfo({...ek.userInfo,voteAndAirDropReward:{...ek.userInfo.voteAndAirDropReward,clairReward:0n}})),await ol(),setTimeout(()=>{ex(!1)},5e3)}catch(e){(0,c.L6)(new c.HU(e,eZ("ClaimVoteAndAirDropRewardFailed")).asToastMessage()),w.Z.E(e)}}async function or(){var e,o;if(!(null===(e=ek.nodeListFilters.selectedDao)||void 0===e?void 0:e.address)){(0,c.L6)(eZ("NoSelectedDao"));return}eC(p.Z.slice.actions.updateUserRewardInfo({...ek.userRewardInfo,voteTopReward:new a.Z(0)}));let t=v.r.getInstance(),n=u.Z.getInstance(t.getProvider()),r=f.bR.connect(null===(o=ek.nodeListFilters.selectedDao)||void 0===o?void 0:o.address,await n.getSigner());try{let e=await r.claimTop3VotedReward();await e.wait(),(0,c.x9)(eZ("ClaimNodeTopRewardSuccess")),await ol()}catch(e){eC(p.Z.slice.actions.updateUserRewardInfo({...ek.userRewardInfo,voteTopReward:ek.userRewardInfo.voteTopReward})),(0,c.L6)(new c.HU(e,eZ("ClaimNodeTopRewardFailed")).asToastMessage()),w.Z.E(e)}}async function oa(){var e,o;if(!(null===(e=ek.nodeListFilters.selectedDao)||void 0===e?void 0:e.address))return(0,c.L6)(eZ("NoSelectedDao"));eC(p.Z.slice.actions.updateUserRewardInfo({...ek.userRewardInfo,nodeTopReward:new a.Z(0)}));let t=v.r.getInstance(),n=u.Z.getInstance(t.getProvider()),r=f.bR.connect(null===(o=ek.nodeListFilters.selectedDao)||void 0===o?void 0:o.address,await n.getSigner());try{let e=await r.claimTop3NodeReward();await e.wait(),(0,c.x9)(eZ("ClaimNodeTopRewardSuccess")),await ol()}catch(e){eC(p.Z.slice.actions.updateUserRewardInfo({...ek.userRewardInfo,nodeTopReward:ek.userRewardInfo.nodeTopReward})),(0,c.L6)(new c.HU(e,eZ("ClaimNodeTopRewardFailed")).asToastMessage()),w.Z.E(e)}}async function od(){var e,o;if(!(null===(e=ek.nodeListFilters.selectedDao)||void 0===e?void 0:e.address))return(0,c.L6)(eZ("NoSelectedDao"));ek.userInfo&&eC(p.Z.slice.actions.updateUserInfo({...ek.userInfo,voteInfo:{...ek.userInfo.voteInfo,isLuckyRewardClaimed:!0}}));let t=v.r.getInstance(),n=u.Z.getInstance(t.getProvider()),r=f.bR.connect(null===(o=ek.nodeListFilters.selectedDao)||void 0===o?void 0:o.address,await n.getSigner());try{let e=await r.claimLuckyReward();await e.wait(),(0,c.x9)(eZ("ClaimLuckyRewardSuccess")),await ol()}catch(e){ek.userInfo&&eC(p.Z.slice.actions.updateUserInfo({...ek.userInfo,voteInfo:{...ek.userInfo.voteInfo,isLuckyRewardClaimed:!1}})),(0,c.L6)(new c.HU(e,eZ("ClaimLuckyRewardFailed")).asToastMessage()),w.Z.E(e)}}async function oi(){var e,o;if(!(null===(e=ek.nodeListFilters.selectedDao)||void 0===e?void 0:e.address))return(0,c.L6)(eZ("NoSelectedDao"));ek.userInfo&&eC(p.Z.slice.actions.updateUserInfo({...ek.userInfo,voteInfo:{...ek.userInfo.voteInfo,isLoserRewardClaimed:!0}}));let t=v.r.getInstance(),n=u.Z.getInstance(t.getProvider()),r=f.bR.connect(null===(o=ek.nodeListFilters.selectedDao)||void 0===o?void 0:o.address,await n.getSigner());try{let e=await r.claimLoserReward();await e.wait(),(0,c.x9)(eZ("ClaimOtherRewardSuccess")),await ol()}catch(e){ek.userInfo&&eC(p.Z.slice.actions.updateUserInfo({...ek.userInfo,voteInfo:{...ek.userInfo.voteInfo,isLoserRewardClaimed:!1}})),(0,c.L6)(new c.HU(e,eZ("ClaimOtherRewardFailed")).asToastMessage()),w.Z.E(e)}}async function ol(){var e;let o=null===(e=ek.nodeListFilters.selectedDao)||void 0===e?void 0:e.address;if(o)try{eV(!0),eW(!0),eC(C.Z.slice.actions.updateTime(Date.now())),await new Promise(e=>setTimeout(e,2e3)),await Promise.all([eL.updateInfo(),eS.updateRankSimpleInfo(o),os(o),oc(o)]),await oR(o),ey.handleAfterClaim&&await ey.handleAfterClaim()}catch(e){w.Z.E("Error in handleAfterClaim:",e)}finally{eV(!1),eW(!1)}}async function os(e){var o;let t=Date.now();if(!eM&&t-eU<6e4||eP)return;let n=new m.Z;if(!(e=null!=e?e:null===(o=ek.nodeListFilters.selectedDao)||void 0===o?void 0:o.address)){(0,c.L6)(eZ("NoSelectedDao"));return}try{eV(!0);let o=await n.getUserVoteNodeRankReward({userAddress:eA.ethInfo.walletAddress,daoAddress:e});eC(p.Z.slice.actions.updateUserRewardInfo({luckyReward:new a.Z(u.Z.wei2eth(o.luckyReward.reward)),voteTopReward:new a.Z(u.Z.wei2eth(o.voteTopReward.reward)),nodeTopReward:new a.Z(u.Z.wei2eth(o.nodeTopReward.reward))})),eF(t)}catch(e){(0,c.L6)(new c.HU(e,eZ("GetUserVoteNodeRankRewardFailed")).asToastMessage()),w.Z.E(e)}finally{eV(!1)}}let ou=n.useCallback(y()(e=>{var o;if(null===(o=ek.daoContractInfo)||void 0===o?void 0:o.daoAddress)return os(ek.daoContractInfo.daoAddress)},800),[ek.daoContractInfo,eA.ethInfo.walletAddress]);async function oc(e){if(eO)return;let o=new m.Z,t=new g.q$p(o.buildConfigure()),n=await t.getLastClaimTime({daoAddress:e}),r=new h.zv(n);if(r.hasError()){let e=r.getError();(0,c.L6)(new c.HU(e,eZ("GetLastClaimTimeFailed")).asToastMessage()),w.Z.E(e);return}let a=d.Z.Time.fromTimestamp(r.getData());eO||a.toJSTime()===eN||eb(a.toJSTime())}function ov(e,o){let t=Number("120");return new a.Z(u.Z.wei2eth(e)).multipliedBy(t).div(100).minus(u.Z.wei2eth(o))}n.useEffect(()=>{if(!eE||!ek.daoContractInfo||!eA.ethInfo.walletAddress)return;let e=l.Z.sleepForAnimationFrame(300);e.wait(()=>{ou()});let o=setInterval(()=>{"visible"===document.visibilityState&&ou()},6e4);return()=>{e.cancel(I.Z.ReactError.useEffectDestroy()),clearInterval(o)}},[ek.daoContractInfo,eA.ethInfo.walletAddress,eE,ou]);let of=n.useCallback(y()(e=>{oc(e)},500),[]);async function ow(){var e;let o=null===(e=ek.nodeListFilters.selectedDao)||void 0===e?void 0:e.address;if(o&&eA.ethInfo.walletAddress)try{eV(!0),eW(!0),await Promise.all([eL.updateInfo(),eS.updateRankSimpleInfo(o),os(o),oc(o)]),await oR(o),eF(Date.now()),eW(!1)}catch(e){w.Z.E("Error in refreshAllData:",e)}finally{eV(!1)}}async function oR(e){try{let o=v.r.getInstance(),t=u.Z.getInstance(o.getProvider()),n=f.bR.connect(e,await t.getSigner()),r=eA.ethInfo.walletAddress;if(!r)return;let a=await n.getVoteAndAirDropReward(r);if(ek.userInfo){let e={...ek.userInfo,voteAndAirDropReward:{...ek.userInfo.voteAndAirDropReward,clairReward:a.clairReward,airdropReward:a.airdropReward,nodeReward:a.nodeReward,airdropLinkReward:a.airdropLinkReward,reinvestReward:a.reinvestReward}};eC(p.Z.slice.actions.updateUserInfo(e))}}catch(e){w.Z.E("Error checking reward claim status:",e)}}return n.useEffect(()=>{var e;if((null===(e=ek.nodeListFilters.selectedDao)||void 0===e?void 0:e.address)&&eT.token)return of(ek.nodeListFilters.selectedDao.address),()=>{of.cancel()}},[null===(Q=ek.nodeListFilters.selectedDao)||void 0===Q?void 0:Q.address,eT.token,of]),n.useEffect(()=>{eM&&eE&&ow()},[eM,eE]),{rewardItems:ot,handleVoteAirdropClaim:on,handleVoteRankClaim:or,handleNodeRankClaim:oa,handleLuckyClaim:od,handleOtherClaim:oi,estimatePendingReward:ov,estimateUserPendingReward:function(){var e,o,t,n;return ov(null!==(t=null===(e=ek.userInfo)||void 0===e?void 0:e.voteInfo.votedAmount)&&void 0!==t?t:0n,null!==(n=null===(o=ek.userInfo)||void 0===o?void 0:o.voteInfo.ethDone)&&void 0!==n?n:0n)},getClaimNodeRewardCountdown:function(){if(!ek.daoContractInfo)return"";let e=Math.floor(eT.currentTime/1e3),o=86400*Math.floor(Math.floor(eB/1e3)/86400),t=o+604800*Math.floor((e-o)/604800)+604800-e;if(t<=0)return"00:00:00";let n=Math.floor(t/3600).toString().padStart(2,"0"),r=Math.floor(t%3600/60).toString().padStart(2,"0"),a=Math.floor(t%60).toString().padStart(2,"0");return"".concat(n,":").concat(r,":").concat(a)},refreshAllData:ow,isUpdating:eP}}}}]);