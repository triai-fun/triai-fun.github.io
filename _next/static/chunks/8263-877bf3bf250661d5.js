"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8263],{30681:function(e,t,o){o.d(t,{Cv:function(){return i},OM:function(){return d},yO:function(){return l}});var r=o(40257);let n=(e,t)=>{var o;return null!==(o=r.env[e])&&void 0!==o?o:t},a={baseSepolia:{aiDaoAddress:n("NEXT_PUBLIC_AIDAO_BASE_SEPOLIA_ADDRESS","0"),targetDaoAddress:n("NEXT_PUBLIC_AIDAO_BASE_SEPOLIA_TARGET_DAO","0"),rewardTokenAddress:n("NEXT_PUBLIC_AIDAO_BASE_SEPOLIA_REWARD_TOKEN","0")},baseMainnet:{aiDaoAddress:n("NEXT_PUBLIC_AIDAO_BASE_MAINNET_ADDRESS","0x79Baf19C82C88C63b4b827Ba5d37F9d0A05e65D5"),targetDaoAddress:n("NEXT_PUBLIC_AIDAO_BASE_MAINNET_TARGET_DAO","0x1A714D76F14B9e7C894B5580cE92316021863341"),rewardTokenAddress:n("NEXT_PUBLIC_AIDAO_BASE_MAINNET_REWARD_TOKEN","0xbff9E7a186ACF2C3f939a9C3Bcf5a38d86E7dbdF")}};function d(e){switch(e){case 84532:return a.baseSepolia;case 8453:return a.baseMainnet;default:return}}function i(e,t){if(!e)return!1;let o=d(t);return!!o&&o.targetDaoAddress.toLowerCase()===e.toLowerCase()}function l(e){let t=d(e);return null==t?void 0:t.aiDaoAddress}},89522:function(e,t,o){o.d(t,{Z:function(){return u}});var r=o(12249),n=o(5853),a=o(68031),d=o(59201),i=o(8113),l=o(344),s=o(63671);class u extends s.bQ{async loginWallet(e){var t;let o=new d.M,r=new l.M2y(this.buildConfigure(o)),n=new a.zv(await r.loginByWallet({walletLoginRequestVO:{walletAddress:e.walletAddress,signature:e.signature,timestamp:e.timestamp.toString()}},{signal:null===(t=e.abortController)||void 0===t?void 0:t.signal}));return n.hasError()||o.afterHandler(n.response,{url:"/login",data:e}),n}async getUserInfo(e){var t;let o=new Headers;e.Authorization&&o.set("Authorization",e.Authorization),delete e.Authorization;let r=new l.M2y(this.buildConfigure());return new a.zv(await r.getUserInfo({signal:null===(t=e.abortController)||void 0===t?void 0:t.signal,headers:o}))}async uploadFile(e){var t;let o=new FormData;o.append("file",e.file);let r=new l.M2y(this.buildConfigure()),n=await r.upload({file:e.file},{signal:null===(t=e.abortController)||void 0===t?void 0:t.signal,body:o});return new a.zv(n)}async addNFTInfo(e){var t;e.Authorization,delete e.Authorization;let o=new l.lG6(this.buildConfigure());return new a.zv(await o.uploadHash({uploadHashRequestVO:e},{signal:null===(t=e.abortController)||void 0===t?void 0:t.signal}))}constructor(e=new d.Z){super(),(0,r._)(this,"httpRequest",void 0),this.httpRequest=e}}u=(0,n.gn)([i.ZP.Singleton,(0,n.w6)("design:type",Function),(0,n.w6)("design:paramtypes",["undefined"==typeof HttpRequest?Object:HttpRequest])],u)},88263:function(e,t,o){o.d(t,{Z:function(){return N}});var r=o(2265),n=o(72917),a=o(68651),d=o(43009),i=o(6178),l=o(74439),s=o(43949),u=o(81939),c=o(83123),f=o(13965),w=o(70042),v=o(10433),R=o(3682),I=o(21707),m=o(95665),h=o(89769),p=o(344),g=o(22928),A=o(68031),C=o(89522),y=o(20605),D=o(64798),T=o.n(D),Z=o(35178),k=o(30681),E=o(88952),L=o(59868);function N(){var e,t,D,N,b,S,F,P,U,_,O,B,x,M,V,H,W,z,K,G,q,Q,X,$,j,J,Y,ee,et,eo,er,en,ea,ed,ei,el,es,eu,ec,ef,ew,ev,eR,eI,em,eh,ep,eg,eA,eC,ey,eD;let eT=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},eZ=(0,i.T)(),{t:ek}=(0,s.$G)(["dao"]),eE=(0,i.C)(e=>e.global),eL=(0,i.C)(e=>e.dao),eN=(0,i.C)(e=>e.user),eb=(0,n.Z)(),eS=null!==(er=null==eT?void 0:eT.autoTrigger)&&void 0!==er&&er,eF=function(e,t){let{t:o}=(0,s.$G)(["dao"]),d=(0,i.T)(),f=(0,i.C)(e=>e.global),w=(0,i.C)(e=>e.dao),D=(0,i.C)(e=>e.user);(0,n.Z)(e);let Z=new g.Z,k=new C.Z,[E,L]=r.useState(0),[N,b]=r.useState(!1);async function S(e){var t;if(!(e=null!=e?e:null===(t=w.nodeListFilters.selectedDao)||void 0===t?void 0:t.address))throw Error("No dao address");let o=await Z.getRankSimpleInfo(e);return d(m.Z.slice.actions.updateSimpleRankInfo({luckyUsers:o.luckyRecords.map(e=>e.userAddress),voteUsers:o.voteAddresses,prevVoteUsers:o.prevVoteAddresses,voteWithdrawed:o.voteWithdrawed,nodeUsers:o.nodeAddresses,prevNodeUsers:o.prevNodeAddresses,nodeWithdrawed:o.nodeWithdrawed})),o}function F(e,t){var o,r,n,d,i,l,s,c;let f=new a.Z(u.Z.wei2eth(null!==(r=null===(o=w.daoCurrentRoundInfo)||void 0===o?void 0:o.pool.luckyPool)&&void 0!==r?r:0n));switch(null==(t=null!=t?t:w.rankInfo.luckyUsers)||t.length,e){case 0:return new a.Z(0);case 1:return f.multipliedBy(null!==(d=null===(n=w.daoContractInfo)||void 0===n?void 0:n.firstLuckyRewardRate)&&void 0!==d?d:.6);case 2:return f.multipliedBy(null!==(l=null===(i=w.daoContractInfo)||void 0===i?void 0:i.secondLuckyRewardRate)&&void 0!==l?l:.3);default:return f.multipliedBy(null!==(c=null===(s=w.daoContractInfo)||void 0===s?void 0:s.thirdLuckyRewardRate)&&void 0!==c?c:.1).div(31)}}function P(e,t){let o=new a.Z(u.Z.wei2eth(e));return e=>{var r,n,d,i,l,s;if(t[e-1])return new a.Z(0);switch(e){case 0:default:return new a.Z(0);case 1:return o.multipliedBy(null!==(n=null===(r=w.daoContractInfo)||void 0===r?void 0:r.firstPlaceRewardRate)&&void 0!==n?n:.6);case 2:return o.multipliedBy(null!==(i=null===(d=w.daoContractInfo)||void 0===d?void 0:d.secondPlaceRewardRate)&&void 0!==i?i:.3);case 3:return o.multipliedBy(null!==(s=null===(l=w.daoContractInfo)||void 0===l?void 0:l.thirdPlaceRewardRate)&&void 0!==s?s:.1)}}}function U(){var e,t,o,r,n;let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"currnet",i=null!==(r="currnet"===d?null===(e=w.daoCurrentRoundInfo)||void 0===e?void 0:e.pool.voteRankPool:null===(t=w.daoContractInfo)||void 0===t?void 0:t.top3VotedPoolPre)&&void 0!==r?r:0n;return new a.Z(i.toString()).multipliedBy(null!==(n=null===(o=w.daoContractInfo)||void 0===o?void 0:o.voteRankRewardRate)&&void 0!==n?n:0)}function _(){var e,t,o,r,n;let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"currnet",i=null!==(r="currnet"===d?null===(e=w.daoCurrentRoundInfo)||void 0===e?void 0:e.pool.communityPool:null===(t=w.daoContractInfo)||void 0===t?void 0:t.top3NodePoolPre)&&void 0!==r?r:0n;return new a.Z(i.toString()).multipliedBy(null!==(n=null===(o=w.daoContractInfo)||void 0===o?void 0:o.communityRewardRate)&&void 0!==n?n:0)}function O(e,t){var o,r;let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"currnet";e=null!=e?e:w.rankInfo.prevVoteUsers,t=null!==(o=null!=t?t:w.rankInfo.voteWithdrawed)&&void 0!==o?o:[];let a=U(n);return null!==(r=null==e?void 0:e.map((e,t)=>t+1).map((o,r)=>{let d=P(BigInt(a.toFixed(0)),"pre"===n?t:[])(o);return{rank:o,address:e[r],reward:d}}))&&void 0!==r?r:[]}function B(e,t){var o,r;let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"currnet";e=null!=e?e:w.rankInfo.prevNodeUsers,t=null!==(o=null!=t?t:w.rankInfo.nodeWithdrawed)&&void 0!==o?o:[];let a=_(n);return null!==(r=null==e?void 0:e.map((e,t)=>t+1).map((o,r)=>{let d=P(BigInt(a.toFixed(0)),"pre"===n?t:[])(o);return{rank:o,address:e[r],reward:d}}))&&void 0!==r?r:[]}async function x(t,o){var r,n,a,d;if(!(o=null!==(a=null!=o?o:e)&&void 0!==a?a:null===(r=w.nodeListFilters.selectedDao)||void 0===r?void 0:r.address))throw Error("No dao address");if(t=null!==(d=null!=t?t:null===(n=w.rankInfo)||void 0===n?void 0:n.luckyUsers)&&void 0!==d?d:[],!w.daoContractInfo)throw Error("No current round no");let i=w.daoContractInfo.currentRoundNO,l=g.Z.buildGetUserRankDetailInfo(t,o,i),s=R.Q.getDefaultProvider(),u=new I.z(R.Q.getTargetNet().chainId,s),c=await u.all(l.calls);return g.Z.analyzeUserDetailInfo(c,l.singleUserCallCount,l.userAddresses)}function M(e,t){return e.map((e,o)=>{let r=o+1;return{rank:r,address:e.userAddress,votes:Number(u.Z.wei2eth(e.voteInfo.votedAmount)),beVotes:0,reward:t(r)}})}async function V(e){let t=Date.now();if((!(t-E<6e4)||!w.rankInfo.luckyRank||!(w.rankInfo.luckyRank.length>0))&&!N)try{var o,r,n,a,i;if(b(!0),!(e=null!=e?e:null===(o=w.nodeListFilters.selectedDao)||void 0===o?void 0:o.address))throw Error("No dao address");if(!w.daoContractInfo)throw Error("No dao contract info");if(!w.daoCurrentRoundInfo)throw Error("No current round info");let l=w.daoContractInfo.currentRoundNO,s=await S(e);f.token&&D.ethInfo.walletAddress&&W(s.nodeWithdrawed);let c=await Z.getRankInfo({daoAddress:e,voteAddresses:s.voteAddresses,nodeAddresses:s.nodeAddresses,userAddress:D.ethInfo.walletAddress,currentRoundNO:l}),v=s.luckyRecords.map(e=>e.userAddress),R=s.luckyRecords.map((e,t)=>({rank:t+1,address:e.userAddress,votes:Number(e.votedAmount),beVotes:0,reward:F(t+1,v).toNumber()})),I=U(),h=(r=c.voteData,n=e=>P(BigInt(I.toFixed(0)),[])(e).toNumber(),M(r,n).map((e,t)=>{let o=Number(u.Z.wei2eth(r[t].promotionInfo.sonVotedAmountToday));return{...e,beVotes:o}})),p=_(),g=(a=c.nodeData,i=e=>P(BigInt(p.toFixed(0)),[])(e).toNumber(),M(a,i).map((e,t)=>{let o=Number(u.Z.wei2eth(a[t].promotionInfo.sonVotedAmountWeek));return{...e,beVotes:o}}));d(m.Z.slice.actions.updateDetailRankInfo({luckyRank:R,voteRank:h,nodeRank:g})),L(t)}catch(e){v.Z.E("useDAORankInfo::updateRankInfo error",e)}finally{b(!1)}}async function H(){d(m.Z.slice.actions.clearRankInfo()),d(m.Z.slice.actions.clearUserRankInfo())}async function W(e){var t,r,n,a,i,l;let s=null===(t=w.nodeListFilters.selectedDao)||void 0===t?void 0:t.address,u=D.ethInfo.walletAddress;if(!s)throw Error(o("NoSelectedDao"));if(!u)throw Error(o("Can't found user address"));new g.Z;let f=new p.q$p(k.buildConfigure()),R=await f.getMyRank({daoAddress:s}),I=new A.zv(R);if(I.hasError()){let e=I.getError();(0,c.L6)(e.msg),v.Z.E(e)}let C=null!==(a=I.getData().daoMyRankList)&&void 0!==a?a:[],y=g.z.DAOUserRankInfoAdapter.getFactory(u),T=C.map(y).map(e=>e.toJSON());d(m.Z.slice.actions.updateUserRankInfo(T));let Z=new Map(T.map(e=>[e.rewardType,e.rank]));d(m.Z.slice.actions.updateUserRankRewardInfo([[h.r.RankRewardType.LUCKY_REWARD,F(Z.get(h.r.RankRewardType.LUCKY_REWARD)).toNumber()],[h.r.RankRewardType.VOTE_TOP_REWARD,P(null!==(i=null===(r=w.daoContractInfo)||void 0===r?void 0:r.top3NodePoolPre)&&void 0!==i?i:0n,e)(Z.get(h.r.RankRewardType.VOTE_TOP_REWARD)).toNumber()],[h.r.RankRewardType.NODE_TOP_REWARD,P(null!==(l=null===(n=w.daoContractInfo)||void 0===n?void 0:n.top3NodePoolPre)&&void 0!==l?l:0n,e)(Z.get(h.r.RankRewardType.NODE_TOP_REWARD)).toNumber()]]))}return r.useEffect(()=>{var e;if(!(null==t?void 0:t.autoTrigger))return;if(!(null===(e=w.nodeListFilters.selectedDao)||void 0===e?void 0:e.address)||!w.daoCurrentRoundInfo){H();return}let r=T()(()=>{V().catch(e=>{(0,c.L6)(new c.HU(e,o("GetRankDataFailed")).asToastMessage()),v.Z.E("updateRankInfo",e)})},1e3),n=l.Z.sleepForAnimationFrame(200);n.wait(()=>r());let a=setInterval(()=>{"visible"===document.visibilityState&&r()},6e4);return()=>{n.cancel(y.Z.ReactError.useEffectDestroy()),clearInterval(a),r.cancel(),H()}},[w.daoCurrentRoundInfo,f.token,D.ethInfo.walletAddress]),{updateRankSimpleInfo:S,updateUserRankInfo:W,calcLuckyRewardInLocal:F,getLuckyRewardInLocal:function(e){var t;return null!==(t=null==(e=null!=e?e:w.rankInfo.luckyUsers)?void 0:e.map((e,t)=>t+1).map((t,o)=>({rank:t,address:e[o],reward:F(t,e)})))&&void 0!==t?t:[]},getUserLuckyRewardInLocal:function(e,t){var o,r;e=null!=e?e:D.ethInfo.walletAddress;let n=null!==(r=(t=null!==(o=null!=t?t:w.rankInfo.luckyUsers)&&void 0!==o?o:[]).indexOf(e))&&void 0!==r?r:-1;return F(-1===n?4:n+1,t)},calcTop3RewardInLocal:P,getVoteTop3Rawards:O,getUserVoteTopReward:function(e,t){var o,r;let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"currnet";return e=null!=e?e:D.ethInfo.walletAddress,(null!==(r=O(void 0,t=null!==(o=null!=t?t:w.rankInfo.voteWithdrawed)&&void 0!==o?o:[],n).find(t=>t.address===e))&&void 0!==r?r:{reward:new a.Z(0)}).reward},getNodeTop3Rawards:B,getUserNodeTopReward:function(e,t){var o,r;let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"currnet";return e=null!=e?e:D.ethInfo.walletAddress,(null!==(r=B(void 0,t=null!==(o=null!=t?t:w.rankInfo.nodeWithdrawed)&&void 0!==o?o:[],n).find(t=>t.address===e))&&void 0!==r?r:{reward:new a.Z(0)}).reward},getLastInvestorsDetailInfo:x,updateRankInfo:V,clearRankInfo:H}}(void 0,{autoTrigger:eS}),[eP,eU]=r.useState(0),[e_,eO]=r.useState(0),[eB,ex]=r.useState(!1),[eM,eV]=r.useState(!1),[eH,eW]=r.useState(!1),[ez,eK]=r.useState("0"),[eG,eq]=r.useState("TOKEN"),[eQ,eX]=r.useState("0"),[e$,ej]=r.useState(0n),[eJ,eY]=r.useState(!1),[e0,e1]=r.useState("0"),e6=null!==(en=null===(e=eL.daoContractInfo)||void 0===e?void 0:e.voteRankClaimDurationAdd)&&void 0!==en?en:0,e2=null!==(ea=null===(t=eL.daoContractInfo)||void 0===t?void 0:t.createTime)&&void 0!==ea?ea:0,e3=null!==(ed=null===(D=eL.daoContractInfo)||void 0===D?void 0:D.rewardRoundPass)&&void 0!==ed?ed:0,e8=null!==(ei=null===(N=eL.daoContractInfo)||void 0===N?void 0:N.airdropDurationGetLimit)&&void 0!==ei?ei:0;g.Z.getCurrentRewardRoundTimestamp(e2,e6,e3);let e4=null!==(el=null===(b=eL.daoCurrentRoundInfo)||void 0===b?void 0:b.roundExpire)&&void 0!==el?el:0,e9=null!==(es=null===(S=eL.userInfo)||void 0===S?void 0:S.voteAndAirDropReward.clairReward)&&void 0!==es?es:0n,e7=eP||(null!==(eu=null===(F=eL.userInfo)||void 0===F?void 0:F.voteInfo.roundFirstVotedDate)&&void 0!==eu?eu:0),e5=e4>0?l.Z.convertTimeDifference(new Date(e7+e8-eE.currentTime),{includeDays:!1}):0,te=e9>0n,tt=Math.floor(eE.currentTime/e6)*e6+e6,to=eL.userRewardInfo.voteTopReward.gt(0)?l.Z.convertTimeDifference(new Date(tt-eE.currentTime),{includeDays:!1}):0,tr=eL.userRewardInfo.voteTopReward.gt(0),tn=null!==(ec=null===(P=eL.daoContractInfo)||void 0===P?void 0:P.communityDuration)&&void 0!==ec?ec:0,ta=Math.floor((null!==(ef=null===(U=eL.daoContractInfo)||void 0===U?void 0:U.top3NodeDate)&&void 0!==ef?ef:0)/tn)*tn+(null!==(ew=null===(_=eL.daoContractInfo)||void 0===_?void 0:_.communityDuration)&&void 0!==ew?ew:0);null===(O=eL.daoContractInfo)||void 0===O||O.communityRewardDuration;let td=eL.userRewardInfo.nodeTopReward.gt(0)?l.Z.convertTimeDifference(new Date(ta-eE.currentTime),{includeDays:!1}):0,ti=eL.userRewardInfo.nodeTopReward.gt(0),tl=l.Z.convertTimeDifference(new Date((null!==(ev=null===(B=eL.daoCurrentRoundInfo)||void 0===B?void 0:B.roundExpire)&&void 0!==ev?ev:0)-eE.currentTime),{includeDays:!1}),ts=l.Z.convertTimeDifference(new Date((null!==(eR=null===(x=eL.daoCurrentRoundInfo)||void 0===x?void 0:x.roundExpire)&&void 0!==eR?eR:0)+(null!==(eI=null===(M=eL.daoContractInfo)||void 0===M?void 0:M.loserPoolRewardTimeLimit)&&void 0!==eI?eI:0)-eE.currentTime),{includeDays:!1}),tu=0===tl&&0!==ts&&eL.userRewardInfo.luckyReward.gt(0)&&(null===(V=eL.userInfo)||void 0===V?void 0:V.voteInfo.isLuckyRewardClaimed)===!1,tc=new a.Z((null!==(em=null===(H=eL.daoCurrentRoundInfo)||void 0===H?void 0:H.totalVoteAmount)&&void 0!==em?em:0n).toString()).minus((null!==(eh=null===(W=eL.daoCurrentRoundInfo)||void 0===W?void 0:W.totalEthDone)&&void 0!==eh?eh:0n).toString()),tf=new a.Z((null===(z=eL.userInfo)||void 0===z?void 0:z.voteInfo.isLoserRewardClaimed)?0:e$.toString()),tw=(null===(K=eL.userInfo)||void 0===K?void 0:K.voteInfo.isLoserRewardClaimed)?new a.Z(0):new a.Z((null!==(ep=null===(G=eL.userInfo)||void 0===G?void 0:G.voteInfo.votedAmount)&&void 0!==ep?ep:0n).toString()).minus((null!==(eg=null===(q=eL.userInfo)||void 0===q?void 0:q.voteInfo.ethDone)&&void 0!==eg?eg:0n).toString()).div(tc.isZero()?"1":tc.toFixed(0)).multipliedBy((null!==(eA=null===(Q=eL.daoCurrentRoundInfo)||void 0===Q?void 0:Q.pool.loserPoolETH)&&void 0!==eA?eA:0n).toString()),tv=l.Z.convertTimeDifference(new Date((null!==(eC=null===(X=eL.daoCurrentRoundInfo)||void 0===X?void 0:X.roundExpire)&&void 0!==eC?eC:0)-eE.currentTime),{includeDays:!1}),tR=l.Z.convertTimeDifference(new Date((null!==(ey=null===($=eL.daoCurrentRoundInfo)||void 0===$?void 0:$.roundExpire)&&void 0!==ey?ey:0)+(null!==(eD=null===(j=eL.daoContractInfo)||void 0===j?void 0:j.loserPoolRewardTimeLimit)&&void 0!==eD?eD:0)-eE.currentTime),{includeDays:!1}),tI=0===tv&&0!==tR&&(tf.gt(0)||tw.gt(0)),tm=R.Q.getTargetNet().chainId,th=(0,k.Cv)(null===(J=eL.nodeListFilters.selectedDao)||void 0===J?void 0:J.address,tm),tp=[{title:ek("DAOReward"),reward:u.Z.wei2eth(e9),hasDetails:!0,countdown:0===e5?"":e5.toFormated(),claimable:te,handleClaim:tC},{title:ek("VoteTopReward"),reward:eL.userRewardInfo.voteTopReward.toString(),hasDetails:!1,countdown:0===to?"":to.toFormated(),claimable:tr,handleClaim:ty},{title:ek("NodeTopReward"),reward:eL.userRewardInfo.nodeTopReward.toString(),hasDetails:!1,countdown:0===td?"":td.toFormated(),claimable:ti,handleClaim:tD},{title:ek("LuckyReward"),reward:eL.userRewardInfo.luckyReward.toString(),hasDetails:!1,countdown:(null===(Y=eL.userInfo)||void 0===Y?void 0:Y.voteInfo.isLuckyRewardClaimed)?"":0!==tl?tl.toFormated():0!==ts?ts.toFormated():"",claimable:tu,handleClaim:tT},{title:ek("OtherReward"),tokenReward:tf.gt(0)?u.Z.wei2eth(tf.toFixed(0,a.Z.ROUND_DOWN)):"0",hasDetails:!1,countdown:(null===(ee=eL.userInfo)||void 0===ee?void 0:ee.voteInfo.isLoserRewardClaimed)?"":0!==tv?tv.toFormated():0!==tR?tR.toFormated():"",claimable:tI,handleClaim:tZ}],tg=th?[...tp,{title:ek("AIReward"),tokenReward:"".concat(ez," ").concat(eG," (≈").concat(d.Z.toFixed(Number(eQ),4)," ETH)"),hasDetails:!1,countdown:(null===(et=eL.userInfo)||void 0===et?void 0:et.voteInfo.isLoserRewardClaimed)?"":0!==tv?tv.toFormated():0!==tR?tR.toFormated():"",claimable:new a.Z(ez).gt(0)&&0===tv&&0!==tR,handleClaim:tk}]:tp;async function tA(e){try{let t=eN.ethInfo.walletAddress;if(!t)return;let o=R.Q.getDefaultProvider(),r=w.bR.connect(e,o),n=await r.getLoserRewardTokenValue(t);ej(n)}catch(e){ej(0n),v.Z.E("Error fetching loser token reward:",e)}}async function tC(){var e,t,o,r,n,d,i,l,s,R;let I=null===(e=eL.nodeListFilters.selectedDao)||void 0===e?void 0:e.address;if(!I){(0,c.L6)(ek("NoSelectedDao"));return}if(!te)return;let h=f.r.getInstance(),p=u.Z.getInstance(h.getProvider()),g=w.bR.connect(I,await p.getSigner());try{let e=null===(t=eL.daoContractInfo)||void 0===t?void 0:t.currentRoundNO;if(!e){let t=await g.currentRoundNO();e=Number(t)}let n=await g.pools(e),d=n.airdropPool;if(e9>d){try{let e=null!==(r=null===(o=eL.daoContractInfo)||void 0===o?void 0:o.firstLuckyRewardRate)&&void 0!==r?r:0,t=new a.Z(u.Z.wei2eth(n.luckyPoolBalance)).multipliedBy(e).toFixed(1);e1(t)}catch(e){e1("0")}eY(!0);return}}catch(e){try{let e=null!==(d=null===(n=eL.daoCurrentRoundInfo)||void 0===n?void 0:n.pool.airdropPool)&&void 0!==d?d:0n;if(e9>e){try{let e=null!==(s=null===(i=eL.daoContractInfo)||void 0===i?void 0:i.firstLuckyRewardRate)&&void 0!==s?s:0,t=new a.Z(u.Z.wei2eth(null!==(R=null===(l=eL.daoCurrentRoundInfo)||void 0===l?void 0:l.pool.luckyPool)&&void 0!==R?R:0n)).multipliedBy(e).toFixed(1);e1(t)}catch(e){e1("0")}eY(!0);return}}catch(e){}}try{let e=await g.claimVoteAndAirDropReward();await e.wait(),(0,c.x9)(ek("ClaimVoteAndAirDropRewardSuccess"));let t=Date.now();eU(t),eV(!0),eL.userInfo&&eZ(m.Z.slice.actions.updateUserInfo({...eL.userInfo,voteAndAirDropReward:{...eL.userInfo.voteAndAirDropReward,clairReward:0n}})),await tE(),setTimeout(()=>{eV(!1)},5e3)}catch(e){(0,c.L6)(new c.HU(e,ek("ClaimVoteAndAirDropRewardFailed")).asToastMessage()),v.Z.E(e)}}async function ty(){var e,t;if(!(null===(e=eL.nodeListFilters.selectedDao)||void 0===e?void 0:e.address)){(0,c.L6)(ek("NoSelectedDao"));return}eZ(m.Z.slice.actions.updateUserRewardInfo({...eL.userRewardInfo,voteTopReward:new a.Z(0)}));let o=f.r.getInstance(),r=u.Z.getInstance(o.getProvider()),n=w.bR.connect(null===(t=eL.nodeListFilters.selectedDao)||void 0===t?void 0:t.address,await r.getSigner());try{let e=await n.claimTop3VotedReward();await e.wait(),(0,c.x9)(ek("ClaimNodeTopRewardSuccess")),await tE()}catch(e){eZ(m.Z.slice.actions.updateUserRewardInfo({...eL.userRewardInfo,voteTopReward:eL.userRewardInfo.voteTopReward})),(0,c.L6)(new c.HU(e,ek("ClaimNodeTopRewardFailed")).asToastMessage()),v.Z.E(e)}}async function tD(){var e,t;if(!(null===(e=eL.nodeListFilters.selectedDao)||void 0===e?void 0:e.address))return(0,c.L6)(ek("NoSelectedDao"));eZ(m.Z.slice.actions.updateUserRewardInfo({...eL.userRewardInfo,nodeTopReward:new a.Z(0)}));let o=f.r.getInstance(),r=u.Z.getInstance(o.getProvider()),n=w.bR.connect(null===(t=eL.nodeListFilters.selectedDao)||void 0===t?void 0:t.address,await r.getSigner());try{let e=await n.claimTop3NodeReward();await e.wait(),(0,c.x9)(ek("ClaimNodeTopRewardSuccess")),await tE()}catch(e){eZ(m.Z.slice.actions.updateUserRewardInfo({...eL.userRewardInfo,nodeTopReward:eL.userRewardInfo.nodeTopReward})),(0,c.L6)(new c.HU(e,ek("ClaimNodeTopRewardFailed")).asToastMessage()),v.Z.E(e)}}async function tT(){var e,t;if(!(null===(e=eL.nodeListFilters.selectedDao)||void 0===e?void 0:e.address))return(0,c.L6)(ek("NoSelectedDao"));eL.userInfo&&eZ(m.Z.slice.actions.updateUserInfo({...eL.userInfo,voteInfo:{...eL.userInfo.voteInfo,isLuckyRewardClaimed:!0}}));let o=f.r.getInstance(),r=u.Z.getInstance(o.getProvider()),n=w.bR.connect(null===(t=eL.nodeListFilters.selectedDao)||void 0===t?void 0:t.address,await r.getSigner());try{let e=await n.claimLuckyReward();await e.wait(),(0,c.x9)(ek("ClaimLuckyRewardSuccess")),await tE()}catch(e){eL.userInfo&&eZ(m.Z.slice.actions.updateUserInfo({...eL.userInfo,voteInfo:{...eL.userInfo.voteInfo,isLuckyRewardClaimed:!1}})),(0,c.L6)(new c.HU(e,ek("ClaimLuckyRewardFailed")).asToastMessage()),v.Z.E(e)}}async function tZ(){var e,t;if(!(null===(e=eL.nodeListFilters.selectedDao)||void 0===e?void 0:e.address))return(0,c.L6)(ek("NoSelectedDao"));eL.userInfo&&eZ(m.Z.slice.actions.updateUserInfo({...eL.userInfo,voteInfo:{...eL.userInfo.voteInfo,isLoserRewardClaimed:!0}}));let o=f.r.getInstance(),r=u.Z.getInstance(o.getProvider()),n=w.bR.connect(null===(t=eL.nodeListFilters.selectedDao)||void 0===t?void 0:t.address,await r.getSigner());try{let e=await n.claimLoserReward();await e.wait(),(0,c.x9)(ek("ClaimOtherRewardSuccess")),await tE()}catch(e){eL.userInfo&&eZ(m.Z.slice.actions.updateUserInfo({...eL.userInfo,voteInfo:{...eL.userInfo.voteInfo,isLoserRewardClaimed:!1}})),(0,c.L6)(new c.HU(e,ek("ClaimOtherRewardFailed")).asToastMessage()),v.Z.E(e)}}async function tk(){let e=R.Q.getTargetNet().chainId,t=(0,k.yO)(e);if(!t){(0,c.L6)(ek("NoAiDaoAddress"));return}let o=f.r.getInstance(),r=u.Z.getInstance(o.getProvider()),n=w.fj.connect(t,await r.getSigner());try{let e=await n.claimLoserReward();await e.wait(),(0,c.x9)(ek("ClaimAIRewardSuccess")),eK("0"),eq("TOKEN"),eX("0"),await tE()}catch(e){(0,c.L6)(new c.HU(e,ek("ClaimAIRewardFailed")).asToastMessage()),v.Z.E(e)}}async function tE(){var e;let t=null===(e=eL.nodeListFilters.selectedDao)||void 0===e?void 0:e.address;if(t)try{ex(!0),eW(!0),eZ(Z.Z.slice.actions.updateTime(Date.now())),await new Promise(e=>setTimeout(e,2e3)),await Promise.all([eb.updateInfo(),eF.updateRankSimpleInfo(t),tL(t),tb(t)]),await t_(t),eT.handleAfterClaim&&await eT.handleAfterClaim()}catch(e){v.Z.E("Error in handleAfterClaim:",e)}finally{ex(!1),eW(!1)}}async function tL(e){var t;let o=Date.now();if(!eH&&o-e_<6e4||eB)return;let r=new g.Z;if(!(e=null!=e?e:null===(t=eL.nodeListFilters.selectedDao)||void 0===t?void 0:t.address)){(0,c.L6)(ek("NoSelectedDao"));return}try{ex(!0);let t=await r.getUserVoteNodeRankReward({userAddress:eN.ethInfo.walletAddress,daoAddress:e});eZ(m.Z.slice.actions.updateUserRewardInfo({luckyReward:new a.Z(u.Z.wei2eth(t.luckyReward.reward)),voteTopReward:new a.Z(u.Z.wei2eth(t.voteTopReward.reward)),nodeTopReward:new a.Z(u.Z.wei2eth(t.nodeTopReward.reward))})),eO(o)}catch(e){(0,c.L6)(new c.HU(e,ek("GetUserVoteNodeRankRewardFailed")).asToastMessage()),v.Z.E(e)}finally{ex(!1)}}let tN=r.useCallback(T()(e=>{var t;if(null===(t=eL.daoContractInfo)||void 0===t?void 0:t.daoAddress)return tL(eL.daoContractInfo.daoAddress)},800),[eL.daoContractInfo,eN.ethInfo.walletAddress]);async function tb(e){if(eM)return;let t=new g.Z,o=new p.q$p(t.buildConfigure()),r=await o.getLastClaimTime({daoAddress:e}),n=new A.zv(r);if(n.hasError()){let e=n.getError();(0,c.L6)(new c.HU(e,ek("GetLastClaimTimeFailed")).asToastMessage()),v.Z.E(e);return}let a=d.Z.Time.fromTimestamp(n.getData());eM||a.toJSTime()===eP||eU(a.toJSTime())}function tS(e,t){let o=Number("120");return new a.Z(u.Z.wei2eth(e)).multipliedBy(o).div(100).minus(u.Z.wei2eth(t))}r.useEffect(()=>{if(!eS||!eL.daoContractInfo||!eN.ethInfo.walletAddress)return;let e=l.Z.sleepForAnimationFrame(300);e.wait(()=>{var e;tN(),(null===(e=eL.nodeListFilters.selectedDao)||void 0===e?void 0:e.address)&&(tU(eL.nodeListFilters.selectedDao.address),tA(eL.nodeListFilters.selectedDao.address))});let t=setInterval(()=>{"visible"===document.visibilityState&&tN()},6e4);return()=>{e.cancel(y.Z.ReactError.useEffectDestroy()),clearInterval(t)}},[eL.daoContractInfo,eN.ethInfo.walletAddress,eS,tN]);let tF=r.useCallback(T()(e=>{tb(e)},500),[]);async function tP(){var e;let t=null===(e=eL.nodeListFilters.selectedDao)||void 0===e?void 0:e.address;if(t&&eN.ethInfo.walletAddress)try{ex(!0),eW(!0),await Promise.all([eb.updateInfo(),eF.updateRankSimpleInfo(t),tL(t),tb(t),tU(t),tA(t)]),await t_(t),eO(Date.now()),eW(!1)}catch(e){v.Z.E("Error in refreshAllData:",e)}finally{ex(!1)}}async function tU(e){try{let t=R.Q.getTargetNet().chainId;if(!(0,k.Cv)(e,t)){eK("0"),eq("TOKEN"),eX("0");return}let r=(0,k.OM)(t),n=(0,k.yO)(t);if(!n||!r){eK("0"),eq("TOKEN"),eX("0");return}let d=f.r.getInstance(),i=u.Z.getInstance(d.getProvider()),l=eN.ethInfo.walletAddress;if(!l)return;let s=w.fj.connect(n,await i.getSigner()),c=await s.getLoserReward(l),I=u.Z.wei2eth(c);eK(I);let m=r.rewardTokenAddress;if(v.Z.L("rewardTokenAddress",m),m&&"0"!==m&&Number(I)>0){v.Z.L("rewardTokenAddress",2);try{v.Z.L("rewardTokenAddress",3);let e=await (0,E.co)(m);v.Z.L("priceInfo",e);let{TrinityTokenAbi:t}=await Promise.resolve().then(o.bind(o,13167)),r=new L.CH(m,t,await i.getSigner()),n=await r.symbol(),d=new a.Z(I).multipliedBy(e.sellPriceETH).toString();eq(n),eX(d)}catch(e){v.Z.L("rewardTokenAddress",4),v.Z.E("Error fetching AI reward token price:",e),eq("TOKEN"),eX("0")}}else eq("TOKEN"),eX("0")}catch(e){eK("0"),eq("TOKEN"),eX("0"),v.Z.E("Error fetching AI reward:",e)}}async function t_(e){try{let t=f.r.getInstance(),o=u.Z.getInstance(t.getProvider()),r=w.bR.connect(e,await o.getSigner()),n=eN.ethInfo.walletAddress;if(!n)return;let a=await r.getVoteAndAirDropReward(n);if(eL.userInfo){let e={...eL.userInfo,voteAndAirDropReward:{...eL.userInfo.voteAndAirDropReward,clairReward:a.clairReward,airdropReward:a.airdropReward,nodeReward:a.nodeReward,airdropLinkReward:a.airdropLinkReward,reinvestReward:a.reinvestReward}};eZ(m.Z.slice.actions.updateUserInfo(e))}}catch(e){v.Z.E("Error checking reward claim status:",e)}}return r.useEffect(()=>{var e;if((null===(e=eL.nodeListFilters.selectedDao)||void 0===e?void 0:e.address)&&eE.token)return tF(eL.nodeListFilters.selectedDao.address),()=>{tF.cancel()}},[null===(eo=eL.nodeListFilters.selectedDao)||void 0===eo?void 0:eo.address,eE.token,tF]),r.useEffect(()=>{eH&&eS&&tP()},[eH,eS]),{rewardItems:tg,handleVoteAirdropClaim:tC,handleVoteRankClaim:ty,handleNodeRankClaim:tD,handleLuckyClaim:tT,handleOtherClaim:tZ,handleAiRewardClaim:tk,estimatePendingReward:tS,estimateUserPendingReward:function(){try{var e,t,o,r;let n=tS(null!==(o=null===(e=eL.userInfo)||void 0===e?void 0:e.voteInfo.votedAmount)&&void 0!==o?o:0n,null!==(r=null===(t=eL.userInfo)||void 0===t?void 0:t.voteInfo.ethDone)&&void 0!==r?r:0n);if(!n||n.isNaN())return new a.Z(0);return n}catch(e){return v.Z.W("Error calculating pending reward:",e),new a.Z(0)}},getClaimNodeRewardCountdown:function(){if(!eL.daoContractInfo)return"";let e=Math.floor(eE.currentTime/1e3),t=86400*Math.floor(Math.floor(e2/1e3)/86400),o=t+604800*Math.floor((e-t)/604800)+604800-e;if(o<=0)return"00:00:00";let r=Math.floor(o/3600).toString().padStart(2,"0"),n=Math.floor(o%3600/60).toString().padStart(2,"0"),a=Math.floor(o%60).toString().padStart(2,"0");return"".concat(r,":").concat(n,":").concat(a)},refreshAllData:tP,isUpdating:eB,ui:{airdropInsufficientOpen:eJ,setAirdropInsufficientOpen:eY,airdropFirstPrizeAmount:e0}}}},88952:function(e,t,o){o.d(t,{co:function(){return I}});var r=o(12249),n=o(3682),a=o(94552),d=o(59868),i=o(41662),l=o(90135),s=o(90005),u=o(96727),c=o(45532),f=o(45556),w=o(10433);class v{async getPairReserves(e){let t,o;let r=await this.getPairAddress(e);if(r===a.N)throw Error("Pair does not exist");let n=new d.CH(r,c._,this.provider);try{let e=await this.provider.getCode(r);if("0x"===e)throw Error("Pair contract does not exist: ".concat(r));let a=await Promise.all([n.token0(),n.token1(),n.getReserves()]);t=a[0],a[1],o=a[2]}catch(e){throw w.Z.E("❌ 获取交易对储备失败:",e),e}let[i,l]=o,s=t.toLowerCase()===this.wethAddress.toLowerCase();return{ethReserve:s?i:l,tokenReserve:s?l:i,pairAddress:r}}async getPairAddress(e){let t=new d.CH(this.tokenSwapAddress,f.R,this.provider);try{let o=await this.provider.getCode(this.tokenSwapAddress);if("0x"===o)return w.Z.E("❌ TokenSwap合约不存在: ".concat(this.tokenSwapAddress)),a.N;let r=await t.trinityswapV2Factory(),n=await this.provider.getCode(r);if("0x"===n)return w.Z.E("❌ Factory合约不存在: ".concat(r)),a.N;try{let t=new d.CH(r,["function getPair(address tokenA, address tokenB) external view returns (address pair)"],this.provider),o=await t.getPair(e,this.wethAddress);if(o!==a.N){let e=await this.provider.getCode(o);if("0x"!==e)return o}}catch(e){}return await this.computePairAddress(r,e,this.wethAddress)}catch(e){return w.Z.E("❌ 获取交易对地址失败:",e),a.N}}async getRealtimePrice(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"1";try{let{ethReserve:o,tokenReserve:r}=await this.getPairReserves(e),n=i.fi(t),a=this.getAmountOut(n,o,r,997n),d=Number(i.dF(a)),l=i.fi("1"),s=this.getAmountOut(l,r,o,997n),u=Number(i.dF(s)),c=Number(o)/Number(r)*1e18,f=Number(i.dF(BigInt(Math.floor(c))));return{buyPriceETH:d,sellPriceETH:u,midPriceETH:f,slippage:f>0?Math.abs(1/d-u)/f*100:0}}catch(e){throw w.Z.E("❌ 计算价格时发生错误:",e),e}}getAmountOut(e,t,o){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:997n;if(0n===e||0n===t||0n===o)return 0n;let n=e*r;return n*o/(1000n*t+n)}async computePairAddress(e,t,o){let[r,n]=t.toLowerCase()<o.toLowerCase()?[t,o]:[o,t],a=l.w(s.VT(["address","address"],[r,n]));for(let t of["0x96e8ac4277198ff8b6f785478aa9a39f403cb768dd02cbee326c3e7da348845f","0xd0d4c4cd0848c93cb4fd1f498d7013ee6bfb25783ea21593d5834f5d250ece66","0x00fb7f630766e6a796048ea87d01acd3068e8ff67d078148a3fa3f4a84f69bd5","0xe18a34eb0e04b04f7a0ac29a6e80748dca96319b42c54d679cb821dca90c6303"]){let o=u.h(e,a,t),r=await this.provider.getCode(o);if("0x"!==r&&r.length>2)return o}return u.h(e,a,"0x96e8ac4277198ff8b6f785478aa9a39f403cb768dd02cbee326c3e7da348845f")}constructor(){if((0,r._)(this,"provider",void 0),(0,r._)(this,"wethAddress",void 0),(0,r._)(this,"tokenSwapAddress",void 0),this.provider=n.Q.getDefaultProvider(),this.wethAddress="0x4200000000000000000000000000000000000006",this.tokenSwapAddress="0x4Cd906AEF43aB89BB5714391B024b3C49bC76617",!this.wethAddress||!this.tokenSwapAddress)throw Error("Missing required environment variables")}}let R=new v;async function I(e){return R.getRealtimePrice(e)}}}]);