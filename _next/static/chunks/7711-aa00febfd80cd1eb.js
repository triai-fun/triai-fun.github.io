"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7711],{59365:function(e,t,n){n.d(t,{Z:function(){return a}});var o=n(57437);function a(e){var t,n;return(0,o.jsx)("img",{src:"/images/icon-eth.svg",width:null!==(t=e.width)&&void 0!==t?t:20,height:null!==(n=e.height)&&void 0!==n?n:20,alt:"ETH",className:e.className})}},40066:function(e,t,n){n.d(t,{Z:function(){return a}});var o=n(57437);function a(e){var t,n;let a=null!==(t=e.defsPrexId)&&void 0!==t?t:"paint0";return(0,o.jsxs)("svg",{viewBox:"0 0 12 15",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:null!==(n=e.className)&&void 0!==n?n:"",children:[(0,o.jsx)("path",{d:"M3.99681 6.00318H1.99045V3.66242C1.99045 3.15287 2.0913 2.67781 2.29299 2.23726C2.49469 1.79671 2.77335 1.40924 3.12898 1.07484C3.48461 0.740446 3.90393 0.477707 4.38694 0.286624C4.86996 0.0955414 5.39809 -1.03773e-08 5.97134 0C6.48089 0 6.97187 0.0955414 7.44427 0.286624C7.91667 0.477707 8.33599 0.740446 8.70223 1.07484C9.06847 1.40924 9.3604 1.79671 9.57802 2.23726C9.79565 2.67781 9.90446 3.15287 9.90446 3.66242V6.00318H7.97771V4.10828C7.97771 3.43949 7.79193 2.92197 7.42038 2.55573C7.04883 2.18949 6.54459 2.00637 5.90764 2.00637C5.33439 2.00637 4.87261 2.18949 4.52229 2.55573C4.17197 2.92197 3.99681 3.43949 3.99681 4.10828V6.00318ZM10.8599 6.9586C11.1465 6.9586 11.3933 7.0621 11.6003 7.26911C11.8073 7.47611 11.9108 7.72293 11.9108 8.00955V12.9459C11.9108 13.2325 11.8604 13.5005 11.7596 13.75C11.6587 13.9995 11.5207 14.2171 11.3455 14.4029C11.1704 14.5886 10.9634 14.7346 10.7245 14.8408C10.4857 14.9469 10.2229 15 9.93631 15H1.8949C1.60828 15 1.3482 14.9469 1.11465 14.8408C0.881104 14.7346 0.682059 14.5939 0.517516 14.4188C0.352972 14.2436 0.225584 14.0393 0.13535 13.8057C0.0451166 13.5722 0 13.3227 0 13.0573V8.00955C0 7.72293 0.100849 7.47611 0.302548 7.26911C0.504246 7.0621 0.748407 6.9586 1.03503 6.9586H1.99045H3.99681H7.97771H9.90446H10.8599Z",fill:"url(#".concat(a,"_linear_20_507)")}),(0,o.jsx)("defs",{children:(0,o.jsxs)("linearGradient",{id:"".concat(a,"_linear_20_507"),x1:"-0.000176537",y1:"7.49995",x2:"11.9108",y2:"7.49995",gradientUnits:"userSpaceOnUse",children:[(0,o.jsx)("stop",{stopColor:"#E700E6"}),(0,o.jsx)("stop",{offset:"1",stopColor:"#4B4BDF"})]})})]})}},30681:function(e,t,n){n.d(t,{Cv:function(){return d},OM:function(){return i},yO:function(){return l}});var o=n(40257);let a=(e,t)=>{var n;return null!==(n=o.env[e])&&void 0!==n?n:t},r={baseSepolia:{aiDaoAddress:a("NEXT_PUBLIC_AIDAO_BASE_SEPOLIA_ADDRESS","0"),targetDaoAddress:a("NEXT_PUBLIC_AIDAO_BASE_SEPOLIA_TARGET_DAO","0"),rewardTokenAddress:a("NEXT_PUBLIC_AIDAO_BASE_SEPOLIA_REWARD_TOKEN","0")},baseMainnet:{aiDaoAddress:a("NEXT_PUBLIC_AIDAO_BASE_MAINNET_ADDRESS","0x79Baf19C82C88C63b4b827Ba5d37F9d0A05e65D5"),targetDaoAddress:a("NEXT_PUBLIC_AIDAO_BASE_MAINNET_TARGET_DAO","0x1A714D76F14B9e7C894B5580cE92316021863341"),rewardTokenAddress:a("NEXT_PUBLIC_AIDAO_BASE_MAINNET_REWARD_TOKEN","0xbff9E7a186ACF2C3f939a9C3Bcf5a38d86E7dbdF")}};function i(e){switch(e){case 84532:return r.baseSepolia;case 8453:return r.baseMainnet;default:return}}function d(e,t){if(!e)return!1;let n=i(t);return!!n&&n.targetDaoAddress.toLowerCase()===e.toLowerCase()}function l(e){let t=i(e);return null==t?void 0:t.aiDaoAddress}},45532:function(e,t,n){n.d(t,{_:function(){return o}});let o=[{inputs:[],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!0,internalType:"address",name:"spender",type:"address"},{indexed:!1,internalType:"uint256",name:"value",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"sender",type:"address"},{indexed:!1,internalType:"uint256",name:"amount0",type:"uint256"},{indexed:!1,internalType:"uint256",name:"amount1",type:"uint256"},{indexed:!0,internalType:"address",name:"to",type:"address"}],name:"Burn",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"sender",type:"address"},{indexed:!1,internalType:"uint256",name:"amount0",type:"uint256"},{indexed:!1,internalType:"uint256",name:"amount1",type:"uint256"}],name:"Mint",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"sender",type:"address"},{indexed:!1,internalType:"uint256",name:"amount0In",type:"uint256"},{indexed:!1,internalType:"uint256",name:"amount1In",type:"uint256"},{indexed:!1,internalType:"uint256",name:"amount0Out",type:"uint256"},{indexed:!1,internalType:"uint256",name:"amount1Out",type:"uint256"},{indexed:!0,internalType:"address",name:"to",type:"address"}],name:"Swap",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint112",name:"reserve0",type:"uint112"},{indexed:!1,internalType:"uint112",name:"reserve1",type:"uint112"}],name:"Sync",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"from",type:"address"},{indexed:!0,internalType:"address",name:"to",type:"address"},{indexed:!1,internalType:"uint256",name:"value",type:"uint256"}],name:"Transfer",type:"event"},{inputs:[],name:"DOMAIN_SEPARATOR",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"MINIMUM_LIQUIDITY",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"PERMIT_TYPEHASH",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"},{internalType:"address",name:"",type:"address"}],name:"allowance",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"value",type:"uint256"}],name:"approve",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"balanceOf",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"to",type:"address"}],name:"burn",outputs:[{internalType:"uint256",name:"amount0",type:"uint256"},{internalType:"uint256",name:"amount1",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"decimals",outputs:[{internalType:"uint8",name:"",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[],name:"factory",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"getReserves",outputs:[{internalType:"uint112",name:"_reserve0",type:"uint112"},{internalType:"uint112",name:"_reserve1",type:"uint112"},{internalType:"uint32",name:"_blockTimestampLast",type:"uint32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_token0",type:"address"},{internalType:"address",name:"_token1",type:"address"},{internalType:"address",name:"_WETH",type:"address"},{internalType:"uint256",name:"_burnRate",type:"uint256"},{internalType:"address",name:"_router",type:"address"}],name:"initialize",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"kLast",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"to",type:"address"}],name:"mint",outputs:[{internalType:"uint256",name:"liquidity",type:"uint256"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"name",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"nonces",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"address",name:"spender",type:"address"},{internalType:"uint256",name:"value",type:"uint256"},{internalType:"uint256",name:"deadline",type:"uint256"},{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],name:"permit",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"price0CumulativeLast",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"price1CumulativeLast",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"router",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"to",type:"address"}],name:"skim",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"amount0Out",type:"uint256"},{internalType:"uint256",name:"amount1Out",type:"uint256"},{internalType:"address",name:"to",type:"address"},{internalType:"bytes",name:"data",type:"bytes"}],name:"swap",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"symbol",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"sync",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"token0",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"token1",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"totalSupply",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"value",type:"uint256"}],name:"transfer",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"address",name:"to",type:"address"},{internalType:"uint256",name:"value",type:"uint256"}],name:"transferFrom",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"nonpayable",type:"function"}]},89522:function(e,t,n){n.d(t,{Z:function(){return u}});var o=n(12249),a=n(5853),r=n(68031),i=n(59201),d=n(8113),l=n(344),s=n(63671);class u extends s.bQ{async loginWallet(e){var t;let n=new i.M,o=new l.M2y(this.buildConfigure(n)),a=new r.zv(await o.loginByWallet({walletLoginRequestVO:{walletAddress:e.walletAddress,signature:e.signature,timestamp:e.timestamp.toString()}},{signal:null===(t=e.abortController)||void 0===t?void 0:t.signal}));return a.hasError()||n.afterHandler(a.response,{url:"/login",data:e}),a}async getUserInfo(e){var t;let n=new Headers;e.Authorization&&n.set("Authorization",e.Authorization),delete e.Authorization;let o=new l.M2y(this.buildConfigure());return new r.zv(await o.getUserInfo({signal:null===(t=e.abortController)||void 0===t?void 0:t.signal,headers:n}))}async uploadFile(e){var t;let n=new FormData;n.append("file",e.file);let o=new l.M2y(this.buildConfigure()),a=await o.upload({file:e.file},{signal:null===(t=e.abortController)||void 0===t?void 0:t.signal,body:n});return new r.zv(a)}async addNFTInfo(e){var t;e.Authorization,delete e.Authorization;let n=new l.lG6(this.buildConfigure());return new r.zv(await n.uploadHash({uploadHashRequestVO:e},{signal:null===(t=e.abortController)||void 0===t?void 0:t.signal}))}constructor(e=new i.Z){super(),(0,o._)(this,"httpRequest",void 0),this.httpRequest=e}}u=(0,a.gn)([d.ZP.Singleton,(0,a.w6)("design:type",Function),(0,a.w6)("design:paramtypes",["undefined"==typeof HttpRequest?Object:HttpRequest])],u)},50544:function(e,t,n){n.d(t,{Z:function(){return v}});var o=n(2265),a=n(89769),r=n(43949),i=n(6178),d=n(21707),l=n(40366),s=n(3682),u=n(10433),c=n(95665),p=n(81939);function v(){var e,t,n,v,f,w,y,m,I,R,g,T,h,C,A,b,N,D,E,k;let Z=(0,i.T)(),{t:L,i18n:S}=(0,r.$G)(["dao"]),M=(0,i.C)(e=>e.dao),F="/images/dao/",P=new Map([[a.r.NodeType.NONE,{color1:"#000",color2:"#fff",title:L("notNode.title"),description:L("notNode.description"),image:"".concat(F,"not-node.png"),upgradeInfo:{userNodeCount:0n,requiredNodeCount:0n,ethPrice:0n}}],[a.r.NodeType.CANDIDATE,{color1:"#E700E6",color2:"#4B4BDF",title:L("candidateNode.title"),description:L("candidateNode.description",{title:L("candidateNode.title").toLocaleLowerCase(),token:M.tokenInfo.symbol,value:p.Z.wei2eth(null!==(g=null===(e=M.daoContractInfo)||void 0===e?void 0:e.applyCandidateEthAmount)&&void 0!==g?g:0n)}),image:"".concat(F,"candidate-node.png"),upgradeInfo:{userNodeCount:0n,requiredNodeCount:0n,ethPrice:null!==(T=null===(t=M.daoContractInfo)||void 0===t?void 0:t.applyCandidateEthAmount)&&void 0!==T?T:0n}}],[a.r.NodeType.MASTER,{color1:"#EA7D01",color2:"#B06D00",title:L("mainNode.title"),description:L("mainNode.description",{prevTitle:L("candidateNode.title").toLocaleLowerCase(),title:L("mainNode.title").toLocaleLowerCase(),nodeCount:String(null!==(h=null===(n=M.daoContractInfo)||void 0===n?void 0:n.votesForMaster)&&void 0!==h?h:0n)}),image:"".concat(F,"main-node.png"),upgradeInfo:{userNodeCount:null!==(C=null===(v=M.userInfo)||void 0===v?void 0:v.userInfo.sonCount)&&void 0!==C?C:0n,requiredNodeCount:null!==(A=null===(f=M.daoContractInfo)||void 0===f?void 0:f.votesForMaster)&&void 0!==A?A:0n,ethPrice:0n}}],[a.r.NodeType.SUPER,{color1:"#00E7D4",color2:"#4B4BDF",title:L("superNode.title"),description:L("superNode.description",{prevTitle:L("mainNode.title").toLocaleLowerCase(),title:L("superNode.title").toLocaleLowerCase(),token:M.tokenInfo.symbol,value:p.Z.wei2eth(null!==(b=null===(w=M.daoContractInfo)||void 0===w?void 0:w.applySuperEthAmount)&&void 0!==b?b:0n),nodeCount:String(null!==(N=null===(y=M.daoContractInfo)||void 0===y?void 0:y.masterForSuper)&&void 0!==N?N:0n)}),image:"".concat(F,"super-node.png"),upgradeInfo:{userNodeCount:null!==(D=null===(m=M.userInfo)||void 0===m?void 0:m.userInfo.sonMasterNodeCount)&&void 0!==D?D:0n,requiredNodeCount:null!==(E=null===(I=M.daoContractInfo)||void 0===I?void 0:I.masterForSuper)&&void 0!==E?E:0n,ethPrice:null!==(k=null===(R=M.daoContractInfo)||void 0===R?void 0:R.applySuperEthAmount)&&void 0!==k?k:0n}}]]),x=Array.from(P.entries()),_=new Map;x.forEach((e,t)=>{let n=e[0],o=x[t+1];_.set(n,{nextKey:o?Number(o[0]):void 0,nextValue:o?o[1]:void 0})});let O=new Map(M.nodesCurrentRoundInfo.map(e=>["".concat(e.daoAddress,",").concat(e.nodeAddress),e])),U=o.useCallback(async(e,t)=>{if(0===e.length)return[];let n=new d.C(t.daoAddress,l.K),o=e.map(e=>n.promotions(t.currentRoundNO,e)),a=s.Q.getDefaultProvider(),r=new d.z(s.Q.getTargetNet().chainId,a),i=await r.all(o),c=e.map((e,n)=>({nodeAddress:e,daoAddress:t.daoAddress,promotionInfo:i[n]}));return u.Z.I("getNodeCurrentRoundSimpleInfo",c),c},[]),B=o.useCallback(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;if(!(t=null!=t?t:M.daoContractInfo)){u.Z.I("updateNodeCurrentRoundInfoSimpleInfo skipped: daoAddress/currentRoundNO not ready");return}let n=await U([e,M.nodes.data.map(e=>e.walletAddress)].flat(),t);Z(c.Z.slice.actions.updateNodesCurrentRoundInfo(n))},[Z,M.daoContractInfo,M.nodes.data,U]),H=o.useCallback(async(e,t)=>{var n;let o=null!=t?t:null===(n=M.daoContractInfo)||void 0===n?void 0:n.daoAddress;if(!o)throw Error("daoAddress can't be empty");try{let t=new d.C(o,l.K),n=s.Q.getDefaultProvider(),a=new d.z(s.Q.getTargetNet().chainId,n),r=t.users(e),i=await a.all([r]),c=Number(i[0].nodeType);return u.Z.I("getNodeTypeByAddress",{nodeAddress:e,nodeType:c}),c}catch(e){return u.Z.E("getNodeTypeByAddress error",e),a.r.NodeType.NONE}},[M.daoContractInfo]);return o.useEffect(()=>{P.set(a.r.NodeType.MASTER,{...P.get(a.r.NodeType.MASTER),title:L("mainNode.title")}),P.set(a.r.NodeType.SUPER,{...P.get(a.r.NodeType.SUPER),title:L("superNode.title")})},[S.language]),{nodeMap:P,nodeToNextMap:_,getNodeCurrentRoundSimpleInfo:U,updateNodeCurrentRoundInfoSimpleInfo:B,nodeCurrentRoundSimpleInfoMap:O,getNodeTypeByAddress:H}}},88263:function(e,t,n){n.d(t,{Z:function(){return Z}});var o=n(2265),a=n(72917),r=n(68651),i=n(43009),d=n(6178),l=n(74439),s=n(43949),u=n(81939),c=n(83123),p=n(13965),v=n(70042),f=n(10433),w=n(3682),y=n(21707),m=n(95665),I=n(89769),R=n(344),g=n(22928),T=n(68031),h=n(89522),C=n(20605),A=n(64798),b=n.n(A),N=n(35178),D=n(30681),E=n(88952),k=n(59868);function Z(){var e,t,A,Z,L,S,M,F,P,x,_,O,U,B,H,V,W,z,q,K,G,Q,j,X,$,Y,J,ee,et,en,eo,ea,er,ei,ed,el,es,eu,ec,ep,ev,ef,ew,ey,em,eI,eR,eg,eT,eh,eC,eA,eb,eN,eD,eE,ek,eZ;let eL=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},eS=(0,d.T)(),{t:eM}=(0,s.$G)(["dao"]),eF=(0,d.C)(e=>e.global),eP=(0,d.C)(e=>e.dao),ex=(0,d.C)(e=>e.user),e_=(0,a.Z)(),eO=null!==(ei=null==eL?void 0:eL.autoTrigger)&&void 0!==ei&&ei,eU=function(e,t){let{t:n}=(0,s.$G)(["dao"]),i=(0,d.T)(),p=(0,d.C)(e=>e.global),v=(0,d.C)(e=>e.dao),A=(0,d.C)(e=>e.user);(0,a.Z)(e);let N=new g.Z,D=new h.Z,[E,k]=o.useState(0),[Z,L]=o.useState(!1);async function S(e){var t;if(!(e=null!=e?e:null===(t=v.nodeListFilters.selectedDao)||void 0===t?void 0:t.address))throw Error("No dao address");let n=await N.getRankSimpleInfo(e);return i(m.Z.slice.actions.updateSimpleRankInfo({luckyUsers:n.luckyRecords.map(e=>e.userAddress),voteUsers:n.voteAddresses,prevVoteUsers:n.prevVoteAddresses,voteWithdrawed:n.voteWithdrawed,nodeUsers:n.nodeAddresses,prevNodeUsers:n.prevNodeAddresses,nodeWithdrawed:n.nodeWithdrawed})),n}function M(e,t){var n,o,a,i,d,l,s,c;let p=new r.Z(u.Z.wei2eth(null!==(o=null===(n=v.daoCurrentRoundInfo)||void 0===n?void 0:n.pool.luckyPool)&&void 0!==o?o:0n));switch(null==(t=null!=t?t:v.rankInfo.luckyUsers)||t.length,e){case 0:return new r.Z(0);case 1:return p.multipliedBy(null!==(i=null===(a=v.daoContractInfo)||void 0===a?void 0:a.firstLuckyRewardRate)&&void 0!==i?i:.6);case 2:return p.multipliedBy(null!==(l=null===(d=v.daoContractInfo)||void 0===d?void 0:d.secondLuckyRewardRate)&&void 0!==l?l:.3);default:return p.multipliedBy(null!==(c=null===(s=v.daoContractInfo)||void 0===s?void 0:s.thirdLuckyRewardRate)&&void 0!==c?c:.1).div(31)}}function F(e,t){let n=new r.Z(u.Z.wei2eth(e));return e=>{var o,a,i,d,l,s;if(t[e-1])return new r.Z(0);switch(e){case 0:default:return new r.Z(0);case 1:return n.multipliedBy(null!==(a=null===(o=v.daoContractInfo)||void 0===o?void 0:o.firstPlaceRewardRate)&&void 0!==a?a:.6);case 2:return n.multipliedBy(null!==(d=null===(i=v.daoContractInfo)||void 0===i?void 0:i.secondPlaceRewardRate)&&void 0!==d?d:.3);case 3:return n.multipliedBy(null!==(s=null===(l=v.daoContractInfo)||void 0===l?void 0:l.thirdPlaceRewardRate)&&void 0!==s?s:.1)}}}function P(){var e,t,n,o,a;let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"currnet",d=null!==(o="currnet"===i?null===(e=v.daoCurrentRoundInfo)||void 0===e?void 0:e.pool.voteRankPool:null===(t=v.daoContractInfo)||void 0===t?void 0:t.top3VotedPoolPre)&&void 0!==o?o:0n;return new r.Z(d.toString()).multipliedBy(null!==(a=null===(n=v.daoContractInfo)||void 0===n?void 0:n.voteRankRewardRate)&&void 0!==a?a:0)}function x(){var e,t,n,o,a;let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"currnet",d=null!==(o="currnet"===i?null===(e=v.daoCurrentRoundInfo)||void 0===e?void 0:e.pool.communityPool:null===(t=v.daoContractInfo)||void 0===t?void 0:t.top3NodePoolPre)&&void 0!==o?o:0n;return new r.Z(d.toString()).multipliedBy(null!==(a=null===(n=v.daoContractInfo)||void 0===n?void 0:n.communityRewardRate)&&void 0!==a?a:0)}function _(e,t){var n,o;let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"currnet";e=null!=e?e:v.rankInfo.prevVoteUsers,t=null!==(n=null!=t?t:v.rankInfo.voteWithdrawed)&&void 0!==n?n:[];let r=P(a);return null!==(o=null==e?void 0:e.map((e,t)=>t+1).map((n,o)=>{let i=F(BigInt(r.toFixed(0)),"pre"===a?t:[])(n);return{rank:n,address:e[o],reward:i}}))&&void 0!==o?o:[]}function O(e,t){var n,o;let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"currnet";e=null!=e?e:v.rankInfo.prevNodeUsers,t=null!==(n=null!=t?t:v.rankInfo.nodeWithdrawed)&&void 0!==n?n:[];let r=x(a);return null!==(o=null==e?void 0:e.map((e,t)=>t+1).map((n,o)=>{let i=F(BigInt(r.toFixed(0)),"pre"===a?t:[])(n);return{rank:n,address:e[o],reward:i}}))&&void 0!==o?o:[]}async function U(t,n){var o,a,r,i;if(!(n=null!==(r=null!=n?n:e)&&void 0!==r?r:null===(o=v.nodeListFilters.selectedDao)||void 0===o?void 0:o.address))throw Error("No dao address");if(t=null!==(i=null!=t?t:null===(a=v.rankInfo)||void 0===a?void 0:a.luckyUsers)&&void 0!==i?i:[],!v.daoContractInfo)throw Error("No current round no");let d=v.daoContractInfo.currentRoundNO,l=g.Z.buildGetUserRankDetailInfo(t,n,d),s=w.Q.getDefaultProvider(),u=new y.z(w.Q.getTargetNet().chainId,s),c=await u.all(l.calls);return g.Z.analyzeUserDetailInfo(c,l.singleUserCallCount,l.userAddresses)}function B(e,t){return e.map((e,n)=>{let o=n+1;return{rank:o,address:e.userAddress,votes:Number(u.Z.wei2eth(e.voteInfo.votedAmount)),beVotes:0,reward:t(o)}})}async function H(e){let t=Date.now();if((!(t-E<6e4)||!v.rankInfo.luckyRank||!(v.rankInfo.luckyRank.length>0))&&!Z)try{var n,o,a,r,d;if(L(!0),!(e=null!=e?e:null===(n=v.nodeListFilters.selectedDao)||void 0===n?void 0:n.address))throw Error("No dao address");if(!v.daoContractInfo)throw Error("No dao contract info");if(!v.daoCurrentRoundInfo)throw Error("No current round info");let l=v.daoContractInfo.currentRoundNO,s=await S(e);p.token&&A.ethInfo.walletAddress&&W(s.nodeWithdrawed);let c=await N.getRankInfo({daoAddress:e,voteAddresses:s.voteAddresses,nodeAddresses:s.nodeAddresses,userAddress:A.ethInfo.walletAddress,currentRoundNO:l}),f=s.luckyRecords.map(e=>e.userAddress),w=s.luckyRecords.map((e,t)=>({rank:t+1,address:e.userAddress,votes:Number(e.votedAmount),beVotes:0,reward:M(t+1,f).toNumber()})),y=P(),I=(o=c.voteData,a=e=>F(BigInt(y.toFixed(0)),[])(e).toNumber(),B(o,a).map((e,t)=>{let n=Number(u.Z.wei2eth(o[t].promotionInfo.sonVotedAmountToday));return{...e,beVotes:n}})),R=x(),g=(r=c.nodeData,d=e=>F(BigInt(R.toFixed(0)),[])(e).toNumber(),B(r,d).map((e,t)=>{let n=Number(u.Z.wei2eth(r[t].promotionInfo.sonVotedAmountWeek));return{...e,beVotes:n}}));i(m.Z.slice.actions.updateDetailRankInfo({luckyRank:w,voteRank:I,nodeRank:g})),k(t)}catch(e){f.Z.E("useDAORankInfo::updateRankInfo error",e)}finally{L(!1)}}async function V(){i(m.Z.slice.actions.clearRankInfo()),i(m.Z.slice.actions.clearUserRankInfo())}async function W(e){var t,o,a,r,d,l;let s=null===(t=v.nodeListFilters.selectedDao)||void 0===t?void 0:t.address,u=A.ethInfo.walletAddress;if(!s)throw Error(n("NoSelectedDao"));if(!u)throw Error(n("Can't found user address"));new g.Z;let p=new R.q$p(D.buildConfigure()),w=await p.getMyRank({daoAddress:s}),y=new T.zv(w);if(y.hasError()){let e=y.getError();(0,c.L6)(e.msg),f.Z.E(e)}let h=null!==(r=y.getData().daoMyRankList)&&void 0!==r?r:[],C=g.z.DAOUserRankInfoAdapter.getFactory(u),b=h.map(C).map(e=>e.toJSON());i(m.Z.slice.actions.updateUserRankInfo(b));let N=new Map(b.map(e=>[e.rewardType,e.rank]));i(m.Z.slice.actions.updateUserRankRewardInfo([[I.r.RankRewardType.LUCKY_REWARD,M(N.get(I.r.RankRewardType.LUCKY_REWARD)).toNumber()],[I.r.RankRewardType.VOTE_TOP_REWARD,F(null!==(d=null===(o=v.daoContractInfo)||void 0===o?void 0:o.top3NodePoolPre)&&void 0!==d?d:0n,e)(N.get(I.r.RankRewardType.VOTE_TOP_REWARD)).toNumber()],[I.r.RankRewardType.NODE_TOP_REWARD,F(null!==(l=null===(a=v.daoContractInfo)||void 0===a?void 0:a.top3NodePoolPre)&&void 0!==l?l:0n,e)(N.get(I.r.RankRewardType.NODE_TOP_REWARD)).toNumber()]]))}return o.useEffect(()=>{var e;if(!(null==t?void 0:t.autoTrigger))return;if(!(null===(e=v.nodeListFilters.selectedDao)||void 0===e?void 0:e.address)||!v.daoCurrentRoundInfo){V();return}let o=b()(()=>{H().catch(e=>{(0,c.L6)(new c.HU(e,n("GetRankDataFailed")).asToastMessage()),f.Z.E("updateRankInfo",e)})},1e3),a=l.Z.sleepForAnimationFrame(200);a.wait(()=>o());let r=setInterval(()=>{"visible"===document.visibilityState&&o()},6e4);return()=>{a.cancel(C.Z.ReactError.useEffectDestroy()),clearInterval(r),o.cancel(),V()}},[v.daoCurrentRoundInfo,p.token,A.ethInfo.walletAddress]),{updateRankSimpleInfo:S,updateUserRankInfo:W,calcLuckyRewardInLocal:M,getLuckyRewardInLocal:function(e){var t;return null!==(t=null==(e=null!=e?e:v.rankInfo.luckyUsers)?void 0:e.map((e,t)=>t+1).map((t,n)=>({rank:t,address:e[n],reward:M(t,e)})))&&void 0!==t?t:[]},getUserLuckyRewardInLocal:function(e,t){var n,o;e=null!=e?e:A.ethInfo.walletAddress;let a=null!==(o=(t=null!==(n=null!=t?t:v.rankInfo.luckyUsers)&&void 0!==n?n:[]).indexOf(e))&&void 0!==o?o:-1;return M(-1===a?4:a+1,t)},calcTop3RewardInLocal:F,getVoteTop3Rawards:_,getUserVoteTopReward:function(e,t){var n,o;let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"currnet";return e=null!=e?e:A.ethInfo.walletAddress,(null!==(o=_(void 0,t=null!==(n=null!=t?t:v.rankInfo.voteWithdrawed)&&void 0!==n?n:[],a).find(t=>t.address===e))&&void 0!==o?o:{reward:new r.Z(0)}).reward},getNodeTop3Rawards:O,getUserNodeTopReward:function(e,t){var n,o;let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"currnet";return e=null!=e?e:A.ethInfo.walletAddress,(null!==(o=O(void 0,t=null!==(n=null!=t?t:v.rankInfo.nodeWithdrawed)&&void 0!==n?n:[],a).find(t=>t.address===e))&&void 0!==o?o:{reward:new r.Z(0)}).reward},getLastInvestorsDetailInfo:U,updateRankInfo:H,clearRankInfo:V}}(void 0,{autoTrigger:eO}),[eB,eH]=o.useState(0),[eV,eW]=o.useState(0),[ez,eq]=o.useState(!1),[eK,eG]=o.useState(!1),[eQ,ej]=o.useState(!1),[eX,e$]=o.useState("0"),[eY,eJ]=o.useState("TOKEN"),[e0,e1]=o.useState("0"),[e2,e6]=o.useState(!1),[e9,e4]=o.useState("0"),e5=null!==(ed=null===(e=eP.daoContractInfo)||void 0===e?void 0:e.voteRankClaimDurationAdd)&&void 0!==ed?ed:0,e3=null!==(el=null===(t=eP.daoContractInfo)||void 0===t?void 0:t.createTime)&&void 0!==el?el:0,e7=null!==(es=null===(A=eP.daoContractInfo)||void 0===A?void 0:A.rewardRoundPass)&&void 0!==es?es:0,e8=null!==(eu=null===(Z=eP.daoContractInfo)||void 0===Z?void 0:Z.airdropDurationGetLimit)&&void 0!==eu?eu:0;g.Z.getCurrentRewardRoundTimestamp(e3,e5,e7);let te=null!==(ec=null===(L=eP.daoCurrentRoundInfo)||void 0===L?void 0:L.roundExpire)&&void 0!==ec?ec:0,tt=null!==(ep=null===(S=eP.userInfo)||void 0===S?void 0:S.voteAndAirDropReward.clairReward)&&void 0!==ep?ep:0n,tn=eB||(null!==(ev=null===(M=eP.userInfo)||void 0===M?void 0:M.voteInfo.roundFirstVotedDate)&&void 0!==ev?ev:0),to=te>0?l.Z.convertTimeDifference(new Date(tn+e8-eF.currentTime),{includeDays:!1}):0,ta=tt>0n,tr=Math.floor(eF.currentTime/e5)*e5+e5,ti=eP.userRewardInfo.voteTopReward.gt(0)?l.Z.convertTimeDifference(new Date(tr-eF.currentTime),{includeDays:!1}):0,td=eP.userRewardInfo.voteTopReward.gt(0),tl=null!==(ef=null===(F=eP.daoContractInfo)||void 0===F?void 0:F.communityDuration)&&void 0!==ef?ef:0,ts=Math.floor((null!==(ew=null===(P=eP.daoContractInfo)||void 0===P?void 0:P.top3NodeDate)&&void 0!==ew?ew:0)/tl)*tl+(null!==(ey=null===(x=eP.daoContractInfo)||void 0===x?void 0:x.communityDuration)&&void 0!==ey?ey:0);null===(_=eP.daoContractInfo)||void 0===_||_.communityRewardDuration;let tu=eP.userRewardInfo.nodeTopReward.gt(0)?l.Z.convertTimeDifference(new Date(ts-eF.currentTime),{includeDays:!1}):0,tc=eP.userRewardInfo.nodeTopReward.gt(0),tp=l.Z.convertTimeDifference(new Date((null!==(em=null===(O=eP.daoCurrentRoundInfo)||void 0===O?void 0:O.roundExpire)&&void 0!==em?em:0)-eF.currentTime),{includeDays:!1}),tv=l.Z.convertTimeDifference(new Date((null!==(eI=null===(U=eP.daoCurrentRoundInfo)||void 0===U?void 0:U.roundExpire)&&void 0!==eI?eI:0)+(null!==(eR=null===(B=eP.daoContractInfo)||void 0===B?void 0:B.loserPoolRewardTimeLimit)&&void 0!==eR?eR:0)-eF.currentTime),{includeDays:!1}),tf=0===tp&&0!==tv&&eP.userRewardInfo.luckyReward.gt(0)&&(null===(H=eP.userInfo)||void 0===H?void 0:H.voteInfo.isLuckyRewardClaimed)===!1,tw=new r.Z((null!==(eg=null===(V=eP.daoCurrentRoundInfo)||void 0===V?void 0:V.totalVoteAmount)&&void 0!==eg?eg:0n).toString()).minus((null!==(eT=null===(W=eP.daoCurrentRoundInfo)||void 0===W?void 0:W.totalEthDone)&&void 0!==eT?eT:0n).toString()),ty=(null===(z=eP.userInfo)||void 0===z?void 0:z.voteInfo.isLoserRewardClaimed)?new r.Z(0):new r.Z((null!==(eh=null===(q=eP.userInfo)||void 0===q?void 0:q.voteInfo.votedAmount)&&void 0!==eh?eh:0n).toString()).minus((null!==(eC=null===(K=eP.userInfo)||void 0===K?void 0:K.voteInfo.ethDone)&&void 0!==eC?eC:0n).toString()).div(tw.isZero()?"1":tw.toFixed(0)).multipliedBy((null!==(eA=null===(G=eP.daoCurrentRoundInfo)||void 0===G?void 0:G.pool.loserPool)&&void 0!==eA?eA:0n).toString()),tm=(null===(Q=eP.userInfo)||void 0===Q?void 0:Q.voteInfo.isLoserRewardClaimed)?new r.Z(0):new r.Z((null!==(eb=null===(j=eP.userInfo)||void 0===j?void 0:j.voteInfo.votedAmount)&&void 0!==eb?eb:0n).toString()).minus((null!==(eN=null===(X=eP.userInfo)||void 0===X?void 0:X.voteInfo.ethDone)&&void 0!==eN?eN:0n).toString()).div(tw.isZero()?"1":tw.toFixed(0)).multipliedBy((null!==(eD=null===($=eP.daoCurrentRoundInfo)||void 0===$?void 0:$.pool.loserPoolETH)&&void 0!==eD?eD:0n).toString()),tI=l.Z.convertTimeDifference(new Date((null!==(eE=null===(Y=eP.daoCurrentRoundInfo)||void 0===Y?void 0:Y.roundExpire)&&void 0!==eE?eE:0)-eF.currentTime),{includeDays:!1}),tR=l.Z.convertTimeDifference(new Date((null!==(ek=null===(J=eP.daoCurrentRoundInfo)||void 0===J?void 0:J.roundExpire)&&void 0!==ek?ek:0)+(null!==(eZ=null===(ee=eP.daoContractInfo)||void 0===ee?void 0:ee.loserPoolRewardTimeLimit)&&void 0!==eZ?eZ:0)-eF.currentTime),{includeDays:!1}),tg=0===tI&&0!==tR&&(ty.gt(0)||tm.gt(0)),tT=w.Q.getTargetNet().chainId,th=(0,D.Cv)(null===(et=eP.nodeListFilters.selectedDao)||void 0===et?void 0:et.address,tT),tC=[{title:eM("DAOReward"),reward:u.Z.wei2eth(tt),hasDetails:!0,countdown:0===to?"":to.toFormated(),claimable:ta,handleClaim:tb},{title:eM("VoteTopReward"),reward:eP.userRewardInfo.voteTopReward.toString(),hasDetails:!1,countdown:0===ti?"":ti.toFormated(),claimable:td,handleClaim:tN},{title:eM("NodeTopReward"),reward:eP.userRewardInfo.nodeTopReward.toString(),hasDetails:!1,countdown:0===tu?"":tu.toFormated(),claimable:tc,handleClaim:tD},{title:eM("LuckyReward"),reward:eP.userRewardInfo.luckyReward.toString(),hasDetails:!1,countdown:(null===(en=eP.userInfo)||void 0===en?void 0:en.voteInfo.isLuckyRewardClaimed)?"":0!==tp?tp.toFormated():0!==tv?tv.toFormated():"",claimable:tf,handleClaim:tE},{title:eM("OtherReward"),tokenReward:ty.gt(0)?u.Z.wei2eth(ty.toFixed(0,r.Z.ROUND_DOWN)):"0",hasDetails:!1,countdown:(null===(eo=eP.userInfo)||void 0===eo?void 0:eo.voteInfo.isLoserRewardClaimed)?"":0!==tI?tI.toFormated():0!==tR?tR.toFormated():"",claimable:tg,handleClaim:tk}],tA=th?[...tC,{title:eM("AIReward"),tokenReward:"".concat(eX," ").concat(eY," (≈").concat(i.Z.toFixed(Number(e0),4)," ETH)"),hasDetails:!1,countdown:(null===(ea=eP.userInfo)||void 0===ea?void 0:ea.voteInfo.isLoserRewardClaimed)?"":0!==tI?tI.toFormated():0!==tR?tR.toFormated():"",claimable:new r.Z(eX).gt(0)&&0===tI&&0!==tR,handleClaim:tZ}]:tC;async function tb(){var e,t,n,o,a,i,d,l,s,w;let y=null===(e=eP.nodeListFilters.selectedDao)||void 0===e?void 0:e.address;if(!y){(0,c.L6)(eM("NoSelectedDao"));return}if(!ta)return;let I=p.r.getInstance(),R=u.Z.getInstance(I.getProvider()),g=v.bR.connect(y,await R.getSigner());try{let e=null===(t=eP.daoContractInfo)||void 0===t?void 0:t.currentRoundNO;if(!e){let t=await g.currentRoundNO();e=Number(t)}let a=await g.pools(e),i=a.airdropPool;if(tt>i){try{let e=null!==(o=null===(n=eP.daoContractInfo)||void 0===n?void 0:n.firstLuckyRewardRate)&&void 0!==o?o:0,t=new r.Z(u.Z.wei2eth(a.luckyPoolBalance)).multipliedBy(e).toFixed(1);e4(t)}catch(e){e4("0")}e6(!0);return}}catch(e){try{let e=null!==(i=null===(a=eP.daoCurrentRoundInfo)||void 0===a?void 0:a.pool.airdropPool)&&void 0!==i?i:0n;if(tt>e){try{let e=null!==(s=null===(d=eP.daoContractInfo)||void 0===d?void 0:d.firstLuckyRewardRate)&&void 0!==s?s:0,t=new r.Z(u.Z.wei2eth(null!==(w=null===(l=eP.daoCurrentRoundInfo)||void 0===l?void 0:l.pool.luckyPool)&&void 0!==w?w:0n)).multipliedBy(e).toFixed(1);e4(t)}catch(e){e4("0")}e6(!0);return}}catch(e){}}try{let e=await g.claimVoteAndAirDropReward();await e.wait(),(0,c.x9)(eM("ClaimVoteAndAirDropRewardSuccess"));let t=Date.now();eH(t),eG(!0),eP.userInfo&&eS(m.Z.slice.actions.updateUserInfo({...eP.userInfo,voteAndAirDropReward:{...eP.userInfo.voteAndAirDropReward,clairReward:0n}})),await tL(),setTimeout(()=>{eG(!1)},5e3)}catch(e){(0,c.L6)(new c.HU(e,eM("ClaimVoteAndAirDropRewardFailed")).asToastMessage()),f.Z.E(e)}}async function tN(){var e,t;if(!(null===(e=eP.nodeListFilters.selectedDao)||void 0===e?void 0:e.address)){(0,c.L6)(eM("NoSelectedDao"));return}eS(m.Z.slice.actions.updateUserRewardInfo({...eP.userRewardInfo,voteTopReward:new r.Z(0)}));let n=p.r.getInstance(),o=u.Z.getInstance(n.getProvider()),a=v.bR.connect(null===(t=eP.nodeListFilters.selectedDao)||void 0===t?void 0:t.address,await o.getSigner());try{let e=await a.claimTop3VotedReward();await e.wait(),(0,c.x9)(eM("ClaimNodeTopRewardSuccess")),await tL()}catch(e){eS(m.Z.slice.actions.updateUserRewardInfo({...eP.userRewardInfo,voteTopReward:eP.userRewardInfo.voteTopReward})),(0,c.L6)(new c.HU(e,eM("ClaimNodeTopRewardFailed")).asToastMessage()),f.Z.E(e)}}async function tD(){var e,t;if(!(null===(e=eP.nodeListFilters.selectedDao)||void 0===e?void 0:e.address))return(0,c.L6)(eM("NoSelectedDao"));eS(m.Z.slice.actions.updateUserRewardInfo({...eP.userRewardInfo,nodeTopReward:new r.Z(0)}));let n=p.r.getInstance(),o=u.Z.getInstance(n.getProvider()),a=v.bR.connect(null===(t=eP.nodeListFilters.selectedDao)||void 0===t?void 0:t.address,await o.getSigner());try{let e=await a.claimTop3NodeReward();await e.wait(),(0,c.x9)(eM("ClaimNodeTopRewardSuccess")),await tL()}catch(e){eS(m.Z.slice.actions.updateUserRewardInfo({...eP.userRewardInfo,nodeTopReward:eP.userRewardInfo.nodeTopReward})),(0,c.L6)(new c.HU(e,eM("ClaimNodeTopRewardFailed")).asToastMessage()),f.Z.E(e)}}async function tE(){var e,t;if(!(null===(e=eP.nodeListFilters.selectedDao)||void 0===e?void 0:e.address))return(0,c.L6)(eM("NoSelectedDao"));eP.userInfo&&eS(m.Z.slice.actions.updateUserInfo({...eP.userInfo,voteInfo:{...eP.userInfo.voteInfo,isLuckyRewardClaimed:!0}}));let n=p.r.getInstance(),o=u.Z.getInstance(n.getProvider()),a=v.bR.connect(null===(t=eP.nodeListFilters.selectedDao)||void 0===t?void 0:t.address,await o.getSigner());try{let e=await a.claimLuckyReward();await e.wait(),(0,c.x9)(eM("ClaimLuckyRewardSuccess")),await tL()}catch(e){eP.userInfo&&eS(m.Z.slice.actions.updateUserInfo({...eP.userInfo,voteInfo:{...eP.userInfo.voteInfo,isLuckyRewardClaimed:!1}})),(0,c.L6)(new c.HU(e,eM("ClaimLuckyRewardFailed")).asToastMessage()),f.Z.E(e)}}async function tk(){var e,t;if(!(null===(e=eP.nodeListFilters.selectedDao)||void 0===e?void 0:e.address))return(0,c.L6)(eM("NoSelectedDao"));eP.userInfo&&eS(m.Z.slice.actions.updateUserInfo({...eP.userInfo,voteInfo:{...eP.userInfo.voteInfo,isLoserRewardClaimed:!0}}));let n=p.r.getInstance(),o=u.Z.getInstance(n.getProvider()),a=v.bR.connect(null===(t=eP.nodeListFilters.selectedDao)||void 0===t?void 0:t.address,await o.getSigner());try{let e=await a.claimLoserReward();await e.wait(),(0,c.x9)(eM("ClaimOtherRewardSuccess")),await tL()}catch(e){eP.userInfo&&eS(m.Z.slice.actions.updateUserInfo({...eP.userInfo,voteInfo:{...eP.userInfo.voteInfo,isLoserRewardClaimed:!1}})),(0,c.L6)(new c.HU(e,eM("ClaimOtherRewardFailed")).asToastMessage()),f.Z.E(e)}}async function tZ(){let e=w.Q.getTargetNet().chainId,t=(0,D.yO)(e);if(!t){(0,c.L6)(eM("NoAiDaoAddress"));return}let n=p.r.getInstance(),o=u.Z.getInstance(n.getProvider()),a=v.fj.connect(t,await o.getSigner());try{let e=await a.claimLoserReward();await e.wait(),(0,c.x9)(eM("ClaimAIRewardSuccess")),e$("0"),eJ("TOKEN"),e1("0"),await tL()}catch(e){(0,c.L6)(new c.HU(e,eM("ClaimAIRewardFailed")).asToastMessage()),f.Z.E(e)}}async function tL(){var e;let t=null===(e=eP.nodeListFilters.selectedDao)||void 0===e?void 0:e.address;if(t)try{eq(!0),ej(!0),eS(N.Z.slice.actions.updateTime(Date.now())),await new Promise(e=>setTimeout(e,2e3)),await Promise.all([e_.updateInfo(),eU.updateRankSimpleInfo(t),tS(t),tF(t)]),await tU(t),eL.handleAfterClaim&&await eL.handleAfterClaim()}catch(e){f.Z.E("Error in handleAfterClaim:",e)}finally{eq(!1),ej(!1)}}async function tS(e){var t;let n=Date.now();if(!eQ&&n-eV<6e4||ez)return;let o=new g.Z;if(!(e=null!=e?e:null===(t=eP.nodeListFilters.selectedDao)||void 0===t?void 0:t.address)){(0,c.L6)(eM("NoSelectedDao"));return}try{eq(!0);let t=await o.getUserVoteNodeRankReward({userAddress:ex.ethInfo.walletAddress,daoAddress:e});eS(m.Z.slice.actions.updateUserRewardInfo({luckyReward:new r.Z(u.Z.wei2eth(t.luckyReward.reward)),voteTopReward:new r.Z(u.Z.wei2eth(t.voteTopReward.reward)),nodeTopReward:new r.Z(u.Z.wei2eth(t.nodeTopReward.reward))})),eW(n)}catch(e){(0,c.L6)(new c.HU(e,eM("GetUserVoteNodeRankRewardFailed")).asToastMessage()),f.Z.E(e)}finally{eq(!1)}}let tM=o.useCallback(b()(e=>{var t;if(null===(t=eP.daoContractInfo)||void 0===t?void 0:t.daoAddress)return tS(eP.daoContractInfo.daoAddress)},800),[eP.daoContractInfo,ex.ethInfo.walletAddress]);async function tF(e){if(eK)return;let t=new g.Z,n=new R.q$p(t.buildConfigure()),o=await n.getLastClaimTime({daoAddress:e}),a=new T.zv(o);if(a.hasError()){let e=a.getError();(0,c.L6)(new c.HU(e,eM("GetLastClaimTimeFailed")).asToastMessage()),f.Z.E(e);return}let r=i.Z.Time.fromTimestamp(a.getData());eK||r.toJSTime()===eB||eH(r.toJSTime())}function tP(e,t){let n=Number("120");return new r.Z(u.Z.wei2eth(e)).multipliedBy(n).div(100).minus(u.Z.wei2eth(t))}o.useEffect(()=>{if(!eO||!eP.daoContractInfo||!ex.ethInfo.walletAddress)return;let e=l.Z.sleepForAnimationFrame(300);e.wait(()=>{var e;tM(),(null===(e=eP.nodeListFilters.selectedDao)||void 0===e?void 0:e.address)&&tO(eP.nodeListFilters.selectedDao.address)});let t=setInterval(()=>{"visible"===document.visibilityState&&tM()},6e4);return()=>{e.cancel(C.Z.ReactError.useEffectDestroy()),clearInterval(t)}},[eP.daoContractInfo,ex.ethInfo.walletAddress,eO,tM]);let tx=o.useCallback(b()(e=>{tF(e)},500),[]);async function t_(){var e;let t=null===(e=eP.nodeListFilters.selectedDao)||void 0===e?void 0:e.address;if(t&&ex.ethInfo.walletAddress)try{eq(!0),ej(!0),await Promise.all([e_.updateInfo(),eU.updateRankSimpleInfo(t),tS(t),tF(t),tO(t)]),await tU(t),eW(Date.now()),ej(!1)}catch(e){f.Z.E("Error in refreshAllData:",e)}finally{eq(!1)}}async function tO(e){try{let t=w.Q.getTargetNet().chainId;if(!(0,D.Cv)(e,t)){e$("0"),eJ("TOKEN"),e1("0");return}let o=(0,D.OM)(t),a=(0,D.yO)(t);if(!a||!o){e$("0"),eJ("TOKEN"),e1("0");return}let i=p.r.getInstance(),d=u.Z.getInstance(i.getProvider()),l=ex.ethInfo.walletAddress;if(!l)return;let s=v.fj.connect(a,await d.getSigner()),c=await s.getLoserReward(l),y=u.Z.wei2eth(c);e$(y);let m=o.rewardTokenAddress;if(console.log("rewardTokenAddress",m),m&&"0"!==m&&Number(y)>0){console.log("rewardTokenAddress",2);try{console.log("rewardTokenAddress",3);let e=await (0,E.co)(m);console.log("priceInfo",e);let{TrinityTokenAbi:t}=await Promise.resolve().then(n.bind(n,13167)),o=new k.CH(m,t,await d.getSigner()),a=await o.symbol(),i=new r.Z(y).multipliedBy(e.sellPriceETH).toString();eJ(a),e1(i)}catch(e){console.log("rewardTokenAddress",4),f.Z.E("Error fetching AI reward token price:",e),eJ("TOKEN"),e1("0")}}else eJ("TOKEN"),e1("0")}catch(e){e$("0"),eJ("TOKEN"),e1("0"),f.Z.E("Error fetching AI reward:",e)}}async function tU(e){try{let t=p.r.getInstance(),n=u.Z.getInstance(t.getProvider()),o=v.bR.connect(e,await n.getSigner()),a=ex.ethInfo.walletAddress;if(!a)return;let r=await o.getVoteAndAirDropReward(a);if(eP.userInfo){let e={...eP.userInfo,voteAndAirDropReward:{...eP.userInfo.voteAndAirDropReward,clairReward:r.clairReward,airdropReward:r.airdropReward,nodeReward:r.nodeReward,airdropLinkReward:r.airdropLinkReward,reinvestReward:r.reinvestReward}};eS(m.Z.slice.actions.updateUserInfo(e))}}catch(e){f.Z.E("Error checking reward claim status:",e)}}return o.useEffect(()=>{var e;if((null===(e=eP.nodeListFilters.selectedDao)||void 0===e?void 0:e.address)&&eF.token)return tx(eP.nodeListFilters.selectedDao.address),()=>{tx.cancel()}},[null===(er=eP.nodeListFilters.selectedDao)||void 0===er?void 0:er.address,eF.token,tx]),o.useEffect(()=>{eQ&&eO&&t_()},[eQ,eO]),{rewardItems:tA,handleVoteAirdropClaim:tb,handleVoteRankClaim:tN,handleNodeRankClaim:tD,handleLuckyClaim:tE,handleOtherClaim:tk,handleAiRewardClaim:tZ,estimatePendingReward:tP,estimateUserPendingReward:function(){try{var e,t,n,o;let a=tP(null!==(n=null===(e=eP.userInfo)||void 0===e?void 0:e.voteInfo.votedAmount)&&void 0!==n?n:0n,null!==(o=null===(t=eP.userInfo)||void 0===t?void 0:t.voteInfo.ethDone)&&void 0!==o?o:0n);if(!a||a.isNaN())return new r.Z(0);return a}catch(e){return console.warn("Error calculating pending reward:",e),new r.Z(0)}},getClaimNodeRewardCountdown:function(){if(!eP.daoContractInfo)return"";let e=Math.floor(eF.currentTime/1e3),t=86400*Math.floor(Math.floor(e3/1e3)/86400),n=t+604800*Math.floor((e-t)/604800)+604800-e;if(n<=0)return"00:00:00";let o=Math.floor(n/3600).toString().padStart(2,"0"),a=Math.floor(n%3600/60).toString().padStart(2,"0"),r=Math.floor(n%60).toString().padStart(2,"0");return"".concat(o,":").concat(a,":").concat(r)},refreshAllData:t_,isUpdating:ez,ui:{airdropInsufficientOpen:e2,setAirdropInsufficientOpen:e6,airdropFirstPrizeAmount:e9}}}},88952:function(e,t,n){n.d(t,{co:function(){return w}});var o=n(12249),a=n(3682),r=n(94552),i=n(59868),d=n(41662),l=n(90135),s=n(90005),u=n(96727),c=n(45532),p=n(45556);class v{async getPairReserves(e){let t,n;let o=await this.getPairAddress(e);if(o===r.N)throw Error("交易对不存在");let a=new i.CH(o,c._,this.provider);try{let e=await this.provider.getCode(o);if("0x"===e)throw Error("交易对合约不存在: ".concat(o));let r=await Promise.all([a.token0(),a.token1(),a.getReserves()]);t=r[0],r[1],n=r[2]}catch(e){throw console.error("❌ 获取交易对储备失败:",e),e}let[d,l]=n,s=t.toLowerCase()===this.wethAddress.toLowerCase();return{ethReserve:s?d:l,tokenReserve:s?l:d,pairAddress:o}}async getPairAddress(e){let t=new i.CH(this.tokenSwapAddress,p.R,this.provider);try{let n=await this.provider.getCode(this.tokenSwapAddress);if("0x"===n)return console.error("❌ TokenSwap合约不存在: ".concat(this.tokenSwapAddress)),r.N;let o=await t.trinityswapV2Factory(),a=await this.provider.getCode(o);if("0x"===a)return console.error("❌ Factory合约不存在: ".concat(o)),r.N;try{let t=new i.CH(o,["function getPair(address tokenA, address tokenB) external view returns (address pair)"],this.provider),n=await t.getPair(e,this.wethAddress);if(n!==r.N){let e=await this.provider.getCode(n);if("0x"!==e)return n}}catch(e){}return await this.computePairAddress(o,e,this.wethAddress)}catch(e){return console.error("❌ 获取交易对地址失败:",e),r.N}}async getRealtimePrice(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"1";try{let{ethReserve:n,tokenReserve:o}=await this.getPairReserves(e),a=d.fi(t),r=this.getAmountOut(a,n,o,997n),i=Number(d.dF(r)),l=d.fi("1"),s=this.getAmountOut(l,o,n,997n),u=Number(d.dF(s)),c=Number(n)/Number(o)*1e18,p=Number(d.dF(BigInt(Math.floor(c))));return{buyPriceETH:i,sellPriceETH:u,midPriceETH:p,slippage:p>0?Math.abs(1/i-u)/p*100:0}}catch(e){throw console.error("❌ 计算价格时发生错误:",e),e}}getAmountOut(e,t,n){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:997n;if(0n===e||0n===t||0n===n)return 0n;let a=e*o;return a*n/(1000n*t+a)}async computePairAddress(e,t,n){let[o,a]=t.toLowerCase()<n.toLowerCase()?[t,n]:[n,t],r=l.w(s.VT(["address","address"],[o,a]));for(let t of["0x96e8ac4277198ff8b6f785478aa9a39f403cb768dd02cbee326c3e7da348845f","0xd0d4c4cd0848c93cb4fd1f498d7013ee6bfb25783ea21593d5834f5d250ece66","0x00fb7f630766e6a796048ea87d01acd3068e8ff67d078148a3fa3f4a84f69bd5","0xe18a34eb0e04b04f7a0ac29a6e80748dca96319b42c54d679cb821dca90c6303"]){let n=u.h(e,r,t),o=await this.provider.getCode(n);if("0x"!==o&&o.length>2)return n}return u.h(e,r,"0x96e8ac4277198ff8b6f785478aa9a39f403cb768dd02cbee326c3e7da348845f")}constructor(){if((0,o._)(this,"provider",void 0),(0,o._)(this,"wethAddress",void 0),(0,o._)(this,"tokenSwapAddress",void 0),this.provider=a.Q.getDefaultProvider(),this.wethAddress="0x4200000000000000000000000000000000000006",this.tokenSwapAddress="0x4Cd906AEF43aB89BB5714391B024b3C49bC76617",!this.wethAddress||!this.tokenSwapAddress)throw Error("Missing required environment variables")}}let f=new v;async function w(e){return f.getRealtimePrice(e)}}}]);