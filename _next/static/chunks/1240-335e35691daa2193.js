(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1240],{54740:function(e,t,n){"use strict";n.d(t,{eO:function(){return d}});var i=n(57437);n(17104);var a=n(72790),o=n(11340),r=n(53335),s=n(43009);function u(e){var t,n,a,o;let s=e.value.indexOf("."),u=-1===s?"":e.value.substring(s+1),d=u.match(/^(0+)/),p=d?d[0].length:0,l=u.substring(p),y=null!==(t=e.keepDecimal)&&void 0!==t?t:4,m=null!==(n=e.decimal)&&void 0!==n?n:18,c=null!==(a=e.useSub)&&void 0!==a&&a;l.length>y&&(l=l.substring(0,y));let T=e.value.substring(0,-1===s?e.value.length:s+p+1)+l;return(0,i.jsxs)("span",{className:(0,r.m6)("format-decimal",e.className),children:[c&&-1!==s&&p>0&&null===u.match(/^0+$/)?(0,i.jsxs)(i.Fragment,{children:[T.substring(0,s+2),(0,i.jsx)("sub",{className:(0,r.m6)("zero-count",e.subClassName),children:p}),l.replace(/0+$/,"")]}):0===Number(e.value)?0:-1!==s&&e.value.length>s+1+m?"".concat(e.value.substring(0,s+1+m)):e.value,null!==(o=e.children)&&void 0!==o?o:""]})}function d(e){let{preChildren:t,value:n,minDecimal:d,decimal:p,className:l,valueClassName:y,keepDecimal:m,useSub:c,children:T,...w}=e;if(isNaN(n)||"number"!=typeof n)return(0,i.jsx)("span",{className:(0,r.m6)("invalid-number",l),children:n});let f=null!=d?d:0;m=null!=m?m:4,void 0!==d&&(p=Math.max(Math.min(d,20),0));let v=null!=p?p:18;void 0!==p&&(p=Math.max(Math.min(p,20),0));let{value:R,suffix:g}=s.Z.getAbbreviatedValue(n);if(""!==g)return(0,i.jsxs)(a.Z,{horizontalArrangement:o.cV.Center,className:"number-formatter ".concat(null!=l?l:""),...w,children:[null!=t?t:"",(0,i.jsx)(u,{value:R.toFixed(m),useSub:c,decimal:p,className:y}),g,T]});let A=n.toFixed(v),h=A.indexOf(".");if(-1!==h){let e=A.substring(h+1),t=(e.match(/^(0+)/)||[""])[0].length,i=e.substring(t);void 0===p&&i.length>m&&(i=i.substring(0,m)),A=n.toLocaleString("en-US",{minimumFractionDigits:f,maximumFractionDigits:null!=p?p:t+i.length})}else A=n.toLocaleString("en-US",{minimumFractionDigits:f,maximumFractionDigits:p});return(0,i.jsxs)(a.Z,{className:(0,r.m6)("number-formatter justify-center",l),...w,children:[null!=t?t:"",(0,i.jsx)(u,{value:A,useSub:c,decimal:p,className:y,subClassName:l}),T]})}},40366:function(e,t,n){"use strict";n.d(t,{K:function(){return i}});let i=[{inputs:[],stateMutability:"nonpayable",type:"constructor"},{inputs:[{internalType:"address",name:"target",type:"address"}],name:"AddressEmptyCode",type:"error"},{inputs:[{internalType:"address",name:"implementation",type:"address"}],name:"ERC1967InvalidImplementation",type:"error"},{inputs:[],name:"ERC1967NonPayable",type:"error"},{inputs:[],name:"FailedCall",type:"error"},{inputs:[],name:"InvalidInitialization",type:"error"},{inputs:[],name:"NotInitializing",type:"error"},{inputs:[],name:"UUPSUnauthorizedCallContext",type:"error"},{inputs:[{internalType:"bytes32",name:"slot",type:"bytes32"}],name:"UUPSUnsupportedProxiableUUID",type:"error"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint64",name:"version",type:"uint64"}],name:"Initialized",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"implementation",type:"address"}],name:"Upgraded",type:"event"},{inputs:[],name:"AIRDROP_DURATION_CALC",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"AIRDROP_DURATION_GET_LIMIT",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"AIRDROP_DURATION_GET_MAX",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"AIRDROP_POOL_RATE",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"CANDIDATE_TOKEN_AMOUNT",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"COMMUNITY_DURATION",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"COMMUNITY_POOL_RATE",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"COMMUNITY_REWARD_EXPIRE",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"COMMUNITY_REWARD_RATE",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"CREATOR_FEE_RATE",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"DAILY_REWARD_RATE",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"DEVELOPER_FEE_RATE",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"FIRST_LUCKY_REWARD",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"FIRST_PLACE_REWARD",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"FUND_POOL_RATE",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"LOSER_POOL_RATE",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"LOSER_POOL_REWARD_TIME_LIMIT",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"LUCKY_POOL_RATE",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"MASTER_FOR_SUPER",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"MASTER_LINK_REWARD_RATE",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"MASTER_NODE_REWARD_RATE",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"ONE_DAY",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"PARENT_NODE_REWARD_RATE",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"QUITE_DURATION",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"QUIT_RATE",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"REWARD_LIMIT_RATE",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"ROUND_DURATION_ADD",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"ROUND_DURATION_MAX",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"SECOND_LUCKY_REWARD",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"SECOND_PLACE_REWARD",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"SUPER_LINK_REWARD_RATE",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"SUPER_NODE_REWARD_RATE",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"SUPER_TOKEN_AMOUNT",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"SWAP_LIMIT",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"THIRD_LUCKY_REWARD",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"THIRD_PLACE_REWARD",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"UPGRADE_INTERFACE_VERSION",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"VOTES_FOR_MASTER",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"VOTE_DURATION",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"VOTE_PRICE",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"VOTE_RANK_POOL_RATE",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"VOTE_RANK_REWARD_RATE",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"applyCandidateNode",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"applySuperNode",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"addr",type:"address"},{internalType:"uint256",name:"curDay",type:"uint256"}],name:"calcEffectiveAirDrop",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"addr",type:"address"},{internalType:"uint256",name:"curDay",type:"uint256"}],name:"calcEffectiveReinvest",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"addr",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"ceilReward",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"claimLoserReward",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"claimLuckyReward",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"claimTop3NodeReward",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"claimTop3VotedReward",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"claimVoteAndAirDropReward",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"createTime",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"creator",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"currentRoundNO",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"daoFactory",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"getLastInvestors",outputs:[{internalType:"address[33]",name:"",type:"address[33]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"addr",type:"address"}],name:"getLuckyReward",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"addr",type:"address"}],name:"getQuiteAmount",outputs:[{internalType:"uint256",name:"",type:"uint256"},{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"addr",type:"address"}],name:"getTop3NodeReward",outputs:[{internalType:"uint256",name:"",type:"uint256"},{internalType:"uint8",name:"",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"addr",type:"address"}],name:"getTop3VotedReward",outputs:[{internalType:"uint256",name:"",type:"uint256"},{internalType:"uint8",name:"",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"addr",type:"address"}],name:"getVoteAndAirDropReward",outputs:[{components:[{internalType:"uint256",name:"nodeReward",type:"uint256"},{internalType:"uint256",name:"airdropReward",type:"uint256"},{internalType:"uint256",name:"airdropLinkReward",type:"uint256"},{internalType:"uint256",name:"reinvestReward",type:"uint256"},{internalType:"uint256",name:"totalReward",type:"uint256"},{internalType:"uint256",name:"clairReward",type:"uint256"}],internalType:"struct IDao.RewardData",name:"",type:"tuple"}],stateMutability:"view",type:"function"},{inputs:[{components:[{internalType:"address",name:"token",type:"address"},{internalType:"address",name:"trinitySwap",type:"address"},{internalType:"address",name:"pair",type:"address"},{internalType:"address",name:"weth",type:"address"},{internalType:"address",name:"priceConsumerV3",type:"address"},{internalType:"address",name:"creator",type:"address"},{internalType:"string",name:"name",type:"string"},{internalType:"address",name:"developer",type:"address"}],internalType:"struct IDao.InitParams",name:"params",type:"tuple"}],name:"initialize",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"lastInvestors",outputs:[{internalType:"uint8",name:"currentIndex",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[],name:"name",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"pair",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"pools",outputs:[{internalType:"uint256",name:"airdropPool",type:"uint256"},{internalType:"uint256",name:"voteRankPool",type:"uint256"},{internalType:"uint256",name:"communityPool",type:"uint256"},{internalType:"uint256",name:"luckyPool",type:"uint256"},{internalType:"uint256",name:"luckyPoolBalance",type:"uint256"},{internalType:"uint256",name:"fundPool",type:"uint256"},{internalType:"uint256",name:"loserPool",type:"uint256"},{internalType:"uint256",name:"loserPoolBalance",type:"uint256"},{internalType:"uint256",name:"loserPoolETH",type:"uint256"},{internalType:"uint256",name:"loserPoolETHBalance",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"priceConsumerV3",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"},{internalType:"address",name:"",type:"address"}],name:"promotions",outputs:[{internalType:"uint256",name:"sonVotedAmountToday",type:"uint256"},{internalType:"uint256",name:"sonVotedAmountWeek",type:"uint256"},{internalType:"uint256",name:"sonVotedDate",type:"uint256"},{internalType:"uint256",name:"sonVotedWeek",type:"uint256"},{internalType:"uint256",name:"airdropLinkReward",type:"uint256"},{internalType:"uint256",name:"nodeReward",type:"uint256"},{internalType:"uint256",name:"totalSonVotedAmount",type:"uint256"},{internalType:"uint256",name:"totalSonEthDone",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"proxiableUUID",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"quit",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"},{internalType:"uint256",name:"",type:"uint256"}],name:"quitAmount",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"restart",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"roundExpire",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"token",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"top3Node",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"top3NodeDate",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"top3NodePoolPre",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"top3NodePre",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"top3NodeWithdraw",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"top3Voted",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"top3VotedDate",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"top3VotedPoolPre",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"top3VotedPre",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"top3VotedWithdraw",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"totalEthDone",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"totalVoteAmount",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"trinitySwap",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"newImplementation",type:"address"}],name:"upgradeTo",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"newImplementation",type:"address"},{internalType:"bytes",name:"data",type:"bytes"}],name:"upgradeToAndCall",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"users",outputs:[{internalType:"uint256",name:"firstJoinTime",type:"uint256"},{internalType:"uint256",name:"roundNo",type:"uint256"},{internalType:"address",name:"parent",type:"address"},{internalType:"uint256",name:"sonCount",type:"uint256"},{internalType:"uint256",name:"sonCandidateCount",type:"uint256"},{internalType:"uint256",name:"sonMasterNodeCount",type:"uint256"},{internalType:"uint256",name:"sonSuperNodeCount",type:"uint256"},{internalType:"enum DaoLibrary.NodeType",name:"nodeType",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"_node",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"vote",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"},{internalType:"address",name:"",type:"address"}],name:"votes",outputs:[{internalType:"uint256",name:"votedAmount",type:"uint256"},{internalType:"uint256",name:"ethDone",type:"uint256"},{internalType:"uint256",name:"roundFirstVotedDate",type:"uint256"},{internalType:"uint256",name:"claimedVotedLastTime",type:"uint256"},{internalType:"uint256",name:"votedDatePre",type:"uint256"},{internalType:"bool",name:"quited",type:"bool"},{internalType:"bool",name:"luckyReward",type:"bool"},{internalType:"bool",name:"loserReward",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"weth",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{stateMutability:"payable",type:"receive"}]},22928:function(e,t,n){"use strict";n.d(t,{Z:function(){return _},z:function(){return i}});var i,a=n(12249),o=n(5853),r=n(8113),s=n(63671),u=n(59201),d=n(68031),p=n(74439),l=n(89769),y=n(344),m=n(43009),c=n(79787),T=n(81900),w=n(94552),f=n(10433),v=n(20151),R=n(71549),g=n(40366),A=n(21707),h=n(81939),D=n(33657),b=n(40257);class _ extends s.bQ{static getCurrentRewardRound(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:m.Z.Time.oneWeek().toJSTime();return Math.floor((+new Date-e)/t)}static getCurrentRewardRoundTimestamp(e,t,n){let i=Math.floor(e/t)*t,a=t*n;return i+_.getCurrentRewardRound(e,a)*a}static getToday(){return 864e5*Math.floor(Date.now()/864e5)}static buildGetInfoWithCondition(e,t,n){let i=new A.C(e,g.K);return{daoAddress:e,calls:[i.roundExpire(t),i.totalVoteAmount(t),i.totalEthDone(t),i.quitAmount(t,BigInt(n)),i.pools(t)]}}static buildGetVoteRankInfo(e){let t=Number("3"),n=new A.C(e,g.K);return{daoAddress:e,calls:Array(t).fill(0).map((e,t)=>[n.top3Voted(t),n.top3VotedPre(t),n.top3VotedWithdraw(t)]),singleUserCallCount:t}}static buildGetNodeRankInfo(e){let t=Number("3"),n=new A.C(e,g.K);return{daoAddress:e,calls:Array(t).fill(0).map((e,t)=>[n.top3Node(t),n.top3NodePre(t),n.top3NodeWithdraw(t)]),singleUserCallCount:t}}static buildGetUserRankDetailInfo(e,t,n){let i=0;if(!e.length)return{daoAddress:t,userAddresses:e,calls:[],singleUserCallCount:i};let a=e.map(e=>{let{calls:a}=_.buildGetUserInfoWithCondition(e,t,n);return i=a.length,a}).flat();return{daoAddress:t,userAddresses:e,calls:a,singleUserCallCount:i}}static analyzeUserCurrentRoundSimpleInfo(e){return{...e.users,nodeType:Number(e.users.nodeType)}}static analyzeUserCurrentRoundVoteInfo(e){return{...e.votes,roundFirstVotedDate:m.Z.BlockTime.from(e.votes.roundFirstVotedDate).toJSTime(),claimedVotedLastTime:m.Z.BlockTime.from(e.votes.claimedVotedLastTime).toJSTime(),votedDatePre:m.Z.BlockTime.from(e.votes.votedDatePre).toJSTime(),isLuckyRewardClaimed:e.votes.luckyReward,isLoserRewardClaimed:e.votes.loserReward}}static analyzeUserCurrentRoundInfo(e){return{userInfo:_.analyzeUserCurrentRoundSimpleInfo(e),voteInfo:_.analyzeUserCurrentRoundVoteInfo(e),promotionInfo:e.promotions,voteAndAirDropReward:e.voteAndAirDropReward,effectiveVote:e.effectiveVote,effectiveEthDone:e.effectiveEthDone}}static analyzeUserDetailInfo(e,t,n){let i=[];for(let a=0;a<e.length/t;a++){let o=a*t,r=o+t,[s,u,d,p,l,y]=e.slice(o,r);i.push({..._.analyzeUserCurrentRoundInfo({users:s,votes:u,promotions:d,voteAndAirDropReward:p,effectiveVote:l,effectiveEthDone:y}),userAddress:n[a]||""})}return i}static buildGetUserInfoWithCondition(e,t,n){let i=new A.C(t,g.K),a=BigInt(m.Z.Time.fromTimestamp(_.getToday()).toUnixTime()),o=[i.users(e),i.votes(n,e),i.promotions(n,e),i.getVoteAndAirDropReward(e),i.calcEffectiveAirDrop(e,a),i.calcEffectiveReinvest(e,a)];return{daoAddress:t,userAddress:e,calls:o}}async getRankSimpleInfo(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=_.buildGetVoteRankInfo(e),a=_.buildGetNodeRankInfo(e);new A.C(e,g.K);let o=new A.z(R.Q.getTargetNet().chainId,R.Q.getDefaultProvider()),[r,s]=await Promise.all([this.getLastLuckyRecord({daoAddress:e}),o.all([i.calls.flat(),a.calls.flat()].flat())]),u=s.slice(0,i.calls.flat().length),d=u.map((e,t)=>t).filter(e=>e%i.singleUserCallCount==0).map(e=>({nodeAddress:u[e++],preNodeAddress:u[e++],nodeWithdrawed:u[e++]})),p=s.slice(i.calls.flat().length,i.calls.flat().length+a.calls.flat().length),l=p.map((e,t)=>t).filter(e=>e%i.singleUserCallCount==0).map(e=>({nodeAddress:p[e++],preNodeAddress:p[e++],nodeWithdrawed:p[e++]})),y=e=>w.N!==e||n;return{daoAddress:e,luckyRecords:r.map(e=>e.toJSON()).filter(e=>y(e.userAddress)),voteAddresses:d.map(e=>e.nodeAddress).filter(y),prevVoteAddresses:d.map(e=>e.preNodeAddress).filter(y),voteWithdrawed:d.map(e=>e.nodeWithdrawed).filter((e,t)=>y(d[t].preNodeAddress)),nodeAddresses:l.map(e=>e.nodeAddress).filter(y),prevNodeAddresses:l.map(e=>e.preNodeAddress).filter(y),nodeWithdrawed:l.map(e=>e.nodeWithdrawed).filter((e,t)=>y(l[t].preNodeAddress))}}async getLastLuckyRecord(e){var t,n;let a=new y.q$p,o=await a.getLuckyRewards({daoAddress:e.daoAddress}),r=new d.zv(o);return r.hasError()?[]:(null!==(n=null===(t=r.getData())||void 0===t?void 0:t.daoLuckyRewardVOs)&&void 0!==n?n:[]).map(e=>i.LastLuckyRecordAdapter.fromServer(e))}async getRankInfo(e){try{let t=_.buildGetUserRankDetailInfo([e.luckyAddresses,e.voteAddresses,e.nodeAddresses,e.userAddress?[e.userAddress]:[]].flat(),e.daoAddress,e.currentRoundNO);console.log("DaoService::getRankInfo detailReq:",t);let n=new A.z(R.Q.getTargetNet().chainId,R.Q.getDefaultProvider()),i=[];for(let a=0;a<t.userAddresses.length;a+=17){let o=t.userAddresses.slice(a,a+17).flatMap(n=>_.buildGetUserInfoWithCondition(n,t.daoAddress,e.currentRoundNO).calls),r=await n.all(o);i.push(...r)}let a=_.analyzeUserDetailInfo(i,t.singleUserCallCount,t.userAddresses),o=0,r=a.slice(o,e.luckyAddresses.length);o+=r.length;let s=a.slice(o,o+e.voteAddresses.length);o+=s.length;let u=a.slice(o,o+e.nodeAddresses.length);o+=u.length;let d=e.userAddress?a.slice(o,o+1)[0]:null;return{luckyData:r,voteData:s,nodeData:u,userData:d}}catch(e){throw console.error("DaoService::getRankInfo error:",e),e}}async getLuckyReward(e){let{daoAddress:t,userAddresses:n}=e,i=new A.C(t,g.K),a=n.map(e=>i.getLuckyReward(e)),o=new A.z(R.Q.getTargetNet().chainId,R.Q.getDefaultProvider());return await o.all(a)}async getUserVoteNodeRankReward(e){let{daoAddress:t,userAddress:n}=e,i=new A.C(t,g.K),a=[i.getLuckyReward(n),i.getTop3NodeReward(n),i.getTop3VotedReward(n)],o=new A.z(R.Q.getTargetNet().chainId,R.Q.getDefaultProvider()),[r,s,u]=await o.all(a);return{luckyReward:{reward:r},voteTopReward:{reward:u[0],rank:u[1]},nodeTopReward:{reward:s[0],rank:s[1]}}}async getCurrentRoundInfo(e){let t=R.Q.getDefaultProvider(),n=new A.z(R.Q.getTargetNet().chainId,t),i=m.Z.Time.fromTimestamp(e.targetWeek).toUnixTime(),{daoAddress:a,calls:o}=_.buildGetInfoWithCondition(e.daoAddress,e.currentRoundNO,i),[r,s,u,d,p]=await n.all([o].flat());return{daoAddress:a,roundExpire:m.Z.BlockTime.fromTimestamp(r).toJSTime(),totalVoteAmount:s,totalEthDone:u,quitAmount:d,pool:p}}async getUserCurrentRoundSimpleInfo(e){let t=[new A.C(e.daoAddress,g.K).users(e.userAddress)],n=R.Q.getDefaultProvider(),i=new A.z(R.Q.getTargetNet().chainId,n),[a]=await i.all(t);return{daoAddress:e.daoAddress,userAddress:e.userAddress,userInfo:_.analyzeUserCurrentRoundSimpleInfo({users:a})}}async getUserCurrentRoundInfo(e){let{calls:t}=_.buildGetUserInfoWithCondition(e.userAddress,e.daoAddress,e.currentRoundNO),n=R.Q.getDefaultProvider(),i=new A.z(R.Q.getTargetNet().chainId,n),[a,o,r,s,u,d]=await i.all(t);return{daoAddress:e.daoAddress,userAddress:e.userAddress,..._.analyzeUserCurrentRoundInfo({users:a,votes:o,promotions:r,voteAndAirDropReward:s,effectiveVote:u,effectiveEthDone:d})}}async getUserCancelAmount(e){return v.bR.connect(e.daoAddress,R.Q.getDefaultProvider()).getQuiteAmount(e.userAddress)}async getDaoChainInfo(e,t){var n;let i=R.Q.getDefaultProvider(),a=new A.z(null!=t?t:R.Q.getTargetNet().chainId,i),o=new A.C(e,g.K),[r,s,u,d,p,l,y,c,T,w,f,v,h,D,_,N,I,E,O,C,S,M,Z,U,k,L,V,P,F,x,z,W,B,J,j,H,q,K,Q,G,Y,$,X,ee]=await a.all([o.ONE_DAY(),o.VOTE_PRICE(),o.CANDIDATE_TOKEN_AMOUNT(),o.SUPER_TOKEN_AMOUNT(),o.VOTES_FOR_MASTER(),o.MASTER_FOR_SUPER(),o.ROUND_DURATION_MAX(),o.ROUND_DURATION_ADD(),o.AIRDROP_DURATION_CALC(),o.AIRDROP_DURATION_GET_LIMIT(),o.AIRDROP_DURATION_GET_MAX(),o.LOSER_POOL_REWARD_TIME_LIMIT(),o.COMMUNITY_DURATION(),o.COMMUNITY_REWARD_EXPIRE(),o.QUITE_DURATION(),o.DAILY_REWARD_RATE(),o.FIRST_PLACE_REWARD(),o.SECOND_PLACE_REWARD(),o.THIRD_PLACE_REWARD(),o.VOTE_RANK_REWARD_RATE(),o.COMMUNITY_REWARD_RATE(),o.FIRST_LUCKY_REWARD(),o.SECOND_LUCKY_REWARD(),o.THIRD_LUCKY_REWARD(),o.LOSER_POOL_RATE(),o.FUND_POOL_RATE(),o.LUCKY_POOL_RATE(),o.AIRDROP_POOL_RATE(),o.VOTE_RANK_POOL_RATE(),o.COMMUNITY_POOL_RATE(),o.QUIT_RATE(),o.CREATOR_FEE_RATE(),o.DEVELOPER_FEE_RATE(),o.token(),o.trinitySwap(),o.pair(),o.name(),o.daoFactory(),o.currentRoundNO(),o.createTime(),o.top3VotedDate(),o.top3VotedPoolPre(),o.top3NodeDate(),o.top3NodePoolPre()]),et=m.Z.BlockTime.fromUnixTimestamp(T).toJSTime();return{daoAddress:e,voteRankClaimDurationAdd:m.Z.BlockTime.fromUnixTimestamp(null!=r?r:m.Z.Time.fromString(null!==(n=b.env.NEXT_PUBLIC_DAO_RANK_DURATION_ADD)&&void 0!==n?n:"24H").toUnixTime()).toJSTime(),votePrice:s,applyCandidateEthAmount:u,applySuperEthAmount:d,votesForMaster:p,masterForSuper:l,roundDurationMax:m.Z.BlockTime.fromUnixTimestamp(y).toJSTime(),roundDurationAdd:m.Z.BlockTime.fromUnixTimestamp(c).toJSTime(),airdropDurationCalc:et,rewardRoundPass:Number(w),airdropDurationGetLimit:Number(w)*et,airdropDurationGetMax:m.Z.BlockTime.fromUnixTimestamp(f).toJSTime(),loserPoolRewardTimeLimit:m.Z.BlockTime.fromUnixTimestamp(v).toJSTime(),communityDuration:m.Z.Time.fromUnixTimestamp(h).toJSTime(),communityRewardDuration:m.Z.Time.fromUnixTimestamp(D).toJSTime(),cancelDurationTime:m.Z.Time.fromUnixTimestamp(_).toJSTime(),dailyRewardRate:Number(N)/100,firstPlaceRewardRate:Number(I)/100,secondPlaceRewardRate:Number(E)/100,thirdPlaceRewardRate:Number(O)/100,voteRankRewardRate:Number(C)/100,communityRewardRate:Number(S)/100,firstLuckyRewardRate:Number(M)/100,secondLuckyRewardRate:Number(Z)/100,thirdLuckyRewardRate:Number(U)/100,loserPoolRate:Number(k)/100,fundPoolRate:Number(L)/100,luckyPoolRate:Number(V)/100,airdropPoolRate:Number(P)/100,voteRankPoolRate:Number(F)/100,communityPoolRate:Number(x)/100,cancelRate:Number(z)/1e3,creatorFeeRate:Number(W)/100,developerFeeRate:Number(B)/100,tokenAddress:J,trinitySwap:j,pairAddress:H,name:q,daoFactoryAddress:K,currentRoundNO:Number(Q),createTime:m.Z.BlockTime.fromUnixTimestamp(G).toJSTime(),top3VotedDate:m.Z.BlockTime.fromUnixTimestamp(Y).toJSTime(),top3VotedPoolPre:$,top3NodeDate:m.Z.BlockTime.fromUnixTimestamp(X).toJSTime(),top3NodePoolPre:ee}}async getDaoList(e){var t;return d.zv.Ok(Array(null!==(t=e.pageSize)&&void 0!==t?t:16).fill({id:"1",name:"DAO",description:"DAO",createTime:+new Date}))}async getDaoListForNodeListFilter(e){var t;let n=new y.q$p(this.buildConfigure()),a=await n.getDaos({pageSize:e.pageSize,page:e.page,keyword:e.keyword}),o=new d.zv(a);return o.hasError()?o:d.zv.Ok((null!==(t=o.getData().daoVOs)&&void 0!==t?t:[]).map(i.DAOAdapter.fromServer).map(e=>e.toJSON()))}async getDaoSimpleInfo(e){let t=new y.q$p(this.buildConfigure()),n=new d.zv(await t.getDaoDetail({daoAddress:e.daoAddress}));if(n.hasError())return n;let a=n.getData();return d.zv.Ok(i.DAOAdapter.fromServer(a).toJSON())}async getNodeList(e){var t,n,a;let o=new y.q$p,r=await o.getNodes({daoAddress:e.daoAddress,pageSize:e.pageSize,page:e.page,keyword:null!==(n=e.keyword)&&void 0!==n?n:""}),s=new d.zv(r);return s.hasError()?s:d.zv.Ok((null!==(a=null===(t=r.data)||void 0===t?void 0:t.nodeVOs)&&void 0!==a?a:[]).map(t=>i.NodeAdapter.fromServer(t,e.daoAddress).toJSON()))}async getNodeDetail(e){let t=new y.q$p,n=await t.getNodeDetail({nodeAddress:e.nodeAddress,daoAddress:e.daoAddress}),a=new d.zv(n);return a.hasError()?a:d.zv.Ok(i.NodeInfoAdapter.getFactory({daoAddress:e.daoAddress})(a.getData()).toJSON())}async getVotingRecords(e){var t;let n=new y.q$p,a=await n.getVotes({daoAddress:e.daoAddress,nodeAddress:e.nodeAddress,page:e.page,pageSize:e.pageSize}),o=new d.zv(a);return o.hasError()?o:d.zv.Ok((null!==(t=o.getData().voteVOs)&&void 0!==t?t:[]).map(i.VoteRecordAdapterV2.fromServer))}async getMyVotingRecords(e){var t;let n=new y.q$p(this.buildConfigure()),a=await n.getMyVotes({daoAddress:e.daoAddress,nodeAddress:e.nodeAddress,page:e.page,pageSize:e.pageSize}),o=new d.zv(a);return o.hasError()?o:d.zv.Ok((null!==(t=o.getData().voteVOs)&&void 0!==t?t:[]).map(i.VoteRecordAdapterV2.fromServer))}async getRewardRecordList(e){var t,n;let a=new y.q$p,o=await a.getRewards({daoAddress:e.daoAddress,page:null!==(t=e.page)&&void 0!==t?t:1,pageSize:null!==(n=e.pageSize)&&void 0!==n?n:16,type:e.type}),r=new d.zv(o);return r.hasError()?r:d.zv.Ok(i.DAORewardRecordAdapter.fromServer(r.getData()))}async getOtherRewardRecordList(e){return e.type=l.r.RewardType.OTHERS_REWARD,this.getRewardRecordList(e)}async getUserRewardRecordList(e){var t,n;let a=new y.q$p(this.buildConfigure()),o=await a.getMyRewards({daoAddress:e.daoAddress,page:null!==(t=e.page)&&void 0!==t?t:1,pageSize:null!==(n=e.pageSize)&&void 0!==n?n:16,type:e.type}),r=new d.zv(o);return r.hasError()?r:d.zv.Ok(i.DAORewardRecordAdapter.fromServer(r.getData()))}constructor(e=new u.Z){super(),(0,a._)(this,"httpRequest",void 0),this.httpRequest=e}}(0,o.gn)([f.Z.Mark(),(0,o.w6)("design:type",Function),(0,o.w6)("design:paramtypes",[String,Boolean,Boolean]),(0,o.w6)("design:returntype",Promise)],_.prototype,"getRankSimpleInfo",null),(0,o.gn)([f.Z.Mark(),(0,o.w6)("design:type",Function),(0,o.w6)("design:paramtypes",[Object]),(0,o.w6)("design:returntype",Promise)],_.prototype,"getRankInfo",null),(0,o.gn)([f.Z.Mark(),(0,o.w6)("design:type",Function),(0,o.w6)("design:paramtypes",["undefined"==typeof DaoDto||void 0===DaoDto.LuckyRewardRequest?Object:DaoDto.LuckyRewardRequest]),(0,o.w6)("design:returntype",Promise)],_.prototype,"getLuckyReward",null),(0,o.gn)([f.Z.Mark(),(0,o.w6)("design:type",Function),(0,o.w6)("design:paramtypes",["undefined"==typeof DaoDto||void 0===DaoDto.VoteNodeRankRewardRequest?Object:DaoDto.VoteNodeRankRewardRequest]),(0,o.w6)("design:returntype",Promise)],_.prototype,"getUserVoteNodeRankReward",null),(0,o.gn)([f.Z.Mark(),(0,o.w6)("design:type",Function),(0,o.w6)("design:paramtypes",["undefined"==typeof DaoDto||void 0===DaoDto.CurrentRoundInfoRequest?Object:DaoDto.CurrentRoundInfoRequest]),(0,o.w6)("design:returntype",Promise)],_.prototype,"getCurrentRoundInfo",null),(0,o.gn)([f.Z.Mark(),(0,o.w6)("design:type",Function),(0,o.w6)("design:paramtypes",["undefined"==typeof DaoDto||void 0===DaoDto.UserCurrentRoundInfoRequest?Object:DaoDto.UserCurrentRoundInfoRequest]),(0,o.w6)("design:returntype",Promise)],_.prototype,"getUserCurrentRoundSimpleInfo",null),(0,o.gn)([f.Z.Mark(),(0,o.w6)("design:type",Function),(0,o.w6)("design:paramtypes",["undefined"==typeof DaoDto||void 0===DaoDto.UserCurrentRoundInfoRequest?Object:DaoDto.UserCurrentRoundInfoRequest]),(0,o.w6)("design:returntype",Promise)],_.prototype,"getUserCurrentRoundInfo",null),(0,o.gn)([f.Z.Mark(),(0,o.w6)("design:type",Function),(0,o.w6)("design:paramtypes",["undefined"==typeof DaoDto||void 0===DaoDto.UserCancelAmountRequest?Object:DaoDto.UserCancelAmountRequest]),(0,o.w6)("design:returntype",Promise)],_.prototype,"getUserCancelAmount",null),(0,o.gn)([f.Z.Mark(),(0,o.w6)("design:type",Function),(0,o.w6)("design:paramtypes",[String,Number]),(0,o.w6)("design:returntype",Promise)],_.prototype,"getDaoChainInfo",null),_=(0,o.gn)([r.ZP.Singleton,(0,o.w6)("design:type",Function),(0,o.w6)("design:paramtypes",["undefined"==typeof HttpRequest?Object:HttpRequest])],_),function(e){class t extends r.Vw.BaseDataAdapter{static fromServer(e){return new t().initialize(e)}toJSON(){return{userAddress:this.userAddress,votedAmount:this.votedAmount}}constructor(...e){super(...e),(0,a._)(this,"userAddress",void 0),(0,a._)(this,"votedAmount",void 0)}}e.LastLuckyRecordAdapter=t,(0,o.gn)([r.Vw.To(c.Z.builder_with_default_then_call(w.N,e=>e.unwrap()),"user"),(0,o.w6)("design:type",String)],t.prototype,"userAddress",void 0),(0,o.gn)([r.Vw.To(T.Z.builder_with_default_then_call(0,e=>h.Z.wei2eth(e.toFixed(0))),"votes"),(0,o.w6)("design:type",String)],t.prototype,"votedAmount",void 0);class n{static fromServer(e){return new n(e.daoAddress.charAt(e.daoAddress.length-1),e.daoName,e.daoImage,e.daoAddress,e.daoName,e.totalVotes)}toJSON(){return{id:this.id,name:this.name,icon:this.icon,address:this.address,symbol:this.symbol,totalVotes:this.totalVotes}}constructor(e,t,n,i,o,r){(0,a._)(this,"id",void 0),(0,a._)(this,"name",void 0),(0,a._)(this,"icon",void 0),(0,a._)(this,"address",void 0),(0,a._)(this,"symbol",void 0),(0,a._)(this,"totalVotes",void 0),this.id=e,this.name=t,this.icon=n,this.address=i,this.symbol=o,this.totalVotes=r}}e.DAOAdapter=n;class i{static fromServer(e,t){return new i(D.Z.SHA256(e.nodeAddress).toString(),t,e.nodeAddress,e.nodeType,0,e.createTime)}static fromDetailServer(e,t){return new i(D.Z.SHA256(e.nodeAddress).toString(),t,e.nodeAddress,l.r.NodeType.NONE,0,e.createTime)}toJSON(){return{id:this.id,daoAddress:this.daoAddress,walletAddress:this.walletAddress,nodeType:this.nodeType,totalVotes:this.totalVotes,createTime:1e3*this.createTime,timeShow:p.Z.dateFormat(new Date(1e3*this.createTime),"yyyy-MM-dd HH:mm:ss")}}constructor(e,t,n,i,o,r){(0,a._)(this,"id",void 0),(0,a._)(this,"daoAddress",void 0),(0,a._)(this,"walletAddress",void 0),(0,a._)(this,"nodeType",void 0),(0,a._)(this,"totalVotes",void 0),(0,a._)(this,"createTime",void 0),this.id=e,this.daoAddress=t,this.walletAddress=n,this.nodeType=i,this.totalVotes=o,this.createTime=r}}e.NodeAdapter=i;class s extends r.Vw.BaseDataAdapter{static getFactory(e){return t=>new s(e).initialize(t)}toJSON(){return{id:this.id.unwrap(),daoAddress:this.data.daoAddress,nodeAddress:this.nodeAddress.unwrap(),creationTime:this.creationTime.toJSTime()}}constructor(e){super(),(0,a._)(this,"data",void 0),(0,a._)(this,"nodeAddress",void 0),(0,a._)(this,"id",void 0),(0,a._)(this,"creationTime",void 0),this.data=e}}e.NodeInfoAdapter=s,(0,o.gn)([r.Vw.To(c.Z.builder_with_default(w.N)),(0,o.w6)("design:type",void 0===c.Z?Object:c.Z)],s.prototype,"nodeAddress",void 0),(0,o.gn)([r.Vw.To(c.Z.builder_with_default("0"),{originName:"nodeId"}),(0,o.w6)("design:type",void 0===c.Z?Object:c.Z)],s.prototype,"id",void 0),(0,o.gn)([r.Vw.To(m.Z.Time.fromTimestamp.bind(m.Z.Time),{originName:"createTime"}),(0,o.w6)("design:type",void 0===m.Z||void 0===m.Z.Time?Object:m.Z.Time)],s.prototype,"creationTime",void 0);class u extends r.Vw.BaseDataAdapter{get voteAmount(){return this.voteAmountInWei.div(10**this.options.decimals)}static fromServer(e){return new u({decimals:18}).initialize(e)}toJSON(){return{userAddress:this.userAddress.unwrap(),txHash:this.txHash.unwrap(),voteTime:this.voteTime.toJSTime(),voteNumber:this.voteNumber.valueOf(),voteAmount:this.voteAmount.toString()}}constructor(e){super(),(0,a._)(this,"options",void 0),(0,a._)(this,"userAddress",void 0),(0,a._)(this,"voteAmountInWei",void 0),(0,a._)(this,"voteNumber",void 0),(0,a._)(this,"voteTime",void 0),(0,a._)(this,"txHash",void 0),this.options=e}}e.VoteRecordAdapterV2=u,(0,o.gn)([r.Vw.To(c.Z.builder_with_default(w.N)),(0,o.w6)("design:type",void 0===c.Z?Object:c.Z)],u.prototype,"userAddress",void 0),(0,o.gn)([r.Vw.To(T.Z,{originName:"amount"}),(0,o.w6)("design:type",void 0===T.Z?Object:T.Z)],u.prototype,"voteAmountInWei",void 0),(0,o.gn)([r.Vw.To(Number),(0,o.w6)("design:type","undefined"==typeof Number?Object:Number)],u.prototype,"voteNumber",void 0),(0,o.gn)([r.Vw.To(m.Z.Time.timestampBuilder(),{originName:"timestamp"}),(0,o.w6)("design:type",void 0===m.Z||void 0===m.Z.Time?Object:m.Z.Time)],u.prototype,"voteTime",void 0),(0,o.gn)([r.Vw.To(c.Z.builder_with_default("")),(0,o.w6)("design:type",void 0===c.Z?Object:c.Z)],u.prototype,"txHash",void 0);class d{static fromServer(e){return new d(e.userAddress,e.txHash,m.Z.Time.fromTimestamp(e.timestamp).toJSTime(),e.voteNumber,e.amount.toString())}toViewModel(){return{userAddress:this.userAddress,txHash:this.txHash,voteTime:this.voteTime,voteNumber:this.voteNumber,voteAmount:this.voteAmount}}constructor(e,t,n,i,o){(0,a._)(this,"userAddress",void 0),(0,a._)(this,"txHash",void 0),(0,a._)(this,"voteTime",void 0),(0,a._)(this,"voteNumber",void 0),(0,a._)(this,"voteAmount",void 0),this.userAddress=e,this.txHash=t,this.voteTime=n,this.voteNumber=i,this.voteAmount=o}}e.VoteRecordAdapter=d;class y extends r.Vw.BaseDataAdapter{static fromServer(t){var n;return new y().initialize({...t,data:(null!==(n=t.daoRewardVOs)&&void 0!==n?n:[]).map(e.DAORewardRecordInfoAdapter.fromServer.bind(e.DAORewardRecordInfoAdapter))})}toJSON(){return{page:this.page,updateTime:this.updateTime.toJSTime(),data:this.data.map(e=>e.toJSON())}}constructor(){super(),(0,a._)(this,"page",void 0),(0,a._)(this,"updateTime",void 0),(0,a._)(this,"data",void 0)}}e.DAORewardRecordAdapter=y,(0,o.gn)([r.Vw.To(Number),(0,o.w6)("design:type",Number)],y.prototype,"page",void 0),(0,o.gn)([r.Vw.To(m.Z.BlockTime.timestampBuilder(()=>+new Date),{originName:"lastUpdateTime"}),(0,o.w6)("design:type",void 0===m.Z||void 0===m.Z.BlockTime?Object:m.Z.BlockTime)],y.prototype,"updateTime",void 0);class f extends r.Vw.BaseDataAdapter{idToString(){return this.id.unwrap()}addressToString(){return this.address.unwrap()}rewardToString(){return h.Z.wei2eth(this.reward.toFixed(0))}tokenRewardToString(){return h.Z.wei2eth(this.tokenReward.toFixed(0))}static fromServer(e){return new f().initialize(e)}toJSON(){return{id:this.idToString(),address:this.addressToString(),reward:this.rewardToString(),tokenReward:this.tokenRewardToString(),createTime:this.createTime.toJSTime(),type:this.type,typeText:"",amount:this.amount.toString(),tx:this.tx.unwrap()}}constructor(...e){super(...e),(0,a._)(this,"id",void 0),(0,a._)(this,"address",void 0),(0,a._)(this,"reward",void 0),(0,a._)(this,"tokenReward",new T.Z(0)),(0,a._)(this,"createTime",void 0),(0,a._)(this,"type",void 0),(0,a._)(this,"amount",void 0),(0,a._)(this,"tx",void 0)}}e.DAORewardRecordInfoAdapter=f,(0,o.gn)([r.Vw.To(c.Z.builder_with_default("0"),"txHash"),(0,o.w6)("design:type",void 0===c.Z?Object:c.Z)],f.prototype,"id",void 0),(0,o.gn)([r.Vw.To(c.Z.builder_with_default(w.N),"userAddress"),(0,o.w6)("design:type",void 0===c.Z?Object:c.Z)],f.prototype,"address",void 0),(0,o.gn)([r.Vw.To(T.Z.builder_with_default(0),{originName:"amount"}),(0,o.w6)("design:type",void 0===T.Z?Object:T.Z)],f.prototype,"reward",void 0),(0,o.gn)([r.Vw.To(T.Z.builder_with_default(0),{originName:"tokenAmount"}),(0,o.w6)("design:type",void 0===T.Z?Object:T.Z)],f.prototype,"tokenReward",void 0),(0,o.gn)([r.Vw.To(m.Z.Time.fromTimestamp.bind(m.Z.Time),{originName:"rewardTime"}),(0,o.w6)("design:type",void 0===m.Z||void 0===m.Z.Time?Object:m.Z.Time)],f.prototype,"createTime",void 0),(0,o.gn)([r.Vw.To(void 0,{originName:"rewardType"}),(0,o.w6)("design:type",void 0===l.r||void 0===l.r.RewardType?Object:l.r.RewardType)],f.prototype,"type",void 0),(0,o.gn)([r.Vw.To(T.Z),(0,o.w6)("design:type",void 0===T.Z?Object:T.Z)],f.prototype,"amount",void 0),(0,o.gn)([r.Vw.To(c.Z.builder_with_default(w.N),{originName:"txHash"}),(0,o.w6)("design:type",void 0===c.Z?Object:c.Z)],f.prototype,"tx",void 0);class v extends r.Vw.BaseDataAdapter{static getFactory(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:w.N;return t=>new v(e).initialize(t)}toJSON(){return{rank:this.rank,votes:Number(this.votes),beVotes:this.beVotes.toNumber(),reward:this.reward.toNumber(),rewardType:this.rewardType,address:this.userAddress}}constructor(e){super(),(0,a._)(this,"userAddress",void 0),(0,a._)(this,"rank",void 0),(0,a._)(this,"votes",void 0),(0,a._)(this,"beVotes",void 0),(0,a._)(this,"reward",void 0),(0,a._)(this,"rewardType",void 0),this.userAddress=e,this.beVotes=new T.Z(0),this.reward=new T.Z(0)}}e.DAOUserRankInfoAdapter=v,(0,o.gn)([r.Vw.To(T.Z.builder_with_default_then_call(0,e=>e.toInteger())),(0,o.w6)("design:type",Number)],v.prototype,"rank",void 0),(0,o.gn)([r.Vw.To(T.Z.builder_with_default_then_call(0,e=>h.Z.wei2eth(e.toFixed(0))),"voteCount"),(0,o.w6)("design:type",String)],v.prototype,"votes",void 0),(0,o.gn)([r.Vw.To(T.Z)],v.prototype,"beVotes",void 0),(0,o.gn)([r.Vw.To(T.Z)],v.prototype,"reward",void 0),(0,o.gn)([r.Vw.To(T.Z.builder_with_default_then_call(l.r.RankRewardType.LUCKY_REWARD,e=>e.toInteger()),{originName:"type"}),(0,o.w6)("design:type",void 0===l.r||void 0===l.r.RankRewardType?Object:l.r.RankRewardType)],v.prototype,"rewardType",void 0)}(i||(i={}))},56196:function(e,t,n){"use strict";n.d(t,{I:function(){return p}});var i=n(74439),a=n(43009),o=n(80149),r=n(56611),s=n(6178),u=n(69356),d=n(2265);function p(){let e=(0,s.T)(),t=(0,s.C)(e=>e.global),n=(0,s.C)(e=>e.user),{connectETHWallet:p}=d.useContext(o.Cv);async function l(){return n.ethInfo.isConnected?!!t.token||(e(u.Z.slice.actions.updateNeedBinding(!0)),!1):(e(u.Z.slice.actions.updateNeedBinding(!0)),await p(r.w3.WALLETCONNECT),!1)}async function y(){let o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.Z.Seconds.from(30);n.ethInfo.isConnected||(e(u.Z.slice.actions.updateNeedBinding(!0)),await p(r.w3.WALLETCONNECT)),t.token||await e(u.Z.slice.actions.updateNeedBinding(!0)),await function*(){let e=0;for(;!t.token;){if(e>=o.toJSTime())return!1;let t=a.Z.Time.oneSecond();yield i.Z.sleepForAnimationFrame(t),e+=t.toJSTime()}return!0}()}return{isLogin:!!t.token&&n.ethInfo.walletAddress,handleLogin:l,loginThen:y}}},56856:function(e,t,n){"use strict";n.d(t,{Z:function(){return m}});var i=n(6178),a=n(95665),o=n(2265),r=n(99376),s=n(88847),u=n(83123),d=n(43949),p=n(22928),l=n(74439),y=n(20605);function m(e){let{t}=(0,d.$G)(["dao"]),n=(0,r.useRouter)(),m=(0,i.T)(),c=(0,i.C)(e=>e.dao),T=(0,i.C)(e=>e.global),[w,f]=o.useState(null);async function v(){let e=new p.Z,t=await e.getDaoSimpleInfo(w?{daoAddress:w}:{});if(t.hasError()){let e=t.getError();return(0,u.L6)(e.msg),Promise.reject(e)}return t.getData()}async function R(){let e=await v();f(e.address),m(a.Z.slice.actions.updateSelectedDao(e));let t=new URLSearchParams(location.search);e.address!==t.get(a.Z.Params.DAO_ADDRESS)&&(t.set(a.Z.Params.DAO_ADDRESS,e.address),n.push("?".concat(t.toString())))}async function g(e){let t=new s.Z,n=await t.getSimpTokenInfoForDaoNodeApply({tokenAddress:e});if(n.hasError()){let e=n.getError();return(0,u.L6)(e.msg),Promise.reject(e)}return n.getData()}async function A(e){var t;if(!(e=null!=e?e:null===(t=c.daoContractInfo)||void 0===t?void 0:t.tokenAddress))throw Error("Token address is not set");let n=await g(e);return m(a.Z.slice.actions.updateTokenInfo(n)),n}function h(){m(a.Z.slice.actions.clearTokenInfo())}return o.useEffect(()=>{if(null===w||!T.isLoginStatusInitialized)return;let e=new AbortController;return l.Z.sleepForAnimationFrame(16).wait(()=>{e.signal.aborted||R()}),()=>{e.abort(y.Z.ReactError.useEffectDestroy())}},[T.isLoginStatusInitialized,w]),o.useEffect(()=>{if(!(null==e?void 0:e.autoTrigger))return;let t=new URLSearchParams(location.search).get(a.Z.Params.DAO_ADDRESS);if(!t)return f("");f(t)},[]),o.useEffect(()=>{var t;if(null==e?void 0:e.autoUpdateTokenInfo){if(!(null===(t=c.daoContractInfo)||void 0===t?void 0:t.tokenAddress))return h();A()}},[c.daoContractInfo]),{daoAddress:w,setDaoAddress:f,getInfo:v,updateInfo:R,getTokenInfo:g,updateTokenInfo:A,clearTokenInfo:h}}},72917:function(e,t,n){"use strict";n.d(t,{Z:function(){return D}});var i=n(10433),a=n(83123),o=n(20151),r=n(6178),s=n(95665),u=n(3876),d=n(94552),p=n(41662),l=n(43949),y=n(81939),m=n(68651),c=n(2265),T=n(56856),w=n(43009),f=n(13965),v=n(49481),R=n(22928),g=n(74439),A=n(20605),h=n(56196);function D(e,t){var n;let D=(0,r.T)();(0,r.C)(e=>e.global);let b=(0,r.C)(e=>e.user),_=(0,r.C)(e=>e.dao),{t:N}=(0,l.$G)(["common","dao"]);(0,T.Z)({autoTrigger:null==t?void 0:t.autoTrigger,autoUpdateTokenInfo:null==t?void 0:t.autoUpdateTokenInfo});let I=(0,v.Z)(b.ethInfo.walletAddress),E=(0,h.I)(),O=new R.Z;async function C(){var t,n;let i=null!==(n=null!=e?e:null===(t=_.nodeListFilters.selectedDao)||void 0===t?void 0:t.address)&&void 0!==n?n:"";if(!i)throw Error("No dao address");return O.getDaoChainInfo(i)}async function S(){let e=await C();D(s.Z.slice.actions.updateDaoContractInfo(e))}async function M(){i.Z.I("useDAOChainInfo::clearInfo"),D(s.Z.slice.actions.clearDaoContractInfo())}async function Z(t){var n,i,a;let o=null!==(a=null!=e?e:null===(n=_.nodeListFilters.selectedDao)||void 0===n?void 0:n.address)&&void 0!==a?a:"";if(!o)throw Error("No dao address");if(!(t=null!=t?t:_.nodeDetail.nodeAddress))throw Error("No node address");if(!(null===(i=_.daoContractInfo)||void 0===i?void 0:i.currentRoundNO))throw Error("No current round no");let r=await O.getUserCurrentRoundInfo({daoAddress:o,userAddress:t,currentRoundNO:_.daoContractInfo.currentRoundNO});D(s.Z.slice.actions.updateNodeChainInfo({...r,nodeAddress:t}))}async function U(){var t,n,i;let a=null!==(i=null!=e?e:null===(t=_.nodeListFilters.selectedDao)||void 0===t?void 0:t.address)&&void 0!==i?i:"";if(!a)throw Error("No dao address");let o=b.ethInfo.walletAddress;if(!o)return D(s.Z.slice.actions.clearUserInfo());if(!(null===(n=_.daoContractInfo)||void 0===n?void 0:n.currentRoundNO))throw Error("No current round no");let r=await O.getUserCurrentRoundInfo({daoAddress:a,userAddress:o,currentRoundNO:_.daoContractInfo.currentRoundNO});D(s.Z.slice.actions.updateUserInfo(r))}async function k(){var t;let n=e||(null===(t=_.nodeListFilters.selectedDao)||void 0===t?void 0:t.address)||"";if(!n)throw Error("No dao address");if(!_.daoContractInfo)throw Error("No current round no and create time");try{let e=_.daoContractInfo.createTime,t=_.daoContractInfo.voteRankClaimDurationAdd,i=_.daoContractInfo.rewardRoundPass,a=R.Z.getCurrentRewardRoundTimestamp(e,t,i),o=await O.getCurrentRoundInfo({daoAddress:n,currentRoundNO:_.daoContractInfo.currentRoundNO,targetWeek:a});D(s.Z.slice.actions.updateCurrentRoundInfo(o))}catch(e){(0,a.L6)(new a.HU(e,N("FailedToUpdateCurrentRoundInfo")).asToastMessage())}}async function L(){D(s.Z.slice.actions.clearCurrentRoundInfo())}async function V(e,t){var n,i;let a=null!==(i=null!=e?e:null===(n=_.nodeListFilters.selectedDao)||void 0===n?void 0:n.address)&&void 0!==i?i:"";if(!a)throw Error("No dao address");if(!(t=null!=t?t:b.ethInfo.walletAddress))throw Error("No user address");let[o,r]=await O.getUserCancelAmount({daoAddress:a,userAddress:t});D(s.Z.slice.actions.updateUserCancelAmount({canCancelAmount:o,maxCancelAmount:r}))}async function P(e){var t,n,r,s,l;if(!(null===(t=_.nodeListFilters.selectedDao)||void 0===t?void 0:t.address)){(0,a.L6)(N("dao:NoSelectedDao"));return}if(!_.nodeDetail.nodeAddress){(0,a.L6)(N("dao:NoSelectedNode"));return}if(!await E.handleLogin())return;if(await u.ru(null!==(s=null===(n=_.nodeCurrentRoundInfo)||void 0===n?void 0:n.userInfo.parent)&&void 0!==s?s:d.N)===await u.ru(b.ethInfo.walletAddress)){(0,a.L6)(N("dao:CannotVoteToEach"));return}let c=new m.Z(y.Z.wei2eth(null!==(l=null===(r=_.daoContractInfo)||void 0===r?void 0:r.votePrice)&&void 0!==l?l:p.fi("0.1"))).multipliedBy(e);if(c.gte(b.ethInfo.walletBalance)){(0,a.L6)(N("common:NotEnoughBalance"));return}let T=f.r.getInstance(),w=y.Z.getInstance(T.getProvider()),v=await w.getSigner(),R=o.bR.connect(_.nodeListFilters.selectedDao.address,v);try{let t=p.fi(c.toString()),n=await R.vote(_.nodeDetail.nodeAddress,e.toString(),{value:t}),i=await n.wait();(0,a.x9)(N("VoteSuccess"));let o=Promise.all([I.updateETHBalance(),Z(),U()]);return{txRes:n,receipt:i,updateDataPromise:o}}catch(e){(0,a.L6)(new a.HU(e,N("VoteFailed")).asToastMessage()),i.Z.E(e);return}}async function F(){var e,t;if(!(null===(e=_.nodeListFilters.selectedDao)||void 0===e?void 0:e.address)){(0,a.L6)(N("NoSelectedDao"));return}if(!_.nodeDetail.nodeAddress){(0,a.L6)(N("NoSelectedNode"));return}if(!await E.handleLogin())return;let n=f.r.getInstance(),r=y.Z.getInstance(n.getProvider()),s=await r.getSigner(),u=o.bR.connect(null===(t=_.nodeListFilters.selectedDao)||void 0===t?void 0:t.address,s);try{await u.quit()}catch(e){(0,a.L6)(new a.HU(e,N("CancelVoteFailed")).asToastMessage()),i.Z.E(e);return}(0,a.x9)(N("CancelVoteSuccess"))}async function x(){var e;let t=null===(e=_.daoCurrentRoundInfo)||void 0===e?void 0:e.daoAddress;if(!t)throw Error("DAO address not found!");if(!await E.handleLogin())return;let n=f.r.getInstance(),r=y.Z.getInstance(n.getProvider()),s=await r.getSigner(),u=o.bR.connect(t,s);try{let e=await u.restart();await e.wait(),(0,a.x9)(N("SuccessfullyOpenDAO")),S()}catch(e){(0,a.L6)(new a.HU(e,N("FailedToRestartDAO")).asToastMessage()),i.Z.E("useDAOChainInfo::reopenDAO",e)}}return c.useEffect(()=>{var e;if(!(null==t?void 0:t.autoTrigger)||!(null===(e=_.nodeListFilters.selectedDao)||void 0===e?void 0:e.address))return;let n=g.Z.sleepForAnimationFrame(w.Z.Milliseconds.from(16));return n.wait(()=>{S().catch(e=>{(0,a.L6)(new a.HU(e,N("FailedToUpdateInfo")).asToastMessage()),i.Z.E("useDAOChainInfo::updateInfo",e)})}),()=>{n.cancel(A.Z.ReactError.useEffectDestroy())}},[null===(n=_.nodeListFilters.selectedDao)||void 0===n?void 0:n.address]),c.useEffect(()=>{var e;if(!(null==t?void 0:t.autoTrigger)||!(null===(e=_.nodeListFilters.selectedDao)||void 0===e?void 0:e.address)||!_.daoContractInfo)return;let n=g.Z.sleepForAnimationFrame(w.Z.Milliseconds.from(16));return n.wait(()=>{k().catch(e=>{(0,a.L6)(new a.HU(e,N("FailedToUpdateCurrentRoundInfo")).asToastMessage()),i.Z.E("useDAOChainInfo::updateCurrentRoundInfo",e)})}),()=>{n.cancel(A.Z.ReactError.useEffectDestroy())}},[_.daoContractInfo,_.nodeListFilters.selectedDao]),c.useEffect(()=>{var e,n;if(!(null==t?void 0:t.autoTrigger))return;if(!b.ethInfo.walletAddress||!(null===(e=_.daoContractInfo)||void 0===e?void 0:e.currentRoundNO)||!(null===(n=_.nodeListFilters.selectedDao)||void 0===n?void 0:n.address)){D(s.Z.slice.actions.clearUserInfo());return}let o=g.Z.sleepForAnimationFrame(w.Z.Milliseconds.from(16));return o.wait(()=>{U().catch(e=>{(0,a.L6)(new a.HU(e,N("FailedToUpdateUserCurrentRoundInfo")).asToastMessage()),i.Z.E("useDAOChainInfo::updateUserCurrentRoundInfo",e)})}),()=>{o.cancel(A.Z.ReactError.useEffectDestroy())}},[_.daoContractInfo,b.ethInfo.walletAddress]),{getInfo:C,updateInfo:S,clearInfo:M,updateUserCurrentRoundInfo:U,updateNodeCurrentRoundInfo:Z,updateCurrentRoundInfo:k,clearCurrentRoundInfo:L,updateCancelInfo:V,voteForNode:P,cancelVote:F,reopenDAO:x}}},17104:function(){}}]);