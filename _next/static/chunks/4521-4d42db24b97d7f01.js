"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4521],{89522:function(e,o,n){n.d(o,{Z:function(){return s}});var t=n(12249),r=n(5853),d=n(68031),a=n(59201),i=n(8113),l=n(344),u=n(63671);class s extends u.bQ{async loginWallet(e){var o;let n=new a.M,t=new l.M2y(this.buildConfigure(n)),r=new d.zv(await t.loginByWallet({walletLoginRequestVO:{walletAddress:e.walletAddress,signature:e.signature,timestamp:e.timestamp.toString()}},{signal:null===(o=e.abortController)||void 0===o?void 0:o.signal}));return r.hasError()||n.afterHandler(r.response,{url:"/login",data:e}),r}async getUserInfo(e){var o;let n=new Headers;e.Authorization&&n.set("Authorization",e.Authorization),delete e.Authorization;let t=new l.M2y(this.buildConfigure());return new d.zv(await t.getUserInfo({signal:null===(o=e.abortController)||void 0===o?void 0:o.signal,headers:n}))}async uploadFile(e){var o;let n=new FormData;n.append("file",e.file);let t=new l.M2y(this.buildConfigure()),r=await t.upload({file:e.file},{signal:null===(o=e.abortController)||void 0===o?void 0:o.signal,body:n});return new d.zv(r)}async addNFTInfo(e){var o;e.Authorization,delete e.Authorization;let n=new l.lG6(this.buildConfigure());return new d.zv(await n.uploadHash({uploadHashRequestVO:e},{signal:null===(o=e.abortController)||void 0===o?void 0:o.signal}))}constructor(e=new a.Z){super(),(0,t._)(this,"httpRequest",void 0),this.httpRequest=e}}s=(0,r.gn)([i.ZP.Singleton,(0,r.w6)("design:type",Function),(0,r.w6)("design:paramtypes",["undefined"==typeof HttpRequest?Object:HttpRequest])],s)},14931:function(e,o,n){n.d(o,{Z:function(){return y}});var t=n(6178),r=n(72917),d=n(71549),a=n(21707),i=n(10433),l=n(95665),u=n(89769),s=n(81939),v=n(68651),c=n(2265),w=n(83123),f=n(43949),R=n(344),m=n(22928),I=n(68031),g=n(89522),p=n(20605),h=n(74439);function y(e,o){let{t:n}=(0,f.$G)(["dao"]),y=(0,t.T)(),C=(0,t.C)(e=>e.global),D=(0,t.C)(e=>e.dao),Z=(0,t.C)(e=>e.user);(0,r.Z)(e);let T=new m.Z,k=new g.Z;async function A(e){var o;if(!(e=null!=e?e:null===(o=D.nodeListFilters.selectedDao)||void 0===o?void 0:o.address))throw Error("No dao address");let n=await T.getRankSimpleInfo(e);return y(l.Z.slice.actions.updateSimpleRankInfo({luckyUsers:n.luckyRecords.map(e=>e.userAddress),voteUsers:n.voteAddresses,prevVoteUsers:n.prevVoteAddresses,voteWithdrawed:n.voteWithdrawed,nodeUsers:n.nodeAddresses,prevNodeUsers:n.prevNodeAddresses,nodeWithdrawed:n.nodeWithdrawed})),n}function L(e,o){var n,t,r,d,a,i,l,u,c,w,f;let R=new v.Z(s.Z.wei2eth(null!==(r=null===(n=D.daoCurrentRoundInfo)||void 0===n?void 0:n.pool.luckyPool)&&void 0!==r?r:0n)).multipliedBy(null!==(d=null===(t=D.daoContractInfo)||void 0===t?void 0:t.firstLuckyRewardRate)&&void 0!==d?d:.02),m=null!==(a=null==(o=null!=o?o:D.rankInfo.luckyUsers)?void 0:o.length)&&void 0!==a?a:0;switch(e){case 0:return new v.Z(0);case 1:return R.multipliedBy(null!==(l=null===(i=D.daoContractInfo)||void 0===i?void 0:i.firstLuckyRewardRate)&&void 0!==l?l:.6);case 2:return R.multipliedBy(null!==(c=null===(u=D.daoContractInfo)||void 0===u?void 0:u.secondLuckyRewardRate)&&void 0!==c?c:.3);default:return 0===m?new v.Z(0):R.multipliedBy(null!==(f=null===(w=D.daoContractInfo)||void 0===w?void 0:w.thirdLuckyRewardRate)&&void 0!==f?f:.1).div(m)}}function N(e,o){let n=new v.Z(s.Z.wei2eth(e));return e=>{var t,r,d,a,i,l;if(o[e-1])return new v.Z(0);switch(e){case 0:default:return new v.Z(0);case 1:return n.multipliedBy(null!==(r=null===(t=D.daoContractInfo)||void 0===t?void 0:t.firstPlaceRewardRate)&&void 0!==r?r:.6);case 2:return n.multipliedBy(null!==(a=null===(d=D.daoContractInfo)||void 0===d?void 0:d.secondPlaceRewardRate)&&void 0!==a?a:.3);case 3:return n.multipliedBy(null!==(l=null===(i=D.daoContractInfo)||void 0===i?void 0:i.thirdPlaceRewardRate)&&void 0!==l?l:.1)}}}function F(){var e,o,n,t,r;let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"currnet",a=null!==(t="currnet"===d?null===(e=D.daoCurrentRoundInfo)||void 0===e?void 0:e.pool.voteRankPool:null===(o=D.daoContractInfo)||void 0===o?void 0:o.top3VotedPoolPre)&&void 0!==t?t:0n;return new v.Z(a.toString()).multipliedBy(null!==(r=null===(n=D.daoContractInfo)||void 0===n?void 0:n.voteRankRewardRate)&&void 0!==r?r:0)}function E(){var e,o,n,t,r;let d=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"currnet",a=null!==(t="currnet"===d?null===(e=D.daoCurrentRoundInfo)||void 0===e?void 0:e.pool.communityPool:null===(o=D.daoContractInfo)||void 0===o?void 0:o.top3NodePoolPre)&&void 0!==t?t:0n;return new v.Z(a.toString()).multipliedBy(null!==(r=null===(n=D.daoContractInfo)||void 0===n?void 0:n.communityRewardRate)&&void 0!==r?r:0)}function b(e,o){var n,t;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"currnet";e=null!=e?e:D.rankInfo.prevVoteUsers,o=null!==(n=null!=o?o:D.rankInfo.voteWithdrawed)&&void 0!==n?n:[];let d=F(r);return null!==(t=null==e?void 0:e.map((e,o)=>o+1).map((n,t)=>{let a=N(BigInt(d.toFixed(0)),"pre"===r?o:[])(n);return{rank:n,address:e[t],reward:a}}))&&void 0!==t?t:[]}function U(e,o){var n,t;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"currnet";e=null!=e?e:D.rankInfo.prevNodeUsers,o=null!==(n=null!=o?o:D.rankInfo.nodeWithdrawed)&&void 0!==n?n:[];let d=E(r);return null!==(t=null==e?void 0:e.map((e,o)=>o+1).map((n,t)=>{let a=N(BigInt(d.toFixed(0)),"pre"===r?o:[])(n);return{rank:n,address:e[t],reward:a}}))&&void 0!==t?t:[]}async function S(o,n){var t,r,i,l;if(!(n=null!==(i=null!=n?n:e)&&void 0!==i?i:null===(t=D.nodeListFilters.selectedDao)||void 0===t?void 0:t.address))throw Error("No dao address");if(o=null!==(l=null!=o?o:null===(r=D.rankInfo)||void 0===r?void 0:r.luckyUsers)&&void 0!==l?l:[],!D.daoContractInfo)throw Error("No current round no");let u=D.daoContractInfo.currentRoundNO,s=m.Z.buildGetUserRankDetailInfo(o,n,u),v=d.Q.getDefaultProvider(),c=new a.z(d.Q.getTargetNet().chainId,v),w=await c.all(s.calls);return m.Z.analyzeUserDetailInfo(w,s.singleUserCallCount,s.userAddresses)}function P(e,o){return e.map((e,n)=>{let t=n+1;return{rank:t,address:e.userAddress,votes:Number(s.Z.wei2eth(e.voteInfo.votedAmount)),beVotes:0,reward:o(t)}})}async function O(e){var o,n,t;if(!(e=null!=e?e:null===(o=D.nodeListFilters.selectedDao)||void 0===o?void 0:o.address))throw Error("No dao address");if(!D.daoContractInfo)throw Error("No dao contract info");if(!D.daoCurrentRoundInfo)throw Error("No current round info");let r=D.daoContractInfo.currentRoundNO,d=await A(e);C.token&&Z.ethInfo.walletAddress&&W(d.nodeWithdrawed);let a=d.luckyRecords.map(e=>e.userAddress),i=await T.getRankInfo({...d,luckyAddresses:a,voteAddresses:d.voteAddresses,nodeAddresses:d.nodeAddresses,userAddress:Z.ethInfo.walletAddress,currentRoundNO:r}),u=P(i.luckyData,e=>L(e,a).toNumber()),c={daoAddress:e,userAddresses:u.map(e=>e.address)},w=await T.getLuckyReward(c),f=u.map((e,o)=>{var n;return{...e,votes:Number(d.luckyRecords[o].votedAmount),reward:new v.Z(s.Z.wei2eth(null!==(n=w[o])&&void 0!==n?n:0n)).toNumber()}}),R=F(),m=P(n=i.voteData,e=>N(BigInt(R.toFixed(0)),[])(e).toNumber()).map((e,o)=>{let t=Number(s.Z.wei2eth(n[o].promotionInfo.sonVotedAmountToday));return{...e,beVotes:t}}),I=E(),g=P(t=i.nodeData,e=>N(BigInt(I.toFixed(0)),[])(e).toNumber()).map((e,o)=>{let n=Number(s.Z.wei2eth(t[o].promotionInfo.sonVotedAmountWeek));return{...e,beVotes:n}});y(l.Z.slice.actions.updateDetailRankInfo({luckyRank:f,voteRank:m,nodeRank:g}))}async function V(){y(l.Z.slice.actions.clearRankInfo()),y(l.Z.slice.actions.clearUserRankInfo())}async function W(e){var o,t,r,d,a,s;let v=null===(o=D.nodeListFilters.selectedDao)||void 0===o?void 0:o.address,c=Z.ethInfo.walletAddress;if(!v)throw Error(n("NoSelectedDao"));if(!c)throw Error(n("Can't found user address"));new m.Z;let f=new R.q$p(k.buildConfigure()),g=await f.getMyRank({daoAddress:v}),p=new I.zv(g);if(p.hasError()){let e=p.getError();(0,w.L6)(e.msg),i.Z.E(e)}let h=null!==(d=p.getData().daoMyRankList)&&void 0!==d?d:[],C=m.z.DAOUserRankInfoAdapter.getFactory(c),T=h.map(C).map(e=>e.toJSON());y(l.Z.slice.actions.updateUserRankInfo(T));let A=new Map(T.map(e=>[e.rewardType,e.rank]));y(l.Z.slice.actions.updateUserRankRewardInfo([[u.r.RankRewardType.LUCKY_REWARD,L(A.get(u.r.RankRewardType.LUCKY_REWARD)).toNumber()],[u.r.RankRewardType.VOTE_TOP_REWARD,N(null!==(a=null===(t=D.daoContractInfo)||void 0===t?void 0:t.top3NodePoolPre)&&void 0!==a?a:0n,e)(A.get(u.r.RankRewardType.VOTE_TOP_REWARD)).toNumber()],[u.r.RankRewardType.NODE_TOP_REWARD,N(null!==(s=null===(r=D.daoContractInfo)||void 0===r?void 0:r.top3NodePoolPre)&&void 0!==s?s:0n,e)(A.get(u.r.RankRewardType.NODE_TOP_REWARD)).toNumber()]]))}return c.useEffect(()=>{var e;if(!(null==o?void 0:o.autoTrigger))return;if(!(null===(e=D.nodeListFilters.selectedDao)||void 0===e?void 0:e.address)||!D.daoCurrentRoundInfo){V();return}let t=h.Z.sleepForAnimationFrame(16);return t.wait(()=>O()).catch(e=>{(0,w.L6)(new w.HU(e,n("GetRankDataFailed")).asToastMessage()),i.Z.E("updateRankInfo",e)}),()=>{t.cancel(p.Z.ReactError.useEffectDestroy()),V()}},[D.daoCurrentRoundInfo,C.token,Z.ethInfo.walletAddress]),{updateRankSimpleInfo:A,updateUserRankInfo:W,calcLuckyRewardInLocal:L,getLuckyRewardInLocal:function(e){var o;return null!==(o=null==(e=null!=e?e:D.rankInfo.luckyUsers)?void 0:e.map((e,o)=>o+1).map((o,n)=>({rank:o,address:e[n],reward:L(o,e)})))&&void 0!==o?o:[]},getUserLuckyRewardInLocal:function(e,o){var n,t;e=null!=e?e:Z.ethInfo.walletAddress;let r=null!==(t=(o=null!==(n=null!=o?o:D.rankInfo.luckyUsers)&&void 0!==n?n:[]).indexOf(e))&&void 0!==t?t:-1;return L(-1===r?4:r+1,o)},calcTop3RewardInLocal:N,getVoteTop3Rawards:b,getUserVoteTopReward:function(e,o){var n,t;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"currnet";return e=null!=e?e:Z.ethInfo.walletAddress,(null!==(t=b(void 0,o=null!==(n=null!=o?o:D.rankInfo.voteWithdrawed)&&void 0!==n?n:[],r).find(o=>o.address===e))&&void 0!==t?t:{reward:new v.Z(0)}).reward},getNodeTop3Rawards:U,getUserNodeTopReward:function(e,o){var n,t;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"currnet";return e=null!=e?e:Z.ethInfo.walletAddress,(null!==(t=U(void 0,o=null!==(n=null!=o?o:D.rankInfo.nodeWithdrawed)&&void 0!==n?n:[],r).find(o=>o.address===e))&&void 0!==t?t:{reward:new v.Z(0)}).reward},getLastInvestorsDetailInfo:S,updateRankInfo:O,clearRankInfo:V}}},94521:function(e,o,n){n.d(o,{Z:function(){return y}});var t=n(2265),r=n(72917),d=n(68651),a=n(43009),i=n(6178),l=n(74439),u=n(43949),s=n(81939),v=n(83123),c=n(13965),w=n(20151),f=n(10433),R=n(14931),m=n(20605),I=n(22928),g=n(95665),p=n(344),h=n(68031);function y(e){var o,n,y,C,D,Z,T,k,A,L,N,F,E,b,U,S,P,O,V,W,x,B,M,_,z,H,q,G,$,Q,j,J,K,Y,X,ee,eo,en,et,er,ed,ea,ei,el,eu,es,ev,ec,ew,ef,eR,em,eI;let eg=(0,i.T)(),{t:ep}=(0,u.$G)(["dao"]),eh=(0,i.C)(e=>e.global),ey=(0,i.C)(e=>e.dao),eC=(0,i.C)(e=>e.user),eD=(0,r.Z)();(0,R.Z)(void 0,{autoTrigger:e.autoTrigger});let[eZ,eT]=t.useState(0),ek=null!==(Q=null===(o=ey.daoContractInfo)||void 0===o?void 0:o.voteRankClaimDurationAdd)&&void 0!==Q?Q:0,eA=null!==(j=null===(n=ey.daoContractInfo)||void 0===n?void 0:n.createTime)&&void 0!==j?j:0,eL=null!==(J=null===(y=ey.daoContractInfo)||void 0===y?void 0:y.rewardRoundPass)&&void 0!==J?J:0,eN=null!==(K=null===(C=ey.daoContractInfo)||void 0===C?void 0:C.airdropDurationGetLimit)&&void 0!==K?K:0,eF=I.Z.getCurrentRewardRoundTimestamp(eA,ek,eL),eE=null!==(Y=null===(D=ey.daoCurrentRoundInfo)||void 0===D?void 0:D.roundExpire)&&void 0!==Y?Y:0,eb=null!==(X=null===(Z=ey.userInfo)||void 0===Z?void 0:Z.voteAndAirDropReward.clairReward)&&void 0!==X?X:0n,eU=eZ||(null!==(ee=null===(T=ey.userInfo)||void 0===T?void 0:T.voteInfo.roundFirstVotedDate)&&void 0!==ee?ee:0),eS=eE>0?l.Z.convertTimeDifference(new Date(eU+eN-eh.currentTime),{includeDays:!1}):0,eP=eb>0n,eO=Math.floor(eh.currentTime/ek)*ek+ek,eV=ey.userRewardInfo.voteTopReward.gt(0)?l.Z.convertTimeDifference(new Date(eO-eh.currentTime),{includeDays:!1}):0,eW=ey.userRewardInfo.voteTopReward.gt(0);null===(k=ey.daoContractInfo)||void 0===k||k.communityDuration,null===(A=ey.daoContractInfo)||void 0===A||A.top3NodeDate,null===(L=ey.daoContractInfo)||void 0===L||L.communityDuration;let ex=eF+(null!==(et=null===(N=ey.daoContractInfo)||void 0===N?void 0:N.communityRewardDuration)&&void 0!==et?et:0),eB=ey.userRewardInfo.nodeTopReward.gt(0)?l.Z.convertTimeDifference(new Date(ex-eh.currentTime),{includeDays:!1}):0,eM=ey.userRewardInfo.nodeTopReward.gt(0),e_=l.Z.convertTimeDifference(new Date((null!==(er=null===(F=ey.daoCurrentRoundInfo)||void 0===F?void 0:F.roundExpire)&&void 0!==er?er:0)-eh.currentTime),{includeDays:!1}),ez=l.Z.convertTimeDifference(new Date((null!==(ed=null===(E=ey.daoCurrentRoundInfo)||void 0===E?void 0:E.roundExpire)&&void 0!==ed?ed:0)+(null!==(ea=null===(b=ey.daoContractInfo)||void 0===b?void 0:b.loserPoolRewardTimeLimit)&&void 0!==ea?ea:0)-eh.currentTime),{includeDays:!1}),eH=0===e_&&0!==ez&&ey.userRewardInfo.luckyReward.gt(0)&&(null===(U=ey.userInfo)||void 0===U?void 0:U.voteInfo.isLuckyRewardClaimed)===!1,eq=(null!==(ei=null===(S=ey.daoCurrentRoundInfo)||void 0===S?void 0:S.totalVoteAmount)&&void 0!==ei?ei:0n)-(null!==(el=null===(P=ey.daoCurrentRoundInfo)||void 0===P?void 0:P.totalEthDone)&&void 0!==el?el:0n),eG=(null===(O=ey.userInfo)||void 0===O?void 0:O.voteInfo.isLoserRewardClaimed)?new d.Z(0):new d.Z((null!==(eu=null===(V=ey.userInfo)||void 0===V?void 0:V.voteInfo.votedAmount)&&void 0!==eu?eu:0n).toString()).minus((null!==(es=null===(W=ey.userInfo)||void 0===W?void 0:W.voteInfo.ethDone)&&void 0!==es?es:0n).toString()).div((0n===eq?1n:eq).toString()).multipliedBy((null!==(ev=null===(x=ey.daoCurrentRoundInfo)||void 0===x?void 0:x.pool.loserPool)&&void 0!==ev?ev:0n).toString()),e$=(null===(B=ey.userInfo)||void 0===B?void 0:B.voteInfo.isLoserRewardClaimed)?new d.Z(0):new d.Z((null!==(ec=null===(M=ey.userInfo)||void 0===M?void 0:M.voteInfo.votedAmount)&&void 0!==ec?ec:0n).toString()).minus((null!==(ew=null===(_=ey.userInfo)||void 0===_?void 0:_.voteInfo.ethDone)&&void 0!==ew?ew:0n).toString()).div((0n===eq?1n:eq).toString()).multipliedBy((null!==(ef=null===(z=ey.daoCurrentRoundInfo)||void 0===z?void 0:z.pool.loserPoolETH)&&void 0!==ef?ef:0n).toString()),eQ=l.Z.convertTimeDifference(new Date((null!==(eR=null===(H=ey.daoCurrentRoundInfo)||void 0===H?void 0:H.roundExpire)&&void 0!==eR?eR:0)-eh.currentTime),{includeDays:!1}),ej=l.Z.convertTimeDifference(new Date((null!==(em=null===(q=ey.daoCurrentRoundInfo)||void 0===q?void 0:q.roundExpire)&&void 0!==em?em:0)+(null!==(eI=null===(G=ey.daoContractInfo)||void 0===G?void 0:G.loserPoolRewardTimeLimit)&&void 0!==eI?eI:0)-eh.currentTime),{includeDays:!1}),eJ=0===eQ&&0!==ej&&(eG.gt(0)||e$.gt(0)),eK=[{title:ep("DAOReward"),reward:s.Z.wei2eth(eb),hasDetails:!0,countdown:0===eS?"":eS.toFormated(),claimable:eP,handleClaim:eY},{title:ep("VoteTopReward"),reward:ey.userRewardInfo.voteTopReward.toString(),hasDetails:!1,countdown:0===eV?"":eV.toFormated(),claimable:eW,handleClaim:eX},{title:ep("NodeTopReward"),reward:ey.userRewardInfo.nodeTopReward.toString(),hasDetails:!1,countdown:0===eB?"":eB.toFormated(),claimable:eM,handleClaim:e0},{title:ep("LuckyReward"),reward:ey.userRewardInfo.luckyReward.toString(),hasDetails:!1,countdown:0!==e_?e_.toFormated():0!==ez?ez.toFormated():"",claimable:eH,handleClaim:e1},{title:ep("OtherReward"),tokenReward:eG.gt(0)?s.Z.wei2eth(eG.toFixed(0,d.Z.ROUND_DOWN)):"0",hasDetails:!1,countdown:0!==eQ?eQ.toFormated():0!==ej?ej.toFormated():"",claimable:eJ,handleClaim:e2}];async function eY(){var e;let o=null===(e=ey.nodeListFilters.selectedDao)||void 0===e?void 0:e.address;if(!o){(0,v.L6)(ep("NoSelectedDao"));return}if(!eP)return;let n=c.r.getInstance(),t=s.Z.getInstance(n.getProvider()),r=w.bR.connect(o,await t.getSigner());try{let e=await r.claimVoteAndAirDropReward();await e.wait(),(0,v.x9)(ep("ClaimVoteAndAirDropRewardSuccess")),e9(o),e6()}catch(e){(0,v.L6)(new v.HU(e,ep("ClaimVoteAndAirDropRewardFailed")).asToastMessage()),f.Z.E(e)}}async function eX(){var e,o;if(!(null===(e=ey.nodeListFilters.selectedDao)||void 0===e?void 0:e.address)){(0,v.L6)(ep("NoSelectedDao"));return}let n=c.r.getInstance(),t=s.Z.getInstance(n.getProvider()),r=w.bR.connect(null===(o=ey.nodeListFilters.selectedDao)||void 0===o?void 0:o.address,await t.getSigner());try{let e=await r.claimTop3VotedReward();await e.wait(),(0,v.x9)(ep("ClaimNodeTopRewardSuccess")),e6()}catch(e){(0,v.L6)(new v.HU(e,ep("ClaimNodeTopRewardFailed")).asToastMessage()),f.Z.E(e)}}async function e0(){var e,o;if(!(null===(e=ey.nodeListFilters.selectedDao)||void 0===e?void 0:e.address))return(0,v.L6)(ep("NoSelectedDao"));let n=c.r.getInstance(),t=s.Z.getInstance(n.getProvider()),r=w.bR.connect(null===(o=ey.nodeListFilters.selectedDao)||void 0===o?void 0:o.address,await t.getSigner());try{let e=await r.claimTop3NodeReward();await e.wait(),(0,v.x9)(ep("ClaimNodeTopRewardSuccess")),e6()}catch(e){(0,v.L6)(new v.HU(e,ep("ClaimNodeTopRewardFailed")).asToastMessage()),f.Z.E(e)}}async function e1(){var e,o;if(!(null===(e=ey.nodeListFilters.selectedDao)||void 0===e?void 0:e.address))return(0,v.L6)(ep("NoSelectedDao"));let n=c.r.getInstance(),t=s.Z.getInstance(n.getProvider()),r=w.bR.connect(null===(o=ey.nodeListFilters.selectedDao)||void 0===o?void 0:o.address,await t.getSigner());try{let e=await r.claimLuckyReward();await e.wait(),(0,v.x9)(ep("ClaimLuckyRewardSuccess")),e6()}catch(e){(0,v.L6)(new v.HU(e,ep("ClaimLuckyRewardFailed")).asToastMessage()),f.Z.E(e)}}async function e2(){var e,o;if(!(null===(e=ey.nodeListFilters.selectedDao)||void 0===e?void 0:e.address))return(0,v.L6)(ep("NoSelectedDao"));let n=c.r.getInstance(),t=s.Z.getInstance(n.getProvider()),r=w.bR.connect(null===(o=ey.nodeListFilters.selectedDao)||void 0===o?void 0:o.address,await t.getSigner());try{let e=await r.claimLoserReward();await e.wait(),(0,v.x9)(ep("ClaimOtherRewardSuccess")),e6()}catch(e){(0,v.L6)(new v.HU(e,ep("ClaimOtherRewardFailed")).asToastMessage()),f.Z.E(e)}}async function e6(){var o;await eD.updateInfo(),null===(o=e.handleAfterClaim)||void 0===o||o.call(e)}async function e3(e){var o;let n=new I.Z;if(!(e=null!=e?e:null===(o=ey.nodeListFilters.selectedDao)||void 0===o?void 0:o.address)){(0,v.L6)(ep("NoSelectedDao"));return}try{let o=await n.getUserVoteNodeRankReward({userAddress:eC.ethInfo.walletAddress,daoAddress:e});eg(g.Z.slice.actions.updateUserRewardInfo({luckyReward:new d.Z(s.Z.wei2eth(o.luckyReward.reward)),voteTopReward:new d.Z(s.Z.wei2eth(o.voteTopReward.reward)),nodeTopReward:new d.Z(s.Z.wei2eth(o.nodeTopReward.reward))}))}catch(e){(0,v.L6)(new v.HU(e,ep("GetUserVoteNodeRankRewardFailed")).asToastMessage()),f.Z.E(e)}}async function e9(e){let o=new I.Z,n=new p.q$p(o.buildConfigure()),t=await n.getLastClaimTime({daoAddress:e}),r=new h.zv(t);if(r.hasError()){let e=r.getError();(0,v.L6)(new v.HU(e,ep("GetLastClaimTimeFailed")).asToastMessage()),f.Z.E(e);return}eT(a.Z.Time.fromTimestamp(r.getData()).toJSTime())}function e4(e,o){let n=Number("120");return new d.Z(s.Z.wei2eth(e)).multipliedBy(n).div(100).minus(s.Z.wei2eth(o))}return t.useEffect(()=>{if(!e.autoTrigger||!ey.daoContractInfo||!eC.ethInfo.walletAddress)return;let o=l.Z.sleepForAnimationFrame(16);return o.wait(()=>{var e;if(null===(e=ey.daoContractInfo)||void 0===e?void 0:e.daoAddress)return e3(ey.daoContractInfo.daoAddress)}),()=>{o.cancel(m.Z.ReactError.useEffectDestroy())}},[ey.daoContractInfo,eC.ethInfo.walletAddress]),t.useEffect(()=>{var e,o;(null===(e=ey.nodeListFilters.selectedDao)||void 0===e?void 0:e.address)&&eh.token&&e9(null===(o=ey.nodeListFilters.selectedDao)||void 0===o?void 0:o.address)},[null===($=ey.nodeListFilters.selectedDao)||void 0===$?void 0:$.address,eh.token]),{rewardItems:eK,handleVoteAirdropClaim:eY,handleVoteRankClaim:eX,handleNodeRankClaim:e0,handleLuckyClaim:e1,estimatePendingReward:e4,estimateUserPendingReward:function(){var e,o,n,t;return e4(null!==(n=null===(e=ey.userInfo)||void 0===e?void 0:e.voteInfo.votedAmount)&&void 0!==n?n:0n,null!==(t=null===(o=ey.userInfo)||void 0===o?void 0:o.voteInfo.ethDone)&&void 0!==t?t:0n)},getClaimNodeRewardCountdown:function(){var e,o;let n=eF+(null!==(o=null===(e=ey.daoContractInfo)||void 0===e?void 0:e.communityDuration)&&void 0!==o?o:0),t=l.Z.convertTimeDifference(new Date(n-eh.currentTime),{includeDays:!1});return"object"==typeof t?t.toFormated():""}}}}}]);